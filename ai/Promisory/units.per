(defrule
	(true)
=>
	(set-goal traintransport no)
	(set-goal trainvillager no)
	(set-goal traincart no)
	(set-goal trainmonk no)
	(set-goal trainunique no)
	(set-goal trainpetard no)
	(set-goal traintrebuchet no)
	(set-goal trainram no)
	(set-goal trainmangonel no)
	(set-goal trainscorpion no)
	(set-goal trainbombard no)
	(set-goal trainfish no)
	(set-goal traingalley no)
	(set-goal trainfire no)
	(set-goal traindemo no))
(defrule
	(true)
=>
	(set-goal trainturtle no)
	(set-goal trainlongboat no)
	(set-goal traincannon no)
	(set-goal trainarcher no)
	(set-goal trainskirm no)
	(set-goal trainhandcannon no)
	(set-goal traincavarcher no)
	(set-goal trainslinger no)
	(set-goal trainpike no)
	(set-goal trainchamp no)
	(set-goal traineagle no)
	(set-goal traincondottiero no)
	(set-goal traincamel no)
	(set-goal trainknight no)
	(set-goal trainhussar no))
(defrule
	(true)
=>
	(set-goal traincog no)
	(set-goal traincaravel no)
	(set-goal trainbattle no)
	(set-goal traingenitour no)
	(set-goal trainsteppe no)
	(set-goal trainflemish no))
;=========================================================
; Civilian units
;=========================================================
;=========================================================
; Transport ships
;=========================================================
(defrule
;	(up-compare-const migration-style == 1)
	(goal migration-state 1)
(or	(building-available town-center); for now
(or	(civilian-population >= min-number-vills);
(or	(up-research-status c: castle-age >= research-pending); ==
(or	(up-idle-unit-count idle-type-villager >= 20)
(or	(housing-headroom < 5);
(or	(population >= del-civ-pop)
	(strategic-number sn-current-age >= imperial)))))))
	(unit-type-count-total transport-ship < 1)
=>
	(set-goal traintransport yes))
(defrule
	(goal inseln yes)
(or	(population >= max-civ-pop)
	(goal attacking yes))
(or	(soldier-count >= 10)
(or	(up-compare-goal my-mpop g:>= allowed-num-military)
	(population >= siege-pop)))
(or	(strategic-number sn-military-superiority >= 1)
	(strategic-number teamsuperiority >= 1))
	(goal underattack no)
	(unit-type-count-total transport-ship < maxtransports)
	(unit-type-count-total transport-ship < 6); for now
=>
	(set-goal traintransport yes))
(defrule
	(goal inseln yes)
(or	(strategic-number sn-current-age >= imperial)
(or	(population >= max-civ-pop)
	(goal attacking yes)))
(or	(population >= max-civ-pop)
	(and	(soldier-count >= 10)
		(or	(up-compare-goal navycount >= 10)
			(goal enemy-boats no))))
	(unit-type-count-total transport-ship < maxtransports)
	(unit-type-count-total transport-ship < 6); for now
=>
	(set-goal traintransport yes))
(defrule
	(goal inseln yes)
(or	(and	(population >= siege-pop)
		(strategic-number sn-current-age >= imperial))
(or	(up-compare-goal my-mpop g:>= allowed-num-military)
	(goal attacking yes)))
	(soldier-count >= 2)
	(unit-type-count-total transport-ship < maxtransports)
	(unit-type-count-total transport-ship < 1)
=>
	(set-goal traintransport yes))
(defrule
	(players-unit-type-count any-human transport-ship >= 1)
(or	(and	(population >= siege-pop)
		(strategic-number sn-current-age >= imperial))
(or	(up-compare-goal my-mpop g:>= allowed-num-military)
	(goal attacking yes)))
	(soldier-count >= 2)
	(unit-type-count-total transport-ship < maxtransports)
	(unit-type-count-total transport-ship < 1)
=>
	(set-goal traintransport yes))
;=========================================================
; Villagers
;=========================================================
(defrule
	(strategic-number sn-current-age <= dark);	(up-research-status c: feudal-age == research-available)
	(up-timer-status FDrop == timer-running)
	(building-type-count town-center == 1)
(or	(up-pending-objects c: villager >= 1)
	(up-research-status c: ri-loom == research-pending))
=>
	(up-jump-rule 17))
(defrule
(or	(strategic-number sn-current-age > dark)
	(and	(up-compare-goal total-food-amount >= 700); 750
		(and	(up-research-status c: feudal-age == research-available)
			(or	(up-compare-goal total-food-amount >= 900)
				(or	(unit-type-count-total villager >= 15); 24
					(up-compare-goal enemyState > dark))))))
=>
	(up-jump-rule 4))
(defrule
	(true)
=>
	(set-goal temporary-goal feudal-food)
	(up-modify-goal temporary-goal c:- 20)
	(up-modify-goal temporary-goal2 g:= temporary-goal)
	(up-modify-goal temporary-goal2 c:- 20)
	(up-modify-goal temporary-goal c:max feudal-f2)
	(up-modify-goal temporary-goal2 c:max feudal-f2))
(defrule
(or	(up-compare-goal total-food-amount < castle-feco); 400
(or	(unit-type-count-total villager < 19)
(or	(and	(up-compare-goal total-food-amount < feudal-food)
		(unit-type-count-total villager < 20))
(or	(and	(up-compare-goal total-food-amount g:< temporary-goal)
		(unit-type-count-total villager < 21))
	(and	(up-compare-goal total-food-amount g:< temporary-goal2)
		(unit-type-count-total villager < 22))))))
=>
	(set-goal trainvillager yes))
(defrule
(or	(up-compare-goal strategy == r-flush)
	(up-compare-goal strategy == usual))
(or	(unit-type-count-total villager < 20)
(or	(and	(up-compare-goal total-food-amount < feudal-food)
		(unit-type-count-total villager < 21))
	(and	(up-compare-goal total-food-amount g:< temporary-goal2)
		(unit-type-count-total villager < 22))))
=>
	(set-goal trainvillager yes))
(defrule
(not	(civ-selected khmer))
	(up-compare-goal enemyState <= dark)
	(up-compare-goal strategy-type <= feudal-war)
	(building-type-count-total barracks <= 0);	(building-type-count-total lumber-camp <= 1)
	(wood-amount < mb-cost); 100
	(goal maa-var yes)
	(up-compare-goal strategy-type2 != water)
	(up-compare-goal milunits != no)
	(unit-type-count-total villager < 21)
	(civilian-population < 23)
(or	(up-compare-goal strategy != s-flush)
	(unit-type-count-total villager < 20))
	(up-compare-goal total-food-amount < feudal-fs)
=>
	(set-goal trainvillager yes)); end jump
(defrule
	(up-research-status c: feudal-age == research-available)
	(up-compare-goal strategy != fast-imp)
(or	(and	(up-compare-goal total-food-amount >= 840)
		(unit-type-count-total villager >= 29))
	(and	(up-compare-goal total-food-amount >= 1050)
		(or	(up-compare-goal total-food-amount >= 1260)
			(unit-type-count-total villager >= 25))))
=>
	(up-jump-rule 11))
(defrule
(or	(goal strategy sling)
	(up-compare-goal strategy-type == feudal-war));)
	(up-research-status c: feudal-age == research-available)
(or	(unit-type-count-total villager >= 25); 26
	(up-compare-goal total-food-amount >= feudal-food)); 450
	(up-compare-goal total-food-amount >= feudal-f2); 400
	(unit-type-count-total villager >= 21)
;(or	(and	(up-compare-goal total-food-amount >= 800); 720
;		(unit-type-count-total fishing-ship >= 5)); 7
=>
	(up-jump-rule 10))
;(defrule
;	(unit-type-count-total villager < darkvills); max
;(or	(and	(up-compare-goal total-food-amount < 765); 810
;		(unit-type-count-total villager < 29))
;	(and	(up-compare-goal total-food-amount < 830); 860
;		(unit-type-count-total villager < 28)))
;	(strategic-number sn-current-age == dark)
;;(or
;	(nand	(up-compare-goal enemy-goal == flush)
;		(goal strategy usual)); test
;;	(goal strategy drush))
;=>
;	(set-goal trainvillager yes))
;(defrule
;	(unit-type-count-total villager < darkvills); max
;(or	(and	(up-compare-goal total-food-amount < 905); 910)
;		(unit-type-count-total villager < 27))
;	(and	(up-compare-goal total-food-amount < 970); 960
;		(unit-type-count-total villager < 26)))
;	(strategic-number sn-current-age == dark)
;;(or
;	(nand	(up-compare-goal enemy-goal == flush)
;		(goal strategy usual)); test
;;	(goal strategy drush))
;=>
;	(set-goal trainvillager yes))
(defrule
	(goal strategy fast-imp)
	(unit-type-count-total villager < fi-vills)
=>
	(set-goal temporary-goal 1235)
	(up-modify-goal temporary-goal c:+ dark-vill-buffer)
	(up-modify-goal temporary-goal2 g:= temporary-goal)
	(up-modify-goal temporary-goal2 c:- 65)
	(up-modify-goal temporary-goal3 g:= temporary-goal2)
	(up-modify-goal temporary-goal3 c:- 65))
(defrule
	(goal strategy fast-imp)
	(unit-type-count-total villager < fi-vills)
(or	(unit-type-count-total villager < 29)
	(up-compare-goal total-food-amount g:< temporary-goal))
(or	(unit-type-count-total villager < 30)
	(up-compare-goal total-food-amount g:< temporary-goal2))
(or	(unit-type-count-total villager < 31)
	(up-compare-goal total-food-amount g:< temporary-goal3))
	(strategic-number sn-current-age == dark)
=>
	(set-goal trainvillager yes))
(defrule
	(true)
=>
	(set-goal temporary-goal 845)
	(up-modify-goal temporary-goal c:+ dark-vill-buffer))
(defrule
	(unit-type-count-total villager >= 24)
	(goal milunits no)
	(strategic-number sn-stone-gatherer-percentage <= 0)
=>
	(up-modify-goal temporary-goal c:- 65)); 50
(defrule
	(unit-type-count-total villager >= 24)
(or	(research-available ri-loom)
	(up-research-status c: ri-wheel-barrow >= research-pending))
=>
	(up-modify-goal temporary-goal c:- 35)); 50
(defrule
	(true)
=>
	(up-modify-goal temporary-goal2 g:= temporary-goal)
	(up-modify-goal temporary-goal2 c:- 65)
	(up-modify-goal temporary-goal3 g:= temporary-goal2)
	(up-modify-goal temporary-goal3 c:- 65)
	(up-modify-goal temporary-goal4 g:= temporary-goal3)
	(up-modify-goal temporary-goal4 c:- 65)
	(up-modify-goal temporary-goal5 g:= temporary-goal4)
	(up-modify-goal temporary-goal5 c:- 65)
	(up-modify-goal temporary-goal6 g:= temporary-goal5)
	(up-modify-goal temporary-goal6 c:- 65)
	(up-modify-goal temporary-goal2 c:max feudal-food)
	(up-modify-goal temporary-goal3 c:max feudal-food)
	(up-modify-goal temporary-goal4 c:max feudal-food)
	(up-modify-goal temporary-goal5 c:max feudal-food)
	(up-modify-goal temporary-goal6 c:max feudal-food))
(defrule
	(unit-type-count-total villager < darkvills)
(or	(unit-type-count-total villager < 25)
	(up-compare-goal total-food-amount g:< temporary-goal)); 900-650
(or	(unit-type-count-total villager < 26)
	(up-compare-goal total-food-amount g:< temporary-goal2)); 850
(or	(unit-type-count-total villager < 27)
	(up-compare-goal total-food-amount g:< temporary-goal3)); 800
	(strategic-number sn-current-age == dark)
=>
	(set-goal trainvillager yes))
(defrule
	(unit-type-count-total villager < darkvills)
	(up-compare-goal total-food-amount g:< temporary-goal)
	(up-compare-goal total-food-amount g:< temporary-goal2)
	(up-compare-goal total-food-amount g:< temporary-goal3)
(or	(unit-type-count-total villager < 28)
	(up-compare-goal total-food-amount g:< temporary-goal4))
(or	(unit-type-count-total villager < 29)
	(up-compare-goal total-food-amount g:< temporary-goal5))
(or	(unit-type-count-total villager < 30)
	(up-compare-goal total-food-amount g:< temporary-goal6))
	(strategic-number sn-current-age == dark)
=>
	(set-goal trainvillager yes))
(defrule
	(unit-type-count-total villager < darkvills)
	(goal drushmicro yes)
	(up-compare-goal trainvillager != yes)
	(up-compare-goal total-food-amount < 750)
(or	(and	(building-type-count-total farm g:< maxfarms)
		(building-type-count-total farm < ten-pop))
	(up-compare-goal total-food-amount < 700))
(or	(up-compare-goal strategy-type >= castle-war)
	(up-compare-goal total-food-amount < feudal-f2))
	(strategic-number sn-current-age == dark)
=>
	(set-goal trainvillager yes))
(defrule
	(unit-type-count-total villager < darkvills)
;	(up-compare-goal total-food-amount < 1035); 470
(or	(unit-type-count-total villager < 21)
(or	(nand	(up-compare-goal enemy-goal == flush)
		(goal strategy usual)); test
	(up-compare-goal total-food-amount < feudal-f2)))
	(unit-type-count-total villager < 25); 24
	(strategic-number sn-current-age == dark)
=>
	(set-goal trainvillager yes)); end jump
(defrule
	(civ-selected malay)
;	(up-compare-goal strategy-type <= feudal-war)
	(up-compare-goal total-food-amount < feudal-food)
(or	(unit-type-count-total villager < 24)
	(not	(players-civ target-player malay)))
	(unit-type-count-total villager < 26)
	(unit-type-count-total villager < darkvills)
=>
	(set-goal trainvillager yes)); end big jump
;=========================================================
(defrule
(or	(goal position-goal pocket)
(or	(up-compare-goal enemyState <= dark)
;(or	(players-current-age every-enemy <= dark-age); test
	(goal strategy drush)));)
	(up-compare-goal strategy-type != feudal-war);
	(building-type-count town-center >= 2)
	(unit-type-count-total villager < 36)
	(up-compare-goal total-food-amount < 440)
	(up-compare-goal total-food-amount < feudal-food)
	(strategic-number sn-current-age <= dark)
=>
	(set-goal trainvillager yes))
;=========================================================
(defrule
(or	(strategic-number sn-current-age == dfeudal)
	(goal strategy sling))
	(strategic-number sn-current-age >= dfeudal)
=>
	(set-goal trainvillager yes))
;=========================================================
(defrule
(or	(unit-type-count-total villager < 18)
(or	(up-compare-goal total-food-amount < castle-food)
	(up-compare-goal total-gold-amount < castle-gold)))
	(strategic-number sn-current-age == feudal)
=>
	(set-goal trainvillager yes))
;=========================================================
(defrule
	(strategic-number sn-current-age == feudal)
(not	(civ-selected khmer))
=>
	(up-get-fact unit-type-count villager feudalvills)
	(up-modify-goal feudalvills c:+ 2)
;	(up-chat-data-to-player my-player-number "feudalvills: %d" g: feudalvills)
	(disable-self))
(defrule
	(strategic-number sn-current-age == feudal)
(not	(civ-selected khmer))
	(up-research-status c: ri-loom == research-pending)
	(up-compare-goal feudalvills >= 2)
=>
	(up-modify-goal feudalvills c:- 1)
	(disable-self))
(defrule
(not	(can-research-with-escrow castle-age))
	(strategic-number sn-current-age == feudal)
	(unit-type-count-total villager g:< feudalvills)
=>
	(set-goal trainvillager yes))
;=========================================================
(defrule
	(up-pending-objects c: villager <= 0)
	(up-compare-goal total-food-amount >= 770)
;	(building-type-count blacksmith == 0)
	(building-type-count archery-range == 0)
	(building-type-count stable == 0)
	(building-type-count market == 0)
	(strategic-number sn-current-age == feudal)
=>
	(set-goal trainvillager yes))
;=========================================================
(defrule
	(up-pending-objects c: villager <= 0)
	(up-compare-goal total-food-amount >= 770)
	(building-type-count blacksmith == 0); test
	(strategic-number sn-current-age == feudal)
=>
	(set-goal trainvillager yes))
;=========================================================
(defrule
	(up-pending-objects c: villager <= 0)
	(up-compare-goal total-food-amount >= 620)
;	(gold-amount >= 150)
	(up-compare-goal strategy-type >= castle-war)
	(building-type-count blacksmith == 0)
	(strategic-number sn-current-age == feudal)
=>
	(set-goal trainvillager yes))
;=========================================================
(defrule
	(up-pending-objects c: villager <= 0)
	(up-compare-goal total-food-amount >= 850)
	(gold-amount <= 170)
	(up-compare-goal total-gold-amount < castle-gold)
;(not	(can-research-with-escrow castle-age)) ^ stops CA research delay with the new queuesys
	(strategic-number sn-current-age == feudal)
=>
	(set-goal trainvillager yes))
;=========================================================
#load-if-defined WONDER-RACE
(defrule
(or	(unit-type-count-total villager < 50)
	(and	(strategic-number sn-current-age >= imperial)
		(unit-type-count-total villager < 60)))
	(strategic-number sn-current-age >= fcastlea)
=>
	(set-goal trainvillager yes))
#else
(defrule
(or	(unit-type-count-total villager < 9)
(or	(population < max-civ-pop)
	(and	(unit-type-count-total villager < 50)
		(population < del-civ-pop))))
	(civilian-population < up-max-civ)
	(unit-type-count-total villager < min-number-vills); 60
	(strategic-number sn-current-age >= fcastlea)
=>
	(set-goal trainvillager yes))
;=========================================================
(defrule
	(up-compare-goal strategy-type == feudal-war)
	(strategic-number sn-current-age >= dfeudal)
=>
	(set-goal trainvillager yes))
;=========================================================
(defrule
	(unit-type-count-total villager < min-number-vills); 60
(or	(and	(strategic-number sn-current-age >= fcastlea)
		(dropsite-min-distance wood < 20))
	(unit-type-count-total villager < 2))
=>
	(set-goal trainvillager yes))
;=========================================================
(defrule
(or	(strategic-number sn-current-age < fcastlea)
	(dropsite-min-distance wood >= 20))
=>
	(up-jump-rule 1))
(defrule
(or	(population < up-max-civ); test
(or	(wood-amount < 400)
(or	(food-amount < 400)
(or	(gold-amount < 400)
(or	(up-compare-goal excessWood < 200)
(or	(up-compare-goal excessFood < 200)
	(up-compare-goal excessGold < 200)))))))
=>
	(set-goal trainvillager yes))
;=========================================================
(defrule
	(up-compare-goal custom-civ-pop < res-vills-d);	(unit-type-count-total villager < res-vills-d)
	(dropsite-min-distance wood < 20)
	(up-compare-goal tradeunits < 40)
(or	(population-headroom >= 65); test
(or	(wood-amount < 3200)
(or	(food-amount < 3200)
	(gold-amount < 3200))))
	(strategic-number sn-current-age >= fcastlea)
=>
	(set-goal trainvillager yes))
;=========================================================
(defrule
	(up-compare-goal custom-civ-pop > res-vills-c);	(unit-type-count-total villager < res-vills-c)
	(dropsite-min-distance wood < 20)
	(up-compare-goal tradeunits < 40)
(or	(population-headroom >= 70); test
(or	(wood-amount < 2400)
(or	(food-amount < 2400)
	(gold-amount < 2400))))
	(strategic-number sn-current-age >= fcastlea)
=>
	(set-goal trainvillager yes))
;=========================================================
(defrule
	(up-compare-goal custom-civ-pop > res-vills-b);	(unit-type-count-total villager < res-vills-b)
	(dropsite-min-distance wood < 20)
	(up-compare-goal tradeunits < 40)
(or	(population-headroom >= 75); test
(or	(wood-amount < 1500)
(or	(food-amount < 1500)
	(gold-amount < 1500))))
	(strategic-number sn-current-age >= fcastlea)
=>
	(set-goal trainvillager yes))
;=========================================================
(defrule
	(up-compare-goal custom-civ-pop > res-vills-a);	(unit-type-count-total villager < res-vills-a)
	(dropsite-min-distance wood < 20)
	(up-compare-goal tradeunits < 40)
(or	(population-headroom >= 80); test
(or	(wood-amount < 700)
(or	(food-amount < 700)
	(gold-amount < 700))))
	(strategic-number sn-current-age >= fcastlea)
=>
	(set-goal trainvillager yes))
;=========================================================
(defrule
	(goal trainvillager yes)
	(research-available feudal-age)
	(unit-type-count-total villager >= 22)
	(up-compare-goal strategy-type == feudal-war)
	(up-compare-goal total-food-amount >= feudal-food)
	(goal position-goal flank)
=>
	(set-goal trainvillager no))
;=========================================================
; Trade Carts
;=========================================================
(defrule
(or	(up-compare-goal tradecarts != yes)
(or	(players-building-type-count every-ally market <= 0)
(or	(up-compare-goal verbuendete <= 0)
(or	(up-compare-goal tradeunits >= maxcartspop)
	(up-compare-goal tradeunits >= maxcartssize)))))
=>
	(up-jump-rule 14))
(defrule
(or	(goal underattack yes)
(or	(and	(unit-type-count-total 178 >= 8)
		(unit-type-count-total 205 >= 8))
	(or	(unit-type-count-total 178 >= 16)
		(unit-type-count-total 205 >= 16))))
=>
	(up-jump-rule 13))
(defrule
	(strategic-number sn-current-age >= cimperial)
	(up-compare-goal excessWood < cartmb-cost)
	(population < max-civ-pop)
(or	(strategic-number sn-military-superiority <= 0)
	(strategic-number teamsuperiority <= 0))
	(building-type-count-total stable < 4)
	(building-type-count-total archery-range < 4)
	(building-type-count-total barracks < 4)
	(building-type-count-total stable < number-stables)
	(building-type-count-total archery-range < number-archery-ranges)
	(building-type-count-total barracks < number-barracks)
=>
	(up-jump-rule 12))
(defrule
	(game-time >= 90)
(or	(game-time >= 2520)
	(and	(strategic-number sn-current-age >= fcastlea)
		(up-gaia-type-count c: gold <= 1)))
	(goal underattack no)
(or	(building-type-count-total market >= 2)
(or	(up-compare-goal excessWood >= cartmb-cost)
	(up-compare-goal increase-ts != market)))
	(unit-type-count-total 178 <= 0)
	(unit-type-count-total 205 <= 0)
	(population < max-civ-pop)
=>
	(up-jump-rule 3))
(defrule
	(strategic-number sn-current-age <= feudal)
	(up-research-status c: ri-caravan <= research-unavailable)
(or	(up-compare-goal excessWood < 1000)
	(and	(dropsite-min-distance gold < 16); 24
		(dropsite-min-distance gold >= 0)))
=>
	(up-jump-rule 10))
(defrule
	(game-time < 2520)
	(up-gaia-type-count c: gold >= 12)
	(unit-type-count villager-gold >= 15)
	(players-building-type-count every-ally market <= 1)
	(up-research-status c: ri-caravan <= research-available)
	(up-research-status c: ri-silk-road <= research-available)
(or	(up-compare-goal excessWood < cartmb-cost)
	(up-compare-goal excessGold < 275))
=>
	(up-jump-rule 9))
(defrule
(or	(and	(up-research-status c: imperial-age <= research-unavailable)
		(and	(strategic-number sn-current-age < cimperial)
			(up-compare-goal excessWood < 300)))
	(and	(or	(unit-type-count villager-gold >= 1)
				(up-compare-goal tradeunits >= 1))
		(and	(up-research-status c: imperial-age == research-available)
			(and	(gold-amount < imperial-gs)
				(gold-amount < imperial-gc)))))
=>
	(up-jump-rule 1)); end mini jump
(defrule
	(goal dreitc yes)
(or	(up-research-status c: imperial-age >= research-pending)
(or	(game-time >= 2520)
(or	(population >= max-civ-pop)
(or	(civilian-population >= up-max-civ)
(or	(building-type-count-total town-center >= 4)
(or	(wood-amount >= tc-100-wood)
	(stone-amount < tc-stone)))))))
	(up-compare-goal tradeunits < 48)
=>
	(set-goal traincart yes))
(defrule
	(strategic-number sn-current-age >= cimperial)
;	(wood-amount >= 200)
(or	(players-building-type-count any-ally market >= 2); test
(or	(game-time >= 2520)
(or	(strategic-number teamsuperiority >= -1);	(goal underattack no)
(or	(strategic-number sn-military-superiority >= -1)
(or	(civilian-population >= up-max-civ)
(or	(population >= max-civ-pop)
	(military-population >= 16)))))))
	(up-compare-goal tradeunits < 48)
=>
	(set-goal traincart yes))
(defrule
	(strategic-number sn-current-age >= cimperial)
	(goal dreitc yes)
(or	(building-type-count-total stable >= number-stables)
	(up-compare-goal palagoal != yes))
(or	(building-type-count-total barracks >= number-barracks)
	(up-compare-goal champgoal != yes))
(or	(building-type-count-total stable >= number-stables)
(or	(building-type-count-total archery-range >= number-archery-ranges)
	(building-type-count-total barracks >= number-barracks)))
	(up-compare-goal tradeunits < 48)
=>
	(set-goal traincart yes))
(defrule
(or	(and	(up-compare-goal tradeunits < 48)
		(and	(or	(dropsite-min-distance gold s:> sn-maximum-gold-drop-distance)
				(dropsite-min-distance gold <= -1))
			(up-gaia-type-count c: gold <= 0)))
(or	(dropsite-min-distance wood >= 16); 24
	(dropsite-min-distance wood <= -1)))
	(up-compare-goal tradeunits < 60)
=>
	(set-goal traincart yes))
(defrule
(or	(strategic-number sn-current-age >= fcastlea)
	(gold-amount >= 250))
(or	(strategic-number sn-military-superiority >= -1)
(or	(strategic-number teamsuperiority >= -1);	(goal underattack no)
	(military-population >= 20)))
(nand	(commodity-selling-price wood >= 34)
	(gold-amount < castle-gs))
(or	(dropsite-min-distance gold >= 16); 24
	(dropsite-min-distance gold <= -1))
	(up-compare-goal tradeunits < 60)
=>
	(set-goal traincart yes))
(defrule
;	(strategic-number sn-current-age >= cimperial)
(or	(up-compare-goal excessGold < 1600)
	(and	(up-compare-goal excessWood >= 3000)
		(housing-headroom >= 20)))
(or	(and	(up-compare-goal excessWood >= 4800)
		(up-compare-goal excessFood >= 4800))
	(and	(up-compare-goal excessGold < 1200)
		(and	(up-compare-goal excessWood >= 3600)
			(up-compare-goal excessFood >= 3600))))
	(up-compare-goal tradeunits < 60)
=>
	(set-goal traincart yes))
(defrule
	(strategic-number sn-current-age >= cimperial)
	(up-compare-goal excessGold < 800)
(or	(and	(up-compare-goal excessWood >= 2400)
		(up-compare-goal excessFood >= 2400))
	(and	(up-compare-goal excessGold < 400)
		(and	(up-compare-goal excessWood >= 1200)
			(up-compare-goal excessFood >= 1200))))
	(up-compare-goal tradeunits < 60)
=>
	(set-goal traincart yes))
(defrule
;	(up-compare-goal tradeunits >= 42)
	(unit-type-count-total 178 <= 0)
	(unit-type-count-total 205 <= 0)
(or	(and	(up-compare-const michi-style == 1)
		(strategic-number sn-current-age >= fcastlea))
(or	(cc-players-unit-type-count 0 gold-mine <= 1)
(or	(cc-players-unit-type-count 0 stone-mine <= 1)
	(cc-players-unit-type-count 0 tree-class <= scout-time))))
=>
	(set-goal traincart yes)); end jump

(defrule
(or	(and	(players-building-type-count every-ally dock == 0)
		(not	(player-in-game any-ally)))
(or	(up-compare-goal tradeunits >= maxcartspop); depending on popcap and difficulty
	(up-compare-goal tradeunits >= maxcartssize))); depending on map size
=>
	(up-jump-rule 1))
(defrule
	(goal tradecarts no)
	(strategic-number sn-current-age >= imperial)
(or	(strategic-number teamsuperiority >= 2)
(or	(strategic-number sn-military-superiority >= 2)
(or	(goal enemy-boats no)
(or	(up-compare-goal biggestenemynavy <= 0)
	(up-compare-goal navycount >= 40)))))
(or	(population >= max-civ-pop)
	(up-idle-unit-count idle-type-villager >= 20))
	(up-compare-goal tradeunits < 45); 50
=>
	(set-goal traincog yes))

(defrule
	(goal tradecarts yes)
;	(population < del-civ-pop)
;	(civilian-population < max-civ-pop)
	(unit-type-count-total villager <= 0)
	(building-type-count town-center <= 0)
	(players-building-type-count any-ally market > 0)
	(up-compare-goal tradeunits < maxcartspop);
	(up-compare-goal tradeunits < maxcartssize);
	(up-compare-goal tradeunits < 75)
=>
	(set-goal traincart yes))
(defrule
	(goal tradecarts no)
;	(population < del-civ-pop)
;	(civilian-population < max-civ-pop)
	(unit-type-count-total villager <= 0)
	(building-type-count town-center <= 0)
	(players-building-type-count any-ally dock > 0)
	(up-compare-goal tradeunits < maxcartspop);
	(up-compare-goal tradeunits < maxcartssize);
	(up-compare-goal tradeunits < 60); 90
=>
	(set-goal traincog yes))

(defrule
(or	(population-cap < 250)
(or	(and	(players-building-type-count every-ally market == 0)
		(not	(player-in-game any-ally)))
(or	(up-compare-goal tradeunits >= maxcartspop); depending on popcap and difficulty
	(up-compare-goal tradeunits >= maxcartssize)))); depending on map size
=>
	(up-jump-rule 2))
(defrule
	(goal tradecarts yes)
;	(population < del-civ-pop)
;	(civilian-population < max-civ-pop)
	(up-compare-goal excessWood >= 200)
(or	(strategic-number sn-current-age >= imperial)
(or	(up-compare-goal excessWood >= 850)
	(building-type-count-total town-center >= 4)))
	(players-building-type-count any-ally market > 0)
	(up-compare-goal tradeunits < 75)
=>
	(set-goal traincart yes))
(defrule
	(goal tradecarts no)
;	(population < del-civ-pop)
;	(civilian-population < max-civ-pop)
	(up-compare-goal excessWood >= 200)
	(strategic-number sn-current-age >= imperial)
(or	(strategic-number teamsuperiority >= 2)
(or	(strategic-number sn-military-superiority >= 2)
(or	(goal enemy-boats no)
(or	(up-compare-goal biggestenemynavy <= 0)
	(up-compare-goal navycount >= 40)))))
	(players-building-type-count any-ally dock > 0)
	(up-compare-goal tradeunits < 60); 90
=>
	(set-goal traincog yes)); end jump

(defrule
(or	(and	(players-building-type-count every-ally market == 0)
		(not	(player-in-game any-ally)))
(or	(up-compare-goal tradeunits >= maxcartspop); depending on popcap and difficulty
	(up-compare-goal tradeunits >= maxcartssize))); depending on map size
=>
	(up-jump-rule 2))
(defrule
	(goal tradecarts yes)
	(goal strategy sling)
	(players-building-type-count any-ally market > 0)
	(up-compare-goal tradeunits < 60)
=>
	(set-goal traincart yes))
(defrule
	(goal tradecarts no)
	(goal strategy sling)
(or	(strategic-number teamsuperiority >= 2)
(or	(strategic-number sn-military-superiority >= 2)
(or	(goal enemy-boats no)
(or	(up-compare-goal biggestenemynavy <= 0)
	(up-compare-goal navycount >= 40)))))
	(players-building-type-count any-ally dock > 0)
	(up-compare-goal tradeunits < 45); 50
=>
	(set-goal traincog yes))
;=========================================================
; Military units
;=========================================================
;=========================================================
; Siege
;=========================================================
;(defrule
;(or	(gold-amount >= 75)
;	(unit-type-count villager-gold >= 2))
;(or	(wood-amount >= 160)
;	(unit-type-count villager-wood >= 4))
;(or	(up-building-type-in-town c: castle >= 1); should be fine even when attacking
;(or	(up-building-type-in-town c: watch-tower >= 4); same here
;	(up-building-type-in-town c: bombard-tower >= 2))); same here
;	(unit-available battering-ram-line)
;	(goal escrowing no)
;=>
;	(set-escrow-percentage wood 100)
;	(set-escrow-percentage gold 100)
;	(set-goal escrowing battering-ram-line))
;(defrule
;	(goal escrowing battering-ram-line)
;	(escrow-amount wood >= 160)
;=>
;	(set-escrow-percentage wood 0))
;(defrule
;	(goal escrowing battering-ram-line)
;	(escrow-amount gold >= 75)
;=>
;	(set-escrow-percentage gold 0))
;(defrule
;(or	(population >= max-pop)
;(or	(unit-type-count-total battering-ram-line >= 2)
;(or	(unit-type-count-total trebuchet-set >= 2)
;(or	(building-type-count-total town-center <= 0)
;	(building-type-count siege-workshop <= 0)))))
;	(goal escrowing battering-ram-line)
;=>
;	(release-escrow wood)
;	(release-escrow gold)
;	(set-escrow-percentage wood 0)
;	(set-escrow-percentage gold 0)
;	(set-goal escrowing 0))
;(defrule
;(or	(population >= max-pop)
;	(not	(unit-available battering-ram-line)))
;	(goal escrowing battering-ram-line)
;=>
;	(release-escrow wood)
;	(release-escrow gold)
;	(set-escrow-percentage wood 0)
;	(set-escrow-percentage gold 0)
;	(set-goal escrowing 0))
;(defrule
;	(goal escrowing battering-ram-line)
;	(can-train-with-escrow battering-ram-line)
;=>
;	(release-escrow wood)
;	(release-escrow gold)
;	(set-escrow-percentage wood 0)
;	(set-escrow-percentage gold 0)
;	(train battering-ram-line)
;	(set-goal escrowing 0))
;=========================================================
(defrule
(or	(strategic-number sn-current-age < imperial)
	(and	(up-compare-goal inseln == yes)
		(and	(unit-type-count-total transport-ship < 1)
			(wood-amount < 300))))
=>
	(up-jump-rule 2))
(defrule
	(goal underattack no)
(or	(population >= siege-pop)
(or	(military-population >= 50); 60
(or	(goal siegereq no)
(or	(strategic-number sn-military-superiority >= 1); 2
	(goal attacking yes)))))
(or	(unit-type-count-total trebuchet-set < 2)
	(goal siegereq no))
	(unit-type-count-total trebuchet-set < 5)
=>
	(set-goal traintrebuchet yes))
(defrule
(or	(military-population >= 33); 30
(or	(goal siegereq no)
(or	(strategic-number sn-military-superiority >= 1)
	(goal attacking yes))))
(or	(and	(goal siegereq no)
		(up-research-status c: ri-siege-ram >= research-pending))
	(unit-type-count-total battering-ram-line < 6))
	(unit-type-count-total battering-ram-line < 8)
=>
	(set-goal trainram yes)); total siege units less than #x and y condition (full civ pop?)
;=========================================================
(defrule
	(goal milunits yes)
	(unit-type-count-total trebuchet-set < 4); 5
	(goal underattack no)
(or	(population > max-civ-pop)
	(goal attacking yes))
(or	(goal attacking yes)
	(strategic-number sn-military-superiority >= 0))
(or	(players-building-type-count focus-player castle > 0)
(or	(players-building-type-count focus-player bombard-tower > 0)
	(players-building-type-count focus-player watch-tower > 1)))
=>
	(set-goal traintrebuchet yes))
(defrule
	(goal milunits yes)
	(unit-type-count-total trebuchet-set < 2); 3
	(goal underattack no)
(or	(up-projectile-detected projectile-castle < 3000)
	(up-projectile-detected projectile-bombard-tower < 3000))
	(up-timer-status resetnow != timer-disabled)
=>
	(set-goal traintrebuchet yes))
;=========================================================
(defrule
	(goal milunits yes)
	(unit-type-count-total battering-ram-line < 3); 2
	(enemy-buildings-in-town)
(or	(players-building-type-count focus-player castle > 0)
(or	(players-building-type-count focus-player bombard-tower > 0)
	(players-building-type-count focus-player watch-tower > 1)))
	(unit-type-count-total trebuchet-set < 3)
=>
	(set-goal traintrebuchet yes))
;=========================================================
(defrule
	(goal milunits yes)
	(goal underattack no)
	(strategic-number sn-current-age <= castlea)
	(up-compare-goal strategy-type <= castle-war)
	(military-population >= 20)
(or	(strategic-number sn-military-superiority >= 1)
	(military-population >= 30))
	(strategic-number sn-military-superiority >= 0)
	(unit-type-count-total battering-ram-line < 1)
=>
	(set-goal trainram yes))
(defrule
(or	(strategic-number sn-military-superiority >= 3)
	(goal attacking yes))
(or	(soldier-count >= 7)
	(strategic-number sn-military-superiority >= 1))
(or	(players-building-type-count focus-player stone-wall-line >= 1)
	(players-building-type-count focus-player gate-class >= 1))
(or	(unit-type-count-total battering-ram-line < 1)
	(strategic-number sn-current-age >= imperial))
	(unit-type-count-total battering-ram-line < 3)
=>
	(set-goal trainram yes))
(defrule
	(up-compare-goal strategy-type s:<= sn-current-age)
	(goal position-goal flank)
	(strategic-number sn-military-superiority >= 0)
	(military-population >= 5)
	(up-compare-goal target-mpop <= 2)
	(up-compare-goal enemyState <= feudal)
	(goal underattack no)
	(goal defend no)
(or	(players-building-type-count target-player watch-tower >= 2); 3
	(players-building-type-count target-player market >= 1))
	(unit-type-count-total battering-ram-line < 1); 3
=>
	(set-goal trainram yes))
;=========================================================
(defrule
	(up-compare-goal milunits != no)
	(goal underattack no)
	(strategic-number sn-military-superiority >= 1)
(or	(strategic-number sn-military-superiority >= 2)
	(unit-type-count-total battering-ram-line < 3))
(or	(up-compare-goal strategy-type <= castle-war)
	(strategic-number sn-current-age >= imperial));(current-age >= imperial-age))
	(unit-type-count-total battering-ram-line < 5)
=>
	(set-goal trainram yes))
;=========================================================
(defrule
	(goal milunits yes)
	(goal underattack no)
	(strategic-number sn-military-superiority >= 3)
(or	(strategic-number sn-military-superiority >= 4)
	(unit-type-count-total battering-ram-line < 7))
(or	(up-compare-goal strategy-type <= castle-war)
	(strategic-number sn-current-age >= imperial));(current-age >= imperial-age))
	(unit-type-count-total battering-ram-line < 9)
=>
	(set-goal trainram yes))
;=========================================================
(defrule
	(goal milunits yes)
	(goal underattack no)
	(goal attacking yes)
(or	(goal position-goal flank)
(or	(strategic-number sn-current-age >= imperial)
	(goal siegereq no)))
	(unit-type-count-total battering-ram-line < 7)
	(unit-type-count-total trebuchet-set < 3)
	(unit-type-count-total bombard-cannon-line < 12)
=>
	(set-goal trainram yes))
;=========================================================
(defrule
;	(goal milunits yes)
	(enemy-buildings-in-town)
(or	(strategic-number sn-current-age < imperial)
	(unit-type-count-total trebuchet-set < 3))
(or	(players-building-type-count focus-player castle >= 2)
(or	(players-building-type-count focus-player bombard-tower >= 2)
	(players-building-type-count focus-player watch-tower >= 4)))
	(unit-type-count-total battering-ram-line < 5)
=>
	(set-goal trainram yes))
;=========================================================
(defrule
;	(goal milunits yes)
	(enemy-buildings-in-town)
(or	(strategic-number sn-current-age < imperial)
	(unit-type-count-total trebuchet-set < 2))
(or	(players-building-type-count focus-player castle >= 1)
(or	(players-building-type-count focus-player bombard-tower >= 1)
	(players-building-type-count focus-player watch-tower >= 2)))
	(unit-type-count-total battering-ram-line < 5)
=>
	(set-goal trainram yes))
;=========================================================
(defrule
(or	(goal milunits no)
(or	(goal attacking yes)
(or	(soldier-count >= 20)
	(strategic-number sn-military-superiority >= 2))))
	(enemy-buildings-in-town)
	(unit-type-count-total battering-ram-line < 2)
	(unit-type-count-total trebuchet-set < 1)
	(unit-type-count-total bombard-cannon-line < 4)
=>
	(set-goal trainram yes))


(defrule
(nor	(up-compare-const inf-game == 1)
(or	(civ-selected turkish)
(or	(civ-selected spanish)
(or	(civ-selected portuguese)
(or	(civ-selected italian)
(or	(civ-selected bohemians)
	(civ-selected burgundians)))))))
=>
	(up-jump-rule 3))
(defrule
(or	(not	(unit-available bombard-cannon))
(or	(up-compare-goal milunits != yes)
(or	(strategic-number cavalry >= 35)
(or	(strategic-number eagles >= 40)
	(players-unit-type-count focus-player woad-raider-line >= 40)))))
=>
	(up-jump-rule 2))
(defrule
	(military-population >= 15)
	(goal underattack no)
(or	(goal siegereq no)
(or	(strategic-number sn-military-superiority >= 1); 2
	(goal attacking yes)))
	(unit-type-count-total bombard-cannon-line < 8)
=>
	(set-goal trainbombard yes))
(defrule
(or	(and	(up-research-status c: ri-artillery >= research-available)
		(and	(strategic-number skirmsarchers >= 15)
			(up-research-status c: ri-elite-skirmisher <= research-unavailable)))
(or	(up-research-status c: ri-arquebus >= research-pending)
	(up-research-status c: ri-houfnice >= research-pending)))
	(unit-type-count-total bombard-cannon-line < ten-pop)
=>
	(set-goal trainbombard yes)); end jump


(defrule
	(goal milunits yes)
	(up-compare-goal mangonel-set < 5)
	(players-unit-type-count focus-player scorpion-line >= 4)
(or	(unit-type-count-total bombard-cannon-line < 2)
(or	(and	(players-unit-type-count focus-player scorpion-line >= 8)
		(unit-type-count-total bombard-cannon-line < 4))
(or	(and	(players-unit-type-count focus-player scorpion-line >= 12)
		(unit-type-count-total bombard-cannon-line < 6))
	(players-unit-type-count focus-player scorpion-line >= 16))))
	(unit-type-count-total bombard-cannon-line < 8)
=>
	(set-goal trainbombard yes))
(defrule
	(goal milunits yes)
	(up-compare-goal mangonel-set < 8); 5
	(players-unit-type-count focus-player mangonel-line >= 3)
(or	(unit-type-count-total bombard-cannon-line < 2)
(or	(and	(players-unit-type-count focus-player mangonel-line >= 6)
		(unit-type-count-total bombard-cannon-line < 4))
(or	(and	(players-unit-type-count focus-player mangonel-line >= 9)
		(unit-type-count-total bombard-cannon-line < 6))
	(players-unit-type-count focus-player mangonel-line >= 12))))
	(unit-type-count-total bombard-cannon-line < 8)
=>
	(set-goal trainbombard yes))
(defrule
	(goal milunits yes)
	(up-compare-goal mangonel-set < 11)
	(strategic-number siege >= 8)
(or	(unit-type-count-total bombard-cannon-line < 2)
(or	(and	(strategic-number siege >= 12)
		(unit-type-count-total bombard-cannon-line < 4))
(or	(and	(strategic-number siege >= 16)
		(unit-type-count-total bombard-cannon-line < 6))
	(strategic-number siege >= 20))))
	(unit-type-count-total bombard-cannon-line < 8)
=>
	(set-goal trainbombard yes))
(defrule
	(goal milunits yes)
(or	(goal researchplan yes)
(or	(goal attacking yes)
	(current-age-time >= 480)))
(or	(military-population >= 33)
(or	(population >= siege-pop)
	(strategic-number sn-military-superiority >= 1)))
(or	(unit-type-count-total bombard-cannon-line < 2)
	(up-compare-goal excessGold >= 425))
	(unit-type-count-total bombard-cannon-line < 4)
=>
	(set-goal trainbombard yes))
;=========================================================
(defrule
(not	(civ-selected korean))
;(nor	(civ-selected korean)
;	(civ-selected celtic))
=>
	(up-jump-rule 1))
(defrule
	(goal milunits yes)
	(strategic-number cavalry < 28)
	(players-unit-type-count focus-player woad-raider-line < 32)
	(strategic-number eagles < 36)
	(strategic-number husks < 40)
(or	(strategic-number sn-current-age >= imperial)
	(gold-amount >= 935))
	(up-compare-goal mangonel-set < 20); 24
=>
	(set-goal trainmangonel yes)); end jump

;#load-if-defined CELTIC-CIV
;(defrule
;	(goal milunits yes)
;	(strategic-number cavalry < 25)
;;	(strategic-number husks < 25)
;	(strategic-number eagles < 25)
;	(players-unit-type-count focus-player mangonel-line < 5)
;	(players-unit-type-count focus-player woad-raider-line < 25)
;(or	(strategic-number sn-current-age >= imperial)
;	(strategic-number sn-military-superiority <= -1))
;;	(unit-type-count-total bombard-cannon-line < 20)
;;	(up-compare-goal mangonel-set < 40)
;;	(unit-type-count-total scorpion-line < 60)
;=>
;	(set-goal trainscorpion yes))
;#end-if

#load-if-defined CHINESE-CIV
(defrule
	(goal milunits yes)
	(strategic-number skirms >= 20)
	(strategic-number cavalry < 25)
	(strategic-number husks < 25)
	(strategic-number eagles < 25)
	(players-unit-type-count focus-player mangonel-line < 4)
	(players-unit-type-count focus-player woad-raider-line < 33)
	(up-research-status c: imperial-age >= research-pending);(or	(strategic-number sn-current-age >= imperial)
;	(strategic-number sn-military-superiority <= -1))
;	(unit-type-count-total bombard-cannon-line < 20)
	(up-compare-goal mangonel-set < 10)
	(unit-type-count-total scorpion-line < 12); 15
(or	(unit-type-count-total scorpion-line < 7)
	(up-research-status c: my-unique-research >= research-pending))
=>
	(set-goal trainscorpion yes))
#end-if
#load-if-defined VIKING-CIV
(defrule
	(goal milunits yes)
(or	(strategic-number archers >= 25)
(or	(players-unit-type-count focus-player jaguar-man-line >= 10)
(or	(players-unit-type-count focus-player teutonic-knight-line >= 10)
	(players-unit-type-count focus-player samurai-line >= 10))))
	(up-research-status c: imperial-age >= research-pending);	(strategic-number sn-current-age >= imperial)
	(up-compare-goal mangonel-set < 10)
	(unit-type-count-total scorpion-line < 12); 15
(or	(unit-type-count-total scorpion-line < 7)
	(up-research-status c: ri-heavy-scorpion >= research-pending))
=>
	(set-goal trainscorpion yes))
#end-if

#load-if-defined BRITON-CIV
(defrule
(or	(up-compare-goal mangonel-set >= 8)
(or	(unit-type-count cavalry-class >= 20)
	(unit-type-count infantry-class >= 30)))
=>
	(up-jump-rule 1))
(defrule
	(goal milunits yes)
(or	(strategic-number skirms >= 20)
	(players-unit-type-count focus-player battering-ram-line >= 6))
	(strategic-number cavalry < 24)
	(players-unit-type-count focus-player woad-raider-line < 27)
	(strategic-number eagles < 30)
	(strategic-number husks < 33)
(or	(goal underattack yes)
(or	(and	(strategic-number sn-military-superiority <= 0)
		(goal position-goal pocket))
	(strategic-number sn-current-age >= imperial)))
=>
	(set-goal trainmangonel yes)); end jump
#end-if




(defrule
(or	(goal position-goal flank)
	(goal underattack yes))
(or	(strategic-number skirmsarchers >= 10)
	(players-building-type-count focus-player watch-tower >= 2))
	(strategic-number cavalry < 7)
	(strategic-number husks < 7)
	(strategic-number eagles < 7)
	(players-unit-type-count focus-player woad-raider-line < 7)
	(strategic-number sn-current-age <= castlea)
	(strategic-number sn-military-superiority <= 1)
	(up-compare-goal mangonel-set < 2)
=>
	(set-goal trainmangonel yes))
(defrule
(or	(goal position-goal flank)
	(goal underattack yes))
	(strategic-number skirmsarchers >= 16)
	(strategic-number cavalry < 12)
	(strategic-number husks < 12)
	(strategic-number eagles < 12)
	(players-unit-type-count focus-player woad-raider-line < 12)
	(strategic-number sn-military-superiority <= 1)
	(up-compare-goal mangonel-set < 3)
=>
	(set-goal trainmangonel yes))
(defrule
(or	(goal position-goal flank)
	(goal underattack yes))
	(strategic-number skirmsarchers >= 24)
	(strategic-number cavalry < 15)
	(strategic-number husks < 15)
	(strategic-number eagles < 15)
	(players-unit-type-count focus-player woad-raider-line < 15)
	(strategic-number sn-military-superiority <= 1)
	(up-compare-goal mangonel-set < 5)
=>
	(set-goal trainmangonel yes))
(defrule; test
	(up-compare-goal milunits != no)
	(up-research-status c: imperial-age <= research-available)
(or	(strategic-number siege >= 3)
	(players-unit-type-count focus-player mangonel-line >= 1))
	(unit-type-count-total infantry-class < 12)
	(unit-type-count-total cavalry-class < 6)
;	(unit-type-count-total archery-class >= 9)
	(up-compare-goal mangonel-set < 2)
=>
	(set-goal trainmangonel yes))
	
#load-if-not-defined ALL-TECHS-ENABLED
(defrule
	(up-research-status c: ri-onager <= research-unavailable)
(or	(current-age >= imperial-age)
	(and	(up-research-status c: imperial-age >= research-pending)
		(or	(civ-selected hun)
			(civ-selected turkish))))
=>
	(up-jump-rule 3))
#end-if
(defrule; for now | todo
	(up-compare-goal milunits != no)
(or	(and	(players-unit-type-count focus-player scorpion-line >= 4)
		(up-compare-goal mangonel-set < 2))
(or	(and	(players-unit-type-count focus-player scorpion-line >= 8)
		(up-compare-goal mangonel-set < 4)); 5
	(and	(players-unit-type-count focus-player scorpion-line >= 12)
		(up-compare-goal mangonel-set < 6)))); 8
=>
	(set-goal trainmangonel yes))
(defrule
	(up-compare-goal milunits != no)
(or	(and	(players-unit-type-count focus-player scorpion-line >= 16)
		(up-compare-goal mangonel-set < 8)); 11
(or	(and	(players-unit-type-count focus-player scorpion-line >= 20)
		(up-compare-goal mangonel-set < 10)); 14
	(and	(players-unit-type-count focus-player scorpion-line >= 24)
		(up-compare-goal mangonel-set < 12)))); 17
=>
	(set-goal trainmangonel yes))
(defrule
	(up-compare-goal milunits != no)
(or	(and	(players-unit-type-count focus-player scorpion-line >= 28)
		(up-compare-goal mangonel-set < 14)); 28
(or	(and	(players-unit-type-count focus-player scorpion-line >= 32)
		(up-compare-goal mangonel-set < 16)); 32
	(and	(players-unit-type-count focus-player scorpion-line >= 36)
		(up-compare-goal mangonel-set < 18)))); 26
=>
	(set-goal trainmangonel yes)); end jump

(defrule
(or	(up-compare-goal milunits != yes)
(or	(strategic-number sn-military-superiority >= 1)
(or	(current-age <= castle-age)
(or	(and	(unit-available huskarl-line)
		(strategic-number gunpowder < 15))
	(nor	(up-compare-goal champgoal == yes)
		(and	(up-compare-goal uugoal == yes)
			(up-compare-const uu-type == infantry-uu)))))))
=>
	(up-jump-rule 5))
(defrule
	(unit-type-count-total bombard-cannon-line >= 20)
	(up-research-status c: ri-onager < research-pending)
	(up-research-status c: ri-heavy-scorpion < research-pending)
=>
	(up-jump-rule 4))
(defrule
	(up-compare-goal champgoal != yes)
(or	(up-compare-goal uugoal != yes)
	(up-compare-const uu-type != infantry-uu))
=>
	(up-jump-rule 1))
(defrule
	(up-research-status c: ri-onager < research-pending)
	(up-research-status c: ri-heavy-scorpion >= research-available)
(or	(strategic-number archers >= 40)
	(strategic-number skirmsarchers >= 50))
	(strategic-number cavalry < 26)
	(strategic-number husks < 33)
	(strategic-number eagles < 33)
	(players-unit-type-count focus-player woad-raider-line < 33)
	(players-unit-type-count focus-player mangonel-line < 5)
	(up-compare-goal mangonel-set < 8)
	(unit-type-count-total scorpion-line < 16)
(or	(up-research-status c: ri-heavy-scorpion >= research-pending)
	(unit-type-count-total scorpion-line < 12))
=>
	(set-goal trainscorpion yes)); end jump
(defrule
(or	(up-research-status c: ri-onager >= research-pending)
	(up-research-status c: ri-heavy-scorpion < research-pending))
	(up-research-status c: ri-onager >= research-available)
(or	(strategic-number archers >= 40)
	(strategic-number skirmsarchers >= 50))
	(strategic-number cavalry < 26)
	(strategic-number husks < 33)
	(strategic-number eagles < 33)
	(players-unit-type-count focus-player woad-raider-line < 33)
;	(unit-type-count-total scorpion-line < 20)
	(up-compare-goal mangonel-set < 8)
=>
	(set-goal trainmangonel yes))
(defrule
	(up-research-status c: ri-onager < research-pending)
	(up-research-status c: ri-heavy-scorpion >= research-available)
(or	(up-research-status c: ri-onager < research-available)
	(up-research-status c: ri-heavy-scorpion >= research-pending))
(or	(strategic-number archers >= 40)
	(strategic-number skirmsarchers >= 50))
	(strategic-number cavalry < 26)
	(strategic-number husks < 33)
	(strategic-number eagles < 33)
	(players-unit-type-count focus-player woad-raider-line < 33)
	(players-unit-type-count focus-player mangonel-line < 5)
	(up-compare-goal mangonel-set < 8)
	(unit-type-count-total scorpion-line < 12)
=>
	(set-goal trainscorpion yes)); end jump

;#load-if-not-defined KOREAN-CIV; SO civs elsewhere
;#load-if-not-defined BRITON-CIV
;#load-if-not-defined CELTIC-CIV
(defrule
(or	(goal trainscorpion yes)
(or	(and	(up-research-status c: ri-onager < research-available);	(up-research-status c: ri-heavy-scorpion < research-available)
		(up-research-status c: imperial-age >= research-complete)); -pending
(or	(and	(strategic-number sn-current-age < imperial);	(current-age <= castle-age)
		(goal position-goal pocket))
	(up-compare-goal milunits != yes))))
=>
	(up-jump-rule 3))
(defrule
	(players-unit-type-count focus-player mangonel-line < 4)
(or	(up-compare-goal enemy-goal != 0)
	(strategic-number skirmsarchers >= 12)); 10
(or	(players-building-type-count focus-player archery-range >= 2)
	(strategic-number skirmsarchers >= 7))
	(strategic-number cavalry < 8)
	(strategic-number eagles < 8)
	(strategic-number husks < 8)
	(players-unit-type-count focus-player woad-raider-line < 8)
	(strategic-number sn-military-superiority <= 0)
	(unit-type-count-total bombard-cannon-line < 2)
	(up-compare-goal mangonel-set < 2)
	(unit-type-count-total scorpion-line < 3)
=>
	(set-goal trainmangonel yes))
(defrule
	(players-unit-type-count focus-player mangonel-line < 12); 8
(or	(up-compare-goal mangonel-set < 4)
	(strategic-number skirmsarchers >= 36)); 30
	(strategic-number skirmsarchers >= 24); 20
	(strategic-number cavalry < 16)
	(strategic-number eagles < 16)
	(strategic-number husks < 16)
	(players-unit-type-count focus-player woad-raider-line < 16)
	(strategic-number sn-military-superiority <= 1); test
	(unit-type-count-total bombard-cannon-line < 6)
	(up-compare-goal mangonel-set < 6)
	(unit-type-count-total scorpion-line < 9)
=>
	(set-goal trainmangonel yes))
(defrule
	(players-unit-type-count focus-player mangonel-line < 20); 12
(or	(up-compare-goal mangonel-set < 8)
	(strategic-number skirmsarchers >= 60)); 50
	(strategic-number skirmsarchers >= 48); 40
	(strategic-number cavalry < 32)
	(strategic-number eagles < 32)
	(strategic-number husks < 32)
	(players-unit-type-count focus-player woad-raider-line < 32)
	(strategic-number sn-military-superiority <= 2); test
	(unit-type-count-total bombard-cannon-line < 10)
	(up-compare-goal mangonel-set < 10)
	(unit-type-count-total scorpion-line < 15)
=>
	(set-goal trainmangonel yes))
(defrule
(or	(nand	(unit-available scorpion-line)
		(not	(unit-available mangonel-line)))
(or	(and	(up-research-status c: ri-heavy-scorpion < research-pending);	(up-research-status c: ri-heavy-scorpion < research-available)
		(up-research-status c: imperial-age >= research-pending)); -complete
(or	(and	(strategic-number sn-current-age < imperial);	(current-age <= castle-age)
		(goal position-goal pocket))
	(up-compare-goal milunits != yes))))
=>
	(up-jump-rule 3))
(defrule
	(players-unit-type-count focus-player mangonel-line < 2)
(or	(up-compare-goal enemy-goal != 0)
	(strategic-number skirmsarchers >= 12)); 10
(or	(players-building-type-count focus-player archery-range >= 2)
	(strategic-number skirmsarchers >= 7))
	(strategic-number cavalry < 7)
	(strategic-number eagles < 7)
	(strategic-number husks < 8)
	(players-unit-type-count focus-player woad-raider-line < 8)
	(strategic-number sn-military-superiority <= 0)
	(unit-type-count-total bombard-cannon-line < 2)
	(up-compare-goal mangonel-set < 1)
	(unit-type-count-total scorpion-line < 3)
=>
	(set-goal trainscorpion yes))
(defrule
	(players-unit-type-count focus-player mangonel-line < 4)
(or	(unit-type-count-total scorpion-line < 6)
	(strategic-number skirmsarchers >= 36)); 30
	(strategic-number skirmsarchers >= 24); 20
	(strategic-number cavalry < 16)
	(strategic-number eagles < 16)
	(strategic-number husks < 16)
	(players-unit-type-count focus-player woad-raider-line < 16)
	(strategic-number sn-military-superiority <= 1); test
	(unit-type-count-total bombard-cannon-line < 6)
	(up-compare-goal mangonel-set < 3)
	(unit-type-count-total scorpion-line < 9)
=>
	(set-goal trainscorpion yes))
(defrule
	(players-unit-type-count focus-player mangonel-line < 6)
(or	(unit-type-count-total scorpion-line < 12)
	(strategic-number skirmsarchers >= 60)); 50
	(strategic-number skirmsarchers >= 48); 40
	(strategic-number cavalry < 32)
	(strategic-number eagles < 32)
	(strategic-number husks < 32)
	(players-unit-type-count focus-player woad-raider-line < 32)
	(strategic-number sn-military-superiority <= 2); test
	(unit-type-count-total bombard-cannon-line < 10)
	(up-compare-goal mangonel-set < 5)
	(unit-type-count-total scorpion-line < 15)
=>
	(set-goal trainscorpion yes))
;#end-if
;#end-if
;#end-if

#load-if-not-defined POLES-CIV
#load-if-not-defined BOHEMIANS-CIV

#load-if-not-defined BURGUNDIANS-CIV

#load-if-not-defined INCAN-CIV
#load-if-not-defined INDIAN-CIV
#load-if-not-defined ITALIAN-CIV
#load-if-not-defined MAGYAR-CIV

#load-if-not-defined BERBERS-CIV
#load-if-not-defined BURMESE-CIV
#load-if-not-defined PORTUGUESE-CIV
#load-if-not-defined KHMER-CIV
#load-if-not-defined MALAY-CIV
#load-if-not-defined VIETNAMESE-CIV

#load-if-not-defined LITHUANIANS-CIV
#load-if-not-defined TATARS-CIV

#load-if-not-defined BRITON-CIV
#load-if-not-defined BYZANTINE-CIV
#load-if-not-defined CHINESE-CIV
#load-if-not-defined FRANKISH-CIV
#load-if-not-defined GOTHIC-CIV
#load-if-not-defined HUN-CIV
#load-if-not-defined JAPANESE-CIV
#load-if-not-defined MAYAN-CIV
#load-if-not-defined PERSIAN-CIV
#load-if-not-defined SPANISH-CIV
#load-if-not-defined TURKISH-CIV ; Siege Onagers, SO civs
#load-if-not-defined VIKING-CIV ; Aztecs, Celts, Koreans, Mongols, Saracens, Teutons, Slavs, Ethiopians, Malians, Bulgarians, Cumans

#load-if-defined UP-MICHI-STYLE
(defrule
	(goal milunits yes)
;(or	(strategic-number skirmsarchers >= 15)
;	(players-unit-type-count focus-player scorpion-line >= 3))
	(strategic-number cavalry < 50)
	(strategic-number eagles < 50)
	(players-unit-type-count focus-player woad-raider-line < 50)
	(strategic-number sn-military-superiority <= 3)
	(up-compare-goal mangonel-set < 16); 12
=>
	(set-goal trainmangonel yes))
	

#else
(defrule
	(goal milunits yes)
(or	(up-compare-goal excessGold >= 1735)
(or	(and	(up-compare-goal excessGold >= 635)
		(goal researchplan yes))
	(up-research-status c: ri-onager >= research-pending)))
	(strategic-number cavalry < 30)
	(strategic-number husks < 39)
	(strategic-number eagles < 33)
	(players-unit-type-count focus-player woad-raider-line < 30)
	(strategic-number sn-military-superiority <= 0); 1
	(up-compare-goal mangonel-set < 5)
=>
	(set-goal trainmangonel yes))
(defrule
	(goal milunits yes)
(or	(strategic-number skirmsarchers >= 24)
	(players-unit-type-count focus-player scorpion-line >= 4))
	(strategic-number cavalry < 50)
	(strategic-number husks < 65)
	(strategic-number eagles < 55)
	(players-unit-type-count focus-player woad-raider-line < 50)
(or	(strategic-number skirmsarchers >= 36); test
	(strategic-number sn-military-superiority <= 0)); 1
(or	(strategic-number skirmsarchers >= 60)
	(up-compare-goal mangonel-set < 5))
	(up-compare-goal mangonel-set < 9)
=>
	(set-goal trainmangonel yes))
#end-if

#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if

#end-if
#end-if
#end-if
#end-if
#end-if
#end-if

#end-if
#end-if

#end-if
#end-if
#end-if
#end-if

#end-if

#end-if
#end-if

#load-if-defined UP-MICHI-STYLE
(defrule
	(goal milunits yes)
(or	(goal researchplan yes)
	(current-age-time >= 480)); 600
(or	(military-population >= 20); 25
(or	(population >= max-civ-pop)
	(strategic-number sn-military-superiority >= 0))); 1
	(unit-type-count-total bombard-cannon-line < 6); testing
=>
	(set-goal trainbombard yes))
#end-if

(defrule; arena test
(or	(wall-completed-percentage 2 >= 100)
	(wall-completed-percentage 1 >= 100))
	(goal inseln no)
(or	(building-type-count stone-wall-line >= 4)
	(building-type-count gate >= 2))
	(goal siegereq yes)
	(strategic-number cavalry < 25)
	(strategic-number eagles < 33)
	(players-unit-type-count focus-player woad-raider-line < 33)
	(strategic-number sn-current-age <= castlea)
	(strategic-number sn-military-superiority <= -1)
	(unit-type-count-total bombard-cannon-line < 1)
	(up-compare-goal mangonel-set < 1)
=>
	(set-goal trainmangonel yes))

(defrule
(or	(goal trainscorpion yes)
(or	(up-research-status c: ri-heavy-scorpion <= research-unavailable)
	(up-research-status c: ri-siege-engineers <= research-unavailable)))
=>
	(up-jump-rule 3))
(defrule
(or	(up-compare-goal mangonel-set >= 12)
(or	(unit-type-count-total scorpion-line >= 24)
(or	(up-compare-goal milunits != yes)
(or	(strategic-number cavalry >= 12)
(or	(strategic-number eagles >= 13)
(or	(players-unit-type-count focus-player woad-raider-line >= 13)
(or	(players-unit-type-count focus-player mangonel-line >= 2)
	(players-unit-type-count focus-player bombard-cannon >= 4))))))))
=>
	(up-jump-rule 2))
(defrule
(or	(civ-selected khmer)
	(players-civ any-ally khmer))
(or	(up-research-status c: ri-furor-celtica >= research-pending)
(or	(up-research-status c: ri-drill >= research-pending)
(or	(up-research-status c: ri-torsion-engines >= research-pending)
(or	(up-research-status c: ri-double-crossbow >= research-pending)
(or	(up-research-status c: ri-ironclad >= research-pending)
	(up-research-status c: ri-rocketry >= research-pending))))))
=>
	(set-goal trainscorpion yes))
(defrule
	(civ-selected khmer)
	(goal milunits yes)
	(goal uugoal no)
(or	(strategic-number spears >= 25)
	(and	(goal trainknight no)
		(goal trainbattle no)))
	(up-compare-goal excessGold >= 275)
=>
	(set-goal trainscorpion yes)); end jump

(defrule
	(goal milunits yes)
	(up-research-status c: ri-siege-onager >= research-pending)
(or	(up-compare-goal excessGold >= 225)
	(goal siegereq yes)); test
	(strategic-number cavalry < 39)
	(strategic-number eagles < 45)
;	(strategic-number husks < 60)
	(players-unit-type-count focus-player woad-raider-line < 45)
(or	(strategic-number sn-military-superiority <= 1)
	(strategic-number skirmsarchers >= 16))
	(unit-type-count-total bombard-cannon-line < 16)
	(unit-type-count-total scorpion-line < 12)
	(up-compare-goal mangonel-set < 12); 18
=>
	(set-goal trainmangonel yes))
(defrule
	(goal milunits yes)
	(up-research-status c: ri-siege-onager < research-pending)
	(up-research-status c: ri-heavy-scorpion >= research-pending)
(or	(up-compare-goal excessGold >= 225)
	(goal siegereq yes)); test
	(players-unit-type-count focus-player mangonel-line < 3)
	(strategic-number skirmsarchers >= 36); 30
	(strategic-number cavalry < 18)
	(strategic-number eagles < 21)
	(players-unit-type-count focus-player woad-raider-line < 21)
	(strategic-number sn-military-superiority <= 2); test
	(unit-type-count-total bombard-cannon-line < 8)
	(up-compare-goal mangonel-set < 6)
	(unit-type-count-total scorpion-line < 12)
=>
	(set-goal trainscorpion yes))
#load-if-not-defined DIFFICULTY-HARD
#load-if-not-defined DIFFICULTY-HARDEST
#load-if-not-defined DIFFICULTY-EXTREME
(defrule
	(strategic-number sn-current-age >= imperial)
(or	(can-train flaming-camel)
	(can-train petard))
=>
	(train flaming-camel)
	(train petard)
;	(set-goal trainpetard yes)
	(disable-self))
#end-if
#end-if
#end-if
;=========================================================
; Snow
;=========================================================
(defrule
	(goal uugoal yes)
	(goal milunits yes)
(or	(up-research-status c: my-unique-unit-upgrade >= research-pending)
	(and	(strategic-number sn-current-age >= cimperial)
		(up-compare-goal excessGold >= uu-gold2)))
=>
	(set-goal trainunique yes))
#load-if-defined MALAY-CIV
(defrule
	(up-research-status c: imperial-age < research-pending)
=>
	(up-jump-rule 2))
(defrule
(or	(strategic-number siege >= 15); 10
(or	(players-unit-type-count focus-player ballista-elephant >= 10)
(or	(players-unit-type-count focus-player elite-ballista-elephant >= 10)
(or	(players-unit-type-count focus-player battle-elephant >= 10)
(or	(players-unit-type-count focus-player elite-battle-elephant >= 10)
;(or	(players-unit-type-count focus-player cataphract-line >= 7)
	(players-unit-type-count focus-player war-elephant-line >= 7))))));)
=>
	(set-goal trainunique no)
	(set-goal champgoal yes)
	(set-goal uugoal no))
(defrule
;(or	(players-unit-type-count focus-player jaguar-man-line >= 7)
;(or	(players-unit-type-count focus-player teutonic-knight-line >= 7)
	(players-unit-type-count focus-player samurai-line >= 7);))
=>
	(set-goal trainunique no)
	(set-goal champgoal yes)
	(set-goal uugoal no)); end jump
#else
#load-if-not-defined INCAN-CIV
#load-if-not-defined INDIAN-CIV
#load-if-not-defined ITALIAN-CIV
#load-if-not-defined MAGYAR-CIV
#load-if-not-defined SLAVIC-CIV

#load-if-not-defined BERBERS-CIV
#load-if-not-defined BURMESE-CIV
#load-if-not-defined ETHIOPIAN-CIV
#load-if-not-defined PORTUGUESE-CIV
#load-if-not-defined KHMER-CIV
#load-if-not-defined MALAY-CIV
#load-if-not-defined MALIAN-CIV
#load-if-not-defined VIETNAMESE-CIV

#load-if-not-defined BULGARIANS-CIV
#load-if-not-defined CUMANS-CIV
#load-if-not-defined LITHUANIANS-CIV
#load-if-not-defined TATARS-CIV

#load-if-not-defined BRITON-CIV
#load-if-not-defined CHINESE-CIV
#load-if-not-defined HUN-CIV
#load-if-not-defined MAYAN-CIV
#load-if-not-defined MONGOL-CIV
#load-if-not-defined KOREAN-CIV
#load-if-not-defined PERSIAN-CIV
(defrule
	(goal milunits yes)
(or	(food-amount >= unique-unit-food)
(or	(up-compare-goal custom-civ-pop >= up-max-civ)
	(strategic-number sn-military-superiority <= -1)))
	(strategic-number moenche < 15)
	(strategic-number husks > 8)
	(unit-type-count-total my-unique-unit-line < 30)
=>
	(set-goal trainunique yes))
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if

#load-if-defined BYZANTINE-CIV
(defrule
	(goal milunits yes)
	(up-research-status c: my-unique-unit-upgrade >= research-pending)
	(strategic-number moenche < 15)
;	(players-unit-type-count focus-player spearman-line < 60)
;	(unit-type-count-total my-unique-unit-line < 80)
=>
	(set-goal trainunique yes))
#end-if

#load-if-defined FRANKISH-CIV
(defrule
	(goal milunits yes)
;(or
	(up-research-status c: my-unique-unit-upgrade >= research-pending)
	(strategic-number moenche < 15)
	(strategic-number archers <= 12)
	(strategic-number gunpowder <= 12)
	(players-unit-type-count focus-player jaguar-man-line < 12)
	(players-unit-type-count focus-player cataphract-line < 12)
	(players-unit-type-count focus-player samurai-line < 12)
	(unit-type-count-total my-unique-unit-line < 75); 70
=>
	(set-goal trainunique yes))
#end-if

#load-if-defined SARACEN-CIV
(defrule
	(goal milunits yes)
(or	(up-research-status c: my-unique-unit-upgrade >= research-pending)
(or	(up-research-status c: my-unique-research >= research-pending); makes them more valuable anyway
(or	(and	(strategic-number cavalry >= 25)
		(up-research-status c: my-unique-unit-upgrade >= research-available))
	(gold-amount >= 1200)))); test
	(strategic-number moenche < 15)
; test	(strategic-number cavalry >= 10)
;	(strategic-number infantry <= 25)
	(strategic-number archers <= 15)
; hmm	(strategic-number spears <= 65)
; hmm	(strategic-number skirms <= 50)
	(players-unit-type-count focus-player cataphract-line <= 15)
;	(unit-type-count-total my-unique-unit-line < 70)
=>
	(set-goal trainunique yes))
#end-if

#load-if-defined TEUTONIC-CIV
(defrule
	(goal palagoal yes)
	(strategic-number camels < 45)
	(strategic-number spears < 50)
=>
	(up-jump-rule 1))
(defrule
	(goal milunits yes)
;(or
	(up-research-status c: my-unique-unit-upgrade >= research-pending)
;	(strategic-number sn-military-superiority <= -2))
	(strategic-number moenche < 10)
	(players-unit-type-count focus-player cataphract-line < 12)
	(players-unit-type-count focus-player scorpion-line < 12)
	(players-unit-type-count focus-player leitis < 12)
	(players-unit-type-count focus-player elite-leitis < 12)
	(strategic-number archers < 24)
;	(unit-type-count-total my-unique-unit-line < 80)
=>
	(set-goal trainunique yes))
#end-if

#load-if-defined PERSIAN-CIV
(defrule
	(goal milunits yes)
	(up-research-status c: my-unique-unit-upgrade >= research-pending)
	(up-research-status c: my-unique-research >= research-pending); test
	(strategic-number moenche < 7)
	(strategic-number camels < 50)
	(strategic-number spears < 60)
;	(unit-type-count-total my-unique-unit-line < 90)
=>
	(set-goal trainunique yes))
#end-if

#load-if-defined JAPANESE-CIV
(defrule
(or	(up-compare-goal milunits != yes)
(or	(strategic-number moenche >= 17)
(or	(strategic-number archers >= 50)
	(strategic-number gunpowder >= 50))))
=>
	(up-jump-rule 2))
(defrule
(or	(strategic-number husks >= 8)
(or	(players-unit-type-count focus-player condottiero >= 8)
(or	(players-unit-type-count focus-player condottiero-placeholder >= 8)
(or	(players-unit-type-count focus-player woad-raider-line >= 8)
(or	(players-unit-type-count focus-player throwing-axeman-line >= 8)
(or	(players-unit-type-count focus-player konnik-line >= 8)
(or	(players-unit-type-count focus-player krepost-konnik-line >= 8)
	(players-unit-type-count focus-player berserk-line >= 8))))))))
;	(unit-type-count-total my-unique-unit-line < 40)
=>
	(set-goal trainunique yes))
(defrule
(or	(up-compare-goal mangonel-set >= 6)
(or	(unit-type-count-total scorpion-line >= 9)
(or	(unit-type-count-total bombard-cannon-line >= 12)
	(up-compare-goal skirmisher-set >= 30))))
(or	(players-unit-type-count focus-player teutonic-knight-line >= 8)
	(up-research-status c: my-unique-unit-upgrade >= research-pending))
=>
	(set-goal trainunique yes)); end jump
#end-if

(defrule
(nor	(civ-selected viking)
	(civ-selected celtic))
=>
	(up-jump-rule 1))
(defrule
	(goal milunits yes)
	(up-research-status c: my-unique-unit-upgrade >= research-pending)
(or	(strategic-number moenche < 15)
	(civ-selected celtic))
(or	(strategic-number archers < 50)
(or	(up-compare-goal mangonel-set >= 6)
(or	(unit-type-count-total scorpion-line >= 8)
(or	(unit-type-count-total bombard-cannon-line >= 10)
	(up-compare-goal skirmisher-set >= 30)))))
;	(unit-type-count-total my-unique-unit-line < 90)
=>
	(set-goal trainunique yes))
#load-if-defined CELTIC-CIV
(defrule
	(goal trainunique yes)
(or	(players-unit-type-count focus-player jaguar-man-line >= 10)
(or	(players-unit-type-count focus-player teutonic-knight-line >= 10)
	(players-unit-type-count focus-player samurai-line >= 10)))
=>
	(set-goal trainunique no))
(defrule
	(goal milunits yes)
	(strategic-number cavalry < 30)
	(players-unit-type-count focus-player woad-raider-line < 33)
	(strategic-number eagles < 36)
	(strategic-number husks < 39)
(or	(strategic-number sn-current-age >= imperial)
	(gold-amount >= 875))
	(unit-type-count-total scorpion-line < 33)
=>
	(set-goal trainscorpion yes))
#end-if


(defrule; ranged UUs
;(or	(and	(goal position-goal pocket)
;		(and	(up-compare-goal targetdistance >= 60)
;			(and	(strategic-number sn-military-superiority >= -2)
;				(and	(goal defend no)
;					(goal underattack no)))))
	(and	(up-compare-const uu-type != archer-uu)
		(up-compare-const uu-type != powder-uu));)
=>
	(up-jump-rule 2))
(defrule
	(goal milunits yes)
(or	(up-research-status c: my-unique-unit-upgrade >= research-pending)
	(strategic-number infantry >= 15))
	(strategic-number siege < 20); 15
	(strategic-number skirms < 67)
	(strategic-number husks < 36)
;	(strategic-number cavalry < 50)
;	(unit-type-count-total my-unique-unit-line < 90)
=>
	(set-goal trainunique yes))
(defrule
	(goal milunits yes)
(or	(strategic-number sn-military-superiority <= -1)
	(strategic-number infantry >= 15))
	(strategic-number siege < 9); 7
	(strategic-number skirms < 36)
	(strategic-number husks < 27)
;	(strategic-number cavalry < 33)
(or	(unit-type-count-total my-unique-unit-line < 40)
	(strategic-number sn-military-superiority <= -2));
=>
	(set-goal trainunique yes)); end mini jump

#load-if-defined KOREAN-CIV
(defrule
	(goal milunits yes)
(or	(up-research-status c: my-unique-unit-upgrade >= research-pending)
(or	(strategic-number infantry >= 15)
	(strategic-number archers >= 15)))
	(strategic-number siege < 20); 15
	(strategic-number skirms < 67)
	(strategic-number husks < 36)
	(players-unit-type-count focus-player mameluke-line < 33)
;	(strategic-number cavalry < 67); 50
;	(unit-type-count-total my-unique-unit-line < 90)
=>
	(set-goal trainunique yes))
#end-if

#load-if-defined TURKISH-CIV
(defrule
	(goal milunits yes)
(or	(up-research-status c: my-unique-unit-upgrade >= research-pending)
(or	(players-unit-type-count focus-player mameluke-line >= 10); 15
	(strategic-number infantry >= 7)))
;	(strategic-number moenche < 25)
	(strategic-number siege < 20); 15
;	(strategic-number cavalry < 55); 50
	(strategic-number archers < 55); 50
;	(unit-type-count-total my-unique-unit-line < 80)
=>
	(set-goal trainunique yes))
#end-if

(defrule
	(up-compare-const uu-type != powder-uu)
=>
	(up-jump-rule 3))
(defrule
(or	(goal palagoal yes)
	(goal cavagoal yes))
	(goal uugoal no)
	(up-compare-const inf-game != yes)
=>
	(up-jump-rule 2))
(defrule
	(goal milunits yes)
(or	(up-research-status c: my-unique-unit-upgrade >= research-pending)
	(strategic-number infantry >= 15))
;	(strategic-number moenche < 25)
(nor	(strategic-number siege >= 20); 15
;(or	(strategic-number cavalry >= 50)
	(strategic-number archers >= 50));)
;	(unit-type-count-total my-unique-unit-line < 80)
=>
	(set-goal trainunique yes))
(defrule
	(goal milunits yes)
(or	(food-amount >= unique-unit-food)
(or	(up-compare-goal custom-civ-pop >= up-max-civ)
	(strategic-number sn-military-superiority <= -1)))
;	(strategic-number moenche < 25)
	(strategic-number siege < 10)
	(strategic-number cavalry < 15)
	(strategic-number archers < 25)
(or	(strategic-number infantry >= 15)
	(strategic-number sn-military-superiority <= -1))
	(strategic-number sn-military-superiority <= 0)
	(unit-type-count-total my-unique-unit-line < 40)
=>
	(set-goal trainunique yes)); end jumps

#load-if-defined AZTEC-CIV
(defrule
	(goal milunits yes)
	(strategic-number infantry >= 24)
(or	(up-research-status c: my-unique-unit-upgrade >= research-pending)
	(and	(strategic-number cavalry < 24)
		(strategic-number archers < 12)))
	(strategic-number cavalry < 48)
	(strategic-number archers < 24)
	(strategic-number moenche < 15)
	(unit-type-count-total my-unique-unit-line < 60);
=>
	(set-goal trainunique yes))
#end-if
#load-if-defined GOTHIC-CIV
(defrule
	(true)
=>
	(up-modify-sn archers s:- gunpowder))
(defrule
	(goal milunits yes)
(or	(up-research-status c: my-unique-unit-upgrade >= research-pending)
(or	(players-civ focus-player mayan)
	(strategic-number archers >= 15)))
	(strategic-number moenche < 15)
=>
	(set-goal trainunique yes))
(defrule
	(true)
=>
	(up-modify-sn archers s:+ gunpowder))
(defrule
(or	(goal trainunique yes)
	(goal uugoal yes))
	(strategic-number moenche < 15)
(or	(players-unit-type-count focus-player militiaman-line >= 42)
(or	(players-unit-type-count focus-player jaguar-man-line >= 10)
(or	(players-unit-type-count focus-player teutonic-knight-line >= 10)
	(players-unit-type-count focus-player samurai-line >= 10))))
=>
	(set-goal trainunique no)
	(set-goal champgoal yes)
	(set-goal trainhandcannon yes))
#end-if

#load-if-defined HUN-CIV
(defrule
	(goal milunits yes)
	(strategic-number sn-current-age >= imperial)
(or	(up-research-status c: my-unique-unit-upgrade >= research-pending)
(or	(strategic-number sn-military-superiority >= 4)
	(and	(can-afford-research my-unique-unit-upgrade)
		(players-military-population every-enemy < 12))))
(or	(goal palagoal no)
	(up-research-status c: my-unique-unit-upgrade >= research-pending))
	(strategic-number sn-military-superiority >= 1); 2
	(strategic-number moenche < 10)
	(strategic-number spears < 15)
=>
	(set-goal trainunique yes))
#end-if

#end-if
#end-if
#end-if
#end-if

#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if

#else; slavs
#load-if-not-defined DE-AVAILABLE
(defrule
	(goal milunits yes)
;t	(up-research-status c: my-unique-unit-upgrade >= research-pending)
(or	(strategic-number sn-current-age >= imperial)
	(goal underattack yes))
	(strategic-number spears < 50)
	(strategic-number camels < 50)
	(strategic-number moenche < 15)
	(goal siegereq yes)
;	(unit-type-count-total boyar < 90)
	(can-train boyar)
=>
	(train boyar))
#else
(defrule
	(goal milunits yes)
(or	(up-research-status c: my-unique-unit-upgrade >= research-pending)
	(goal champgoal no))
(or	(strategic-number sn-current-age >= imperial)
	(goal underattack yes))
	(strategic-number spears < 50)
	(strategic-number camels < 60)
	(strategic-number moenche < 15)
	(goal siegereq yes)
;	(unit-type-count-total boyar < 90)
=>
	(set-goal trainunique yes))
#end-if
#end-if
#else; magyars
(defrule
	(goal palagoal yes)
	(up-compare-goal excessGold >= 825)
	(up-compare-goal tradeunits >= 32)
	(population >= max-civ-pop)
	(housing-headroom < 16)
(or	(goal trainknight yes)
	(up-pending-objects c: knight-line >= 1))
=>
	(up-jump-rule 1))
#load-if-not-defined DE-AVAILABLE
(defrule
	(goal milunits yes)
(or	(goal uugoal yes)
(or	(up-research-status c: my-unique-unit-upgrade >= research-pending)
	(up-research-status c: ri-mercenaries >= research-pending)))
(or	(strategic-number sn-current-age >= imperial)
	(goal underattack yes))
	(strategic-number spears < 42)
	(strategic-number camels < 42)
	(goal siegereq yes)
;	(unit-type-count-total magyar-huszar < 90)
	(can-train magyar-huszar)
=>
	(train magyar-huszar)); end jump
#else
(defrule
	(goal milunits yes)
(or	(goal uugoal yes)
(or	(up-research-status c: my-unique-unit-upgrade >= research-pending)
	(up-research-status c: ri-mercenaries >= research-pending)))
(or	(strategic-number sn-current-age >= imperial)
	(goal underattack yes))
	(strategic-number spears < 42)
	(strategic-number camels < 42)
	(goal siegereq yes)
;	(unit-type-count-total magyar-huszar < 90)
=>
	(set-goal trainunique yes)); end jump
#end-if
#end-if
#else; italians
#load-if-not-defined DE-AVAILABLE
(defrule
	(goal milunits yes)
;t	(up-research-status c: my-unique-unit-upgrade >= research-pending)
(or	(strategic-number sn-current-age >= imperial)
	(goal underattack yes))
	(goal siegereq yes)
;	(unit-type-count-total genoese-crossbowman < 90)
	(can-train genoese-crossbowman)
=>
	(train genoese-crossbowman))
#else
(defrule
	(goal milunits yes)
;t	(up-research-status c: my-unique-unit-upgrade >= research-pending)
(or	(strategic-number sn-current-age >= imperial)
	(goal underattack yes))
	(goal siegereq yes)
;	(unit-type-count-total genoese-crossbowman < 90)
=>
	(set-goal trainunique yes))
#end-if
#end-if
#else; indians
#load-if-not-defined DE-AVAILABLE
(defrule
	(goal milunits yes)
;t	(up-research-status c: my-unique-unit-upgrade >= research-pending)
(or	(strategic-number sn-current-age >= imperial)
	(goal underattack yes))
	(strategic-number moenche < 15)
	(goal siegereq yes)
;	(unit-type-count-total elephant-archer < 80)
	(can-train elephant-archer)
=>
	(train elephant-archer))
#else
(defrule
	(goal milunits yes)
;t	(up-research-status c: my-unique-unit-upgrade >= research-pending)
(or	(strategic-number sn-current-age >= imperial)
	(goal underattack yes))
	(strategic-number moenche < 15)
	(goal siegereq yes)
;	(unit-type-count-total elephant-archer < 80)
=>
	(set-goal trainunique yes))
#end-if
#end-if
#else; incans
#load-if-not-defined DE-AVAILABLE
(defrule
	(goal milunits yes)
(or	(up-research-status c: my-unique-unit-upgrade >= research-pending)
(or	(strategic-number cavalry >= 20)
	(strategic-number sn-military-superiority <= -2)))
	(strategic-number moenche < 15)
	(strategic-number cavalry >= 10)
	(goal siegereq yes)
;	(unit-type-count-total kamayuk < 48)
	(can-train kamayuk)
=>
	(train kamayuk))
#else
(defrule
	(goal milunits yes)
(or	(up-research-status c: my-unique-unit-upgrade >= research-pending)
(or	(strategic-number cavalry >= 20)
	(strategic-number sn-military-superiority <= -2)))
	(strategic-number moenche < 15)
	(strategic-number cavalry >= 10)
	(goal siegereq yes)
;	(unit-type-count-total kamayuk < 48)
=>
	(set-goal trainunique yes))
#end-if
#end-if

#end-if; not malay
;=========================================================
; Ships
;=========================================================
(defrule
(or	(up-compare-goal navycount g:>= maxnavy)
(or	(up-compare-goal fleet != yes)
(or	(up-compare-goal enemy-boats != yes)
	(and	(dropsite-min-distance wood >= 4); 5
		(wood-amount < farmcamp-cost)))))
=>
	(up-jump-rule 15))
(defrule
	(goal inseln no)
	(up-compare-const extra-water-focus == 0)
	(wood-amount < farmmb-cost)
	(up-compare-goal custom-civ-pop < up-max-civ)
	(population < max-civ-pop)
=>
	(up-jump-rule 14))
(defrule
	(strategic-number sn-current-age < imperial)
	(up-compare-goal biggestenemynavy <= 0)
	(goal inseln no)
	(up-compare-const extra-water-focus == 0)
	(up-research-status c: ri-war-galley <= research-available)
	(up-compare-goal strategy-type2 != water)
	(up-compare-goal attacking != yes)
=>
	(up-jump-rule 13))
(defrule
	(goal migration-state 1)
	(goal traintransport yes)
	(building-type-count-total transport-ship < 1)
	(unit-available transport-ship)
	(wood-amount < 225)
=>
	(up-jump-rule 12))
(defrule
	(up-research-status c: ri-heavy-demolition-ship >= research-pending)
	(up-compare-goal navycount g:< enemyfocusnavy)
	(up-compare-goal navycount < 12)
	(players-unit-type-count every-enemy galley-line < 8)
	(players-unit-type-count every-enemy longboat-line < 8)
	(players-unit-type-count every-enemy caravel-line < 8)
	(players-unit-type-count every-enemy turtle-ship-line < 2)
	(unit-type-count-total demolition-ship-line < 12)
=>
	(set-goal traindemo yes)
	(up-jump-rule 3))
(defrule
(or	(current-age <= castle-age)
	(up-research-status c: ri-heavy-demolition-ship >= research-pending))
	(players-unit-type-count every-enemy galley-line < 2)
	(players-unit-type-count every-enemy longboat-line < 2)
	(players-unit-type-count every-enemy caravel-line < 2)
	(players-unit-type-count every-enemy turtle-ship-line < 1)
	(players-unit-type-count any-enemy fire-ship-line >= 4)
(or	(players-unit-type-count any-enemy fire-ship-line >= 8)
	(unit-type-count-total demolition-ship-line < 3))
;(or	(players-unit-type-count any-enemy fire-ship-line >= 12)
;	(unit-type-count-total demolition-ship-line < 6))
	(unit-type-count-total demolition-ship-line < minNavy); 9
=>
	(set-goal traindemo yes)
	(up-jump-rule 2))
(defrule
	(building-type-count dock >= 1)
	(up-compare-goal biggestenemynavy < 7)
	(players-building-type-count any-enemy dock >= 1)
	(unit-type-count-total demolition-ship-line < 3)
=>
	(up-full-reset-search)
	(up-find-local c: dock c: 1)
	(up-set-target-object search-local c: 0)
	(up-get-point position-object temporary-point-x)
	(up-set-target-point temporary-point-x))
(defrule; end neg jump
	(building-type-count dock >= 1)
	(up-compare-goal biggestenemynavy < 7)
	(players-building-type-count any-enemy dock >= 1)
	(unit-type-count-total demolition-ship-line < 3)
(or	(up-compare-const extra-water-focus == 1)
	(and	(up-set-target-object search-local c: 0)
		(or	(up-point-terrain temporary-point-x == terrain-walkable-shallows-mangrove)
			(up-point-terrain temporary-point-x == terrain-mangrove-forest))))
=>
	(set-goal traindemo yes))
(defrule
	(goal enemy-boats yes)
	(up-research-status c: ri-fast-fire-ship >= research-available)
(or	(up-research-status c: ri-galleon <= research-unavailable)
(or	(civ-selected berbers)
(or	(up-research-status c: ri-dry-dock >= research-available)
	(up-research-status c: ri-greek-fire >= research-available))))
	(unit-type-count-total fire-ship-line < 12)
	(unit-type-count-total fire-ship-line g:< biggestenemynavy)
	(up-compare-goal biggestenemynavy < 36)
	(up-compare-goal navycount < 18)
=>
	(set-goal trainfire yes)
	(up-jump-rule 4))
(defrule
(or	(up-research-status c: ri-fast-fire-ship >= research-pending)
	(up-research-status c: ri-greek-fire >= research-pending))
	(players-unit-type-count every-enemy demolition-ship-line < 2)
	(players-unit-type-count every-enemy turtle-ship-line < 2)
(or	(players-unit-type-count focus-player galley-line >= 1)
(or	(players-unit-type-count focus-player caravel-line >= 1)
	(players-unit-type-count focus-player longboat-line >= 1)))
	(unit-type-count-total fire-ship-line < 12); 10
	(unit-type-count-total fire-ship-line g:< biggestenemynavy)
	(up-compare-goal biggestenemynavy < 36)
	(up-compare-goal navycount < 18); 15
=>
	(set-goal trainfire yes)
	(up-jump-rule 3))
(defrule
	(current-age <= castle-age)
(or	(goal position-goal flank)
	(up-compare-goal gl-threat-source == warship-class))
	(players-unit-type-count every-enemy demolition-ship-line < 1)
	(players-unit-type-count every-enemy turtle-ship-line < 1)
	(players-unit-type-count focus-player galley-line >= 1)
(or	(unit-type-count-total galley-line < 1)
	(up-research-status c: ri-fast-fire-ship >= research-pending))
	(unit-type-count-total fire-ship-line < 12); 10
	(unit-type-count-total fire-ship-line g:< biggestenemynavy)
	(up-compare-goal biggestenemynavy < 30)
	(up-compare-goal navycount < 15)
=>
	(set-goal trainfire yes)
	(up-jump-rule 2))
(defrule
(or	(building-type-count-total blacksmith >= 1)
	(up-research-status c: castle-age >= research-available))
(or	(gold-amount >= 230)
	(strategic-number sn-current-age >= fcastlea))
(or	(goal inseln yes)
	(population < max-civ-pop))
	(wood-amount >= farmcamp-cost)
(or	(goal siegereq yes)
	(unit-type-count-total cannon-galleon-line >= 4))
=>
	(set-goal traingalley yes))
(defrule
(or	(goal dreitc yes)
(or	(population >= max-civ-pop)
(or	(up-compare-goal custom-civ-pop >= up-max-civ)
	(wood-amount >= 295))))
	(strategic-number sn-current-age >= castlea)
	(wood-amount >= farmcamp-cost)
(or	(goal siegereq yes)
	(unit-type-count-total cannon-galleon-line >= 4))
=>
	(set-goal traingalley yes)); end mini jump
(defrule
(or	(goal dreitc yes)
(or	(population >= max-civ-pop)
(or	(up-compare-goal custom-civ-pop >= up-max-civ)
	(wood-amount >= 295))))
(or	(up-research-status c: ri-galleon <= research-available)
	(up-research-status c: ri-elite-longboat >= research-pending)); for now
	(wood-amount >= farmcamp-cost)
(or	(goal siegereq yes)
	(unit-type-count-total cannon-galleon-line >= 4))
=>
	(set-goal trainlongboat yes))
(defrule
(or	(goal dreitc yes)
(or	(population >= max-civ-pop)
(or	(up-compare-goal custom-civ-pop >= up-max-civ)
	(wood-amount >= 295))))
(or	(up-research-status c: ri-galleon <= research-available)
	(up-research-status c: ri-elite-caravel >= research-pending)); for now
	(wood-amount >= farmcamp-cost)
(or	(goal siegereq yes)
	(unit-type-count-total cannon-galleon-line >= 4))
	(up-compare-goal navycount g:< maxnavy)
=>
	(set-goal traincaravel yes))
(defrule
(or	(up-research-status c: ri-elite-turtle-ship >= research-pending)
(or	(and	(population >= max-civ-pop)
		(up-compare-const wk-game == 1))
(or	(players-unit-type-count any-enemy demolition-ship-line >= 3)
	(players-unit-type-count any-enemy fire-ship-line >= 6))))
(or	(goal dreitc yes)
(or	(wood-amount >= 455)
	(unit-type-count-total turtle-ship-line < 2))); 1
=>
	(set-goal trainturtle yes)); end jump
(defrule
(or	(up-compare-goal navycount >= up-max-civ)
(or	(and	(dropsite-min-distance wood >= 5)
		(wood-amount < 110))
(or	(up-compare-goal fleet != yes)
	(and	(game-time < 180)
		(building-type-count dock < 5)))))
=>
	(up-jump-rule 1))
(defrule
(or	(up-compare-goal enemy-boats == yes)
	(and	(up-compare-goal navycount g:< maxnavy)
		(unit-type-count-total cannon-galleon-line < 1)))
(or	(civilian-population >= up-max-civ)
(or	(population >= max-civ-pop)
	(wood-amount >= 175)))
(or	(unit-type-count-total cannon-galleon-line < 6); 8?
	(population-cap >= 225))
	(unit-type-count-total cannon-galleon-line < minNavy)
=>
	(set-goal traincannon yes))

(defrule
	(goal migration-state 1)
	(building-type-count-total town-center <= 0)
	(wood-amount < 600); 350
=>
	(up-jump-rule 7)); 8
(defrule
(or	(and	(dropsite-min-distance wood >= 5)
		(wood-amount < 110))
(or	(and	(goal siegereq no)
		(unit-type-count-total cannon-galleon-line < 4))
(or	(up-compare-goal fishing != yes)
(or	(population >= max-civ-pop)
	(civilian-population >= up-max-civ)))))
=>
	(up-jump-rule 6)); 7
(defrule
	(building-type-count-total mill < 1)
	(wood-amount < 110)
(or	(unit-type-count-total villager >= 21); 22
(or	(unit-type-count villager-forager >= 1)
	(and	(dropsite-min-distance hunting >= 7)
		(up-compare-goal mysheep < 1))))
=>
	(up-jump-rule 5)); 6
(defrule
	(goal strategy grush)
	(game-time < 1800)
	(strategic-number sn-current-age <= dfeudal)
(or	(strategic-number sn-current-age == dark)
(or	(building-type-count-total dock >= 3)
(or	(and	(players-current-age target-player <= dark-age)
		(building-type-count-total dock >= 2))
	(and	(up-compare-goal navycount g:>= enemyfocusnavy)
		(unit-type-count-total fishing-ship < 4)))))
	(unit-type-count-total fishing-ship < 16)
=>
	(set-goal trainfish yes))
(defrule
; test	(goal fleet yes)
	(strategic-number sn-current-age <= dfeudal)
(or	(strategic-number sn-current-age <= dark)
	(wood-amount >= 480))
	(up-compare-goal biggestenemynavy <= 0)
(or	(unit-type-count-total fishing-ship < 8); 12
(or	(cc-players-unit-type-count 0 shore-fish-class >= shorefishreq)
	(cc-players-unit-type-count 0 ocean-fish-class >= deepfishreq)))
(or	(cc-players-unit-type-count 0 shore-fish-class >= shorefishreq2)
	(cc-players-unit-type-count 0 ocean-fish-class >= deepfishreq2))
	(unit-type-count-total fishing-ship < 12); 16
=>
	(set-goal trainfish yes))
;(defrule
;; test	(goal fleet yes)
;	(strategic-number sn-current-age <= dfeudal)
;(or	(cc-players-unit-type-count 0 shore-fish-class >= 3)
;	(cc-players-unit-type-count 0 ocean-fish-class >= 3))
;	(goal enemy-boats no)
;(or	(and	(up-compare-goal strategy-type >= castle-war)
;		(unit-type-count-total fishing-ship < 4)); 6
;	(unit-type-count-total fishing-ship < 3)); 4
;=>
;	(set-goal trainfish yes))
(defrule
; test	(goal fleet yes)
;	(goal researchplan no)
	(strategic-number sn-current-age <= feudal)
(or	(cc-players-unit-type-count 0 shore-fish-class >= 6); 3
	(cc-players-unit-type-count 0 ocean-fish-class >= 3))
(or	(goal enemy-boats no)
	(up-compare-goal navycount >= 5))
(or	(building-type-count-total blacksmith >= 1)
	(wood-amount >= 475))
	(unit-type-count-total fishing-ship < 4); 8
=>
	(set-goal trainfish yes))
(defrule
; test	(goal fleet yes)
	(goal researchplan no)
	(population < up-max-civ)
(or	(goal enemy-boats no)
(or	(up-compare-goal navycount g:>= biggestenemynavy)
(or	(up-compare-goal navycount g:>= maxnavy)
	(up-compare-goal navycount >= 40))))
	(food-amount < 300)
	(wood-amount >= 250); 350
	(unit-type-count-total fishing-ship < 8)
(or	(game-time < 900)
	(unit-type-count-total fishing-ship < 4))
=>
	(set-goal trainfish yes))
(defrule
; test	(goal fleet yes)
	(strategic-number sn-current-age == fcastlea)
(or	(cc-players-unit-type-count 0 shore-fish-class >= 1)
	(cc-players-unit-type-count 0 ocean-fish-class >= 1))
	(players-unit-type-count focus-player galley-line <= 0)
	(players-unit-type-count focus-player fire-ship-line <= 0)
	(players-unit-type-count focus-player longboat-line <= 0)
	(players-unit-type-count focus-player turtle-ship-line <= 0)
	(players-unit-type-count focus-player cannon-galleon-line <= 0)
	(unit-type-count-total fishing-ship <= 0)
	(wood-amount >= 250)
=>
	(set-goal trainfish yes)
	(disable-self)); end jump
	
#load-if-defined CROSSROADS-MAP
;sometimes the AI gets stuck despite finding main wood as it overbooms fish and runs out of initial wood/stragglers
(defrule
	(unit-type-count-total fishing-ship > 3)
	(building-type-count-total lumber-camp < 2)
	(building-type-count-total dock > 0)
	(current-age == dark-age)
	(wood-amount < 177)
=>
	(set-goal trainfish no)
)

#end-if
;=========================================================
;#load-if-defined POPULATION-CAP-EXTENDED
;#load-if-not-defined POPULATION-CAP-225
;#load-if-not-defined POPULATION-CAP-250
;#load-if-not-defined AZTEC-CIV
;#load-if-not-defined HUN-CIV
;(defrule
;	(goal milunits yes)
;	(strategic-number sn-current-age >= imperial)
;(or	(population > 225)
;	(gold-amount > 4500))
;	(goal researchplan yes)
;	(unit-type-count-total my-unique-unit-line < 800)
;=>
;	(set-goal trainunique yes))
;#else ; Huns
;(defrule
;	(goal milunits yes)
;	(strategic-number sn-current-age >= imperial)
;	(strategic-number moenche < 15)
;(or	(population > 225)
;	(gold-amount > 4500))
;	(goal researchplan yes)
;	(unit-type-count-total knight-line < 800)
;=>
;	(set-goal trainknight yes))
;#end-if
;#else ; Aztecs
;(defrule
;	(goal milunits yes)
;	(strategic-number sn-current-age >= imperial)
;	(strategic-number archers < 33)
;	(strategic-number eagles < 25)
;	(players-unit-type-count focus-player scout-cavalry-line < 22)
;	(players-unit-type-count focus-player woad-raider-line < 33)
;(or	(population > 225)
;	(gold-amount > 4500))
;	(gold-amount >= 300); 200
;	(goal researchplan yes)
;	(goal siegereq yes)
;;	(unit-type-count-total monk-set < 800)
;=>
;	(set-goal trainmonk yes))
;#end-if
;#end-if
;#end-if
;#end-if

#load-if-not-defined BOHEMIANS-CIV
;#load-if-not-defined POLES-CIV

#load-if-not-defined SICILIANS-CIV
;#load-if-not-defined BURGUNDIANS-CIV

#load-if-not-defined INCAN-CIV
#load-if-not-defined INDIAN-CIV
#load-if-not-defined ITALIAN-CIV
;#load-if-not-defined MAGYAR-CIV
#load-if-not-defined SLAVIC-CIV

#load-if-not-defined BERBERS-CIV
#load-if-not-defined BURMESE-CIV
#load-if-not-defined ETHIOPIAN-CIV
#load-if-not-defined KHMER-CIV
#load-if-not-defined MALAY-CIV
#load-if-not-defined MALIAN-CIV
#load-if-not-defined PORTUGUESE-CIV
#load-if-not-defined VIETNAMESE-CIV

#load-if-not-defined BULGARIANS-CIV
#load-if-not-defined TATARS-CIV

#load-if-not-defined AZTEC-CIV
#load-if-not-defined BRITON-CIV
#load-if-not-defined BYZANTINE-CIV
#load-if-not-defined CELTIC-CIV
#load-if-not-defined CHINESE-CIV
;#load-if-not-defined FRANKISH-CIV
#load-if-not-defined KOREAN-CIV
#load-if-not-defined GOTHIC-CIV
;#load-if-not-defined HUN-CIV
#load-if-not-defined JAPANESE-CIV
#load-if-not-defined MAYAN-CIV
#load-if-not-defined MONGOL-CIV
;#load-if-not-defined PERSIAN-CIV
#load-if-not-defined SARACEN-CIV
;#load-if-not-defined SPANISH-CIV
;#load-if-not-defined TEUTONIC-CIV
#load-if-not-defined TURKISH-CIV
#load-if-not-defined VIKING-CIV ; Huns, Franks, Spanish, Persians, Teutons, Cumans, Lithuanians, Magyars, Burgundians

#load-if-not-defined MAGYAR-CIV
(defrule
	(up-compare-goal palagoal != no)
	(goal uugoal yes)
(or	(strategic-number sn-current-age < imperial)
	(goal trainunique yes))
	(up-research-status c: ri-paladin <= research-available)
(or	(up-compare-goal excessFood < 1300)
	(up-compare-goal excessGold < 750))
	(unit-type-count-total knight-line < 6)
=>
	(set-goal palagoal no)
	(up-jump-rule 6))
#end-if
(defrule
(or	(goal palagoal yes)
	(goal strategy fast-imp))
=>
	(up-jump-rule 5))
(defrule
	(civ-selected poles)
	(up-research-status c: ri-szlachta-privileges <= research-available)
=>
	(up-jump-rule 4))
(defrule
	(civ-selected magyar)
	(goal position-goal flank)
	(goal uugoal no)
(or	(and	(up-compare-goal excessGold < 825); 825
		(goal cavagoal no))
	(up-compare-goal tradeunits < 32))
=>
	(up-jump-rule 3))
(defrule
(or	(and	(goal strategy krush)
		(building-type-count-total stable >= 1))
(or	(up-research-status c: ri-cavalier >= research-pending)
(or	(up-research-status c: ri-plate-barding >= research-pending); chain
	(unit-type-count-total knight-line >= 6))))
=>
	(set-goal palagoal yes))
(defrule
	(strategic-number sn-current-age >= cimperial)
(or	(up-compare-goal excessFood >= 2000); 1000
(or	(up-compare-goal excessGold >= 2000); 1000
(or	(or	(or	(up-compare-goal custom-civ-pop >= up-max-civ)
			(civilian-population >= up-max-civ))
		(population >= max-civ-pop))
	(and	(goal champgoal no)
		(goal uugoal no)))))
=>
	(set-goal palagoal yes))
(defrule
	(strategic-number sn-current-age >= cimperial)
	(current-age >= castle-age)
	(up-compare-goal strategy != castledrop)
	(goal uugoal no)
(or	(unit-type-count-total my-unique-unit-line < 4)
	(building-type-count-total castle <= 0))
=>
	(set-goal palagoal yes)); end jump
;#end-if
;#end-if
;#end-if
;#end-if
;#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if

#end-if
#end-if

#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if

#end-if
;#end-if
#end-if
#end-if
#end-if

;#end-if
#end-if

;#end-if
#end-if

(defrule
(or	(up-compare-goal palagoal != yes)
(or	(up-compare-goal milunits != yes)
(or	(strategic-number moenche >= 15)
(or	(strategic-number camels >= 50)
	(strategic-number spears >= 60)))))
=>
	(up-jump-rule 3))
(defrule
	(strategic-number sn-current-age >= imperial)
(or	(strategic-number sn-military-superiority <= -1)
(or	(up-research-status c: ri-paladin >= research-pending)
(or	(gold-amount >= 875)
(or	(and	(up-research-status c: imperial-age == research-pending)
		(gold-amount >= 375))
	(and	(strategic-number sn-current-age >= imperial)
		(gold-amount >= 825))))))
=>
	(set-goal trainknight yes))
(defrule
	(strategic-number camels < 45)
	(strategic-number spears < 50)
(or	(strategic-number husks >= 7)
	(players-unit-type-count focus-player cataphract-line >= 9))
	(unit-type-count-total knight-line < 25)
=>
	(set-goal trainknight yes))
(defrule
	(strategic-number sn-military-superiority <= 0)
(or	(food-amount >= k-buffer-f)
(or	(civilian-population >= up-max-civ)
(or	(population >= max-civ-pop)
	(strategic-number sn-military-superiority <= -1))))
(or	(goal attacking yes)
(or	(gold-amount > 100)
	(unit-type-count-total monk >= 1)))
	(unit-type-count-total knight-line < 25)
=>
	(set-goal trainknight yes)); end jump



(defrule
	(goal milunits yes)
	(up-research-status c: ri-paladin >= research-pending)
	(strategic-number moenche < 15)
	(strategic-number camels < 45)
	(strategic-number spears < 50)
(or	(gold-amount > 300)
(or	(up-research-status c: ri-blast-furnace >= research-pending)
	(up-research-status c: ri-plate-barding >= research-pending)))
(nand	(civ-selected byzantine)
	(up-research-status c: my-unique-unit-upgrade >= research-pending))
=>
	(set-goal trainknight yes))
	
#load-if-defined SICILIANS-CIV ;new balance changes make cavalier really good against archers, less bad against halbs/camel but much weaker to enemy knight-line

(defrule
	(current-age == imperial-age)
=>
	(up-modify-goal temporary-goal7 s:= sn-focus-player-number)
	(set-goal trainknight no)
)

#load-if-defined UP-POCKET-POSITION
(defrule
	(current-age == imperial-age)
	(or(current-age-time < 150)
	(and(up-research-status c: ri-cavalier != 1)
	(up-research-status c: ri-plate-barding != 1)))
	(food-amount > 360)
	(gold-amount > 360)
	(or(up-research-status c: ri-scutage != 1)
	(current-age-time < 400))
	(unit-type-count-total knight-line < 10)
	(players-unit-type-count focus-player knight-line < 10)
	(players-unit-type-count target-player knight-line < 7)
=>
	(set-goal trainknight yes)
)
#end-if

#load-if-not-defined UP-POCKET-POSITION
(defrule
	(current-age == imperial-age)
	(or(current-age-time < 150)
	(and(up-research-status c: ri-cavalier != 1)
	(up-research-status c: ri-plate-barding != 1)))
	(food-amount > 360)
	(gold-amount > 360)
	(or(up-research-status c: ri-scutage != 1)
	(current-age-time < 400))
	(unit-type-count-total knight-line < 4)
	(current-age-time > 300)
	(players-unit-type-count focus-player knight-line < 10)
	(players-unit-type-count target-player knight-line < 7)
=>
	(set-goal trainknight yes)
)
#end-if

(defrule
	(research-completed ri-scutage)
	(research-completed ri-cavalier)
	(research-completed ri-plate-barding)
(or	(unit-type-count-total knight-line < ten-pop)
	(unit-type-count-total knight-line < 8))
	(gold-amount > 750)
	(food-amount > 1000)
=>
	(set-goal trainknight yes)
)
(defrule
	(current-age == imperial-age)
	(or(current-age-time < 150)
	(and(up-research-status c: ri-cavalier != 1)
	(up-research-status c: ri-plate-barding != 1)))
	(food-amount > 360)
	(gold-amount > 360)
	(or(up-research-status c: ri-scutage != 1)
	(current-age-time < 400))
	(unit-type-count-total knight-line < ten-pop)
	(players-unit-type-count focus-player knight-line < 10)
	(players-unit-type-count focus-player archer-line > 10)
=>
	(set-goal trainknight yes)
)
(defrule
	(current-age == imperial-age)
=>
	(up-modify-sn sn-focus-player-number g:= temporary-goal7)
)

#end-if
;=========================================================
; Monks
;=========================================================
(defrule
(or	(game-time >= max-delay)
(or	(up-compare-const ctr-game == 1)
(or	(goal underattack yes)
(or	(strategic-number moenche >= 1)
	(players-building-type-count any-enemy monastery >= 1)))))
	(unit-type-count-total monk-set < 1);	(unit-type-count-total monastery-class < 1)
=>
	(set-goal trainmonk yes))
#load-if-not-defined DIFFICULTY-EASIEST
#load-if-not-defined DIFFICULTY-EASY
#load-if-not-defined DIFFICULTY-MODERATE
(defrule
	(up-research-status c: ri-hussite-reforms >= research-complete)
	(up-compare-goal excessFood >= 800)
	(strategic-number eagles < 20)
	(players-unit-type-count focus-player eagle-warrior-line < 24)
	(strategic-number archers < 28)
(or	(unit-type-count-total monastery-class < 11)
	(up-compare-const diff-fp == 1))
	(unit-type-count-total monastery-class < 20)
=>
	(set-goal trainmonk yes))
(defrule
	(game-time < 2100); 1800
	(unit-type-count 134 <= 0)
(or	(not	(player-in-game any-ally))
	(up-compare-goal strategy-type >= imperial-war))
	(unit-type-count-total monk-set < 4)
(or	(unit-type-count-total monk-set < 3)
	(up-gaia-type-count-total c: relic >= 4));(cc-players-unit-type-count 0 relic >= 4)); 3
(or	(unit-type-count-total monk-set < 2)
	(up-gaia-type-count-total c: relic >= 3));(cc-players-unit-type-count 0 relic >= 3)); 2
	(up-gaia-type-count-total c: relic >= 2);(cc-players-unit-type-count 0 relic >= 2); 1
=>
	(set-goal trainmonk yes))
(defrule
	(cc-players-unit-type-count 0 tree-class < 200)
(or	(cc-players-unit-type-count 0 tree-class < 50)
	(dropsite-min-distance wood > 25))
	(strategic-number archers < 25)
	(players-unit-type-count focus-player eagle-warrior-line < 20)
	(players-unit-type-count focus-player scout-cavalry-line < 16)
	(up-compare-goal excessGold >= 250); 225 ; for now
(or	(up-compare-goal excessGold > 900)
(or	(up-compare-goal tradeunits >= 1)
	(up-compare-goal relic-count >= 1)))
;	(unit-type-count-total monastery-class < 20)
	(goal siegereq yes)
=>
	(set-goal trainmonk yes))
;=========================================================
(defrule
(or	(unit-type-count-total monastery-class >= 20)
(or	(military-population >= 11)
(or	(strategic-number archers >= 9)
(or	(players-unit-type-count focus-player eagle-warrior-line >= 7)
(or	(players-unit-type-count focus-player scout-cavalry-line >= 5)
(or	(population >= max-civ-pop)
	(and	(up-compare-goal milunits != no)
		(up-compare-goal milunits != yes))))))))
=>
	(up-jump-rule 2))
(defrule
;	(wood-amount < 300)
	(up-compare-goal excessFood < 110)
	(up-compare-goal excessGold >= 250);
(or	(up-compare-goal excessGold >= 400); 900?
(or	(up-compare-goal tradeunits >= 20)
	(up-compare-goal relic-count >= 3)))
	(strategic-number sn-military-superiority <= -1); 0?
	(unit-type-count-total monastery-class < 6); 20
=>
	(set-goal trainmonk yes))
(defrule
	(up-compare-goal excessWood < 200)
	(up-compare-goal excessFood < 200)
	(up-compare-goal excessGold >= 800)
	(strategic-number sn-current-age >= imperial)
(or	(up-compare-goal excessGold >= 1600)
(or	(up-compare-goal tradeunits >= 20)
	(up-compare-goal relic-count >= 3)))
	(strategic-number sn-military-superiority <= -1); 0?
	(unit-type-count-total monastery-class < 11); 20
=>
	(set-goal trainmonk yes))
;=========================================================
(defrule
;(or	(up-compare-goal milunits != no)
(or	(military-population >= 13); 15
(or	(and	(strategic-number target-military-superiority >= 0)
		(strategic-number ep-military-superiority >= -1))
(or	(unit-type-count-total monastery-class >= 11); 15
(or	(strategic-number sn-current-age > castlea)
(or	(and	(up-research-status c: imperial-age == research-available)
		(gold-amount < imperial-gs))
	(up-compare-goal escrowing == imperial-age))))));)
=>
	(up-jump-rule 1))
(defrule
(or	(goal position-goal pocket)
	(and	(strategic-number archers < 9)
		(and	(players-unit-type-count focus-player eagle-warrior-line < 7)
			(players-unit-type-count focus-player scout-cavalry-line < 5))))
	(population < up-max-civ); max-civ-pop
(or	(goal milunits no)
(or	(up-compare-goal excessGold >= 200); 900; 600; 300
(or	(up-enemy-units-in-town >= 5)
	(up-compare-goal relic-count >= 3))))
=>
	(set-goal trainmonk yes))
;=========================================================
#load-if-not-defined INFINITE-RESOURCES-START
(defrule
(or	(and	(up-compare-goal tradeunits <= 0)
		(up-compare-goal relic-count <= 0))
(or	(up-research-status c: ri-sanctity <= research-unavailable)
	(and	(current-age >= imperial-age)
		(up-research-status c: ri-theocracy <= research-unavailable))))
	(up-compare-goal excessGold < 6100)
=>
	(up-jump-rule 6))
#end-if
(defrule
	(goal milunits yes)
	(strategic-number sn-military-superiority < 1); 2
	(strategic-number archers < 24)
	(players-unit-type-count focus-player eagle-warrior-line < 20)
	(players-unit-type-count focus-player scout-cavalry-line < 16)
(or	(players-unit-type-count focus-player war-elephant-line >= 6)
(or	(players-unit-type-count focus-player battle-elephant >= 12)
(or	(players-unit-type-count focus-player elite-battle-elephant >= 12)
	(players-unit-type-count focus-player teutonic-knight-line >= 6))))
	(unit-type-count-total monastery-class < 14); 18
	(up-compare-goal excessGold >= 325); 200
=>
	(set-goal trainmonk yes))
(defrule
	(goal milunits yes)
	(strategic-number sn-military-superiority < 1); 2
	(strategic-number archers < 24)
	(players-unit-type-count focus-player eagle-warrior-line < 20)
	(players-unit-type-count focus-player scout-cavalry-line < 16)
(or	(players-unit-type-count focus-player tarkan-line >= 24)
(or	(players-unit-type-count focus-player keshik >= 24)
(or	(players-unit-type-count focus-player elite-keshik >= 24)
	(players-unit-type-count focus-player leitis >= 24))))
	(unit-type-count-total monastery-class < 14); 18
	(up-compare-goal excessGold >= 325); 200
=>
	(set-goal trainmonk yes))
(defrule
	(goal milunits yes)
	(strategic-number sn-military-superiority < 1); 2
	(strategic-number archers < 24)
	(players-unit-type-count focus-player eagle-warrior-line < 20)
	(players-unit-type-count focus-player scout-cavalry-line < 16)
(or	(players-unit-type-count focus-player elite-leitis >= 24)
(or	(players-unit-type-count focus-player konnik >= 24)
(or	(players-unit-type-count focus-player elite-konnik >= 24)
	(players-unit-type-count focus-player flaming-camel >= 6))))
	(unit-type-count-total monastery-class < 14); 18
	(up-compare-goal excessGold >= 325); 200
=>
	(set-goal trainmonk yes))
(defrule
	(goal milunits yes)
	(strategic-number sn-military-superiority < 1); 2
	(strategic-number archers < 24)
	(players-unit-type-count focus-player eagle-warrior-line < 20)
	(players-unit-type-count focus-player scout-cavalry-line < 16)
(or	(players-unit-type-count focus-player boyar >= 18)
(or	(players-unit-type-count focus-player elite-boyar >= 18)
(or	(players-unit-type-count focus-player knight-line >= 24)
	(strategic-number camels >= 30))))
	(unit-type-count-total monastery-class < 11); 15
	(up-compare-goal excessGold >= 325); 200
=>
	(set-goal trainmonk yes))
(defrule
	(goal milunits yes)
	(strategic-number sn-military-superiority < 3); 2
	(strategic-number archers < 26)
	(players-unit-type-count focus-player eagle-warrior-line < 22)
	(players-unit-type-count focus-player scout-cavalry-line < 18)
	(unit-type-count-total hand-cannoneer < 16)
	(unit-type-count archery-cannon-class < 16)
	(unit-type-count-total samurai-line < 16)
	(unit-type-count-total jaguar-man-line < 16)
	(strategic-number husks >= 6)
	(unit-type-count-total monastery-class < 14); 18
	(up-compare-goal excessGold >= 325); 200
=>
	(set-goal trainmonk yes))
(defrule
	(goal milunits yes)
	(goal enemy-goal rush)
	(strategic-number sn-military-superiority < 3)
	(strategic-number archers < 10)
	(players-unit-type-count focus-player eagle-warrior-line < 7)
	(players-unit-type-count focus-player scout-cavalry-line < 5)
(or	(players-building-type-count focus-player stable >= 1)
	(players-unit-type-count focus-player knight-line >= 3))
	(players-building-type-count focus-player archery-range <= 0)
	(unit-type-count-total monastery-class < 6); 15
(or	(strategic-number sn-military-superiority <= 0); -1
	(up-compare-goal excessGold >= 200))
=>
	(set-goal trainmonk yes)); end jump
;=========================================================
#load-if-defined AZTEC-CIV
(defrule
	(goal milunits yes)
;	(up-compare-goal strategy != stonewall); test
	(strategic-number archers < 20)
	(players-unit-type-count focus-player eagle-warrior-line < 17)
	(players-unit-type-count focus-player scout-cavalry-line < 14)
(or	(up-compare-goal relic-count >= 3)
(or	(strategic-number sn-military-superiority <= -2)
(or	(up-compare-goal excessGold >= 1200)
	(and	(up-research-status c: ri-fervor >= research-pending)
		(up-research-status c: ri-herbal-medicine >= research-pending)))))
;	(unit-type-count-total monastery-class < 70)
	(up-compare-goal excessGold >= 300); 200
=>
	(set-goal trainmonk yes))
#end-if
#end-if; di
#end-if; ff
#end-if; iculty (for now)
;=========================================================
; Knights
;=========================================================
;(defrule
;	(goal milunits yes)
;	(strategic-number moenche < 10)
;(or	(strategic-number siege >= 3)
;(or	(players-unit-type-count focus-player battering-ram-line >= 3)
;(or	(players-unit-type-count focus-player archer-line >= 7)
;	(strategic-number skirms >= 7))))
;	(food-amount >= 160)
;	(gold-amount >= 210)
;	(unit-type-count-total knight-line <= 17)
;=>
;	(set-goal trainknight yes))
;=========================================================
(defrule
	(goal milunits yes)
	(strategic-number moenche < 10)
	(strategic-number spears < 10)
	(strategic-number sn-current-age <= castlea)
(or	(up-compare-goal mangonel-set <= 1)
(or	(players-unit-type-count focus-player mangonel-line >= 3)
	(players-unit-type-count focus-player bombard-cannon >= 1)))
	(strategic-number siege >= 3)
	(strategic-number sn-military-superiority <= -1)
(or	(food-amount >= k-buffer-f)
	(civilian-population >= up-max-civ))
	(unit-type-count-total knight-line < 12)
=>
	(set-goal trainknight yes))
;=========================================================
(defrule
	(goal milunits yes)
	(goal attacking no)
	(strategic-number moenche < 10)
	(enemy-buildings-in-town)
	(players-building-type-count focus-player watch-tower-line > 0)
	(strategic-number spears < 12)
	(up-compare-goal camel-set < 10)
	(unit-type-count-total scout-cavalry-line < 8)
	(unit-type-count-total knight-line < 6)
	(unit-type-count-total siege-weapon-class <= 0)
	(unit-type-count-total trebuchet-set <= 0)
;	(building-type-count castle == 0)
=>
	(set-goal trainknight yes))
;=========================================================
(defrule
	(goal milunits yes)
	(strategic-number moenche < 10)
	(strategic-number sn-current-age <= castlea)
	(strategic-number spears < 30)
	(strategic-number camels < 25)
(or	(players-unit-type-count focus-player scorpion-line >= 4)
	(players-unit-type-count focus-player mangonel-line >= 2))
	(unit-type-count-total knight-line < 8)
=>
	(set-goal trainknight yes))
;=========================================================
(defrule
	(goal milunits yes)
	(strategic-number moenche < 10)
	(strategic-number sn-current-age <= castlea)
	(strategic-number spears < 40)
	(strategic-number camels < 35)
(or	(players-unit-type-count focus-player scorpion-line >= 8)
	(players-unit-type-count focus-player mangonel-line >= 4))
	(unit-type-count-total knight-line < 14)
=>
	(set-goal trainknight yes))
;=========================================================
(defrule
	(goal milunits yes)
	(strategic-number moenche < 10)
	(strategic-number spears < 30)
	(strategic-number camels < 25)
	(goal enemy-goal rush)
	(building-type-count castle == 0)
	(strategic-number sn-military-superiority <= -1)
(or	(food-amount >= k-buffer-f)
(or	(strategic-number sn-military-superiority <= -2)
	(goal defend yes)))
	(unit-type-count-total knight-line < 15)
=>
	(set-goal trainknight yes))
;=========================================================
;(defrule
;	(goal milunits yes)
;(nor	(strategic-number moenche >= 10)
;(or	(strategic-number spears >= 30)
;	(strategic-number camels >= 25)))
;(or	(research-available ri-cavalier)
;(or	(research-available ri-paladin)
;	(up-research-status c: ri-paladin >= research-pending)))
;	(players-unit-type-count focus-player cataphract-line > 11)
;	(unit-type-count-total knight-line <= 30)
;=>
;	(set-goal trainknight yes))
;=========================================================
(defrule
	(up-research-status c: imperial-age >= research-pending)
	(goal underattack no)
	(up-compare-goal palagoal != yes)
(or	(and	(goal defend no)
		(strategic-number sn-military-superiority >= -2)); 0
	(strategic-number sn-military-superiority >= 0)); 1
=>
	(up-jump-rule 3)); 4
(defrule
(or	(population >= max-civ-pop)
(or	(and	(up-research-status c: imperial-age >= research-pending)
		(and	(building-type-count castle >= 1)
			(goal uugoal yes)))
(or	(strategic-number teamsuperiority >= 2);(and	(up-research-status c: ri-forging < research-pending)
							;(up-research-status c: ri-scale-barding < research-pending))
	(and	(strategic-number sn-military-superiority >= 0)
		(military-population >= 30)))))
=>
	(up-jump-rule 2)); 3
(defrule
(or	(strategic-number sn-military-superiority >= 0); 1
(or	(current-age >= imperial-age)	;(and	(civ-selected saracen)
		;	(strategic-number sn-current-age >= imperial))
(or	(building-type-count stable < 1)
(or	(up-compare-goal milunits != yes)
(or	(strategic-number spears >= 25)
(or	(strategic-number camels >= 20)
	(strategic-number moenche >= 10)))))))
=>
	(up-jump-rule 1)); 2
(defrule
(or	(strategic-number sn-military-superiority <= -2)
(or	(up-compare-goal excessFood >= k-buffer-f)
(or	(up-compare-goal custom-civ-pop >= up-max-civ)
	(goal underattack yes))))
;(up-research-status c: imperial-age < research-pending);(nand	(building-type-count castle >= 1)
;	(strategic-number sn-current-age >= imperial))
(or	(strategic-number sn-military-superiority <= -1)
	(goal defend yes))
(or	(unit-type-count-total knight-line < 20); 16
	(goal palagoal yes))
=>
	(set-goal trainknight yes))
;(defrule
;(or	(players-unit-type-count focus-player militiaman-line > 5)
;(or	(players-unit-type-count focus-player archer-line > 7)
;(or	(players-unit-type-count focus-player eagle-warrior-line > 5)
;	(strategic-number skirms > 10))))
;	(building-type-count castle == 0)
;;tl	(food-amount >= k-buffer-f)
;	(strategic-number sn-military-superiority <= -1)
;	(unit-type-count-total knight-line < 18)
;=>
;	(set-goal trainknight yes))
;=========================================================
(defrule
	(goal milunits yes)
	(gold-amount >= 100)
	(strategic-number moenche < 10)
	(strategic-number spears < 20)
	(strategic-number camels < 15)
	(goal enemy-goal flush)
	(building-type-count castle == 0)
	(food-amount >= k-buffer-f)
	(strategic-number sn-military-superiority <= -1)
	(unit-type-count-total knight-line < 11)
=>
	(set-goal trainknight yes))
;=========================================================
(defrule
	(goal milunits yes)
	(strategic-number moenche < 10)
	(building-type-count castle == 0)
(or	(goal enemy-goal rush)
	(players-unit-type-count focus-player eagle-warrior-line > 10))
	(players-unit-type-count focus-player eagle-warrior-line > 4)
	(strategic-number spears < 25)
	(strategic-number sn-military-superiority <= -2)
	(unit-type-count-total knight-line < 12)
=>
	(set-goal trainknight yes))
;=========================================================
;(defrule
;	(goal milunits yes)
;	(strategic-number moenche < 10)
;	(strategic-number spears < 30)
;	(strategic-number camels < 25)
;	(research-completed ri-cavalier)
;	(players-unit-type-count focus-player knight-line > 34)
;	(unit-type-count-total knight-line < 18)
;=>
;	(set-goal trainknight yes))
;=========================================================
(defrule
	(goal milunits yes);
	(strategic-number sn-military-superiority <= 3)
	(strategic-number moenche < 10)
	(strategic-number spears < 45)
	(strategic-number camels < 35)
(or	(strategic-number sn-military-superiority <= -3)
;(or
	(goal underattack yes)
;	(goal attacking yes))
)
	(building-type-count castle == 0)
	(unit-type-count-total knight-line < 12)
=>
	(set-goal trainknight yes))
;=========================================================
; Pikes
;=========================================================
(defrule
;	(goal nomaden yes)
	(up-compare-goal inseln != yes)
	(goal scouting yes)
(not	(players-building-count every-enemy >= 1))
	(military-population < 1)
	(unit-type-count-total spearman-line < 1)
=>
	(set-goal trainpike yes)
;	(disable-self) ; can-train may not be true ; it should be fine like it is as of now anyway ; + wolves
)
;=========================================================
(defrule
(nor	(civ-selected celtic)
(or	(civ-selected korean)
	(civ-selected khmer)))
=>
	(up-jump-rule 3))
(defrule
(or	(goal trainchamp yes)
(or	(goal trainhussar yes)
(or	(goal trainbattle yes)
(or	(goal trainknight yes)
(or	(goal traincondottiero yes)
	(and	(goal trainunique yes)
		(or	(up-compare-const uu-type == infantry-uu)
			(up-compare-const uu-type == cavalry-uu))))))))
=>
	(up-jump-rule 2))
(defrule
(or	(unit-type-count cavalry-class >= 7)
	(unit-type-count infantry-class >= 7))
=>
	(up-jump-rule 1))
(defrule
	(goal milunits yes)
	(goal allowspears yes)
	(population < siege-pop)
	(food-amount >= pk-buffer-f)
	(strategic-number infantry < 36); 28
	(strategic-number archers < 33); 25
	(unit-type-count-total my-unique-unit-line < 9)
(or	(unit-type-count-total scorpion-line >= 9)
	(up-compare-goal mangonel-set >= 7))
;(or	(up-research-status c: ri-heavy-scorpion >= research-pending)
;	(up-research-status c: ri-siege-onager >= research-pending))
	(unit-type-count-total spearman-line < 20); 16
=>
	(set-goal trainpike yes))
;=========================================================
(defrule
	(enemy-buildings-in-town);
	(up-building-type-in-town c: watch-tower == 1)
	(up-compare-goal ttower-distance < 32)
	(goal milunits yes)
	(goal allowspears yes)
	(goal attacking no)
	(strategic-number moenche < 18)
	(unit-type-count-total knight-line < 1)
	(unit-type-count-total eagle-warrior-line < 2)
	(food-amount >= pk-buffer-f);
;	(building-type-count castle == 0)
	(unit-type-count battering-ram <= 0)
	(unit-type-count-total spearman-line < 6)
=>
	(set-goal trainpike yes))
;=========================================================
(defrule
;	(goal milunits yes)
	(goal allowspears yes); hmm
	(current-age < castle-age)
	(goal attacking no)
(or	(up-unit-type-in-town c: knight-line >= 2)
(or	(up-unit-type-in-town c: camel-line >= 2)
	(up-unit-type-in-town c: scout-cavalry-line >= 4)))
	(unit-type-count-total spearman-line < 4)
=>
	(set-goal trainpike yes))
;=========================================================
(defrule
	(goal milunits yes)
	(goal allowspears yes)
	(strategic-number moenche < 18)
	(strategic-number sn-military-superiority <= -1)
(or	(strategic-number sn-current-age == fcastlea)
	(strategic-number sn-current-age == castlea))
	(food-amount >= pk-buffer-f)
	(wood-amount >= farm-cost)
	(players-building-type-count focus-player stable >= 1)
	(strategic-number archers < 5)
	(unit-type-count-total spearman-line < 6)
=>
	(set-goal trainpike yes))
;=========================================================
(defrule
	(goal milunits yes)
	(goal allowspears yes)
	(strategic-number moenche < 18)
	(strategic-number sn-military-superiority <= 0)
(or	(strategic-number sn-current-age == fcastlea)
	(strategic-number sn-current-age == castlea))
	(up-compare-goal enemy-goal == flush)
	(players-building-type-count focus-player archery-range < 1)
	(strategic-number skirmsarchers < 1); (strategic-number archers < 3)
	(food-amount >= pk-buffer-f)
	(unit-type-count-total spearman-line < 3)
=>
	(set-goal trainpike yes))
;=========================================================
(defrule
	(goal milunits yes)
	(goal allowspears yes)
	(strategic-number moenche < 18)
	(strategic-number sn-military-superiority <= -1)
(or	(strategic-number sn-current-age == fcastlea)
	(strategic-number sn-current-age == castlea))
	(players-building-type-count focus-player stable >= 2)
	(strategic-number skirmsarchers < 1); (strategic-number archers < 3)
	(food-amount >= pk-buffer-f)
	(unit-type-count-total spearman-line < 9)
=>
	(set-goal trainpike yes))
;=========================================================
(defrule
	(goal milunits yes)
	(goal allowspears yes)
	(goal enemy-goal rush)
	(strategic-number moenche < 3)
	(strategic-number infantry < 5)
;	(strategic-number cavalry < 5)
	(strategic-number archers < 3)
;	(strategic-number gunpowder < 3)
	(strategic-number siege < 3)
	(strategic-number husks < 3)
;	(food-amount >= pk-buffer-f)
	(players-building-type-count focus-player siege-workshop <= 1)
	(players-building-type-count focus-player barracks <= 1)
	(players-building-type-count focus-player archery-range <= 0)
	(players-building-type-count focus-player castle <= 0)
	(strategic-number sn-military-superiority <= 0)
	(unit-type-count-total spearman-line < 6)
=>
	(set-goal trainpike yes))
;=========================================================
#load-if-not-defined TURKISH-CIV
(defrule
	(goal milunits yes)
	(goal allowspears yes)
	(strategic-number moenche < 18)
	(strategic-number cavalry >= 3)
	(strategic-number sn-current-age <= castlea)
(or	(food-amount >= pk-buffer-f)
(or	(goal underattack yes)
	(strategic-number sn-military-superiority <= -2)))
(or	(unit-type-count-total spearman-line < 4); 5
	(and	(players-current-age focus-player >= castle-age)
		(unit-type-count-total spearman-line < 6))); 7
=>
	(set-goal trainpike yes))
;=========================================================
(defrule
	(goal milunits yes)
	(goal allowspears yes)
	(strategic-number moenche < 18)
	(strategic-number cavalry >= 5)
	(food-amount >= pk-buffer-f)
	(unit-type-count-total spearman-line < 8); 10
=>
	(set-goal trainpike yes))
;=========================================================
(defrule
	(goal milunits yes)
	(goal allowspears yes)
	(strategic-number cavalry >= 7)
	(food-amount >= pk-buffer-f)
	(unit-type-count-total spearman-line < 12); 14
=>
	(set-goal trainpike yes))
;=========================================================
(defrule
	(goal milunits yes)
	(goal allowspears yes)
	(strategic-number cavalry >= 10)
	(food-amount >= pk-buffer-f)
	(unit-type-count-total spearman-line < 16); 18
=>
	(set-goal trainpike yes))
;=========================================================
(defrule
	(goal milunits yes)
	(goal allowspears yes)
	(strategic-number cavalry >= 15)
	(food-amount >= pk-buffer-f)
	(unit-type-count-total spearman-line < 24); 25
=>
	(set-goal trainpike yes))
;=========================================================
(defrule
	(goal milunits yes)
	(goal allowspears yes)
	(strategic-number cavalry >= 25)
	(food-amount >= pk-buffer-f)
	(unit-type-count-total spearman-line < 40)
=>
	(set-goal trainpike yes))
;=========================================================
(defrule
	(goal milunits yes)
	(goal allowspears yes)
	(strategic-number cavalry >= 40)
	(food-amount >= pk-buffer-f)
	(unit-type-count-total spearman-line < 60)
=>
	(set-goal trainpike yes))
;=========================================================
(defrule
(nor	(civ-selected byzantine)
(or	(civ-selected gothic)
(or	(civ-selected malian)
(or	(civ-selected burmese)
(or	(civ-selected slavic)
	(civ-selected teutonic))))))
=>
	(up-jump-rule 8))
(defrule
	(goal milunits yes)
	(goal allowspears yes)
	(strategic-number moenche < 18)
	(strategic-number cavalry >= 3)
	(strategic-number sn-current-age <= castlea)
	(food-amount >= pk-buffer-f)
(or	(unit-type-count-total spearman-line < 5); 6
	(and	(players-current-age focus-player >= castle-age)
		(unit-type-count-total spearman-line < 7))); 8
=>
	(set-goal trainpike yes))
(defrule
	(goal milunits yes)
	(goal allowspears yes)
	(strategic-number moenche < 18)
	(strategic-number cavalry >= 5)
	(food-amount >= pk-buffer-f)
	(unit-type-count-total spearman-line < 9); 12
=>
	(set-goal trainpike yes))
(defrule
	(goal milunits yes)
	(goal allowspears yes)
	(strategic-number cavalry >= 7)
	(food-amount >= pk-buffer-f)
	(unit-type-count-total spearman-line < 13); 16
=>
	(set-goal trainpike yes))
(defrule
	(goal milunits yes)
	(goal allowspears yes)
	(strategic-number cavalry >= 10)
	(food-amount >= pk-buffer-f)
	(unit-type-count-total spearman-line < 18); 20
=>
	(set-goal trainpike yes))
(defrule
	(goal milunits yes)
	(goal allowspears yes)
	(strategic-number cavalry >= 15)
	(food-amount >= pk-buffer-f)
	(unit-type-count-total spearman-line < 28); 30
=>
	(set-goal trainpike yes))
(defrule
	(goal milunits yes)
	(goal allowspears yes)
	(strategic-number cavalry >= 25)
	(food-amount >= pk-buffer-f)
	(unit-type-count-total spearman-line < 46)
=>
	(set-goal trainpike yes))
(defrule
	(goal milunits yes)
	(goal allowspears yes)
	(strategic-number cavalry >= 40)
	(food-amount >= pk-buffer-f)
	(unit-type-count-total spearman-line < 65)
=>
	(set-goal trainpike yes))
(defrule
	(population-cap >= 400)
	(goal milunits yes)
	(goal allowspears yes)
	(strategic-number cavalry >= 40)
	(food-amount >= pk-buffer-f)
	(unit-type-count-total spearman-line < 130)
=>
	(set-goal trainpike yes)); end jump
;=========================================================

#else ; Turks

(defrule
	(goal milunits yes)
	(goal allowspears yes)
	(strategic-number moenche < 18)
	(strategic-number cavalry >= 3)
	(strategic-number sn-current-age <= castlea)
(or	(building-type-count stable < 1)
	(and	(goal enemy-goal rush)
		(gold-amount < 60)))
	(food-amount >= pk-buffer-f)
(or	(unit-type-count-total spearman-line < 3)
	(players-current-age focus-player >= castle-age))
	(unit-type-count-total spearman-line < 5); 6
=>
	(set-goal trainpike yes))
;=========================================================
(defrule
	(goal milunits yes)
	(goal allowspears yes)
	(strategic-number moenche < 18)
	(strategic-number cavalry >= 5)
(or	(building-type-count stable < 1)
	(and	(goal enemy-goal rush)
		(gold-amount < 60)))
	(food-amount >= pk-buffer-f)
	(unit-type-count-total spearman-line < 7); 9
=>
	(set-goal trainpike yes))
;=========================================================
(defrule
	(goal milunits yes)
	(goal allowspears yes)
	(strategic-number cavalry >= 7)
	(building-type-count stable < 1)
	(food-amount >= pk-buffer-f)
	(unit-type-count-total spearman-line < 9); 12
=>
	(set-goal trainpike yes))
;=========================================================
(defrule
	(goal milunits yes)
	(goal allowspears yes)
	(strategic-number cavalry >= 10)
	(building-type-count stable < 1)
	(food-amount >= pk-buffer-f)
	(unit-type-count-total spearman-line < 13); 15
=>
	(set-goal trainpike yes))
;=========================================================
(defrule
	(goal milunits yes)
	(goal allowspears yes)
	(strategic-number cavalry >= 15)
	(building-type-count stable < 1)
	(food-amount >= pk-buffer-f)
	(unit-type-count-total spearman-line < 19); 21
=>
	(set-goal trainpike yes))
;=========================================================
(defrule
	(goal milunits yes)
	(goal allowspears yes)
	(strategic-number cavalry >= 25)
	(building-type-count stable < 1)
	(food-amount >= pk-buffer-f)
	(unit-type-count-total spearman-line < 29); 31
=>
	(set-goal trainpike yes))
;=========================================================
(defrule
	(goal milunits yes)
	(goal allowspears yes)
	(strategic-number cavalry >= 40)
	(building-type-count stable < 1)
	(food-amount >= pk-buffer-f)
	(unit-type-count-total spearman-line < 44); 47
=>
	(set-goal trainpike yes)); camels below
#end-if

(defrule
	(goal milunits yes)
	(goal allowspears yes)
	(goal enemy-goal flush)
	(food-amount >= pk-buffer-f)
(or	(goal underattack yes)
	(strategic-number sn-military-superiority <= 0))
	(players-current-age focus-player == feudal-age)
(or	(players-building-type-count focus-player archery-range <= 0)
	(players-building-type-count focus-player stable >= 1))
	(strategic-number skirmsarchers < 1); (strategic-number archers < 3)
	(players-unit-type-count focus-player militiaman-line < 1)
	(unit-type-count-total spearman-line < 4)
=>
	(set-goal trainpike yes))
;=========================================================
;(defrule
;	(goal milunits yes)
;	(goal allowspears yes)
;	(goal enemy-goal flush)
;	(food-amount >= pk-buffer-f)
;(or	(goal underattack yes)
;	(strategic-number sn-military-superiority <= 0))
;	(players-unit-type-count focus-player scout-cavalry-line > 1)
;	(players-current-age focus-player == feudal-age)
;	(unit-type-count-total spearman-line < 4)
;=>
;	(set-goal trainpike yes))
;=========================================================
(defrule
	(goal milunits yes)
	(goal allowspears yes)
	(goal enemy-goal flush)
	(food-amount >= pk-buffer-f)
(or	(players-building-type-count focus-player stable >= 1)
	(players-unit-type-count focus-player scout-cavalry-line >= 2))
(or	(goal underattack yes)
	(strategic-number sn-military-superiority <= 0))
	(players-current-age focus-player == feudal-age)
	(unit-type-count-total spearman-line < 4)
=>
	(set-goal trainpike yes))
;=========================================================
(defrule
	(goal milunits yes)
	(goal allowspears yes)
	(food-amount >= pk-buffer-f)
(or	(players-building-type-count focus-player stable >= 2)
	(strategic-number cavalry >= 3))
	(goal enemy-goal rush)
(or	(goal underattack yes)
	(strategic-number sn-military-superiority <= 0))
	(strategic-number sn-military-superiority <= 1)
	(unit-type-count-total spearman-line < 8); 9
=>
	(set-goal trainpike yes))
;=========================================================
#load-if-not-defined TURKISH-CIV
(defrule
	(goal milunits yes)
	(goal allowspears yes)
	(up-compare-goal excessWood >= pk-buffer-wc)
	(up-compare-goal excessFood >= pk-buffer-f)
	(strategic-number moenche < 18)
	(strategic-number sn-military-superiority <= -1)
	(commodity-selling-price wood < 50)
	(commodity-selling-price food < 50)
	(unit-type-count-total spearman-line < 12)
	(strategic-number cavalry >= 5)
=>
	(set-goal trainpike yes))
#end-if

(defrule
(nor	(civ-selected byzantine)
	(civ-selected gothic))
=>
	(up-jump-rule 3))
(defrule
(or	(players-civ focus-player byzantine)
(or	(players-civ focus-player gothic)
(or	(players-civ focus-player japanese)
;(or	(players-civ focus-player lithuanians)
	(players-civ focus-player slavic))));)
=>
	(up-jump-rule 2))
(defrule
(or	(strategic-number archers >= 25)
(or	(strategic-number gunpowder >= 25)
(or	(and	(goal position-goal pocket)
		(up-compare-goal tradeunits >= 3))
	(population >= siege-pop))))
=>
	(up-jump-rule 1))
(defrule
	(goal milunits yes)
	(goal allowspears yes)
	(strategic-number moenche < 18)
	(up-research-status c: ri-pikeman != research-available); test
	(up-research-status c: ri-halberdier != research-available)
	(food-amount >= pk-buffer-f)
(or	(strategic-number cavalry >= 7)
	(strategic-number sn-military-superiority <= -1))
	(up-compare-goal excessGold < 225); test
	(players-unit-type-count focus-player spearman-line >= 6)
	(strategic-number spears g:> spearcount)
(or	(unit-type-count-total spearman-line < 30)
	(population < max-civ-pop))
=>
	(set-goal trainpike yes)); end jumps
;=========================================================
; Skirmishers
;=========================================================
#load-if-not-defined BYZANTINE-CIV
(defrule
	(goal milunits yes)
	(strategic-number moenche < 18)
(or	(players-unit-type-count focus-player mameluke-line >= 3)
	(strategic-number archers >= 3))
	(strategic-number sn-current-age <= castlea)
(or	(food-amount >= sk-buffer-f)
(or	(strategic-number sn-military-superiority <= -2); test
	(goal underattack yes)))
	(up-compare-goal skirmisher-set < 6); 8 
=>
	(set-goal trainskirm yes))
;=========================================================
(defrule
	(goal milunits yes)
	(strategic-number moenche < 18)
(or	(players-unit-type-count focus-player mameluke-line >= 5)
	(strategic-number archers >= 5))
	(food-amount >= sk-buffer-f)
	(up-compare-goal skirmisher-set < 10); 11
=>
	(set-goal trainskirm yes))
;=========================================================
(defrule
	(goal milunits yes)
	(strategic-number moenche < 18)
(or	(players-unit-type-count focus-player mameluke-line >= 7)
	(strategic-number archers >= 7))
(or	(food-amount >= sk-buffer-f)
	(goal underattack yes))
	(up-compare-goal skirmisher-set < 14); 16
=>
	(set-goal trainskirm yes))
;=========================================================
(defrule
	(goal milunits yes)
(or	(players-unit-type-count focus-player mameluke-line >= 10)
	(strategic-number archers >= 10))
	(food-amount >= sk-buffer-f)
	(up-compare-goal skirmisher-set < 20); 21
=>
	(set-goal trainskirm yes))
;=========================================================
(defrule
	(goal milunits yes)
(or	(players-unit-type-count focus-player mameluke-line >= 15)
	(strategic-number archers >= 15))
	(food-amount >= sk-buffer-f)
(or	(up-research-status c: ri-hand-cart >= research-pending)
(or	(goal defend yes)
	(strategic-number sn-military-superiority <= 0)))
	(up-compare-goal skirmisher-set < 30); 32
=>
	(set-goal trainskirm yes))
;=========================================================
(defrule
	(goal milunits yes)
(or	(players-unit-type-count focus-player mameluke-line >= 25)
	(strategic-number archers >= 25))
	(food-amount >= sk-buffer-f)
(or	(up-research-status c: ri-hand-cart >= research-pending)
(or	(goal defend yes)
	(strategic-number sn-military-superiority <= 0)))
	(up-compare-goal skirmisher-set < 48)
=>
	(set-goal trainskirm yes))
;=========================================================
(defrule
	(goal milunits yes)
(or	(players-unit-type-count focus-player mameluke-line >= 40)
	(strategic-number archers >= 40))
	(food-amount >= sk-buffer-f)
(or	(up-research-status c: ri-hand-cart >= research-pending)
(or	(goal defend yes)
	(strategic-number sn-military-superiority <= 0)))
	(up-compare-goal skirmisher-set < 60)
=>
	(set-goal trainskirm yes))
(defrule
	(population-cap >= 400)
	(goal milunits yes)
(or	(players-unit-type-count focus-player mameluke-line >= 40)
	(strategic-number archers >= 40))
	(food-amount >= sk-buffer-f)
(or	(up-research-status c: ri-hand-cart >= research-pending)
(or	(goal defend yes)
	(strategic-number sn-military-superiority <= 0)))
	(up-compare-goal skirmisher-set < 200)
=>
	(set-goal trainskirm yes))

#else ; byzantines

(defrule
	(goal milunits yes)
	(strategic-number moenche < 18)
(or	(players-unit-type-count focus-player mameluke-line >= 3)
	(strategic-number archers >= 3))
	(strategic-number sn-current-age <= castlea)
(or	(food-amount >= sk-buffer-f)
(or	(strategic-number sn-military-superiority <= -2); test
	(goal underattack yes)))
	(up-compare-goal skirmisher-set < 8); 9
=>
	(set-goal trainskirm yes))
;=========================================================
(defrule
	(goal milunits yes)
	(strategic-number moenche < 18)
(or	(players-unit-type-count focus-player mameluke-line >= 5)
	(strategic-number archers >= 5))
(or	(food-amount >= sk-buffer-f)
	(goal underattack yes))
	(up-compare-goal skirmisher-set < 13); 15
=>
	(set-goal trainskirm yes))
;=========================================================
(defrule
	(goal milunits yes)
(or	(players-unit-type-count focus-player mameluke-line >= 7)
	(strategic-number archers >= 7))
(or	(food-amount >= sk-buffer-f)
	(goal underattack yes))
	(up-compare-goal skirmisher-set < 18); 21
=>
	(set-goal trainskirm yes))
;=========================================================
(defrule
	(goal milunits yes)
(or	(players-unit-type-count focus-player mameluke-line >= 10)
	(strategic-number archers >= 10))
	(food-amount >= sk-buffer-f)
(or	(up-research-status c: ri-hand-cart >= research-pending)
(or	(goal defend yes)
	(strategic-number sn-military-superiority <= 0)))
	(up-compare-goal skirmisher-set < 25); 28
=>
	(set-goal trainskirm yes))
;=========================================================
(defrule
	(goal milunits yes)
(or	(players-unit-type-count focus-player mameluke-line >= 15)
	(strategic-number archers >= 15))
	(food-amount >= sk-buffer-f)
(or	(up-research-status c: ri-hand-cart >= research-pending)
(or	(goal defend yes)
	(strategic-number sn-military-superiority <= 0)))
	(up-compare-goal skirmisher-set < 35); 36
=>
	(set-goal trainskirm yes))
;=========================================================
(defrule
	(goal milunits yes)
(or	(players-unit-type-count focus-player mameluke-line >= 25)
	(strategic-number archers >= 25))
	(food-amount >= sk-buffer-f)
(or	(up-research-status c: ri-hand-cart >= research-pending)
(or	(goal defend yes)
	(strategic-number sn-military-superiority <= 0)))
	(up-compare-goal skirmisher-set < 50)
=>
	(set-goal trainskirm yes))
;=========================================================
(defrule
	(goal milunits yes)
(or	(players-unit-type-count focus-player mameluke-line >= 40)
	(strategic-number archers >= 40))
	(food-amount >= sk-buffer-f)
(or	(up-research-status c: ri-hand-cart >= research-pending)
(or	(goal defend yes)
	(strategic-number sn-military-superiority <= 0)))
	(up-compare-goal skirmisher-set < 65)
=>
	(set-goal trainskirm yes))
(defrule
	(population-cap >= 400)
	(goal milunits yes)
(or	(players-unit-type-count focus-player mameluke-line >= 40)
	(strategic-number archers >= 40))
	(food-amount >= sk-buffer-f)
(or	(up-research-status c: ri-hand-cart >= research-pending)
(or	(goal defend yes)
	(strategic-number sn-military-superiority <= 0)))
	(up-compare-goal skirmisher-set < 250)
=>
	(set-goal trainskirm yes))

#end-if; non-byz

#load-if-defined UP-GAME-WK
(defrule
	(up-compare-goal trainskirm != no)
	(up-research-status c: ri-elite-skirmisher <= research-unavailable)
(or	(and	(current-age >= castle-age)
		(strategic-number sn-current-age >= imperial))
(or	(unit-available genitour)
(or	(unit-available elite-genitour)
	(unit-available genitour-placeholder))))
=>
	(set-goal trainskirm no)
	(set-goal traingenitour yes))
(defrule
	(up-compare-goal traingenitour != no)
	(players-unit-type-count focus-player genoese-crossbowman >= 6)
	(up-research-status c: ri-elite-skirmisher >= research-available);
=>
	(set-goal traingenitour no)
	(set-goal trainskirm yes))
#end-if

(defrule
	(goal milunits yes)
	(strategic-number moenche < 18)
	(food-amount >= sk-buffer-f)
	(strategic-number infantry <= 5)
	(strategic-number cavalry < 3)
	(strategic-number eagles < 3)
	(strategic-number husks < 3)
(or	(strategic-number sn-military-superiority <= -2)
	(and	(goal enemy-goal flush)
		(strategic-number sn-military-superiority <= -1)))
	(current-age <= feudal-age)
	(up-compare-goal skirmisher-set < 12)
=>
	(set-goal trainskirm yes))
;=========================================================
(defrule
	(goal milunits yes)
	(strategic-number moenche < 18)
	(food-amount >= sk-buffer-f)
	(strategic-number infantry <= 5)
	(strategic-number cavalry < 3)
	(strategic-number eagles < 3)
	(strategic-number husks < 3)
(or	(strategic-number sn-military-superiority <= -2); -2
	(goal underattack yes))
	(building-type-count stable <= 0)
	(building-type-count castle <= 0)
	(current-age <= castle-age);
	(up-compare-goal skirmisher-set < 12)
=>
	(set-goal trainskirm yes))
;=========================================================
(defrule
	(goal milunits yes) ; feudal def
	(goal position-goal flank)
	(up-research-status c: castle-age <= research-pending); ==
(or	(strategic-number sn-military-superiority <= -2)
(or	(strategic-number skirmsarchers >= 10)
	(strategic-number archers >= 5)))
	(players-unit-type-count focus-player militiaman-line < 6)
	(strategic-number cavalry < 6)
	(strategic-number eagles < 3)
	(strategic-number husks < 3)
	(wood-amount >= sk-buffer-w);
	(food-amount >= sk-buffer-f)
	(strategic-number sn-military-superiority <= -1)
=>
	(set-goal trainskirm yes))
;=========================================================
(defrule
	(goal milunits yes)
	(goal enemy-goal flush)
	(up-research-status c: castle-age == research-pending);	(strategic-number sn-current-age == fcastlea)
	(players-unit-type-count focus-player militiaman-line < 6)
	(players-unit-type-count focus-player scout-cavalry-line < 6)
; tl	(strategic-number cavalry < 3)
	(strategic-number eagles < 3)
	(strategic-number husks < 3)
	(food-amount >= sk-buffer-f)
	(strategic-number sn-military-superiority <= 0)
(or	(strategic-number sn-military-superiority <= -1)
	(and	(up-research-status c: ri-double-bit-axe >= research-pending)
		(up-research-status c: ri-horse-collar >= research-pending)))
	(up-compare-goal skirmisher-set < 16)
=>
	(set-goal trainskirm yes))
;=========================================================
(defrule
	(goal milunits yes)
	(goal enemy-goal rush)
(or	(food-amount >= sk-buffer-f)
	(goal underattack yes));(strategic-number sn-military-superiority <= -2))
	(players-unit-type-count focus-player militiaman-line < 8)
	(strategic-number eagles < 3)
	(strategic-number husks < 3)
	(players-unit-type-count focus-player knight-line < 4)
	(players-unit-type-count focus-player scout-cavalry-line < 6)
	(strategic-number sn-military-superiority <= 0)
	(up-compare-goal skirmisher-set < 16)
=>
	(set-goal trainskirm yes))
;=========================================================
(defrule
	(goal milunits yes)
	(goal enemy-goal flush)
	(players-current-age focus-player == feudal-age)
(or	(players-building-type-count focus-player archery-range > 0)
	(strategic-number archers >= 3))
(or	(players-unit-type-count focus-player militiaman-line < 6)
	(players-unit-type-count focus-player archer-line >= 6))
	(strategic-number sn-military-superiority <= -1)
(or	(food-amount >= sk-buffer-f)
	(goal underattack yes));(strategic-number sn-military-superiority <= -2))
	(strategic-number eagles < 3)
	(strategic-number husks < 3)
;	(up-compare-goal skirmisher-set < 20)
=>
	(set-goal trainskirm yes))
;=========================================================
(defrule
	(goal milunits yes)
	(strategic-number moenche < 18)
	(strategic-number archers >= 5)
	(strategic-number sn-military-superiority <= -1)
	(commodity-selling-price wood < 50)
	(commodity-selling-price food < 50)
	(food-amount >= sk-buffer-f)
(or	(players-unit-type-count focus-player militiaman-line < 8)
	(strategic-number archers >= 10))
	(up-compare-goal skirmisher-set < 16)
=>
	(set-goal trainskirm yes))
;=========================================================

#load-if-not-defined INCAN-CIV
#load-if-not-defined INDIAN-CIV
#load-if-not-defined ITALIAN-CIV
#load-if-not-defined MAGYAR-CIV
#load-if-not-defined SLAVIC-CIV

#load-if-not-defined BERBERS-CIV
#load-if-not-defined BURMESE-CIV
#load-if-not-defined ETHIOPIAN-CIV
#load-if-not-defined PORTUGUESE-CIV
#load-if-not-defined KHMER-CIV
#load-if-not-defined MALAY-CIV
#load-if-not-defined MALIAN-CIV
#load-if-not-defined VIETNAMESE-CIV

#load-if-not-defined BULGARIANS-CIV
#load-if-not-defined CUMANS-CIV
#load-if-not-defined LITHUANIANS-CIV
#load-if-not-defined TATARS-CIV

#load-if-not-defined SICILIANS-CIV
#load-if-not-defined BURGUNDIANS-CIV

#load-if-not-defined BOHEMIANS-CIV
#load-if-not-defined POLES-CIV

#load-if-not-defined AZTEC-CIV
#load-if-not-defined BRITON-CIV
#load-if-not-defined TURKISH-CIV
#load-if-not-defined CELTIC-CIV
#load-if-not-defined CHINESE-CIV
#load-if-not-defined FRANKISH-CIV
#load-if-not-defined GOTHIC-CIV
#load-if-not-defined SPANISH-CIV
#load-if-not-defined HUN-CIV
#load-if-not-defined JAPANESE-CIV
#load-if-not-defined KOREAN-CIV
#load-if-not-defined MAYAN-CIV
#load-if-not-defined MONGOL-CIV
#load-if-not-defined PERSIAN-CIV
#load-if-not-defined SARACEN-CIV
#load-if-not-defined TEUTONIC-CIV
#load-if-not-defined VIKING-CIV ; Byzantines[, Lithuanians]

(defrule
	(players-civ any-enemy vietnamese)
(not	(players-civ any-ally vietnamese))
	(up-research-status c: ri-imperial-skirmisher <= research-unavailable); test
=>
	(up-jump-rule 1))
(defrule
	(goal milunits yes)
;	(up-research-status c: ri-elite-skirmisher != research-available); test
;(nor
	(players-civ focus-player byzantine)
;	(players-civ focus-player lithuanians))
	(food-amount >= sk-buffer-f)
(or	(strategic-number archers >= 7)
	(strategic-number sn-military-superiority <= -1))
	(up-compare-goal excessGold < 225); test
	(population < siege-pop)
	(strategic-number skirms >= 6)
	(strategic-number skirms g:> skirmcount)
	(up-compare-goal skirmisher-set < 40)
=>
	(set-goal trainskirm yes))

#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if

#end-if
#end-if
#end-if
#end-if

#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if

#end-if
#end-if
#end-if
#end-if
#end-if

#end-if
#end-if

#end-if
#end-if
;=========================================================
; Arbs
;=========================================================
#load-if-not-defined BULGARIANS-CIV
#load-if-not-defined SPANISH-CIV
;Don't think this is the source of burmese imp xbows but best to put safeguard
(defrule
	(current-age == imperial-age)
	(up-research-status c: ri-arbalest < 1) ;unavailable and not researched
	(not(civ-selected persian))
	(or(current-age-time > 180)
	(nand(up-research-status c: ri-leather-archer-armor > 1) ;making FU xbows during first few mins of imp not terrible idea, but only if we at least get bracer and leather
	(up-research-status c: ri-bracer > 1)))
=>
	(set-goal trainarcher no)
	(up-jump-rule 2)
)

(defrule ; anti-flush test
	(goal milunits yes)
	(strategic-number skirms < 9); 10
(or	(strategic-number sn-military-superiority <= -2); (gold-amount >= 245); test
(or	(players-building-type-count focus-player barracks >= 2)
(or	(players-unit-type-count focus-player spearman-line >= 7)
	(players-unit-type-count focus-player militiaman-line >= 4))))
	(goal enemy-goal flush)
	(strategic-number sn-military-superiority <= -1)
	(players-current-age focus-player == feudal-age)
	(unit-type-count-total archer-line < 20)
=>
	(set-goal trainarcher yes))

(defrule
	(goal milunits yes)
	(goal escrowing no)
	(up-compare-const a-rush-affinity >= ca-rush-affinity)
(or	(up-research-status c: ri-crossbow >= research-pending)
	(strategic-number sn-military-superiority <= -2))
	(population < up-max-civ)
	(strategic-number sn-current-age <= castlea);	(current-age <= castle-age)
	(strategic-number sn-military-superiority <= -1)
	(up-compare-goal excessWood >= 125)
	(up-compare-goal excessGold >= 145)
	(strategic-number siege < 3)
	(strategic-number skirms < 12)
	(strategic-number husks < 3)
	(unit-type-count-total archer-line < 40)
=>
	(set-goal trainarcher yes))
;Forward jump rule (2) ends here
(defrule
	(goal milunits yes)
	(goal escrowing no)
	(up-compare-const ca-rush-affinity > a-rush-affinity)
	(population < up-max-civ)
	(strategic-number sn-current-age <= castlea);	(current-age <= castle-age)
	(strategic-number sn-military-superiority <= -1)
	(up-compare-goal excessWood >= 136)
	(up-compare-goal excessGold >= 154)
	(strategic-number siege < 3)
	(strategic-number skirms < 12)
	(strategic-number husks < 3)
	(unit-type-count-total cavalry-archer-line < 33)
=>
	(set-goal traincavarcher yes))


#load-if-not-defined BERBERS-CIV
#load-if-not-defined BURMESE-CIV
#load-if-not-defined BURGUNDIANS-CIV
#load-if-not-defined CELTIC-CIV
#load-if-not-defined CUMANS-CIV
#load-if-not-defined FRANKISH-CIV
#load-if-not-defined GOTHIC-CIV
#load-if-not-defined HUN-CIV
#load-if-not-defined INDIAN-CIV
#load-if-not-defined KHMER-CIV
#load-if-not-defined LITHUANIANS-CIV
#load-if-not-defined PERSIAN-CIV
#load-if-not-defined SLAVIC-CIV
#load-if-not-defined TATARS-CIV
#load-if-not-defined TEUTONIC-CIV
#load-if-not-defined TURKISH-CIV ; arbalest civs
(defrule
	(goal milunits yes)
	(strategic-number sn-current-age <= castlea)
	(strategic-number infantry >= 3)
	(strategic-number husks < 5)
	(unit-type-count-total scorpion-line < 4)
	(up-compare-goal mangonel-set < 4)
	(unit-type-count-total bombard-cannon-line < 4)
	(unit-type-count-total archer-line < 9)
=>
	(set-goal trainarcher yes))
;=========================================================
(defrule
	(goal milunits yes)
	(strategic-number infantry >= 5)
	(strategic-number husks < 8)
	(unit-type-count-total scorpion-line < 8)
	(up-compare-goal mangonel-set < 8)
	(unit-type-count-total bombard-cannon-line < 8)
	(unit-type-count-total archer-line < 12)
=>
	(set-goal trainarcher yes))
;=========================================================
(defrule
	(goal milunits yes)
	(strategic-number infantry >= 10)
	(strategic-number husks < 11)
	(unit-type-count-total scorpion-line < 13)
	(up-compare-goal mangonel-set < 13)
	(unit-type-count-total bombard-cannon-line < 13)
	(unit-type-count-total archer-line < 20)
=>
	(set-goal trainarcher yes))
;=========================================================
(defrule
	(goal milunits yes)
	(strategic-number infantry >= 15)
	(strategic-number husks < 14)
	(unit-type-count-total scorpion-line < 19)
	(up-compare-goal mangonel-set < 19)
	(unit-type-count-total bombard-cannon-line < 19)
	(unit-type-count-total archer-line < 30)
=>
	(set-goal trainarcher yes))
;=========================================================
(defrule
	(goal milunits yes)
	(strategic-number infantry >= 25)
	(strategic-number husks < 17)
	(unit-type-count-total scorpion-line < 26)
	(up-compare-goal mangonel-set < 26)
	(unit-type-count-total bombard-cannon-line < 26)
	(unit-type-count-total archer-line < 44)
=>
	(set-goal trainarcher yes))
;=========================================================
(defrule
	(goal milunits yes)
	(strategic-number infantry >= 40)
	(strategic-number husks < 20)
	(unit-type-count-total scorpion-line < 34)
	(up-compare-goal mangonel-set < 34)
	(unit-type-count-total bombard-cannon-line < 34)
	(unit-type-count-total archer-line < 60)
=>
	(set-goal trainarcher yes))
;=========================================================
(defrule
	(goal milunits yes)
	(strategic-number sn-current-age >= fcastlea)
	(strategic-number husks < 5)
	(strategic-number skirms < 15)
	(strategic-number siege < 7)
	(players-unit-type-count focus-player eagle-warrior-line < 15)
	(strategic-number sn-military-superiority <= -1)
(or	(players-building-type-count focus-player barracks >= 2)
	(players-unit-type-count focus-player militiaman-line >= 2))
	(goal enemy-goal rush)
	(current-age <= castle-age)
	(unit-type-count-total archer-line < 20)
=>
	(set-goal trainarcher yes))
;=========================================================
(defrule
	(goal milunits yes)
	(strategic-number skirms < 20)
	(strategic-number husks < 5)
	(players-unit-type-count focus-player war-wagon-line < 5)
	(strategic-number archers < 15); else just go for skirms
	(strategic-number cavalry < 15)
(or	(civ-selected aztec)
(or	(civ-selected incan)
	(civ-selected mayan)))
	(strategic-number sn-military-superiority <= -1); -2
	(strategic-number sn-current-age < imperial)
	(unit-type-count-total archer-line < 25)
=>
	(set-goal trainarcher yes))

#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if

#end-if
#end-if

#load-if-not-defined SICILIANS-CIV

#load-if-not-defined INCAN-CIV
#load-if-not-defined ITALIAN-CIV
#load-if-not-defined MAGYAR-CIV
#load-if-not-defined SLAVIC-CIV

#load-if-not-defined ETHIOPIAN-CIV
#load-if-not-defined MALAY-CIV
#load-if-not-defined MALIAN-CIV
#load-if-not-defined PORTUGUESE-CIV
#load-if-not-defined VIETNAMESE-CIV

#load-if-not-defined AZTEC-CIV
#load-if-not-defined BRITON-CIV
#load-if-not-defined MONGOL-CIV
#load-if-not-defined CELTIC-CIV
#load-if-not-defined CHINESE-CIV
#load-if-not-defined HUN-CIV
#load-if-not-defined KOREAN-CIV
#load-if-not-defined BYZANTINE-CIV
#load-if-not-defined JAPANESE-CIV
#load-if-not-defined MAYAN-CIV
#load-if-not-defined SARACEN-CIV
#load-if-not-defined VIKING-CIV ; Goths, Turks, Teutons, Persians, Franks, (Spanish), Berbers, Burmese, Khmer, (Bulgarians), Cumans, Lithuanians, Tatars, Indians, Burgundians

#load-if-not-defined BULGARIANS-CIV
#load-if-not-defined SPANISH-CIV
(defrule
	(goal milunits yes)
	(strategic-number sn-current-age <= castlea)
	(strategic-number infantry >= 3)
	(strategic-number husks < 5)
(or	(up-research-status c: ri-chemistry < research-pending)
	(current-age < imperial-age))
	(unit-type-count-total scorpion-line < 4)
	(up-compare-goal mangonel-set < 4)
	(unit-type-count-total bombard-cannon-line < 4)
	(unit-type-count-total archer-line < 9)
=>
	(set-goal trainarcher yes))
;=========================================================
(defrule
	(goal milunits yes)
	(strategic-number infantry >= 5)
(or	(up-research-status c: ri-chemistry < research-pending)
	(current-age < imperial-age))
	(strategic-number husks < 8)
	(unit-type-count-total scorpion-line < 8)
	(up-compare-goal mangonel-set < 8)
	(unit-type-count-total bombard-cannon-line < 8)
	(unit-type-count-total archer-line < 12)
=>
	(set-goal trainarcher yes))
;=========================================================
(defrule
	(goal milunits yes)
	(strategic-number infantry >= 10)
(or	(up-research-status c: ri-chemistry < research-pending)
	(current-age < imperial-age))
	(strategic-number husks < 11)
	(unit-type-count-total scorpion-line < 13)
	(up-compare-goal mangonel-set < 13)
	(unit-type-count-total bombard-cannon-line < 13)
	(unit-type-count-total archer-line < 18)
=>
	(set-goal trainarcher yes))
;=========================================================
(defrule
	(goal milunits yes)
	(strategic-number infantry >= 15)
(or	(up-research-status c: ri-chemistry < research-pending)
	(current-age < imperial-age))
	(strategic-number husks < 14)
	(unit-type-count-total scorpion-line < 19)
	(up-compare-goal mangonel-set < 19)
	(unit-type-count-total bombard-cannon-line < 19)
	(unit-type-count-total archer-line < 26)
=>
	(set-goal trainarcher yes))
;=========================================================
(defrule
	(goal milunits yes)
	(strategic-number infantry >= 25)
(or	(up-research-status c: ri-chemistry < research-pending)
	(current-age < imperial-age))
	(strategic-number husks < 17)
	(unit-type-count-total scorpion-line < 26)
	(up-compare-goal mangonel-set < 26)
	(unit-type-count-total bombard-cannon-line < 26)
	(unit-type-count-total archer-line < 40)
=>
	(set-goal trainarcher yes))
;=========================================================
(defrule
	(goal milunits yes)
	(strategic-number infantry >= 40)
(or	(up-research-status c: ri-chemistry < research-pending)
	(current-age < imperial-age))
	(strategic-number husks < 20)
	(unit-type-count-total scorpion-line < 34)
	(up-compare-goal mangonel-set < 34)
	(unit-type-count-total bombard-cannon-line < 34)
	(unit-type-count-total archer-line < 60)
=>
	(set-goal trainarcher yes))
;=========================================================
(defrule
	(goal milunits yes)
	(strategic-number husks < 5)
	(strategic-number skirms < 15)
	(strategic-number siege < 7)
	(players-unit-type-count focus-player eagle-warrior-line < 10)
	(strategic-number sn-military-superiority <= -1)
(or	(players-building-type-count focus-player barracks >= 2)
	(players-unit-type-count focus-player militiaman-line >= 2))
	(goal enemy-goal rush)
(or	(strategic-number sn-current-age == fcastlea)
	(strategic-number sn-current-age == castlea))
	(unit-type-count-total archer-line < 15)
=>
	(set-goal trainarcher yes))
;=========================================================
(defrule
	(goal milunits yes)
	(current-age != imperial-age)
	(strategic-number skirms < 10)
;	(players-unit-type-count focus-player scout-cavalry < 8)
(or	(players-building-type-count focus-player barracks >= 2)
(or	(players-unit-type-count focus-player spearman-line >= 6)
	(players-unit-type-count focus-player militiaman-line >= 2)))
	(goal enemy-goal flush)
	(strategic-number sn-military-superiority <= -1)
	(players-current-age focus-player == feudal-age)
	(unit-type-count-total archer-line < 10)
=>
	(set-goal trainarcher yes))
#end-if
#end-if

;=========================================================
;(defrule
;	(goal milunits yes)
;	(strategic-number infantry >= 3)
;	(strategic-number sn-current-age >= imperial)
;	(unit-type-count-total scorpion-line < 4)
;	(up-compare-goal mangonel-set < 4)
;	(unit-type-count-total hand-cannoneer < 9)
;=>
;	(set-goal trainhandcannon yes))
;=========================================================
(defrule
	(goal milunits yes)
(or	(strategic-number infantry >= 5)
(or	(strategic-number eagles >= 5)
	(strategic-number husks >= 5)))
	(strategic-number sn-current-age >= imperial)
	(unit-type-count-total scorpion-line < 8)
	(unit-type-count-total hand-cannoneer < 12)
=>
	(set-goal trainhandcannon yes))
;=========================================================
(defrule
	(goal milunits yes)
(or	(strategic-number infantry >= 10)
(or	(strategic-number eagles >= 10)
	(strategic-number husks >= 10)))
	(strategic-number sn-current-age >= imperial)
	(unit-type-count-total scorpion-line < 13)
	(unit-type-count-total hand-cannoneer < 18)
=>
	(set-goal trainhandcannon yes))
;=========================================================
(defrule
	(goal milunits yes)
(or	(strategic-number infantry >= 15)
(or	(strategic-number eagles >= 15)
	(strategic-number husks >= 15)))
	(strategic-number sn-current-age >= imperial)
	(unit-type-count-total scorpion-line < 19)
	(unit-type-count-total hand-cannoneer < 26)
=>
	(set-goal trainhandcannon yes))
;=========================================================
(defrule
	(goal milunits yes)
(or	(strategic-number infantry >= 25)
(or	(strategic-number eagles >= 25)
	(strategic-number husks >= 25)))
	(strategic-number sn-current-age >= imperial)
	(unit-type-count-total scorpion-line < 26)
	(unit-type-count-total hand-cannoneer < 40)
=>
	(set-goal trainhandcannon yes))
;=========================================================
(defrule
	(goal milunits yes)
(or	(strategic-number infantry >= 40)
(or	(strategic-number eagles >= 40)
	(strategic-number husks >= 40)))
	(strategic-number sn-current-age >= imperial)
	(unit-type-count-total scorpion-line < 34)
	(unit-type-count-total hand-cannoneer < 60)
=>
	(set-goal trainhandcannon yes))

#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if

#end-if
#end-if
#end-if
#end-if
#end-if

#end-if
#end-if
#end-if
#end-if

#end-if

;=========================================================
#load-if-defined SARACEN-CIV
(defrule
(or	(up-compare-goal milunits != yes)
(or	(goal position-goal pocket)
(or	(strategic-number skirms >= 32)
(or	(strategic-number cavalry >= 24)
	(players-building-count every-enemy <= 0)))))
=>
	(up-jump-rule 2))
(defrule
(or	(goal trainunique yes)
	(goal uugoal yes))
	(building-type-count-total castle >= 1)
(or	(building-type-count castle >= 1)
	(goal underattack no))
	(players-unit-type-count focus-player teutonic-knight-line <= 5)
=>
	(up-jump-rule 1))
(defrule
(or	(and	(up-compare-goal excessGold >= 845)
		(and	(strategic-number sn-current-age >= imperial)
			(goal traincamel no)))
(or	(and	(goal underattack yes)
		(up-research-status c: ri-bodkin-arrow >= research-pending))
	(strategic-number sn-military-superiority <= -2)))
	(strategic-number sn-military-superiority <= -1); 0
	(strategic-number teamsuperiority <= 0)
	(population < siege-pop); test
;	(unit-type-count-total archer-line < 75)
=>
	(set-goal trainarcher yes)); end jump
#end-if
#load-if-defined ETHIOPIAN-CIV
(defrule
	(goal milunits yes)
(or	(goal uugoal no)
	(strategic-number infantry >= 15))
	(strategic-number skirms < 40)
	(strategic-number eagles < 40)
	(strategic-number siege < 15)
	(strategic-number husks < 15)
	(strategic-number sn-current-age >= imperial)
	(up-compare-goal excessGold >= 245)
	(population < siege-pop)
	(strategic-number sn-military-superiority <= 2);
	(players-building-count any-enemy >= 1)
=>
	(set-goal trainarcher yes))
#end-if
;=========================================================
#load-if-not-defined BURGUNDIANS-CIV
#load-if-not-defined SICILIANS-CIV

#load-if-not-defined INCAN-CIV
#load-if-not-defined INDIAN-CIV
#load-if-not-defined ITALIAN-CIV
;#load-if-not-defined MAGYAR-CIV
#load-if-not-defined SLAVIC-CIV

#load-if-not-defined BERBERS-CIV
#load-if-not-defined BURMESE-CIV
#load-if-not-defined ETHIOPIAN-CIV
#load-if-not-defined KHMER-CIV
#load-if-not-defined MALAY-CIV
#load-if-not-defined MALIAN-CIV
#load-if-not-defined PORTUGUESE-CIV
#load-if-not-defined VIETNAMESE-CIV

#load-if-not-defined BULGARIANS-CIV
#load-if-not-defined CUMANS-CIV
#load-if-not-defined LITHUANIANS-CIV
;#load-if-not-defined TATARS-CIV

#load-if-not-defined AZTEC-CIV
#load-if-not-defined BRITON-CIV
#load-if-not-defined BYZANTINE-CIV
#load-if-not-defined CELTIC-CIV
#load-if-not-defined CHINESE-CIV
#load-if-not-defined GOTHIC-CIV
;#load-if-not-defined HUN-CIV
#load-if-not-defined JAPANESE-CIV
#load-if-not-defined KOREAN-CIV
#load-if-not-defined MONGOL-CIV
#load-if-not-defined MAYAN-CIV
#load-if-not-defined PERSIAN-CIV
#load-if-not-defined FRANKISH-CIV
#load-if-not-defined SARACEN-CIV
#load-if-not-defined SPANISH-CIV
#load-if-not-defined TEUTONIC-CIV
;#load-if-not-defined TURKISH-CIV
#load-if-not-defined VIKING-CIV; Huns, Tatars, Turks, Magyars

(defrule
(or	(goal cavagoal yes)
(or	(goal strategy fast-imp)
(or	(strategic-number skirms >= 40); 26
(or	(strategic-number camels >= 30); 26
(or	(strategic-number siege >= 15); 11
	(strategic-number sn-current-age < imperial))))))
=>
	(up-jump-rule 4))
(defrule
(or	(civ-selected hun)
	(civ-selected tatars))
	(building-type-count-total archery-range >= 1)
(or	(up-compare-goal uugoal != yes)
	(and	(current-age >= imperial-age)
		(building-type-count-total castle <= 0)))
(or	(up-compare-goal palagoal != yes)
	(and	(current-age >= imperial-age)
		(building-type-count-total stable <= 0)))
=>
	(set-goal cavagoal yes))
(defrule
(or	(and	(civ-selected turkish)
		(up-research-status c: ri-sipahi >= research-pending))
	(and	(civ-selected magyar)
		(up-research-status c: ri-recurve-bow >= research-pending)))
(or	(up-compare-goal uugoal != yes)
	(and	(current-age >= imperial-age)
		(current-age-time >= 180))); test
	(building-type-count-total castle <= 0)
	(stone-amount < castle-stone)
=>
	(set-goal cavagoal yes))
(defrule
(or	(civ-selected hun)
(or	(civ-selected magyar)
(or	(civ-selected turkish)
	(civ-selected tatars))))
	(up-compare-goal uugoal != yes)
	(up-compare-goal palagoal != yes)
	(up-compare-goal champgoal != yes)
	(up-research-status c: imperial-age >= research-pending)
=>
	(set-goal cavagoal yes))
(defrule
	(civ-selected magyar)
	(up-compare-goal palagoal != yes)
	(up-compare-goal excessGold >= 560)
(or	(up-compare-goal excessGold >= 960)
(or	(up-compare-goal tradeunits >= 32)
	(and	(goal uugoal yes)
		(up-research-status c: ri-mercenaries >= research-pending))))
	(up-research-status c: imperial-age >= research-pending)
=>
	(set-goal cavagoal yes)); end jump


(defrule
(or	(up-compare-goal cavagoal != yes)
(or	(up-compare-goal milunits != yes)
(or	(strategic-number sn-current-age < imperial)
	(up-research-status c: ri-heavy-cavalry-archer < research-pending))))
=>
	(up-jump-rule 1))
(defrule
	(strategic-number skirms <= 36)
	(strategic-number camels <= 24)
	(strategic-number siege <= 12); 10
;	(strategic-number sn-current-age >= imperial)
=>
	(set-goal traincavarcher yes))

#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
;#end-if
;#end-if

#end-if
#end-if
#end-if
;#end-if

#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if

#end-if
#end-if
#end-if
#end-if
;#end-if

#end-if
#end-if
;=========================================================
(defrule
(nor	(civ-selected hun)
(or	(and	(up-research-status	c: ri-sipahi >= research-pending)
		(goal trainhandcannon no))
(or	(up-research-status	c: ri-silk-armor >= research-pending)
(or	(up-research-status c: ri-recurve-bow >= research-pending)
	(goal cavagoal yes)))))
=>
	(up-jump-rule 9))
(defrule
	(goal milunits yes)
(or	(players-unit-type-count focus-player teutonic-knight-line >= 9)
	(players-unit-type-count focus-player war-elephant-line >= 6))
(or	(strategic-number skirms <= 32)
	(unit-type-count cavalry-class >= 16))
	(strategic-number camels <= 24)
	(strategic-number husks <= 20)
	(strategic-number archers <= 32)
	(unit-type-count-total cavalry-archer-line < 48)
=>
	(set-goal traincavarcher yes))
(defrule
	(goal milunits yes)
	(strategic-number infantry >= 3)
(nor	(strategic-number skirms > 24)
(or	(strategic-number camels > 14)
(or	(strategic-number husks >= 8)
	(strategic-number archers >= 10))))
	(strategic-number sn-current-age <= castlea)
	(unit-type-count-total cavalry-archer-line < 7)
=>
	(set-goal traincavarcher yes))
(defrule
	(goal milunits yes)
	(strategic-number infantry >= 5)
(nor	(strategic-number skirms > 32)
(or	(strategic-number camels > 19)
(or	(strategic-number husks >= 11)
	(strategic-number archers >= 15))))
	(unit-type-count-total cavalry-archer-line < 11)
=>
	(set-goal traincavarcher yes))
(defrule
	(goal milunits yes)
	(strategic-number infantry >= 7)
(nor	(strategic-number skirms > 40)
(or	(strategic-number husks >= 14)
(or	(strategic-number camels > 24)
	(strategic-number archers >= 15))))
	(unit-type-count-total cavalry-archer-line < 15)
=>
	(set-goal traincavarcher yes))
(defrule
	(goal milunits yes)
	(strategic-number infantry >= 10)
(nor	(strategic-number skirms > 48)
(or	(strategic-number husks >= 17)
(or	(strategic-number camels > 29)
	(strategic-number archers >= 25))))
	(unit-type-count-total cavalry-archer-line < 20)
=>
	(set-goal traincavarcher yes))
(defrule
	(goal milunits yes)
	(strategic-number infantry >= 15)
(nor	(strategic-number skirms > 56)
(or	(strategic-number husks >= 20)
(or	(strategic-number camels > 34)
	(strategic-number archers >= 25))))
	(unit-type-count-total cavalry-archer-line < 28)
=>
	(set-goal traincavarcher yes))
(defrule
	(goal milunits yes)
	(strategic-number infantry >= 25)
(nor	(strategic-number skirms > 64)
(or	(strategic-number husks >= 20)
(or	(strategic-number camels > 39)
	(strategic-number archers >= 40))))
	(unit-type-count-total cavalry-archer-line < 40)
=>
	(set-goal traincavarcher yes))
(defrule
	(goal milunits yes)
	(strategic-number infantry >= 40)
	(strategic-number husks < 30)
	(unit-type-count-total cavalry-archer-line < 55)
=>
	(set-goal traincavarcher yes))
(defrule
	(goal milunits yes)
	(up-compare-goal excessGold >= 800)
	(strategic-number skirms < 39)
	(strategic-number husks < 30)
	(strategic-number camels < 29)
	(strategic-number siege < 10)
	(strategic-number archers < 40)
	(unit-type-count-total cavalry-archer-line < 60)
=>
	(set-goal traincavarcher yes)); end jump
;(defrule
;	(goal milunits yes)
;(nor	(strategic-number skirms > 29)
;(or	(strategic-number camels > 24)
;	(strategic-number archers >= 25)))
;(or	(players-unit-type-count focus-player cavalry-archer-line >= 6)
;	(gold-amount > 200))
;	(gold-amount > 100)
;	(unit-type-count-total cavalry-archer-line < 20)
;=>
;	(set-goal traincavarcher yes))
;=========================================================
(defrule
(or	(up-compare-goal milunits != yes)
(or	(up-research-status c: ri-sipahi >= research-pending)
(or	(up-research-status c: ri-recurve-bow >= research-pending)
	(up-research-status c: ri-silk-armor >= research-pending))))
=>
	(up-jump-rule 1))
(defrule
(or	(strategic-number sn-current-age <= castlea); tbs
(or	(up-research-status c: ri-heavy-cavalry-archer < research-pending)
(or	(up-research-status c: ri-parthian-tactics <= research-unavailable)
(or	(up-research-status c: ri-bracer <= research-unavailable)
(or	(up-research-status c: ri-padded-archer-armor <= research-unavailable)
	(up-research-status c: ri-thumb-ring <= research-unavailable))))))
=>
	(up-jump-rule 1))
(defrule
(or	(up-compare-const wk-game == 1)
	(civ-selected hun))
	(strategic-number husks < 12)
	(strategic-number camels < 24)
	(strategic-number skirms < 30)
	(strategic-number archers < 36)
;;	(up-compare-const ca-rush-affinity > a-rush-affinity)
;	(up-research-status c: ri-parthian-tactics >= research-pending)
;;	(up-research-status c: ri-bracer >= research-available)
;;	(up-research-status c: ri-leather-archer-armor >= research-available)
;;	(up-research-status c: ri-thumb-ring >= research-available)
	(up-compare-goal excessGold >= 500)
(or	(goal researchplan yes)
	(up-compare-goal excessGold >= 800))
=>
	(set-goal traincavarcher yes))
;=========================================================
(defrule
	(goal milunits yes)
	(strategic-number sn-military-superiority <= 1); 0
(or	(strategic-number sn-military-superiority <= -1); -2
	(up-compare-goal excessGold >= 245)); 100
	(strategic-number husks >= 8)
	(unit-type-count-total hand-cannoneer < 48)
(or	(strategic-number husks >= 16)
	(unit-type-count-total hand-cannoneer < 16))
(or	(strategic-number husks >= 24)
	(unit-type-count-total hand-cannoneer < 32))
=>
	(set-goal trainhandcannon yes))
;=========================================================
(defrule
	(unit-available slinger)
(or	(goal trainarcher yes)
(or	(strategic-number husks >= 8)
	(strategic-number eagles >= 8)))
	(up-compare-goal strategy != a-rush)
(or	(strategic-number infantry >= 7)
(or	(strategic-number husks >= 8)
	(strategic-number eagles >= 8)))
	(current-age >= castle-age)
=>
	(set-goal trainarcher no)
	(set-goal trainslinger yes))
(defrule
	(unit-available slinger)
(or	(goal trainarcher yes)
	(and	(strategic-number infantry >= 15)
		(players-unit-type-count focus-player condottiero < 3)))
;	(up-research-status c: ri-andean-sling >= research-pending)
	(up-research-status c: ri-couriers >= research-pending)
	(current-age >= castle-age)
=>
	(set-goal trainarcher no)
	(set-goal trainslinger yes))
(defrule
	(goal trainslinger yes)
	(strategic-number skirms >= 36)
	(strategic-number infantry < 12)
	(strategic-number husks < 8)
	(strategic-number eagles < 8)
	(up-compare-goal excessGold < 240)
	(up-compare-goal tradeunits < 48)
	(housing-headroom < 24)
=>
	(set-goal trainslinger no))
;=========================================================
; Hussars
;=========================================================
(defrule
	(up-compare-goal milunits != no)
	(up-compare-goal strategy != krush)
	(goal enemy-goal rush)
	(strategic-number siege >= 3)
(or	(strategic-number sn-current-age <= castlea)
	(strategic-number siege >= 5))
	(up-compare-goal mangonel-set < 4)
	(unit-type-count-total bombard-cannon-line < 4)
	(unit-type-count-total cavalry-class < 8)
	(unit-type-count-total magyar-huszar < 8)
	(unit-type-count-total boyar < 8)
	(unit-type-count-total scout-cavalry-line < 12)
=>
	(set-goal trainhussar yes))
;=========================================================
(defrule
(or	(strategic-number moenche >= 11)
	(strategic-number moenchesiege >= 15))
=>
	(up-get-fact unit-type-count-total scout-cavalry-line temporary-goal)
	(up-modify-goal temporary-goal2 g:= temporary-goal)
	(up-modify-goal temporary-goal2 s:max moenchesiege)
	(up-modify-goal temporary-goal2 c:* 2)
	(up-modify-goal temporary-goal3 s:= moenchesiege)
	(up-modify-goal temporary-goal3 c:* 4)
	(up-modify-goal temporary-goal3 c:/ 3)
	(up-modify-goal temporary-goal4 s:= moenche)
	(up-modify-goal temporary-goal4 c:* 3)
	(up-modify-goal temporary-goal4 c:/ 2))
(defrule
(or	(and	(up-compare-goal temporary-goal >= 50)
		(unit-type-count-total scout-cavalry-line s:>= moenchesiege))
(or	(and	(strategic-number moenche < 11)
		(strategic-number moenchesiege < 15))
(or	(strategic-number spears >= 67)
(or	(strategic-number camels >= 67)
	(up-compare-goal milunits != yes)))))
=>
	(up-jump-rule 2))
(defrule
	(strategic-number moenche < 10)
(or	(up-compare-goal mangonel-set s:>= moenchesiege)
(or	(unit-type-count-total bombard-cannon-line s:>= moenchesiege)
(or	(unit-type-count-total cavalry-class s:>= moenchesiege)
(or	(unit-type-count-total magyar-huszar s:>= moenchesiege)
(or	(unit-type-count-total boyar s:>= moenchesiege)
	(and	(up-compare-const uu-type == cavalry-uu)
		(unit-type-count-total my-unique-unit-line s:>= moenchesiege)))))))
=>
	(up-jump-rule 1))
(defrule
	(strategic-number camels g:< temporary-goal2)
	(strategic-number spears g:< temporary-goal2)
(or	(up-compare-goal temporary-goal g:< temporary-goal3)
	(up-compare-goal temporary-goal g:< temporary-goal4))
=>
	(set-goal trainhussar yes)); end jump

;#load-if-not-defined POLES-CIV
#load-if-not-defined BOHEMIANS-CIV

;#load-if-not-defined BURGUNDIANS-CIV
#load-if-not-defined SICILIANS-CIV

#load-if-not-defined INCAN-CIV
;#load-if-not-defined INDIAN-CIV
;#load-if-not-defined ITALIAN-CIV
;#load-if-not-defined MAGYAR-CIV
;#load-if-not-defined SLAVIC-CIV

;#load-if-not-defined BERBERS-CIV
;#load-if-not-defined BURMESE-CIV
#load-if-not-defined ETHIOPIAN-CIV;
;#load-if-not-defined KHMER-CIV
#load-if-not-defined MALAY-CIV
;#load-if-not-defined MALIAN-CIV
#load-if-not-defined PORTUGUESE-CIV
#load-if-not-defined VIETNAMESE-CIV

;#load-if-not-defined BULGARIANS-CIV
;#load-if-not-defined CUMANS-CIV
;#load-if-not-defined LITHUANIANS-CIV
;#load-if-not-defined TATARS-CIV

#load-if-not-defined AZTEC-CIV
#load-if-not-defined BRITON-CIV
#load-if-not-defined BYZANTINE-CIV
#load-if-not-defined CELTIC-CIV
#load-if-not-defined CHINESE-CIV
#load-if-not-defined FRANKISH-CIV
#load-if-not-defined GOTHIC-CIV
;#load-if-not-defined HUN-CIV
#load-if-not-defined JAPANESE-CIV
#load-if-not-defined KOREAN-CIV
#load-if-not-defined MAYAN-CIV
;#load-if-not-defined PERSIAN-CIV
;#load-if-not-defined SARACEN-CIV
;#load-if-not-defined SPANISH-CIV; [Malians], Italians,
#load-if-not-defined TEUTONIC-CIV; Mongols, Turks, Saracens, Persians, Huns, Indians, Magyars, Slavs, Spanish
#load-if-not-defined VIKING-CIV; Berbers, Burmese, Bulgarians, Cumans, Lithuanians, Tatars, Khmer, Burgundians

(defrule
(or	(up-compare-goal milunits != yes)
(or	(strategic-number sn-current-age <= castlea);	(strategic-number sn-current-age <= feudal)
;(or	(and	(unit-type-count-total scout-cavalry-line >= 60)
;		(population-cap <= 224))
(or	(strategic-number spears >= 45)
	(strategic-number camels >= 36))));)
=>
	(up-jump-rule 5))
(defrule
	(up-compare-goal excessGold >= 225)
(or	(and	(population < max-civ-pop)
		(and	(up-research-status c: ri-hussar <= research-available)
			(up-research-status c: ri-farimba <= research-available)))
(or	(player-in-game any-ally)
(or	(goal palagoal yes)
	(and	(goal uugoal yes)
		(up-compare-const uu-type == cavalry-uu)))))
=>
	(up-jump-rule 4))
(defrule
	(player-in-game any-ally)
	(goal researchplan no)
	(up-compare-goal custom-civ-pop < up-max-civ)
	(strategic-number sn-military-superiority >= -2)
	(goal underattack no)
	(up-gaia-type-count c: gold >= 5)
	(strategic-number skirms < 16)
	(strategic-number moenchesiege < 16)
	(up-compare-goal excessFood < 2200)
=>
	(up-jump-rule 3))
(defrule
(or	(up-compare-goal excessGold < 200); 225
	(population < max-civ-pop))
(or	(up-compare-goal excessGold < 100)
(or	(and	(or	(goal attacking yes)
			(goal underattack yes))
		(or	(up-compare-goal excessGold < 200)
			(strategic-number sn-military-superiority <= -2)))
	(strategic-number skirms >= 20)))
;(or
	(up-compare-goal excessFood >= 130)
;	(strategic-number sn-military-superiority <= -1))
=>
	(set-goal trainhussar yes))
(defrule
	(strategic-number spears < 18)
	(strategic-number camels < 13)
(or	(up-compare-goal excessGold < 200); 225
	(population < max-civ-pop))
	(population < siege-pop)
(or	(goal attacking yes)
(or	(and	(up-compare-goal excessFood >= 1200)
		(up-compare-goal excessGold < 800))
	(strategic-number sn-military-superiority <= -1)))
;(or
	(up-compare-goal excessFood >= 130)
;	(strategic-number sn-military-superiority <= -1))
	(unit-type-count-total scout-cavalry-line < 16)
=>
	(set-goal trainhussar yes))
(defrule
(or	(up-research-status c: ri-winged-hussar >= research-pending)
	(up-research-status c: ri-lechitic-legacy >= research-pending))	
	(strategic-number spears < 40)
	(strategic-number camels < 33)
	(up-compare-goal excessFood >= s-buffer)
(or	(up-compare-goal excessGold < 225)
	(population < max-civ-pop))
(or	(up-compare-goal excessGold < 225)
(or	(strategic-number sn-military-superiority <= 0)
	(goal attacking yes)))
=>
	(set-goal trainhussar yes)); end jumps

;#end-if
;#end-if
;#end-if
;#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if

;#end-if
;#end-if
;#end-if
;#end-if

;#end-if
;#end-if
;#end-if
;#end-if
#end-if
#end-if
#end-if
#end-if

;#end-if
;#end-if
;#end-if
;#end-if
#end-if

#end-if
;#end-if

#end-if
;#end-if
;=========================================================
; Eagles
;=========================================================
(defrule
	(up-compare-goal milunits != no)
	(goal enemy-goal rush)
	(strategic-number siege >= 3)
(or	(strategic-number sn-current-age <= castlea)
	(strategic-number siege >= 5))
	(up-compare-goal mangonel-set < 4)
	(unit-type-count-total bombard-cannon-line < 4)
	(unit-type-count-total cavalry-class < 8)
	(unit-type-count-total magyar-huszar < 8)
	(unit-type-count-total boyar < 8)
	(unit-type-count-total eagle-warrior-line < 18)
=>
	(set-goal traineagle yes))
;=========================================================
(defrule
	(goal milunits yes)
	(goal trainchamp no)
(or	(up-research-status c: imperial-age <= research-pending)
	(up-research-status c: ri-elite-eagle-warrior >= research-available)); pending
	(goal attacking no)
	(enemy-buildings-in-town)
	(up-compare-goal enemy-goal2 != klew)
;	(goal allowspears yes); non meso enemy
	(unit-type-count-total battering-ram-line <= 0)
	(unit-type-count-total trebuchet-set <= 0)
	(unit-type-count-total bombard-cannon-line <= 0)
	(players-building-type-count focus-player watch-tower-line > 0)
	(unit-type-count-total spearman-line < 8)
	(unit-type-count-total militiaman-line < 4)
	(unit-type-count-total eagle-warrior-line < 5)
=>
	(set-goal traineagle yes))
;=========================================================
;(defrule
;	(goal milunits yes)
;	(goal enemy-goal rush)
;	(up-compare-goal enemy-goal2 != klew)
;	(goal allowspears yes); non meso enemy
;	(strategic-number sn-military-superiority <= -1)
;	(unit-type-count-total militiaman-line < 10)
;	(unit-type-count-total eagle-warrior-line < 14)
;=>
;	(set-goal traineagle yes))
;=========================================================
;(defrule
;	(goal milunits yes)
;	(food-amount > 70)
;	(up-compare-goal enemy-goal2 != klew)
;	(goal allowspears yes); non meso enemy
;(or	(strategic-number sn-military-superiority <= -1)
;	(goal underattack yes))
;	(unit-type-count-total eagle-warrior-line < 13)
;	(unit-type-count-total militiaman-line < 8)
;	(strategic-number sn-current-age == castlea)
;=>
;	(set-goal traineagle yes))
;=========================================================
(defrule
	(goal milunits yes)
	(goal trainchamp no)
	(goal enemy-goal flush)
	(strategic-number sn-military-superiority <= -1)
	(unit-type-count-total eagle-warrior-line < 10)
	(players-unit-type-count focus-player militiaman-line < 6)
=>
	(set-goal traineagle yes))
;=========================================================
(defrule
	(goal milunits yes)
	(goal trainchamp no)
	(goal position-goal flank)
	(strategic-number skirms >= 8)
	(players-unit-type-count focus-player militiaman-line <= 0)
	(strategic-number sn-military-superiority <= -1)
(or	(gold-amount >= 250)
	(strategic-number sn-military-superiority <= -2))
	(unit-type-count-total eagle-warrior-line < 16)
=>
	(set-goal traineagle yes))
;=========================================================
;(defrule
;	(goal milunits yes)
;	(up-compare-goal enemy-goal2 != klew)
;;tl	(goal allowspears yes); non meso enemy
;(or	(players-unit-type-count focus-player spearman-line > 6)
;(or	(players-unit-type-count focus-player archer-line > 7)
;(or	(players-unit-type-count focus-player eagle-warrior-line > 5)
;	(strategic-number skirms > 8))))
;	(food-amount > 70)
;(or	(goal enemy-goal rush)
;	(strategic-number sn-military-superiority <= -2))
;	(unit-type-count-total militiaman-line < 12)
;	(unit-type-count-total eagle-warrior-line < 15)
;=>
;	(set-goal traineagle yes))
;=========================================================
;(defrule
;	(goal milunits yes)
;	(up-compare-goal enemy-goal2 != klew)
;;tl	(goal allowspears yes); non meso enemy
;(nor	(players-unit-type-count focus-player militiaman-line > 25)
;(or	(players-unit-type-count focus-player cataphract-line > 25)
;(or	(players-unit-type-count focus-player knight-line > 25)
;(or	(players-unit-type-count focus-player war-elephant-line > 25)
;	(players-unit-type-count focus-player mameluke-line > 25)))))
;	(strategic-number sn-military-superiority <= -2)
;	(unit-type-count-total militiaman-line < 11)
;	(unit-type-count-total eagle-warrior-line < 16)
;=>
;	(set-goal traineagle yes))
;=========================================================
;(defrule
;	(goal milunits yes)
;	(up-compare-goal enemy-goal2 != klew)
;	(goal allowspears yes); non meso enemy
;(or	(goal enemy-goal rush)
;	(players-unit-type-count focus-player eagle-warrior-line > 15))
;	(players-unit-type-count focus-player eagle-warrior-line > 5)
;	(strategic-number sn-military-superiority <= -2)
;	(unit-type-count-total eagle-warrior-line < 12)
;	(unit-type-count-total militiaman-line < 10)
;=>
;	(set-goal traineagle yes))
;=========================================================
;(defrule
;;	(goal milunits yes)
;	(up-compare-goal enemy-goal2 != klew)
;	(goal allowspears yes); non meso enemy
;	(strategic-number sn-military-superiority <= 3)
;;(or
;	(goal underattack yes)
;;	(goal attacking yes))
;	(players-unit-type-count focus-player militiaman-line < 30)
;	(players-unit-type-count focus-player cataphract-line < 30)
;	(players-unit-type-count focus-player knight-line < 30)
;	(players-unit-type-count focus-player war-elephant-line < 30)
;	(players-unit-type-count focus-player mameluke-line < 30)
;	(unit-type-count-total militiaman-line < 10)
;	(unit-type-count-total eagle-warrior-line < 20)
;=>
;	(set-goal traineagle yes))
;=========================================================
(defrule
(or	(strategic-number moenche >= 11)
	(strategic-number moenchesiege >= 15))
=>
	(up-get-fact unit-type-count-total eagle-warrior-line temporary-goal)
	(up-modify-goal temporary-goal2 g:= temporary-goal)
	(up-modify-goal temporary-goal2 s:max moenchesiege)
	(up-modify-goal temporary-goal2 c:* 2)
	(up-modify-goal temporary-goal3 s:= moenchesiege)
	(up-modify-goal temporary-goal3 c:* 4)
	(up-modify-goal temporary-goal3 c:/ 3)
	(up-modify-goal temporary-goal4 s:= moenche)
	(up-modify-goal temporary-goal4 c:* 3)
	(up-modify-goal temporary-goal4 c:/ 2))
(defrule
(or	(and	(up-compare-goal temporary-goal >= 50)
		(unit-type-count-total eagle-warrior-line s:>= moenchesiege))
(or	(and	(strategic-number moenche < 11)
		(strategic-number moenchesiege < 15))
(or	(players-unit-type-count focus-player jaguar-man-line >= 67)
(or	(players-unit-type-count focus-player militiaman-line >= 67)
	(up-compare-goal milunits != yes)))))
=>
	(up-jump-rule 2))
(defrule
	(strategic-number moenche < 10)
(or	(up-compare-goal mangonel-set s:>= moenchesiege)
(or	(unit-type-count-total bombard-cannon-line s:>= moenchesiege)
(or	(unit-type-count-total cavalry-class s:>= moenchesiege)
(or	(unit-type-count-total magyar-huszar s:>= moenchesiege)
(or	(unit-type-count-total boyar s:>= moenchesiege)
	(and	(up-compare-const uu-type == cavalry-uu)
		(unit-type-count-total my-unique-unit-line s:>= moenchesiege)))))))
=>
	(up-jump-rule 1))
(defrule
	(players-unit-type-count focus-player jaguar-man-line g:< temporary-goal2)
	(players-unit-type-count focus-player militiaman-line g:< temporary-goal2)
(or	(up-compare-goal temporary-goal g:< temporary-goal3)
	(up-compare-goal temporary-goal g:< temporary-goal4))
=>
	(set-goal traineagle yes)); end jump
;=========================================================
;#load-if-defined AZTEC-CIV
;(defrule
;	(goal milunits yes)
;	(goal researchplan yes)
;	(strategic-number sn-military-superiority >= 0)
;	(strategic-number archers == 0)
;	(strategic-number cavalry == 0)
;	(strategic-number infantry == 0)
;	(unit-type-count-total militiaman-line < 20)
;	(unit-type-count-total eagle-warrior-line < 60)
;=>
;	(set-goal traineagle yes))
;#end-if
;=========================================================
#load-if-defined INCAN-CIV
(defrule
	(goal uugoal no)
;	(goal trainslinger no)
	(up-compare-goal excessGold >= 250); 225
	(strategic-number sn-current-age >= imperial)
	(players-unit-type-count focus-player slinger < 10)
	(players-unit-type-count focus-player militiaman-line < 10)
	(players-unit-type-count focus-player samurai-line < 10)
	(players-unit-type-count focus-player teutonic-knight-line < 10)
	(players-unit-type-count focus-player throwing-axeman-line < 10)
	(players-unit-type-count focus-player berserk-line < 10)
	(players-unit-type-count focus-player jaguar-man-line < 10)
	(strategic-number husks < 10)
	(players-unit-type-count focus-player cataphract-line < 10)
	(players-unit-type-count focus-player war-elephant-line < 10)
	(players-unit-type-count focus-player mameluke-line < 10)
=>
	(set-goal traineagle yes))
#end-if
;=========================================================
(defrule
	(up-research-status c: ri-elite-eagle-warrior >= research-pending)
	(up-compare-goal excessGold >= 500); 900
(or	(up-research-status c: my-unique-research >= research-pending)
	(up-compare-goal excessGold >= 800))
	(players-unit-type-count focus-player militiaman-line < 7)
	(players-unit-type-count focus-player samurai-line < 7)
	(players-unit-type-count focus-player teutonic-knight-line < 7)
	(players-unit-type-count focus-player throwing-axeman-line < 7)
	(players-unit-type-count focus-player berserk-line < 7)
	(players-unit-type-count focus-player jaguar-man-line < 7)
	(strategic-number husks < 7)
	(players-unit-type-count focus-player cataphract-line < 7)
	(players-unit-type-count focus-player war-elephant-line < 7)
	(players-unit-type-count focus-player mameluke-line < 7)
=>
	(set-goal traineagle yes))
;=========================================================
(defrule
(or	(population >= max-civ-pop)
(or	(and	(up-research-status c: imperial-age >= research-pending)
		(and	(building-type-count castle >= 1)
			(goal uugoal yes)))
(or	(strategic-number teamsuperiority >= 2);(and	(up-research-status c: ri-forging < research-pending)
							;(up-research-status c: ri-scale-mail < research-pending))
	(and	(strategic-number sn-military-superiority >= 0)
		(military-population >= 33)))))
=>
	(up-jump-rule 2)); 3
(defrule
(or	(strategic-number sn-military-superiority >= 0); 1
(or	(current-age >= imperial-age)	;(and	(civ-selected saracen)
		;	(strategic-number sn-current-age >= imperial))
(or	(building-type-count barracks < 1)
(or	(up-compare-goal milunits != yes)
(or	(strategic-number archers >= 48)
(or	(strategic-number husks >= 12)
(or	(players-unit-type-count focus-player samurai-line >= 10)
	(players-unit-type-count focus-player militiaman-line >= 10))))))))
=>
	(up-jump-rule 1)); 2
(defrule
	(goal trainchamp no)
(or	(strategic-number sn-military-superiority <= -2)
(or	(food-amount >= 70)
(or	(civilian-population >= up-max-civ)
	(goal underattack yes))))
;(up-research-status c: imperial-age < research-pending);(nand	(building-type-count castle >= 1)
;	(strategic-number sn-current-age >= imperial))
(or	(strategic-number sn-military-superiority <= -1)
	(goal defend yes))
	(unit-type-count-total eagle-warrior-line < 24); 20
=>
	(set-goal traineagle yes))
;=========================================================
; Camels
;=========================================================
(defrule
	(strategic-number camels >= 1)
=>
	(up-modify-sn cavalry s:- camels))
;=========================================================
#load-if-defined TURKISH-CIV
(defrule
	(up-compare-goal excessGold < 860)
	(up-compare-goal tradeunits < 10)
(or	(military-population >= 16)
	(strategic-number sn-military-superiority >= 0)); 1
=>
	(up-jump-rule 1))
(defrule
	(goal milunits yes)
	(strategic-number moenche < 15)
	(strategic-number sn-current-age <= castlea)
(or	(strategic-number cavalry >= 4)
(or	(players-unit-type-count focus-player genitour >= 4)
(or	(players-unit-type-count focus-player elite-genitour >= 4)
(or	(players-unit-type-count focus-player genitour-placeholder >= 4)
	(strategic-number cavarchers >= 4)))))
	(food-amount >= cm-buffer-f)
	(up-compare-goal camel-set < 6); 5
=>
	(set-goal traincamel yes)); end jump
(defrule
	(goal milunits yes)
	(strategic-number moenche < 15)
(or	(strategic-number cavalry >= 5)
(or	(players-unit-type-count focus-player genitour >= 5)
(or	(players-unit-type-count focus-player elite-genitour >= 5)
(or	(players-unit-type-count focus-player genitour-placeholder >= 5)
	(strategic-number cavarchers >= 5)))))
	(food-amount >= cm-buffer-f)
	(up-compare-goal camel-set < 8); 7
=>
	(set-goal traincamel yes))
(defrule
	(goal milunits yes)
	(strategic-number moenche < 15)
(or	(strategic-number cavalry >= 7)
(or	(players-unit-type-count focus-player genitour >= 7)
(or	(players-unit-type-count focus-player elite-genitour >= 7)
(or	(players-unit-type-count focus-player genitour-placeholder >= 7)
	(strategic-number cavarchers >= 7)))))
	(food-amount >= cm-buffer-f)
	(up-compare-goal camel-set < 11); 12
=>
	(set-goal traincamel yes))
(defrule
	(goal milunits yes)
(or	(strategic-number cavalry >= 10)
(or	(players-unit-type-count focus-player genitour >= 10)
(or	(players-unit-type-count focus-player elite-genitour >= 10)
(or	(players-unit-type-count focus-player genitour-placeholder >= 10)
	(strategic-number cavarchers >= 10)))))
	(food-amount >= cm-buffer-f)
	(up-compare-goal camel-set < 16); 18
=>
	(set-goal traincamel yes))
(defrule
	(goal milunits yes)
(or	(strategic-number cavalry >= 15)
(or	(players-unit-type-count focus-player genitour >= 15)
(or	(players-unit-type-count focus-player elite-genitour >= 15)
(or	(players-unit-type-count focus-player genitour-placeholder >= 15)
	(strategic-number cavarchers >= 15)))))
	(food-amount >= cm-buffer-f)
	(up-compare-goal camel-set < 24); 27
=>
	(set-goal traincamel yes))
(defrule
	(goal milunits yes)
(or	(strategic-number cavalry >= 25)
(or	(players-unit-type-count focus-player genitour >= 25)
(or	(players-unit-type-count focus-player elite-genitour >= 25)
(or	(players-unit-type-count focus-player genitour-placeholder >= 25)
	(strategic-number cavarchers >= 25)))))
	(food-amount >= cm-buffer-f)
	(up-compare-goal camel-set < 40); 42
=>
	(set-goal traincamel yes))
(defrule
	(goal milunits yes)
(or	(strategic-number cavalry >= 40)
(or	(players-unit-type-count focus-player genitour >= 40)
(or	(players-unit-type-count focus-player elite-genitour >= 40)
(or	(players-unit-type-count focus-player genitour-placeholder >= 40)
	(strategic-number cavarchers >= 40)))))
	(food-amount >= cm-buffer-f)
	(up-compare-goal camel-set < 58); 60
=>
	(set-goal traincamel yes))
#end-if
;=========================================================
(defrule
(or	(up-research-status c: ri-imperial-camel >= research-pending)
(or	(up-research-status c: ri-farimba >= research-pending)
(or	(up-research-status c: ri-zealotry >= research-pending)
	(and	(up-research-status c: ri-heavy-camel >= research-pending)
		(up-research-status c: ri-halberdier <= research-available)))))
=>
	(up-jump-rule 2))
(defrule
(or	(up-compare-goal milunits != yes)
	(and	(strategic-number sn-military-superiority >= -1)
		(goal underattack no)))
=>
	(up-jump-rule 5))
(defrule
	(up-research-status c: imperial-age >= research-pending)
	(up-research-status c: ri-heavy-camel <= research-available)
(nor	(civ-selected berbers)
(or	(civ-selected byzantine)
(or	(civ-selected indian)
(or	(civ-selected malian)
(or	(civ-selected saracen)
(or	(civ-selected tatars)
	(civ-selected turkish)))))))
=>
	(up-jump-rule 4)); end jump
(defrule
	(strategic-number spears < 10)
	(strategic-number moenche < 10)
(or	(players-unit-type-count focus-player genitour >= 10)
(or	(players-unit-type-count focus-player elite-genitour >= 10)
(or	(players-unit-type-count focus-player genitour-placeholder >= 10)
	(strategic-number cavarchers >= 10))))
	(up-compare-goal camel-set < 15)
=>
	(set-goal traincamel yes))
(defrule
	(strategic-number spears < 15)
	(strategic-number moenche < 12)
(or	(players-unit-type-count focus-player genitour >= 15)
(or	(players-unit-type-count focus-player elite-genitour >= 15)
(or	(players-unit-type-count focus-player genitour-placeholder >= 15)
	(strategic-number cavarchers >= 10))))
	(up-compare-goal camel-set < 20)
=>
	(set-goal traincamel yes))
(defrule
	(strategic-number spears < 25)
	(strategic-number moenche < 14)
(or	(players-unit-type-count focus-player genitour >= 25)
(or	(players-unit-type-count focus-player elite-genitour >= 25)
(or	(players-unit-type-count focus-player genitour-placeholder >= 25)
	(strategic-number cavarchers >= 25))))
	(up-compare-goal camel-set < 35)
=>
	(set-goal traincamel yes))
(defrule
	(strategic-number spears < 35)
	(strategic-number moenche < 16)
(or	(players-unit-type-count focus-player genitour >= 35)
(or	(players-unit-type-count focus-player elite-genitour >= 35)
(or	(players-unit-type-count focus-player genitour-placeholder >= 35)
	(strategic-number cavarchers >= 35))))
	(up-compare-goal camel-set < 45)
=>
	(set-goal traincamel yes)); end jump
;=========================================================
#load-if-not-defined BURGUNDIANS-CIV
#load-if-not-defined SICILIANS-CIV

#load-if-not-defined INCAN-CIV
#load-if-not-defined ITALIAN-CIV
#load-if-not-defined MAGYAR-CIV
#load-if-not-defined SLAVIC-CIV

#load-if-not-defined BURMESE-CIV
#load-if-not-defined ETHIOPIAN-CIV
#load-if-not-defined KHMER-CIV
#load-if-not-defined MALAY-CIV
#load-if-not-defined PORTUGUESE-CIV
#load-if-not-defined VIETNAMESE-CIV

#load-if-not-defined BULGARIANS-CIV
#load-if-not-defined CUMANS-CIV
#load-if-not-defined LITHUANIANS-CIV
#load-if-not-defined TATARS-CIV

#load-if-not-defined AZTEC-CIV
#load-if-not-defined BRITON-CIV
#load-if-not-defined BYZANTINE-CIV
#load-if-not-defined CELTIC-CIV
#load-if-not-defined CHINESE-CIV
#load-if-not-defined FRANKISH-CIV
#load-if-not-defined GOTHIC-CIV
#load-if-not-defined HUN-CIV
#load-if-not-defined JAPANESE-CIV
#load-if-not-defined KOREAN-CIV
#load-if-not-defined MONGOL-CIV
#load-if-not-defined MAYAN-CIV
#load-if-not-defined PERSIAN-CIV
#load-if-not-defined SPANISH-CIV
#load-if-not-defined TEUTONIC-CIV
#load-if-not-defined TURKISH-CIV
#load-if-not-defined VIKING-CIV ; Saracens, Indians, Berbers, Malians
(defrule
(or	(up-compare-goal milunits != yes)
	(and	(up-research-status c: imperial-age <= research-available)
		(and	(civ-selected saracen)
			(civ-selected berbers))))
=>
	(up-jump-rule 5))
(defrule
	(civ-selected berbers)
(or	(population >= max-civ-pop)
	(up-research-status c: ri-heavy-camel <= research-available))
(or	(strategic-number cavarchers < 3)
	(and	(unit-type-count-total my-unique-unit-line <= 0)
		(and	(up-compare-goal trainunique != yes)
			(up-compare-goal uugoal != yes))))
=>
	(up-jump-rule 4))
(defrule
	(civ-selected malian)
(or	(up-research-status c: ri-farimba <= research-available)
(or	(and	(goal uugoal yes)
		(building-type-count-total castle >= 1))
	(goal champgoal yes)))
=>
	(up-jump-rule 3))
(defrule	
	(strategic-number spears < 15)
	(strategic-number moenche < 10)
	(strategic-number sn-current-age <= castlea)
(or	(strategic-number cavalry >= 3)
(or	(players-unit-type-count focus-player genitour >= 3)
(or	(players-unit-type-count focus-player elite-genitour >= 3)
(or	(players-unit-type-count focus-player genitour-placeholder >= 3)
	(strategic-number cavarchers >= 3)))))
	(up-compare-goal camel-set < 10)
=>
	(set-goal traincamel yes))
(defrule
	(strategic-number spears < 25)
	(strategic-number moenche < 12)
(or	(strategic-number cavalry >= 7)
(or	(players-unit-type-count focus-player genitour >= 7)
(or	(players-unit-type-count focus-player elite-genitour >= 7)
(or	(players-unit-type-count focus-player genitour-placeholder >= 7)
	(strategic-number cavarchers >= 7)))))
	(up-compare-goal camel-set < 20)
=>
	(set-goal traincamel yes))
(defrule
	(strategic-number spears < 40)
	(strategic-number moenche < 14)
(or	(strategic-number cavalry >= 15)
(or	(players-unit-type-count focus-player genitour >= 15)
(or	(players-unit-type-count focus-player elite-genitour >= 15)
(or	(players-unit-type-count focus-player genitour-placeholder >= 15)
	(strategic-number cavarchers >= 15)))))
	(up-compare-goal camel-set < 40)
=>
	(set-goal traincamel yes)); end jump
(defrule
	(goal milunits yes)
	(up-research-status c: ri-imperial-camel >= research-pending)
	(strategic-number spears < 20)
	(strategic-number moenche < 10)
(or	(players-unit-type-count focus-player berserk-line < 10)
	(up-compare-const wk-game != 1))
	(players-unit-type-count focus-player teutonic-knight-line < 5)
	(players-unit-type-count focus-player genoese-crossbowman < 5)
(or	(population < max-civ-pop)
	(up-compare-goal camel-set < 30))
=>
	(set-goal traincamel yes))
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if

#end-if
#end-if
#end-if
#end-if

#end-if
#end-if
#end-if
#end-if
#end-if
#end-if

#end-if
#end-if
#end-if
#end-if

#end-if
#end-if
;=========================================================
(defrule
(or	(up-compare-goal milunits != yes)
(or	(up-compare-goal camel-set >= 40)
(or	(strategic-number infantry >= 36)
(or	(strategic-number archers >= 48)
(or	(strategic-number spears >= 30)
	(strategic-number moenche >= 10))))))
=>
	(up-jump-rule 2))
(defrule
	(strategic-number cavalry < 18)
	(players-unit-type-count focus-player genitour < 18)
	(players-unit-type-count focus-player elite-genitour < 18)
	(players-unit-type-count focus-player genitour-placeholder < 18)
	(strategic-number cavarchers < 18)
=>
	(up-jump-rule 1))
(defrule
(or	(up-research-status c: ri-heavy-camel >= research-pending)
(or	(and	(up-research-status c: my-unique-unit-upgrade <= research-available)
		(or	(up-research-status c: ri-maghrabi-camels >= research-pending)
			(up-research-status c: ri-zealotry >= research-pending)))
	(up-research-status c: ri-imperial-camel >= research-pending)))
=>
	(set-goal traincamel yes))
(defrule
	(strategic-number camels >= 1)
=>
	(up-modify-sn cavalry s:+ camels))
;=========================================================
; Champs
;=========================================================
(defrule
;test	(goal milunits yes)
(or	(goal strategy drush)
	(goal drushmicro yes))
(or	(up-compare-goal total-food-amount >= 110); maa-buffer-f
(or	(unit-type-count-total militiaman-line == 4); just one left for 5 - sanic
	(up-pending-objects c: villager >= 2)))
	(players-current-age focus-player <= dark-age)
	(strategic-number sn-current-age < feudal)
	(unit-type-count-total 152 < 1); dead militias
	(unit-type-count-total militiaman-line < drush-militias)
=>
	(set-goal trainchamp yes))

#load-if-not-defined BERBERS-CIV
#load-if-not-defined BRITON-CIV
#load-if-not-defined BYZANTINE-CIV
#load-if-not-defined CELTIC-CIV
#load-if-not-defined CHINESE-CIV
#load-if-not-defined CUMANS-CIV
#load-if-not-defined ETHIOPIAN-CIV
#load-if-not-defined FRANKISH-CIV
#load-if-not-defined HUN-CIV
#load-if-not-defined INCAN-CIV
#load-if-not-defined INDIAN-CIV
#load-if-not-defined ITALIAN-CIV
#load-if-not-defined KHMER-CIV
#load-if-not-defined KOREAN-CIV
#load-if-not-defined LITHUANIANS-CIV
#load-if-not-defined MAGYAR-CIV
#load-if-not-defined MAYAN-CIV
#load-if-not-defined MONGOL-CIV
#load-if-not-defined PERSIAN-CIV
#load-if-not-defined PORTUGUESE-CIV
#load-if-not-defined SARACEN-CIV
#load-if-not-defined SPANISH-CIV
#load-if-not-defined TATARS-CIV
#load-if-not-defined TEUTONIC-CIV
#load-if-not-defined TURKISH-CIV
#load-if-not-defined VIETNAMESE-CIV ; Aztecs, Goths, Vikings, Japanese, Malay, Malians, Burmese, Slavic, Bulgarians, Burgundians, Sicilians

(defrule
(or	(goal champgoal yes)
(or	(players-unit-type-count focus-player teutonic-knight-line >= 15); 13
(or	(and	(strategic-number archers >= 42); 26
		(not	(civ-selected malian)))
(or	(strategic-number moenche >= 15); 11
(or	(up-compare-goal strategy == stonewall)
	(strategic-number sn-current-age < imperial))))))
=>
	(up-jump-rule 12))
(defrule
	(goal strategy fast-imp)
	(up-compare-goal custom-civ-pop < 64)
=>
	(up-jump-rule 11))
(defrule
(or	(civ-selected malian)
(or	(civ-selected aztec)
	(civ-selected viking)))
(or	(up-compare-goal uugoal != yes)
	(and	(current-age >= imperial-age)
		(building-type-count-total castle <= 0)))
=>
	(set-goal champgoal yes))
(defrule
	(civ-selected japanese)
	(up-research-status c: imperial-age >= research-pending); (strategic-number sn-current-age >= imperial)
(or	(up-compare-goal uugoal != yes)
	(and	(current-age >= imperial-age)
		(and	(current-age-time >= 180)
			(and	(building-type-count-total castle <= 0)
				(stone-amount < castle-stone)))))
=>
	(set-goal champgoal yes))
(defrule
	(civ-selected gothic)
	(strategic-number sn-current-age >= imperial)
(or	(up-research-status c: my-unique-unit-upgrade >= research-pending)
(or	(strategic-number archers <= 5); test
(or	(and	(current-age >= imperial-age);(strategic-number sn-current-age >= imperial)
		(and	(building-type-count-total castle <= 0)
			(stone-amount < castle-stone)))
	(goal uugoal no))))
=>
	(set-goal champgoal yes)
	(up-jump-rule 1))
(defrule
	(civ-selected gothic)
	(strategic-number sn-current-age >= imperial)
(or	(players-unit-type-count focus-player militiaman-line >= 15)
(or	(strategic-number husks >= 15)
	(players-unit-type-count focus-player eagle-warrior-line >= 20)))
=>
	(set-goal champgoal yes)); end jump
(defrule
	(civ-selected malay)
(or	(up-research-status c: ri-forced-levy >= research-pending)
(or	(goal trainchamp yes)
(or	(up-research-status c: ri-two-handed-swordsman >= research-pending)
	(unit-type-count-total militiaman-line >= 7))))
=>
	(set-goal champgoal yes))
(defrule
	(civ-selected malian)
	(goal uugoal yes)
(or	(population >= max-pop)
	(strategic-number skirmsarchers >= 1))
=>
	(set-goal champgoal yes))
(defrule
	(civ-selected bulgarians)
(or	(up-compare-goal uugoal != yes)
(or	(players-unit-type-count focus-player samurai-line >= 10)
	(and	(or	(strategic-number spears >= 67)
			(strategic-number archers <= 0))
		(up-research-status c: ri-bagains >= research-pending))))
=>
	(set-goal champgoal yes))
(defrule
	(civ-selected bulgarians)
	(up-compare-goal uugoal != yes)
(or	(players-civ focus-player bulgarians)
(or	(players-civ focus-player celtic)
(or	(players-civ focus-player frankish)
(or	(players-civ focus-player gothic)
(or	(players-civ focus-player incan)
(or	(players-civ focus-player japanese)
	(players-civ focus-player magyar)))))))
=>
	(set-goal champgoal yes))
(defrule
	(civ-selected bulgarians)
	(up-compare-goal uugoal != yes)
(or	(players-civ focus-player malay)
(or	(players-civ focus-player malian)
(or	(players-civ focus-player persian)
(or	(players-civ focus-player saracen)
(or	(players-civ focus-player slavic)
(or	(players-civ focus-player teutonic)
	(players-civ focus-player viking)))))))
=>
	(set-goal champgoal yes))
(defrule
	(civ-selected burmese)
(or	(up-compare-goal uugoal != yes)
(or	(players-unit-type-count focus-player genoese-crossbowman >= 6)
(or	(players-unit-type-count focus-player elite-genoese-crossbowman >= 6)
(or	(players-unit-type-count focus-player camel-archer-line >= 6)
(or	(strategic-number husks >= 6)
(or	(strategic-number eagles >= 12)
	(strategic-number spears >= 24)))))))
=>
	(set-goal champgoal yes))
(defrule
(or	(civ-selected burgundians)
	(civ-selected sicilians))
	(goal uugoal no)
	(goal palagoal no)
	(goal cavagoal no)
=>
	(set-goal champgoal yes)); end jump

(defrule
	(civ-selected japanese)
	(goal champgoal yes)
	(current-age <= castle-age)
	(strategic-number sn-current-age <= castlea)
	(up-research-status c: ri-long-swordsman <= research-available)
;(or
	(goal uugoal yes)
;(or	(building-type-count-total castle >= 1)
;	(stone-amount >= castle-stone)))
=>
	(set-goal champgoal no))

(defrule
(or	(up-compare-goal champgoal != yes)
(or	(up-compare-goal milunits != yes)
(or	(strategic-number sn-current-age < imperial)
(or	(strategic-number moenche >= 15); 12
(or	(players-unit-type-count focus-player teutonic-knight-line >= 12)
	(players-unit-type-count focus-player jaguar-man-line >= 12))))))
=>
	(up-jump-rule 2))
(defrule
(nor	(up-research-status c: ri-champion >= research-pending)
	(and	(up-research-status c: ri-two-handed-swordsman >= research-pending)
		(or	(up-research-status c: ri-forced-levy >= research-pending)
			(and	(up-research-status c: ri-forced-levy != research-available)
				(and	(up-compare-goal excessFood >= 810)
					(up-compare-goal excessGold >= 370))))))
=>
	(up-jump-rule 1))
(defrule
(or	(strategic-number archers < 50)
(or	(and	(strategic-number gunpowder < 50)
		(civ-selected malian))
(or	(up-compare-goal mangonel-set >= 6)
(or	(unit-type-count-total scorpion-line >= 8)
(or	(unit-type-count-total bombard-cannon-line >= 10)
;(or	(up-compare-goal battle-elephant-set >= 16)
	(up-compare-goal skirmisher-set >= 30))))));)
;	(strategic-number sn-current-age >= imperial)
;	(unit-type-count-total my-unique-unit-line < 30)
;	(unit-type-count-total militiaman-line < 90)
=>
	(set-goal trainchamp yes)); end jump
;=========================================================
;(defrule
;	(goal milunits yes)
;(nor	(strategic-number archers >= 15)
;(or	(strategic-number cavalry >= 25)
;(or	(strategic-number moenche >= 10)
;(or	(strategic-number gunpowder >= 15)
;	(players-unit-type-count focus-player teutonic-knight-line > 5)))))
;	(goal enemy-goal flush)
;	(game-time < 1110)
;	(strategic-number sn-military-superiority <= 0)
;	(unit-type-count-total militiaman-line < 18)
;=>
;	(set-goal trainchamp yes))

#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if


(defrule
(or	(strategic-number husks < 6)
(or	(up-compare-goal milunits != yes)
(or	(strategic-number moenche >= 7)
(or	(strategic-number skirmsarchers >= 6)
(or	(strategic-number cavalry >= 6)
(or	(and	(building-type-count monastery >= 1)
		(goal trainmonk yes))
	(strategic-number sn-current-age >= imperial)))))))
=>
	(up-jump-rule 2))
(defrule
(or	(and	(building-type-count castle >= 1)
		(and	(goal trainunique yes)
			(or	(up-compare-const uu-type == infantry-uu)
				(up-compare-const uu-type == cavalry-uu))))
	(and	(building-type-count stable >= 1)
		(or	(goal trainknight yes)
			(or	(goal trainsteppe yes)
				(goal trainbattle yes)))))
=>
	(up-jump-rule 1))
(defrule
	(strategic-number sn-current-age >= fcastlea)
	(goal position-goal flank)
(or (up-compare-const maa-var-affinity >= 2)
(or	(up-compare-const dm-unit == militiaman-line)
	(up-compare-const champ-available == 1)))
	(strategic-number sn-military-superiority <= -1)
=>
;	(chat-local-to-self "Anti-Husks.")
	(set-goal trainchamp yes)); end jump


(defrule
(or	(and	(up-compare-goal enemy-goal2 != klew)
		(strategic-number eagles < 16))
(or	(strategic-number eagles <= 1)
(or	(strategic-number moenche >= 7)
(or	(strategic-number skirmsarchers >= 6)
(or	(strategic-number cavalry >= 2); :'D
(or	(strategic-number husks >= 2); hmm 11
	(strategic-number sn-current-age >= imperial)))))))
=>
	(up-jump-rule 2))
(defrule
(or	(and	(building-type-count castle >= 1); 2
		(and	(or	(goal milunits castledrop)
				(goal trainunique yes))
			(or	(up-compare-const uu-type == infantry-uu)
				(up-compare-const uu-type == cavalry-uu))))
;(or	(up-compare-goal milunits != yes)
	(goal strategy krush));)
=>
	(up-jump-rule 1))
(defrule
	(strategic-number sn-military-superiority <= 0)
(or	(unit-type-count-total militiaman-line < 16)
(or	(up-research-status c: ri-supplies != research-available)
	(strategic-number sn-military-superiority <= -1)))
(or	(strategic-number sn-current-age >= fcastlea)
(or	(strategic-number sn-military-superiority <= -2)
	(up-compare-goal total-food-amount < castle-f2)))
=>
;	(chat-local-to-self "Anti-Eagles.")
; bmbr	(up-modify-goal maa-var c:max yes)
	(set-goal trainchamp yes)); end jump


;#load-if-not-defined INCAN-CIV
#load-if-not-defined INDIAN-CIV
;#load-if-not-defined ITALIAN-CIV
#load-if-not-defined MAGYAR-CIV
#load-if-not-defined SLAVIC-CIV

#load-if-not-defined BERBERS-CIV
#load-if-not-defined BURMESE-CIV
#load-if-not-defined ETHIOPIAN-CIV
#load-if-not-defined KHMER-CIV
;#load-if-not-defined MALAY-CIV
;#load-if-not-defined MALIAN-CIV
#load-if-not-defined PORTUGUESE-CIV
#load-if-not-defined VIETNAMESE-CIV

#load-if-not-defined BULGARIANS-CIV
#load-if-not-defined CUMANS-CIV
#load-if-not-defined LITHUANIANS-CIV
#load-if-not-defined TATARS-CIV

;#load-if-not-defined AZTEC-CIV
;#load-if-not-defined BRITON-CIV
#load-if-not-defined BYZANTINE-CIV
;#load-if-not-defined CELTIC-CIV
;#load-if-not-defined CHINESE-CIV
#load-if-not-defined FRANKISH-CIV
;#load-if-not-defined GOTH-CIV
#load-if-not-defined HUN-CIV
;#load-if-not-defined JAPANESE-CIV
;#load-if-not-defined KOREAN-CIV
#load-if-not-defined MONGOL-CIV
#load-if-not-defined MAYAN-CIV
#load-if-not-defined PERSIAN-CIV
;#load-if-not-defined SARACEN-CIV
#load-if-not-defined SPANISH-CIV
;#load-if-not-defined TEUTONIC-CIV
;#load-if-not-defined TURKISH-CIV
;#load-if-not-defined VIKING-CIV; Incas, Italians, Aztecs, Britons, Celts, Chinese, Goths, Japanese, Koreans, Saracens, Teutons, Turks, Vikings, Malay, Malian
(defrule
(or	(unit-type-count-total janissary-line >= 7)
(or	(unit-type-count-total samurai-line >= 7)
(or	(unit-type-count-total teutonic-knight-line >= 5)
(or	(unit-type-count-total woad-raider-line >= 7)
(or	(unit-type-count-total throwing-axeman-line >= 7)
(or	(unit-type-count-total berserk-line >= 7)
(or	(unit-type-count-total jaguar-man-line >= 5)
	(unit-type-count-total mameluke-line >= 6))))))))
=>
	(up-jump-rule 1))
(defrule; eagle counters for the ones who may need it
	(goal milunits yes)
	(goal palagoal no)
	(strategic-number sn-current-age >= imperial)
	(players-current-age focus-player >= imperial-age)
	(strategic-number eagles >= 12)
	(up-research-status c: ri-two-handed-swordsman >= research-pending)
	(strategic-number sn-military-superiority <= 0)
	(players-unit-type-count focus-player eagle-warrior-line g:> champcount)
	(strategic-number archers < 24)
	(players-unit-type-count focus-player jaguar-man-line < 6)
=>
	(set-goal trainchamp yes))
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
;#end-if
;#end-if
;#end-if
;#end-if
;#end-if
;#end-if
#end-if
;#end-if
;#end-if
;#end-if
;#end-if

;#end-if
#end-if
#end-if
#end-if

;#end-if
;#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if

;#end-if
;#end-if
#end-if
#end-if
#end-if



(defrule
	(up-research-status c: imperial-age >= research-pending)
	(up-compare-goal champgoal != yes)
	(up-compare-const maa-var-affinity <= 3); 2
=>
	(up-jump-rule 3))
(defrule
(or	(population >= max-civ-pop)
(or	(and	(up-research-status c: imperial-age >= research-pending)
		(and	(building-type-count castle >= 1)
			(goal uugoal yes)))
(or	(strategic-number teamsuperiority >= 2);(and	(up-research-status c: ri-forging < research-pending)
							;(up-research-status c: ri-scale-barding < research-pending))
	(and	(strategic-number sn-military-superiority >= 0)
		(military-population >= 30)))))
=>
	(up-jump-rule 2))
(defrule
(or	(up-compare-const maa-var-affinity <= 1)
(or	(strategic-number sn-military-superiority >= 0); 1
(or	(current-age >= imperial-age)
(or	(building-type-count barracks < 1)
(or	(up-compare-goal milunits != yes)
(or	(strategic-number archers >= 20)
(or	(strategic-number siege >= 10)
	(strategic-number moenche >= 10))))))))
=>
	(up-jump-rule 1))
(defrule
	(up-research-status c: ri-supplies >= research-pending)
	(up-research-status c: ri-long-swordsman >= research-pending)
(or	(strategic-number sn-military-superiority <= -2)
(or	(up-pending-objects c: villager >= 2)
	(up-compare-goal excessFood >= maa-buffer-f)))
(or	(unit-type-count-total militiaman-line < 30)
	(goal champgoal yes))
=>
	(set-goal trainchamp yes)); end jump
;=========================================================
(defrule
	(goal milunits yes)
	(goal position-goal flank);
	(goal enemy-goal drush)
	(strategic-number sn-current-age == dark)
	(players-military-population focus-player >= 3)
(or	(food-amount >= 560)
	(and	(strategic-number sn-current-age >= dfeudal)
		(building-type-count archery-range <= 0)))
	(military-population < 4)
	(unit-type-count-total militiaman-line < 3); 5
=>
	(set-goal maa-var yes)
	(set-goal trainchamp yes))
;=========================================================
;(defrule; early nomad scout
;(or	(up-compare-goal nomaden != no)
;	(up-compare-goal landnomad != no))
;	(goal underattack no)
;	(goal defend no)
;	(military-population <= 0)
;(or	(food-amount >= 560)
;	(strategic-number sn-current-age >= dfeudal))
;=>
;	(set-goal trainchamp yes)
;	(disable-self))
;=========================================================
; Early DM
;=========================================================
(defrule
	(up-compare-const dm-game == 1)
	(strategic-number sn-current-age < castlea)
(or	(strategic-number sn-military-superiority <= 0)
	(strategic-number teamsuperiority <= 0))
	(up-compare-goal excessFood >= 2250)
	(up-compare-goal excessGold >= 1000)
	(goal trainpike no)
	(goal traineagle no)
=>
	(set-goal trainchamp yes))
(defrule
	(up-compare-const dm-game == 1)
	(strategic-number sn-current-age < castlea)
(or	(strategic-number sn-military-superiority <= 0)
	(strategic-number teamsuperiority <= 0))
;(or	(goal enemy-boats yes)
	(up-compare-goal navycount < minNavy);)
	(up-compare-goal excessFood >= 4500)
	(up-compare-goal excessGold >= 1500)
	(goal trainfire no)
	(goal traindemo no)
=>
	(set-goal traingalley yes))
;=========================================================
; No gold left ; Trash war
;=========================================================
;(defrule
;	(goal milunits yes)
;	(cc-players-unit-type-count 0 gold-mine < 3)
;	(building-type-count-total blacksmith >= 1)
;	(up-compare-goal excessGold < 200)
;(or	(research-completed ri-champion)
;	(up-compare-goal excessFood > 750))
;(or	(up-compare-goal excessFood > 500)
;(or	(strategic-number sn-military-superiority <= -2)
;	(strategic-number spears < 30)))
;=>
;	(set-goal trainhussar yes))
;(defrule
;	(goal milunits yes)
;	(cc-players-unit-type-count 0 gold-mine < 3)
;	(building-type-count-total blacksmith >= 1)
;	(up-compare-goal excessGold < 200)
;	(up-compare-goal excessWood < 200)
;	(up-compare-goal excessFood > 1000)
;	(strategic-number spears < 45)
;=>
;	(set-goal trainhussar yes))
(defrule
	(goal milunits yes)
(or	(up-compare-goal tradeunits < 19)
	(cc-players-unit-type-count 0 tree-class < 125))
(or	(cc-players-unit-type-count 0 gold-mine < 4)
	(cc-players-unit-type-count 0 tree-class < 125))
	(strategic-number sn-current-age >= imperial);	(building-type-count-total blacksmith >= 1)
	(up-compare-goal excessGold < 150)
	(up-compare-goal excessWood < 100)
	(up-compare-goal excessFood >= 130)
	(strategic-number spears < 45)
	(strategic-number camels < 42)
=>
	(set-goal trainhussar yes))
(defrule
	(goal milunits yes)
	(up-compare-goal tradeunits < 9)
(not	(player-in-game any-ally))
	(cc-players-unit-type-count 0 gold-mine < 8)
	(up-gaia-type-count c: gold <= 4)
	(strategic-number sn-current-age >= imperial);	(building-type-count-total blacksmith >= 1)
	(up-compare-goal excessFood >= 600)
	(commodity-selling-price food < 30)
	(up-compare-goal excessGold < 200)
	(strategic-number spears < 33)
	(strategic-number camels < 30)
=>
	(set-goal trainhussar yes))
(defrule
	(goal milunits yes)
	(up-compare-goal tradeunits < 19)
	(cc-players-unit-type-count 0 gold-mine < 4)
	(strategic-number sn-current-age >= imperial);	(building-type-count-total blacksmith >= 1)
	(up-compare-goal excessWood > 100)
	(up-compare-goal excessFood >= sk-buffer-f)
	(up-compare-goal excessGold < 200)
=>
	(set-goal trainskirm yes))
(defrule
	(goal milunits yes)
	(up-compare-goal tradeunits < 9)
(not	(player-in-game any-ally))
	(cc-players-unit-type-count 0 gold-mine < 8)
	(up-gaia-type-count c: gold <= 4)
	(strategic-number sn-current-age >= imperial);	(building-type-count-total blacksmith >= 1)
	(up-compare-goal excessWood >= 600)
	(up-compare-goal excessFood >= 600)
(or	(commodity-selling-price wood < 30)
	(commodity-selling-price food < 30))
	(up-compare-goal excessGold < 200)
=>
	(set-goal trainskirm yes))
(defrule
	(goal milunits yes)
	(up-compare-goal tradeunits < 19)
	(cc-players-unit-type-count 0 gold-mine < 4)
	(strategic-number sn-current-age >= imperial);	(building-type-count-total blacksmith >= 1)
	(up-compare-goal excessWood >= pk-buffer-wc)
	(up-compare-goal excessFood >= pk-buffer-f)
	(up-compare-goal excessGold < 200)
=>
	(set-goal trainpike yes))
(defrule
	(goal milunits yes)
	(up-compare-goal tradeunits < 9)
(not	(player-in-game any-ally))
	(cc-players-unit-type-count 0 gold-mine < 8)
	(up-gaia-type-count c: gold <= 4)
	(strategic-number sn-current-age >= imperial);	(building-type-count-total blacksmith >= 1)
	(up-compare-goal excessWood >= 600)
	(up-compare-goal excessFood >= 600)
(or	(commodity-selling-price wood < 30)
	(commodity-selling-price food < 30))
	(up-compare-goal excessGold < 200)
=>
	(set-goal trainpike yes))
(defrule
	(civ-selected persian)
	(up-research-status c: ri-boiling-oil >= research-pending)
	(up-compare-goal excessWood >= 600)
(or	(commodity-selling-price wood < 30)
	(up-compare-goal tradeunits < 12))
	(up-compare-goal excessGold < 200)
(or	(strategic-number skirms < 24)
(or	(unit-type-count infantry-class >= 16)
	(unit-type-count cavalry-class >= 8)))
=>
	(set-goal trainarcher yes))
(defrule
	(goal milunits yes)
(or	(players-unit-type-count focus-player spearman-line > 34)
	(strategic-number skirms > 39))
	(strategic-number archers < 25)
	(cc-players-unit-type-count 0 gold-mine < 4)
(or	(up-compare-goal tradeunits < 19)
	(cc-players-unit-type-count 0 tree-class < 125))
;(or	(unit-type-count-total militiaman-line < 6)
	(up-research-status c: ri-champion >= research-pending);)
=>
	(set-goal trainchamp yes))
(defrule
(or	(cc-players-unit-type-count 0 gold-mine >= 4)
(or	(up-compare-goal milunits != yes)
(or	(players-unit-type-count focus-player teutonic-knight-line >= 12)
(or	(players-unit-type-count focus-player jaguar-man-line >= 12)
	(strategic-number moenche >= 15))))); 12
=>
	(up-jump-rule 1))
(defrule
	(up-research-status c: ri-forced-levy >= research-pending)
	(up-research-status c: ri-long-swordsman >= research-pending)
(or	(up-research-status c: ri-two-handed-swordsman >= research-pending)
	(up-compare-goal excessFood >= 365))
(or	(strategic-number archers < 50)
(or	(up-compare-goal mangonel-set >= 6)
(or	(unit-type-count-total scorpion-line >= 8)
(or	(unit-type-count-total bombard-cannon-line >= 10)
	(up-compare-goal skirmisher-set >= 30)))))
=>
	(set-goal trainchamp yes)); end jump
;=========================================================
; Expansions
;=========================================================
(defrule
(nor(unit-available condottiero-placeholder)
	(unit-available condottiero))
=>
	(up-jump-rule 4))
(defrule
(or	(unit-type-count-total condottiero s:>= gunpowder)
(or	(unit-type-count-total condottiero-placeholder s:>= gunpowder)
(or	(players-unit-type-count focus-player teutonic-knight-line >= 10)
	(players-unit-type-count focus-player samurai-line >= 10))))
=>
	(up-jump-rule 3))
(defrule
	(strategic-number gunpowder >= 7);(players-unit-type-count focus-player hand-cannoneer >= 7)
	(up-compare-goal excessGold >= 235)
(or	(goal champgoal yes)
(or	(civ-selected aztec)
(or	(civ-selected incan)
(or	(civ-selected japanese)
(or	(civ-selected viking)
	(civ-selected malay))))))
	(unit-type-count-total condottiero < 42)
	(unit-type-count-total condottiero-placeholder < 42)
=>
	(set-goal traincondottiero yes))
(defrule
	(strategic-number gunpowder >= 7);(players-unit-type-count focus-player hand-cannoneer >= 7)
	(up-compare-goal excessGold >= 235)
(or	(civ-selected malian)
(or	(up-research-status c: ri-pavise >= research-pending)
(or	(unit-type-count-total shotel-warrior >= 5)
(or	(unit-type-count-total elite-shotel-warrior >= 5)
(or	(unit-type-count-total teutonic-knight-line >= 5)
	(civ-selected gothic))))))
	(unit-type-count-total condottiero < 42)
	(unit-type-count-total condottiero-placeholder < 42)
=>
	(set-goal traincondottiero yes))
(defrule
	(strategic-number gunpowder >= 10);(players-unit-type-count focus-player hand-cannoneer >= 7)
	(up-compare-goal excessGold >= 260)
	(up-research-status c: ri-squires >= research-available)
	(up-research-status c: ri-plate-mail >= research-available)
	(up-research-status c: ri-blast-furnace >= research-available)
(or	(up-research-status c: ri-plate-mail >= research-pending)
	(up-research-status c: ri-blast-furnace >= research-pending))
	(unit-type-count-total condottiero < 42)
	(unit-type-count-total condottiero-placeholder < 42)
=>
	(set-goal traincondottiero yes)); end jump
;=========================================================
(defrule
(nor(unit-available battle-elephant-line)
(or	(unit-available battle-elephant)
	(unit-available elite-battle-elephant)))
=>
	(up-jump-rule 4))
(defrule
(or	(strategic-number moenche >= 10)
(or	(strategic-number spears >= 36)
(or	(players-unit-type-count focus-player genoese-crossbowman >= 24)
(or	(players-unit-type-count focus-player elite-genoese-crossbowman >= 24)
	(strategic-number sn-current-age < cimperial)))))
=>
	(up-jump-rule 3))
(defrule
	(up-research-status c: ri-elite-battle-elephant <= research-available)
(or	(up-compare-goal battle-elephant-set >= Promi)
	(strategic-number sn-military-superiority >= 4)); 2
=>
	(up-jump-rule 2))
(defrule
(or	(and	(goal uugoal no)
		(and	(goal palagoal no)
			(goal champgoal no)))
(or	(strategic-number sn-military-superiority <= -2)
(or	(up-research-status c: ri-elite-battle-elephant >= research-pending)
(or	(up-research-status c: ri-howdah >= research-pending)
(or	(up-research-status c: ri-tusk-swords >= research-pending)
	(up-research-status c: ri-chatras >= research-pending))))))
=>
	(set-goal trainbattle yes))
(defrule
	(civ-selected burmese)
(or	(and	(goal champgoal no)
		(players-unit-type-count focus-player samurai >= 10))
	(and	(or	(up-compare-goal excessGold >= 400)
				(up-compare-goal tradeunits >= 40))
		(strategic-number archers >= 45)))
	(up-compare-goal battle-elephant-set < 16); ^
=>
	(set-goal trainbattle yes)); end jump
;=========================================================
(defrule
(nor(unit-available genitour-line)
(or	(unit-available genitour)
(or	(unit-available elite-genitour)
	(unit-available genitour-placeholder))))
=>
	(up-jump-rule 2))
(defrule
(or	(and	(up-research-status c: ri-imperial-skirmisher >= research-pending)
		(or	(up-research-status c: ri-elite-genitour < research-pending)
			(or	(up-research-status c: ri-bloodlines < research-pending)
				(up-research-status c: ri-husbandry < research-pending))))
(or	(up-research-status c: ri-yeomen >= research-pending)
(or	(strategic-number camels >= 12)
(or	(players-unit-type-count focus-player genoese-crossbowman >= 8)
	(strategic-number spears >= 36)))))
=>
	(up-jump-rule 1))
(defrule
	(goal trainskirm yes)
	(current-age >= castle-age)
(or	(up-research-status c: ri-elite-genitour >= research-pending)
(or	(up-research-status c: ri-sipahi >= research-available)
(or	(up-research-status c: ri-elite-skirmisher <= research-unavailable)
	(and	(up-research-status c: ri-elite-genitour >= research-available)
		(and	(up-research-status c: ri-bloodlines >= research-available)
			(up-research-status c: ri-husbandry >= research-available))))))
=>
	(set-goal trainskirm no)
	(set-goal traingenitour yes)); end jump
;=========================================================
(defrule
(or	(civ-selected indian)
	(up-research-status c: ri-imperial-camel >= research-available))
	(goal milunits yes)
	(goal uugoal no)
	(strategic-number spears < 40)
	(strategic-number moenche < 15)
	(up-compare-goal excessFood >= cm-buffer-f)
	(up-compare-goal excessGold >= 260)
=>
	(set-goal traincamel yes))
;=========================================================
#load-if-defined KHMER-CIV
(defrule
	(unit-available scorpion-line)
	(goal trainmangonel yes)
(or	(up-compare-goal mangonel-set >= 2)
	(up-research-status c: imperial-age >= research-pending))
(or	(up-compare-goal mangonel-set < 10)
	(up-research-status c: ri-onager <= research-available))
	(unit-type-count-total scorpion-line < 20)
	(current-age >= castle-age)
=>
	(set-goal trainmangonel no)
	(set-goal trainscorpion yes))
#end-if
;=========================================================
(defrule
(or	(nor	(unit-available steppe-lancer-line)
		(or	(unit-available steppe-lancer)
			(unit-available elite-steppe-lancer)))
(or	(up-compare-goal milunits != yes)
(or	(strategic-number sn-current-age < cimperial)
	(current-age <= feudal-age))))
=>
	(up-jump-rule 4))
(defrule
	(goal palagoal no)
	(up-compare-const pala-available != 1)
	(up-research-status c: imperial-age >= research-pending)
	(goal uugoal yes)
(or	(up-compare-const uu-type == archer-uu)
	(up-compare-const uu-type == powder-uu))
(or	(strategic-number skirms >= 24)
	(strategic-number siege >= 8))
(or	(up-research-status c: ri-hussar <= research-available)
	(up-research-status c: ri-elite-steppe-lancer >= research-pending))
	(unit-type-count cavalry-class < twenty-pop)
	(unit-type-count-total steppe-lancer-line < twenty-pop)
=>
	(set-goal trainsteppe yes))
(defrule
(or	(and	(can-afford-research ri-elite-steppe-lancer)
		(goal escrowing no))
	(up-research-status c: ri-elite-steppe-lancer >= research-pending))
(or	(military-population >= 31)
	(population-cap >= 225))
	(population >= max-civ-pop)
	(strategic-number moenche < 15)
	(strategic-number spears < 45)
	(strategic-number camels < 45)
	(unit-type-count-total steppe-lancer-line < Promi)
=>
	(set-goal trainsteppe yes))
(defrule
(or	(up-compare-const military-percent < 100)
	(up-research-status c: ri-elite-steppe-lancer >= research-pending))
	(players-military-population every-enemy < 32)
(or	(up-compare-const military-percent < 100)
	(and	(strategic-number sn-military-superiority >= 2); 1
		(strategic-number teamsuperiority >= 1))); 1
	(strategic-number moenche < 10)
	(strategic-number spears < 20)
	(strategic-number camels < 20)
;	(unit-type-count-total steppe-lancer-line < 48)
=>
	(set-goal trainsteppe yes))
(defrule
	(up-research-status c: ri-elite-steppe-lancer >= research-pending)
	(up-compare-goal excessGold >= 245)
(or	(up-compare-goal tradeunits >= 5)
	(up-compare-goal excessGold >= 295))
=>
	(set-goal trainsteppe yes)); end jump
;=========================================================
; Age Ends
;=========================================================
#load-if-defined DARK-AGE-END
(defrule
	(goal milunits yes)
(nor	(strategic-number archers >= 25)
(or	(strategic-number cavalry >= 40)
(or	(strategic-number moenche >= 10)
(or	(strategic-number gunpowder >= 25)
	(players-unit-type-count focus-player teutonic-knight-line > 13)))))
	(strategic-number sn-current-age >= imperial)
=>
	(set-goal trainchamp yes))
#end-if
#load-if-defined FEUDAL-AGE-END
(defrule
	(goal milunits yes)
(or	(up-compare-goal custom-civ-pop >= up-max-civ)
(or	(population >= max-civ-pop)
	(food-amount >= maa-buffer-f)))
	(strategic-number archers < 32)
	(strategic-number cavalry < 48)
	(strategic-number moenche < 12)
	(strategic-number gunpowder < 32)
	(players-unit-type-count focus-player teutonic-knight-line < 12)
	(strategic-number sn-current-age >= imperial)
=>
	(set-goal trainchamp yes))
(defrule
	(goal milunits yes)
	(goal trainskirm no)
	(strategic-number skirms < 32)
	(food-amount < maa-buffer-f2)
	(strategic-number sn-current-age >= imperial)
=>
	(set-goal trainarcher yes))
#end-if
#load-if-defined CASTLE-AGE-END
(defrule
	(goal milunits yes)
(or	(population < siege-pop)
	(strategic-number sn-military-superiority <= -1))
	(strategic-number sn-current-age >= imperial)
=>
	(set-goal trainknight yes)
	(set-goal traineagle yes))
#end-if
;=========================================================
; M@a-var.
;=========================================================
(defrule
	(up-compare-goal maa-var != yes)
=>
	(up-jump-rule 3))
(defrule
(or	(up-research-status c: castle-age >= research-pending)
(or	(up-research-status c: feudal-age < research-pending)
(or	(up-compare-goal strategy-type != feudal-war)
(or	(strategic-number archers >= 3)
(or	(and	(up-research-status c: feudal-age == research-pending)
		(food-amount < maa-buffer-f2))
;	(and
	(food-amount < maa-buffer-f)
;		(up-research-status c: ri-wheel-barrow != research-pending))
)))))
=>
	(up-jump-rule 2))
(defrule
(or	(up-research-status c: ri-man-at-arms != research-available)
	(and	(food-amount >= maa-buffer-f2)
		(gold-amount >= maa-buffer-g)))
	(unit-type-count-total militiaman-line < 12)
=>
	(set-goal trainchamp yes))
(defrule
	(up-unit-type-in-town c: scout-cavalry-line >= 4)
(or	(food-amount >= s-buffer)
(or	(up-research-status c: ri-wheel-barrow == research-pending)
	(up-pending-objects c: villager >= 2)))
(or	(strategic-number archers <= 0)
(or	(goal underattack yes)
	(goal defend yes)))
	(wood-amount < pk-buffer-wc)
	(unit-type-count-total spearman-line < 2)
=>
	(set-goal trainpike yes)); end jump
;=========================================================
; S-Flush.
;=========================================================
(defrule
	(up-compare-goal strategy != s-flush)
(or	(up-compare-goal scoutmicro != yes)
(or	(and	(strategic-number sn-current-age >= fcastlea)
		(or	(up-research-status c: ri-bloodlines <= research-unavailable)
			(goal attacking no)))
	(strategic-number sn-current-age >= cimperial)))
=>
	(up-jump-rule 3))
(defrule
(or	(unit-type-count-total scout-cavalry-line >= scrush-cap)
	(and	(current-age-time >= 240)
		(or	(and	(up-compare-goal milunits != s-flush)
				(strategic-number sn-current-age >= fcastlea))
			(unit-type-count-total 449 >= 1))))
=>
	(up-jump-rule 1))
(defrule
(or	(up-compare-goal total-food-amount >= s-buffer)
(or	(up-research-status c: ri-wheel-barrow == research-pending)
	(up-pending-objects c: villager >= 2)))
=>
	(set-goal trainhussar yes))
(defrule
	(up-unit-type-in-town c: scout-cavalry-line >= 4)
(or	(food-amount >= s-buffer)
(or	(up-research-status c: ri-wheel-barrow == research-pending)
	(up-pending-objects c: villager >= 2)))
(or	(and	(strategic-number archers <= 0)
		(up-compare-goal feinde <= 1))
(or	(goal underattack yes)
	(goal defend yes)))
	(wood-amount < pk-buffer-wc)
	(unit-type-count-total spearman-line < 2)
=>
	(set-goal trainpike yes)); end jump
;=========================================================
; R-Flush.
;=========================================================
(defrule
	(up-compare-goal milunits != r-flush)
=>
	(up-jump-rule 31))
;=========================================================
(defrule; ?
(or	(and	(dropsite-min-distance wood > 4); 5
		(wood-amount < 120)); 100
	(and	(current-age >= castle-age)
		(and	(wood-amount < 200)
			(building-type-count-total siege-workshop <= 0))))
=>
	(up-jump-rule 2))
(defrule
;	(goal milunits r-flush)
(or	(and	(military-population >= 25); 26
		(strategic-number sn-military-superiority >= 0))
(or	(strategic-number sn-military-superiority >= 1)
(or	(goal attacking yes)
	(goal researchplan yes))))
(or	(goal underattack no)
	(strategic-number sn-military-superiority >= 0))
	(strategic-number sn-military-superiority >= -1)
	(unit-type-count-total battering-ram-line < 3)
=>
	(set-goal trainram yes))
(defrule
;	(goal milunits r-flush)
(or	(strategic-number skirmsarchers >= 10)
(or	(players-unit-type-count focus-player battering-ram-line >= 1)
(or	(players-unit-type-count focus-player scorpion-line >= 1)
	(players-unit-type-count focus-player mangonel-line >= 1))))
	(up-compare-goal mangonel-set < 2)
=>
	(set-goal trainmangonel yes))
;=========================================================
(defrule
;	(goal milunits r-flush)
	(strategic-number moenche < 10)
(or	(strategic-number siege >= 3)
(or	(players-unit-type-count focus-player scorpion-line >= 1)
	(players-unit-type-count focus-player mangonel-line >= 1)))
	(unit-type-count-total knight-line < 5); 4
=>
	(set-goal trainknight yes))
;=========================================================
(defrule
(or	(and	(up-pending-objects c: lumber-camp <= 0)
		(and	(dropsite-min-distance wood > 4); 5
			(wood-amount < pk-buffer-wc)))
	(and	(current-age >= castle-age)
		(and	(wood-amount < 225)
			(building-type-count-total siege-workshop <= 0))))
=>
	(up-jump-rule 9))
(defrule
(or	(goal allowspears no)
	(and	(building-type-count-total mining-camp <= 0)
		(and	(unit-type-count villager-gold >= 1)
			(and	(dropsite-min-distance gold > 5)
				(wood-amount < pk-buffer-wc)))))
=>
	(up-jump-rule 8))
(defrule
	(building-type-count-total farm g:< maxfarms)
	(wood-amount < pk-buffer-w)
(or	(and	(strategic-number sn-military-superiority >= 0); JUST TESTING
		(and	(military-population >= 5)
			(up-compare-sn sn-current-age g:<= enemyState))); <
(or	(and	(unit-type-count villager-food < 7)
		(building-type-count-total farm < 7))
	(and	(idle-farm-count <= 0)
		(strategic-number sn-military-superiority >= 2))))
=>
	(up-jump-rule 7)); one less
(defrule
;	(goal milunits r-flush)
	(strategic-number sn-military-superiority < 4)
;(or	(food-amount >= pk-buffer-fl)
;	(up-research-status c: ri-fletching >= research-pending))
(or	(food-amount >= pk-buffer-f); 70
	(up-pending-objects c: villager >= 2))
(or	(and	(strategic-number cavalry >= 3)
		(unit-type-count-total spearman-line < 4)); 6
	(and	(players-building-type-count focus-player stable >= 1)
		(unit-type-count-total spearman-line < 3)))
=>
	(set-goal trainpike yes))
(defrule
;	(goal milunits r-flush)
	(strategic-number sn-military-superiority < 4)
;(or	(food-amount >= pk-buffer-fl)
;	(up-research-status c: ri-fletching >= research-pending))
(or	(food-amount >= pk-buffer-f); 70
	(up-pending-objects c: villager >= 2))
(or	(and	(strategic-number cavalry >= 5)
		(unit-type-count-total spearman-line < 6)); 9
	(and	(strategic-number cavalry >= 7)
		(unit-type-count-total spearman-line < 8))); 12
=>
	(set-goal trainpike yes))
(defrule
;	(goal milunits r-flush)
	(strategic-number sn-military-superiority < 4)
;(or	(food-amount >= pk-buffer-fl)
;	(up-research-status c: ri-fletching >= research-pending))
(or	(food-amount >= pk-buffer-f); 70
	(up-pending-objects c: villager >= 2))
(or	(and	(strategic-number cavalry >= 10)
		(unit-type-count-total spearman-line < 12)); 15
	(and	(strategic-number cavalry >= 14)
		(unit-type-count-total spearman-line < 16)))
=>
	(set-goal trainpike yes))
(defrule
;	(goal milunits r-flush)
	(up-building-type-in-town c: watch-tower == 1)
	(up-compare-goal ttower-distance < 32)
(or	(strategic-number sn-maximum-town-size <= 33)
	(and	(strategic-number archers < 3)
		(up-building-type-in-town c: watch-tower >= 1)))
(or	(food-amount >= pk-buffer-f); 70
	(up-pending-objects c: villager >= 2))
	(unit-type-count-total spearman-line < 4)
=>
	(set-goal trainpike yes))
(defrule
;	(goal milunits r-flush)
(or	(up-unit-type-in-town c: knight-line >= 1)
(or	(strategic-number cavalry >= 2)
	(and	(up-compare-goal ep-stables >= 1);	(players-building-type-count any-enemy stable >= 1); test
		(up-compare-goal ep-mpop >= 2))))
;(or	(up-unit-type-in-town c: knight-line >= 1)
;(or	(players-unit-type-count focus-player scout-cavalry-line >= 2)
;(or	(players-unit-type-count any-enemy camel-line >= 1)
;	(players-unit-type-count any-enemy knight-line >= 1)))); 2
;(or	(food-amount >= pk-buffer-fl)
;	(up-research-status c: ri-fletching >= research-pending))
(or	(food-amount >= pk-buffer-f)
(or	(up-research-status c: ri-wheel-barrow == research-pending)
	(up-pending-objects c: villager >= 2)))
	(unit-type-count-total spearman-line < 6); 3
=>
	(set-goal trainpike yes))
(defrule
;	(goal milunits r-flush)
	(goal sk-var yes)
;(or	(food-amount >= pk-buffer-fl)
;	(up-research-status c: ri-fletching >= research-pending))
(or	(food-amount >= pk-buffer-f)
(or	(up-research-status c: ri-wheel-barrow == research-pending)
	(up-pending-objects c: villager >= 2)))
	(unit-type-count-total spearman-line < 6); 3
(or	(and	(up-compare-goal ep-stables >= 1);	(players-building-type-count any-enemy stable >= 1); test
		(up-compare-goal ep-mpop >= 2))
;(or	(players-current-age any-enemy >= castle-age)
	(military-population >= 18));); 14
=>
	(set-goal trainpike yes))
(defrule
;	(goal milunits r-flush)
	(goal sk-var yes)
;(or	(food-amount >= pk-buffer-fl)
;	(up-research-status c: ri-fletching >= research-pending))
(or	(food-amount >= pk-buffer-f)
(or	(up-research-status c: ri-wheel-barrow == research-pending)
	(up-pending-objects c: villager >= 2)))
	(unit-type-count-total spearman-line < 9); 6
(or	(players-building-type-count focus-player stable >= 1); target
(or	(strategic-number cavalry >= 2)
	(military-population >= 30))); for now
=>
	(set-goal trainpike yes))
;=========================================================
(defrule
	(up-research-status c: castle-age == research-pending)
	(strategic-number sn-military-superiority >= 0); 1
	(gold-amount < 380)
(or	(up-compare-goal skirmisher-set >= 9)
	(gold-amount < 220))
=>
	(up-jump-rule 6))
(defrule
	(building-available siege-workshop)
(or	(and	(wood-amount < 225)
		(building-type-count-total siege-workshop <= 0))
	(and	(building-type-count-total siege-workshop >= 1)
		(and	(strategic-number sn-military-superiority >= 1)
			(and	(unit-type-count-total battering-ram-line <= 1); 0
				(and	(wood-amount < 180)
					(gold-amount < 120))))))
=>
	(up-jump-rule 5))
(defrule
(or	(goal sk-var yes)
(or	(and	(up-pending-objects c: lumber-camp <= 0)
		(and	(dropsite-min-distance wood > 4); 5
			(wood-amount < ar-buffer-wc)))
	(and	(current-age >= castle-age)
		(and	(wood-amount < 225)
			(building-type-count-total siege-workshop <= 0)))))
=>
	(up-jump-rule 4))
(defrule
(or	(and	(research-available castle-age)
		(and	(up-compare-goal total-food-amount >= 450)
			(gold-amount < ar-buffer-g2)))
	(and	(building-type-count-total mining-camp <= 0)
		(and	(unit-type-count villager-gold >= 1)
			(and	(dropsite-min-distance gold > 5)
				(wood-amount < ar-buffer-wc)))))
=>
	(up-jump-rule 3))
(defrule
	(building-type-count-total farm g:< maxfarms)
	(wood-amount < ar-buffer-w)
(or	(and	(strategic-number sn-military-superiority >= 0); JUST TESTING
		(and	(military-population >= 5)
			(up-compare-sn sn-current-age g:<= enemyState))); <
(or	(and	(unit-type-count villager-food < 7)
		(building-type-count-total farm < 7))
	(and	(idle-farm-count <= 0)
		(strategic-number sn-military-superiority >= 2))))
=>
	(up-jump-rule 2))
(defrule
;	(goal milunits r-flush)
	(strategic-number sn-military-superiority < 3); 4
(or	(and	(unit-type-count-total archery-class < 3);	(military-population < 3); 5
		(up-research-status c: ri-loom >= research-pending))
(or	(building-type-count-total blacksmith <= 0);(military-population < 5)
(or	(up-compare-goal total-food-amount < 100);
(or	(gold-amount >= ar-buffer-g)
	(up-research-status c: ri-fletching >= research-pending)))))
(or	(up-research-status c: castle-age < research-pending);(current-age < castle-age)
	(strategic-number sn-military-superiority < 0)); 3
=>
	(set-goal trainarcher yes))
(defrule
;	(goal milunits r-flush)
	(strategic-number sn-military-superiority < 3); 4
(or	(and	(or	(building-type-count-total blacksmith <= 0);(military-population < 5)
			(up-research-status c: ri-bodkin-arrow >= research-pending))
		(gold-amount >= 120))
(or	(gold-amount >= 220)
(or	(strategic-number sn-military-superiority < 0)
	(and	(up-research-status c: ri-bodkin-arrow >= research-pending)
		(up-research-status c: ri-crossbow >= research-pending)))))
	(up-research-status c: castle-age >= research-pending);(current-age >= castle-age)
=>
	(set-goal trainarcher yes))
;=========================================================
(defrule
	(up-research-status c: castle-age == research-pending)
	(strategic-number sn-military-superiority >= 1)
	(wood-amount < 285)
=>
	(up-jump-rule 9))
(defrule
(or	(and	(up-pending-objects c: lumber-camp <= 0)
		(and	(dropsite-min-distance wood > 4); 5
			(wood-amount < sk-buffer-wc)))
	(and	(current-age >= castle-age)
		(and	(wood-amount < 235)
			(building-type-count-total siege-workshop <= 0))))
=>
	(up-jump-rule 8))
(defrule
	(and	(building-type-count-total mining-camp <= 0)
		(and	(unit-type-count villager-gold >= 1)
			(and	(dropsite-min-distance gold > 5)
				(wood-amount < sk-buffer-wc))))
=>
	(up-jump-rule 7))
(defrule
	(building-type-count-total farm g:< maxfarms)
	(wood-amount < sk-buffer-w)
(or	(and	(strategic-number sn-military-superiority >= 0); JUST TESTING
		(and	(military-population >= 5)
			(up-compare-sn sn-current-age g:<= enemyState))); <
(or	(and	(unit-type-count villager-food < 7)
		(building-type-count-total farm < 7))
	(and	(idle-farm-count <= 0)
		(strategic-number sn-military-superiority >= 2))))
=>
	(up-jump-rule 6))
(defrule
	(up-research-status c: ri-fletching >= research-complete)
	(unit-type-count-total archery-class >= 9)
(or	(goal attacking yes)
	(strategic-number sn-military-superiority >= 0)); 1
	(food-amount < sk-buffer-f)
	(up-research-status c: ri-padded-archer-armor == research-available)
=>
	(up-jump-rule 5))
(defrule
;	(goal milunits r-flush)
	(strategic-number sn-military-superiority < 2); 4; 3
(or	(building-type-count-total blacksmith <= 0);(military-population < 5)
(or	(food-amount >= sk-buffer-f)
	(up-research-status c: ri-fletching >= research-pending)))
(or	(food-amount >= sk-buffer-f)
	(up-pending-objects c: villager >= 2))
	(gold-amount < archer-g)
(or	(up-research-status c: castle-age < research-pending);(current-age < castle-age)
	(strategic-number sn-military-superiority < 2))
=>
	(set-goal trainskirm yes))
(defrule
;	(goal milunits r-flush)
	(strategic-number sn-military-superiority < 2); 4; 3
	(up-research-status c: ri-fletching < research-pending)
	(gold-amount < ar-buffer-g)
	(food-amount >= sk-buffer-f)
	(building-type-count-total blacksmith >= 1)
;	(up-research-status c: ri-padded-archer-armor >= research-pending)
(or	(food-amount >= sk-buffer-f)
	(up-pending-objects c: villager >= 2))
(or	(current-age < castle-age)
	(strategic-number sn-military-superiority < 0)); 2
=>
	(set-goal trainskirm yes))
(defrule
;	(goal milunits r-flush)
	(strategic-number sn-military-superiority < 3); 4
(or	(strategic-number sn-military-superiority < 0)
(or	(building-type-count-total siege-workshop <= 0)
(or	(unit-type-count-total battering-ram-line >= 2)
	(wood-amount >= 205))))
(or	(food-amount >= sk-buffer-f)
	(up-pending-objects c: villager >= 6)); 2
(or	(food-amount >= 225)
	(up-research-status c: ri-bodkin-arrow >= research-pending))
	(up-research-status c: castle-age >= research-pending);(current-age >= castle-age)
=>
	(set-goal trainskirm yes))
(defrule
(or	(and	(players-military-population focus-player <= 1)
		(strategic-number sn-military-superiority >= 1))
(or	(strategic-number sn-military-superiority >= 3); 4
	(and	(strategic-number sn-gold-gatherer-percentage >= 1)
		(and	(building-type-count-total mining-camp <= 0)
			(and	(dropsite-min-distance gold > 5)
				(wood-amount < sk-buffer-wc))))))
=>
	(up-jump-rule 1))
(defrule
;	(goal milunits r-flush)
	(goal sk-var yes)
(or	(military-population < 5); 3
(or	(strategic-number sn-military-superiority <= -1); test
(or	(food-amount >= sk-buffer-f)
(or	(building-type-count-total blacksmith <= 0)
	(up-research-status c: ri-fletching >= research-pending)))))
(or	(food-amount >= sk-buffer-f)
(or	(up-research-status c: ri-wheel-barrow == research-pending)
	(up-pending-objects c: villager >= 2)))
=>
	(set-goal trainskirm yes))
;=========================================================
; A-Rush.
;=========================================================
(defrule
(or	(up-research-status c: castle-age < research-pending)
(or	(up-compare-goal milunits != a-rush)
(or	(and	(strategic-number sn-military-superiority >= 3); 2
		(and	(current-age >= castle-age)
			(and	(wood-amount < 225)
				(building-type-count-total siege-workshop <= 0))))
	(and	(dropsite-min-distance wood > 4); 5
		(wood-amount < 100)))))
=>
	(up-jump-rule 20))
;=========================================================
(defrule
(or	(military-population >= 25)
(or	(strategic-number sn-military-superiority >= 1)
(or	(goal attacking yes)
	(goal researchplan yes))))
(or	(goal underattack no)
	(strategic-number sn-military-superiority >= 0))
	(strategic-number sn-military-superiority >= -1)
	(unit-type-count-total battering-ram-line < 4)
=>
	(set-goal trainram yes))
;=========================================================
(defrule
(or	(strategic-number skirmsarchers >= 10)
(or	(players-unit-type-count focus-player battering-ram-line >= 1)
(or	(players-unit-type-count focus-player scorpion-line >= 1)
	(players-unit-type-count focus-player mangonel-line >= 1))))
	(up-compare-goal mangonel-set < 2)
=>
	(set-goal trainmangonel yes))
;=========================================================
(defrule;
	(strategic-number moenche < 10)
(or	(players-unit-type-count focus-player scorpion-line >= 1)
	(players-unit-type-count focus-player mangonel-line >= 1))
	(unit-type-count-total knight-line < 4)
=>
	(set-goal trainknight yes))
;=========================================================
(defrule
	(goal allowspears no)
=>
	(up-jump-rule 6))
(defrule
	(building-type-count-total farm g:< maxfarms)
	(wood-amount < pk-buffer-w)
(or	(and	(strategic-number sn-military-superiority >= 0); JUST TESTING
		(and	(military-population >= 5)
			(up-compare-sn sn-current-age g:< enemyState)))
(or	(and	(unit-type-count villager-food < 7)
		(building-type-count-total farm < 7))
	(and	(idle-farm-count <= 0)
		(strategic-number sn-military-superiority >= 2))))
=>
	(up-jump-rule 5))
(defrule
	(strategic-number sn-military-superiority < 4)
(or	(food-amount >= 235)
	(up-research-status c: ri-bodkin-arrow >= research-pending))
(or	(food-amount >= pk-buffer-f)
	(up-pending-objects c: villager >= 2))
(or	(strategic-number cavalry >= 3)
	(players-building-type-count target-player stable >= 2))
	(unit-type-count-total spearman-line < 6); 4
=>
	(set-goal trainpike yes))
(defrule
	(strategic-number sn-military-superiority < 4)
(or	(food-amount >= 235)
	(up-research-status c: ri-bodkin-arrow >= research-pending))
(or	(food-amount >= pk-buffer-f)
	(up-pending-objects c: villager >= 2))
(or	(and	(strategic-number cavalry >= 5)
		(unit-type-count-total spearman-line < 8)); 9
	(and	(strategic-number cavalry >= 7)
		(unit-type-count-total spearman-line < 10))); 12
=>
	(set-goal trainpike yes))
(defrule
	(strategic-number sn-military-superiority < 4)
(or	(food-amount >= 235)
	(up-research-status c: ri-bodkin-arrow >= research-pending))
(or	(food-amount >= pk-buffer-f)
	(up-pending-objects c: villager >= 2))
(or	(and	(strategic-number cavalry >= 9)
		(unit-type-count-total spearman-line < 12)); 15
	(and	(strategic-number cavalry >= 13)
		(unit-type-count-total spearman-line < 17)))
=>
	(set-goal trainpike yes))
(defrule
	(up-building-type-in-town c: watch-tower == 1)
	(up-compare-goal ttower-distance < 32)
(or	(strategic-number sn-maximum-town-size <= 33)
	(and	(strategic-number archers < 3)
		(up-building-type-in-town c: watch-tower == 1)))
	(unit-type-count-total spearman-line < 6); 4
=>
	(set-goal trainpike yes))
(defrule
(or	(up-unit-type-in-town c: knight-line >= 1)
	(players-unit-type-count any-enemy knight-line >= 2))
(or	(food-amount >= 135)
	(up-research-status c: ri-fletching >= research-pending))
(or	(food-amount >= pk-buffer-f)
	(up-pending-objects c: villager >= 2))
	(unit-type-count-total spearman-line < 6); 4
=>
	(set-goal trainpike yes))
;=========================================================
(defrule
	(building-type-count-total farm g:< maxfarms)
	(wood-amount < ar-buffer-w)
(or	(and	(strategic-number sn-military-superiority >= 0); JUST TESTING
		(and	(military-population >= 5)
			(up-compare-sn sn-current-age g:< enemyState)))
(or	(and	(unit-type-count villager-food < 7)
		(building-type-count-total farm < 7))
	(and	(idle-farm-count <= 0)
		(strategic-number sn-military-superiority >= 2))))
=>
	(up-jump-rule 3))
(defrule
	(strategic-number sn-military-superiority >= 2)
(or	(and	(wood-amount < 225)
		(building-type-count-total siege-workshop < 1))
	(and	(unit-type-count-total battering-ram-line < 2)
		(or	(wood-amount < 185)
			(gold-amount < 120))))
	(current-age >= castle-age)
=>
	(up-jump-rule 2))
(defrule
	(building-type-count monastery >= 1)
	(strategic-number sn-military-superiority >= 2)
	(unit-type-count-total monk <= 0)
	(unit-type-count 134 <= 0); dead monk
	(gold-amount < 100)
	(housing-headroom >= 1)
=>
	(up-jump-rule 1))
(defrule
	(strategic-number sn-military-superiority < 3); 4
(or	(gold-amount >= 220); 145
	(and	(current-age >= castle-age)
		(and	(up-research-status c: ri-crossbow != research-available)
			(up-research-status c: ri-bodkin-arrow != research-available))))
=>
	(set-goal trainarcher yes))
;=========================================================
(defrule
(or	(food-amount < 185)
(or	(and	(or	(food-amount < 360)
			(current-age <= feudal-age))
		(or	(up-research-status c: ri-bodkin-arrow < research-pending)
			(up-research-status c: ri-crossbow < research-pending)))
	(and	(strategic-number archers < 10)
		(food-amount < 300))))
=>
	(up-jump-rule 5))
(defrule
	(building-type-count-total farm g:< maxfarms)
	(wood-amount < sk-buffer-w)
(or	(and	(strategic-number sn-military-superiority >= 0); JUST TESTING
		(and	(military-population >= 5)
			(up-compare-sn sn-current-age g:< enemyState)))
(or	(and	(unit-type-count villager-food < 7)
		(building-type-count-total farm < 7))
	(and	(idle-farm-count <= 0)
		(strategic-number sn-military-superiority >= 2))))
=>
	(up-jump-rule 4))
(defrule
(or	(goal attacking yes)
	(strategic-number sn-military-superiority >= 1))
	(food-amount < 125)
	(research-available ri-padded-archer-armor)
	(up-research-status c: ri-padded-archer-armor < research-pending)
=>
	(up-jump-rule 3))
(defrule
	(strategic-number sn-military-superiority < 2); 4
(or	(food-amount >= 225)
	(up-research-status c: ri-bodkin-arrow >= research-pending))
(or	(food-amount >= sk-buffer-f)
	(up-pending-objects c: villager >= 2))
	(gold-amount < 45)
(or	(current-age < castle-age)
	(strategic-number sn-military-superiority <= 2))
=>
	(set-goal trainskirm yes))
(defrule
	(strategic-number sn-military-superiority < 2); 4
	(up-research-status c: ri-bodkin-arrow < research-pending)
	(gold-amount < 145)
	(food-amount >= 225)
	(building-type-count-total blacksmith >= 1)
;	(up-research-status c: ri-padded-archer-armor >= research-pending)
(or	(food-amount >= sk-buffer-f)
	(up-pending-objects c: villager >= 2))
(or	(current-age < castle-age)
	(strategic-number sn-military-superiority <= 2))
=>
	(set-goal trainskirm yes))
(defrule
	(strategic-number sn-military-superiority < 2); 4
(or	(wood-amount >= 235)
	(building-type-count-total siege-workshop >= 1))
(or	(food-amount >= sk-buffer-f)
	(up-pending-objects c: villager >= 2))
(or	(unit-type-count-total battering-ram-line >= 2)
	(wood-amount >= 195))
(or	(food-amount >= 225)
	(up-research-status c: ri-bodkin-arrow >= research-pending))
	(current-age >= castle-age)
=>
	(set-goal trainskirm yes))
;=========================================================
; Krush.
;=========================================================
(defrule
	(up-compare-goal strategy != krush)
=>
	(up-jump-rule 4))
(defrule
	(true)
=>
	(up-get-fact unit-type-in-town knight-line temporary-goal2)
	(up-modify-goal temporary-goal g:= temporary-goal2)
	(up-get-fact unit-type-in-town camel-line temporary-goal2)
	(up-modify-goal temporary-goal g:max temporary-goal2)
	(up-get-fact unit-type-in-town battle-elephant temporary-goal2)
	(up-modify-goal temporary-goal2 c:* 2)
	(up-modify-goal temporary-goal g:max temporary-goal2)
	(up-get-fact unit-type-in-town steppe-lancer temporary-goal2)
	(up-modify-goal temporary-goal g:max temporary-goal2)
	(up-modify-goal temporary-goal3 s:= cavalry)
	(up-get-focus-fact unit-type-count scout-cavalry-line temporary-goal2)
	(up-modify-goal temporary-goal3 g:- temporary-goal2)
	(up-modify-goal temporary-goal g:max temporary-goal3)
	(up-modify-goal temporary-goal c:max 0))
(defrule
	(strategic-number sn-military-superiority <= 2); 3
	(up-compare-goal temporary-goal >= 4)
	(up-compare-goal camel-set < 20)
	(up-compare-goal camel-set g:< temporary-goal)
	(unit-available camel-line)
=>
	(set-goal traincamel yes))
(defrule
	(strategic-number sn-military-superiority <= 1); 2
;(or	(up-compare-goal excessGold < 60)
(or	(not	(unit-available camel-line))
	(strategic-number sn-military-superiority <= -3));); -2
	(up-research-status c: ri-pikeman >= research-available)
	(up-compare-goal temporary-goal >= 6)
	(unit-type-count-total spearman-line < 25)
	(unit-type-count-total spearman-line g:< temporary-goal)
	(strategic-number skirmsarchers < 5)
	(strategic-number husks < 3)
	(strategic-number eagles < 3)
	(strategic-number moenchesiege < 6)
=>
	(set-goal trainpike yes))
(defrule
	(strategic-number sn-military-superiority <= 2); 3
;hm	(strategic-number teamsuperiority >= 0)
=>
	(set-goal trainknight yes)); end jump
;=========================================================
; CA-Rush.
;=========================================================
(defrule
(or	(up-compare-goal strategy != ca-rush)
	(and	(building-type-count-total mining-camp <= 0)
		(and	(unit-type-count villager-gold >= 1)
			(and	(dropsite-min-distance gold > 5)
				(wood-amount < ca-buffer-w)))))
=>
	(up-jump-rule 5))
(defrule
	(building-available siege-workshop)
(or	(and	(wood-amount < 225)
		(building-type-count-total siege-workshop <= 0))
	(and	(building-type-count-total siege-workshop >= 1)
		(and	(strategic-number sn-military-superiority >= 1)
			(and	(unit-type-count-total battering-ram-line <= 1); 0
				(and	(wood-amount < 190)
					(gold-amount < 128))))))
=>
	(up-jump-rule 4))
(defrule
(or	(and	(up-pending-objects c: lumber-camp <= 0)
		(and	(dropsite-min-distance wood > 4); 5
			(wood-amount < ca-buffer-w)))
	(and	(current-age >= castle-age)
		(and	(wood-amount < 225)
			(building-type-count-total siege-workshop <= 0))))
=>
	(up-jump-rule 3))
(defrule
	(building-type-count-total farm g:< maxfarms)
	(wood-amount < ca-buffer-w)
(or	(and	(strategic-number sn-military-superiority >= 0); JUST TESTING
		(and	(military-population >= 5)
			(up-compare-sn sn-current-age g:<= enemyState))); <
(or	(and	(unit-type-count villager-food < 7)
		(building-type-count-total farm < 7))
	(and	(idle-farm-count <= 0)
		(strategic-number sn-military-superiority >= 2))))
=>
	(up-jump-rule 2))
(defrule
	(unit-available monk)
	(building-type-count monastery >= 1)
	(strategic-number sn-military-superiority >= 2)
	(unit-type-count-total monk <= 0)
	(unit-type-count 134 <= 0); dead monk
	(gold-amount < 100)
	(housing-headroom >= 1)
=>
	(up-jump-rule 1))
(defrule
	(strategic-number sn-military-superiority < 3); 4
(or	(and	(and	(unit-type-count-total archery-class < 3)
			(unit-type-count-total cavalry-archer-class < 3));	(military-population < 3); 5
		(up-research-status c: ri-loom >= research-pending))
(or	(building-type-count-total blacksmith <= 0);(military-population < 5)
(or	(gold-amount >= ca-buffer-g)
	(up-research-status c: ri-fletching >= research-pending))))
=>
	(set-goal traincavarcher yes)); end jump
;=========================================================
; Castledrop.
;=========================================================
(defrule
(or	(up-compare-goal strategy != castledrop)
(or	(wood-amount < unique-unit-wood)
	(food-amount < unique-unit-food)))
=>
	(up-jump-rule 1))
(defrule
(or	(strategic-number sn-military-superiority < 3); 4
(or	(goal attacking yes)
	(up-compare-goal strategy-type <= castle-war)))
(or	(not	(building-available town-center))
(or	(goal underattack yes)
(or	(goal dreitc yes)
(or	(stone-amount < tc-stone)
	(wood-amount >= uu-w-dtc))))); 500
=>
	(set-goal trainunique yes))
;=========================================================
; Stonewall.
;=========================================================
(defrule
	(up-compare-goal strategy != stonewall)
=>
	(up-jump-rule 5)); 6
(defrule
	(strategic-number sn-current-age >= imperial)
(or	(wood-amount >= 400)
	(building-type-count-total barracks >= 6))
(or	(up-research-status c: ri-elite-eagle-warrior >= research-pending)
	(gold-amount >= 700))
	(unit-type-count-total trebuchet-set < 3)
=>
	(set-goal traintrebuchet yes))
;=========================================================
(defrule
	(strategic-number sn-current-age >= imperial)
(or	(wood-amount >= 350)
	(building-type-count-total barracks >= 6))
(or	(up-research-status c: ri-elite-eagle-warrior >= research-pending)
	(gold-amount >= 575))
	(strategic-number sn-military-superiority >= -2);
	(unit-type-count-total battering-ram-line < 6)
=>
	(set-goal trainram yes))
;=========================================================
(defrule
	(strategic-number sn-current-age >= imperial)
(or	(up-research-status c: ri-elite-eagle-warrior >= research-pending)
	(and	(food-amount >= 820)
		(gold-amount >= 550)))
(or	(gold-amount >= 125)
(or	(and	(goal attacking no)
		(strategic-number sn-military-superiority <= -2))
(or	(unit-type-count-total battering-ram-line >= 4)
	(unit-type-count-total trebuchet-set >= 2))))
=>
	(set-goal traineagle yes))
;=========================================================
(defrule; test
	(strategic-number sn-current-age >= imperial)
	(goal allowspears yes)
	(strategic-number moenche < 18)
(or	(up-research-status c: ri-elite-eagle-warrior >= research-pending)
	(food-amount >= 835))
	(strategic-number cavalry g:> spearcount)
(or	(population < del-civ-pop)
	(population < siege-pop))
	(up-compare-goal excessWood >= pk-buffer-wc)
	(up-compare-goal excessFood >= pk-buffer-f)
	(unit-type-count-total spearman-line < 40)
=>
	(set-goal trainpike yes))
;=========================================================
;(defrule; similar working rule in monk section already
;	(up-research-status c: ri-elite-eagle-warrior < research-pending)
;	(strategic-number sn-current-age <= castlea)
;	(strategic-number archers < 22)
;	(players-unit-type-count every-enemy eagle-warrior-line < 15)
;	(players-unit-type-count every-enemy scout-cavalry-line < 12)
;(or	(gold-amount >= 200); 900; 600; 300
;	(up-compare-goal relic-count >= 4))
;	(up-compare-goal escrowing != imperial-age)
;	(players-military-population any-enemy >= 2)
;	(soldier-count < 16)
;	(unit-type-count-total monastery-class < 15)
;=>
;	(set-goal trainmonk yes))
;=========================================================
(defrule
(or	(goal trainmangonel yes)
	(goal trainscorpion yes))
(or	(up-compare-goal excessGold < 235)
(or	(population < max-civ-pop)
	(strategic-number sn-current-age < cimperial)))
	(strategic-number archers < 45)
	(strategic-number gunpowder < 15)
	(strategic-number siege < 15)
=>
	(set-goal trainmangonel no)
	(set-goal trainscorpion no))
;=========================================================
; Fast imp.
;=========================================================
(defrule
(or	(up-compare-goal strategy != fast-imp)
	(up-research-status c: imperial-age <= research-available))
=>
	(up-jump-rule 4))
(defrule
	(unit-available hand-cannoneer)
(or	(goal attacking yes)
	(population < max-civ-pop))
=>
	(set-goal trainhandcannon yes)
	(up-jump-rule 1))
(defrule
	(up-compare-const hc-available == 0)
	(up-research-status c: ri-crossbow >= research-available)
	(unit-available archer-line)
(or	(goal attacking yes)
	(population < max-civ-pop))
=>
	(set-goal trainarcher yes))
(defrule
	(unit-available bombard-cannon)
(or	(goal attacking yes)
(or	(military-population >= 12)
	(current-age-time < 120)))
(or	(goal attacking yes)
(or	(unit-type-count-total bombard-cannon-line < 2)
	(up-compare-goal excessGold >= 425)))
	(unit-type-count-total bombard-cannon-line < 4)
=>
	(set-goal trainbombard yes))
(defrule
	(goal trainram yes)
	(goal trainbombard yes)
=>
	(set-goal trainram no)); end jump
	
(defrule
	(or(research-completed ri-onager)
	(current-age == castle-age))
	(unit-type-count-total mangonel-line < 4)
	(players-unit-type-count target-player hussite-wagon-line > 3)
	(can-train mangonel-line)
=>
	(set-goal trainmangonel yes)
)
;=========================================================
; Grush.
;=========================================================
(defrule
(or	(up-compare-goal strategy != grush)
(or	(and	(dropsite-min-distance wood >= 4); 5
		(wood-amount < 110))
(or	(up-compare-goal navycount >= up-max-civ)
(or	(population >= max-civ-pop)
	(up-compare-goal navycount g:>= maxnavy)))))
=>
	(up-jump-rule 3))
(defrule
	(goal fg-var yes)
(or	(up-compare-const grush-affinity <= 1)
	(up-compare-goal navycount <= minNavy))
=>
	(up-jump-rule 1))
(defrule
(nand	(up-research-status c: ri-fletching == research-available)
	(and	(up-compare-goal navycount >= 3)
		(and	(food-amount >= 100)
			(gold-amount < 80))))
(nand	(up-research-status c: ri-careening == research-available)
	(and	(up-compare-goal navycount >= 12)
		(and	(food-amount >= 250)
			(gold-amount < 150))))
=>
	(set-goal traingalley yes))
(defrule
	(goal fg-var yes)
(nand	(up-research-status c: ri-careening == research-available)
	(and	(up-compare-goal navycount >= 9)
		(and	(food-amount >= 250)
			(gold-amount < 150))))
=>
	(set-goal trainfire yes)); end jump
#end-if
;=========================================================
; Adjusting train goals
;=========================================================
#load-if-defined INFINITE-RESOURCES-START
(defrule
;	(game-time < 600)
	(current-age <= feudal-age)
	(population < max-civ-pop)
	(up-train-site-ready c: militiaman)
=>
	(set-goal trainchamp yes))
(defrule
;	(game-time < 600)
	(current-age <= feudal-age)
	(population < max-civ-pop)
	(up-train-site-ready c: archer)
=>
	(set-goal trainarcher yes))
(defrule
;	(game-time < 600)
	(current-age <= feudal-age)
	(population < max-civ-pop)
	(up-train-site-ready c: scout-cavalry)
=>
	(set-goal trainhussar yes))
#end-if


(defrule
	(goal traincart yes)
	(game-time < 2400)
(or	(unit-type-count-total 178 >= 3)
	(unit-type-count-total 205 >= 3))
	(strategic-number sn-current-age < imperial)
	(up-compare-goal strategy != sling)
	(up-compare-goal relic-count < 5)
	(gold-amount < imperial-gs)
	(gold-amount < 850)
	(dropsite-min-distance gold < 40)
	(dropsite-min-distance gold >= 0)
	(strategic-number sn-military-superiority < 0)
=>
	(set-goal traincart no))
(defrule
	(goal strategy stonewall)
	(up-compare-goal excessWood < 275)
	(building-type-count-total barracks < 6)
;	(up-research-status c: imperial-age >= research-pending)
(or	(goal traincart yes)
	(goal traincog yes))
=>
	(set-goal traincart no)
	(set-goal traincog no))
#load-if-defined DEFEND-WONDER
(defrule
(or	(cc-players-unit-type-count 0 gold-mine >= 8)
	(up-compare-goal victory-time < 1024))
;(or	(goal traincart yes)
;	(goal traincog yes))
=>
	(set-goal traincart no)
	(set-goal traincog no))
#end-if
(defrule
	(goal traingalley yes)
	(up-research-status c: ri-galleon < research-available)
(or	(civ-selected aztec)
(or	(civ-selected malian)
	(up-research-status c: ri-fast-fire-ship >= research-available)))
	(up-research-status c: imperial-age >= research-pending)
=>
	(set-goal traingalley no)
	(set-goal trainfire yes))
#load-if-defined MAGYAR-CIV
(defrule
	(goal trainhussar yes)
	(up-research-status c: my-unique-unit-upgrade >= research-complete)
(or	(up-research-status c: ri-mercenaries >= research-pending)
	(up-compare-goal excessGold >= 10))
	(unit-available my-unique-unit-line)
	(building-type-count castle >= 1)
=>
	(set-goal trainhussar no)
	(set-goal trainunique yes))
#end-if
(defrule
(nor	(civ-selected saracen)
	(civ-selected indian))
=>
	(up-jump-rule 1))
(defrule
	(goal trainpike yes)
	(up-research-status c: imperial-age >= research-pending)
(or	(up-compare-goal excessGold >= 260)
(or	(unit-type-count villager-gold >= 12); 8
(or	(up-compare-goal tradeunits >= 30); 24
	(up-compare-goal relic-count >= 5)))); 4
	(building-type-count stable >= 3)
=>
	(set-goal trainpike no)
	(set-goal traincamel yes))
(defrule
	(civ-selected indian)
(not	(unit-available knight-line))
(or	(goal trainknight yes)
	(and	(strategic-number sn-current-age >= imperial)
		(and	(population < siege-pop)
			(and	(up-compare-goal excessGold >= 225)
				(strategic-number spears < 25)))))
=>
	(set-goal trainknight no)
	(set-goal traincamel yes))
(defrule
	(goal trainknight yes)
	(goal trainsteppe yes)
	(goal palagoal no)
(or	(up-compare-const pala-available != 1)
	(up-research-status c: ri-bloodlines <= research-unavailable))
	(up-research-status c: imperial-age >= research-pending)
(or	(unit-available steppe-lancer-line)
(or	(unit-available steppe-lancer)
	(unit-available elite-steppe-lancer)))
(or	(up-research-status c: ri-cavalier <= research-available)
	(up-research-status c: ri-elite-steppe-lancer >= research-pending))
=>
	(set-goal trainknight no))
#load-if-defined TURKISH-CIV
(defrule
; tl	(goal trainskirm yes)
(or	(up-compare-goal mangonel-set >= 2); 3
(or	(unit-type-count-total scorpion-line >= 3)
(or	(unit-type-count-total bombard-cannon-line >= 3)
(or	(and	(or	(goal trainhussar yes)
			(goal trainknight yes))
		(up-research-status c: ri-chain-barding >= research-pending))
	(and	(goal trainunique yes)
		(up-research-status c: ri-leather-archer-armor >= research-pending))))))
=>
	(set-goal trainskirm no))
(defrule
	(goal trainskirm yes)
	(up-research-status c: imperial-age >= research-pending)
=>
	(set-goal trainskirm no)
	(set-goal trainhussar yes))
(defrule; todo | for now
	(goal trainpike yes)
	(current-age >= castle-age)
(or	(up-research-status c: imperial-age >= research-pending); disable here anyway
(or	(gold-amount >= 60)
(or	(unit-type-count villager-gold >= 3)
(or	(up-compare-goal tradeunits >= 8)
	(up-compare-goal relic-count >= 2)))))
;testpi	(building-type-count stable >= 1)
=>
	(set-goal trainpike no)
	(set-goal traincamel yes))
#end-if
#load-if-not-defined INDIAN-CIV
(defrule
	(goal traincamel yes)
	(up-compare-goal camel-set >= 40)
	(up-compare-goal camel-set s:>= cavalry)
	(up-compare-goal camel-set s:>= cavarchers)
	(up-research-status c: ri-imperial-camel <= research-unavailable)
	(up-research-status c: ri-zealotry <= research-available)
	(up-research-status c: ri-maghrabi-camels <= research-available)
	(up-research-status c: ri-farimba <= research-available)
	(population >= max-civ-pop)
	(population-cap <= 224)
=>
	(set-goal traincamel no))
#else
(defrule
	(goal trainpike yes)
	(up-research-status c: ri-imperial-camel >= research-pending); disable here anyway
	(up-compare-goal excessGold >= 260);	(up-compare-goal excessGold >= 60)
	(building-type-count stable >= 1)
=>
	(set-goal trainpike no)
	(set-goal traincamel yes))
#end-if
(defrule; testing
	(goal trainhussar yes)
	(up-research-status c: castle-age == research-available)
	(strategic-number sn-military-superiority >= 0); 1
(or	(players-current-age any-enemy >= castle-age)
	(strategic-number sn-military-superiority >= 1)); 2
(or	(current-age-time >= 270); 240
	(up-compare-goal strategy-type >= imperial-war))
(nand	(current-age-time < 420); 360 ; test
	(goal s-flush yes))
	(food-amount < 880)
	(goal attacking no); hmm
	(goal underattack no)
=>
	(set-goal trainhussar no))

#load-if-not-defined AZTEC-CIV
#load-if-not-defined CELTIC-CIV
#load-if-not-defined ETHIOPIAN-CIV
#load-if-not-defined KOREAN-CIV
#load-if-not-defined MALIAN-CIV
#load-if-not-defined MONGOL-CIV
#load-if-not-defined SARACEN-CIV
#load-if-not-defined SLAVIC-CIV
#load-if-not-defined TEUTONIC-CIV; non-SO civs
(defrule
	(goal trainmangonel yes)
	(up-research-status c: ri-heavy-scorpion >= research-pending)
;(or	(players-civ any-ally khmer)
	(up-research-status c: ri-onager < research-pending);)
;	(up-research-status c: ri-siege-onager < research-available)
=>
	(set-goal trainmangonel no)
	(set-goal trainscorpion yes))
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
(defrule
	(goal trainmangonel yes)
(not	(unit-available mangonel-line))
	(unit-available scorpion-line)
=>
	(set-goal trainmangonel no)
	(set-goal trainscorpion yes))
(defrule
	(goal trainscorpion yes)
(not	(unit-available scorpion-line))
	(unit-available mangonel-line)
=>
	(set-goal trainscorpion no)
	(set-goal trainmangonel yes))
(defrule
	(goal trainscorpion yes)
	(up-research-status c: ri-onager >= research-pending); siege
;	(wood-amount >= 160)
;	(gold-amount >= 135)
(or	(up-research-status c: ri-siege-onager >= research-pending)
	(up-research-status c: ri-heavy-scorpion < research-pending))
=>
	(set-goal trainscorpion no)
	(set-goal trainmangonel yes))
(defrule
	(goal trainscorpion yes)
	(up-research-status c: ri-onager >= research-available)
;	(wood-amount >= 160)
;	(gold-amount >= 135)
(or	(up-research-status c: ri-siege-onager >= research-pending)
	(up-research-status c: ri-heavy-scorpion < research-available))
=>
	(set-goal trainscorpion no)
	(set-goal trainmangonel yes))

#load-if-not-defined BERBERS-CIV
#load-if-not-defined BRITON-CIV
#load-if-not-defined BURMESE-CIV
#load-if-not-defined BURGUNDIANS-CIV
#load-if-not-defined BYZANTINE-CIV
#load-if-not-defined CHINESE-CIV
#load-if-not-defined FRANKISH-CIV
#load-if-not-defined GOTHIC-CIV
#load-if-not-defined HUN-CIV
#load-if-not-defined INCAN-CIV
#load-if-not-defined INDIAN-CIV
#load-if-not-defined ITALIAN-CIV
#load-if-not-defined JAPANESE-CIV
#load-if-not-defined KHMER-CIV
#load-if-not-defined LITHUANIANS-CIV
#load-if-not-defined MAGYAR-CIV
#load-if-not-defined MALAY-CIV
#load-if-not-defined MAYAN-CIV
#load-if-not-defined PERSIAN-CIV
#load-if-not-defined PORTUGUESE-CIV
#load-if-not-defined SPANISH-CIV
#load-if-not-defined TATARS-CIV
#load-if-not-defined TURKISH-CIV
#load-if-not-defined VIETNAMESE-CIV ; Siege Onagers
#load-if-not-defined VIKING-CIV ; Aztecs, Celts, Koreans, Mongols, Saracens, Teutons, Slavs, Ethiopians, Malians, Bulgarians, Cumans
(defrule
	(civ-selected celtic)
(or	(and	(or	(goal uugoal yes)
			(players-civ any-ally khmer))
		(players-unit-type-count focus-player mangonel-line <= 2))
(or	(players-civ every-enemy hun)
	(players-civ every-enemy turkish)))
=>
	(up-jump-rule 1))
(defrule
	(goal trainscorpion yes)
; test	(up-research-status c: ri-onager >= research-available)
;	(wood-amount >= 160)
;	(gold-amount >= 135)
;(or
	(up-research-status c: ri-heavy-scorpion < research-pending)
;(or	(not	(players-civ any-ally khmer))
;	(up-research-status c: ri-heavy-scorpion < research-available))
;	(and	(food-amount >= 800)
;		(gold-amount >= 500)))
=>
	(set-goal trainscorpion no)
	(set-goal trainmangonel yes))
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if

(defrule
(or	(not	(unit-available bombard-cannon))
(or	(and	(goal trainmangonel yes)
		(up-research-status c: ri-onager >= research-available))
(or	(and	(goal trainscorpion yes)
		(up-research-status c: ri-heavy-scorpion >= research-available)); pending))
	(and	(up-compare-goal trainmangonel != yes)
		(up-compare-goal trainscorpion != yes)))))
=>
	(up-jump-rule 2))
(defrule
	(building-type-count siege-workshop >= 1)
	(current-age >= imperial-age)
	(unit-type-count-total bombard-cannon-line < 12)
=>
	(set-goal trainbombard yes))
(defrule
	(building-type-count siege-workshop >= 1)
	(current-age >= imperial-age)
(or	(goal trainbombard yes)
	(unit-type-count-total bombard-cannon-line >= 12))
=>
	(set-goal trainscorpion no)
	(set-goal trainmangonel no)); end jump

#load-if-defined HUN-CIV
#end-if
#load-if-defined TURKISH-CIV
#end-if
(defrule
	(goal trainmangonel yes)
(or	(civ-selected turkish)
	(civ-selected hun))
;	(players-current-age focus-player >= imperial-age)
	(strategic-number sn-current-age >= imperial)
	(up-research-status c: imperial-age >= research-available);
=>
	(set-goal trainmangonel no))
(defrule
	(goal trainram yes)
	(up-research-status c: ri-siege-ram <= research-available); un
(or	(players-building-type-count focus-player castle > 0)
(or	(players-building-type-count focus-player bombard-tower > 0)
	(players-building-type-count focus-player watch-tower > 1)))
	(unit-type-count-total trebuchet-set < 2)
	(unit-type-count-total bombard-cannon-line < 10)
	(unit-available trebuchet)
	(building-type-count castle >= 1)
=>
	(set-goal traintrebuchet yes)
	(set-goal trainram no))
(defrule
	(goal trainram yes)
	(up-compare-goal traintrebuchet != yes)
	(up-compare-goal mangonel-set >= 9); 7; -total?
	(unit-type-count-total trebuchet-set < 5)
	(unit-type-count-total bombard-cannon-line < 10); 12
	(unit-available trebuchet)
=>
	(set-goal traintrebuchet yes))
(defrule
	(goal trainram yes)
	(up-compare-goal mangonel-set >= 9); 7; -total?
(or	(unit-type-count-total trebuchet-set >= 4)
	(unit-type-count-total bombard-cannon-line >= 10))
=>
	(set-goal siegereq yes)
	(set-goal trainram no))


#load-if-not-defined INCAN-CIV
;#load-if-not-defined INDIAN-CIV ; exception
#load-if-not-defined ITALIAN-CIV
#load-if-not-defined MAGYAR-CIV
#load-if-not-defined AZTEC-CIV
#load-if-not-defined BRITON-CIV
#load-if-not-defined BYZANTINE-CIV
#load-if-not-defined CHINESE-CIV
#load-if-not-defined ETHIOPIAN-CIV
#load-if-not-defined JAPANESE-CIV
#load-if-not-defined KOREAN-CIV
#load-if-not-defined MALAY-CIV
#load-if-not-defined MALIAN-CIV
#load-if-not-defined MAYAN-CIV
#load-if-not-defined MONGOL-CIV
#load-if-not-defined PORTUGUESE-CIV
#load-if-not-defined SARACEN-CIV
#load-if-not-defined VIETNAMESE-CIV
#load-if-not-defined VIKING-CIV; no arbs
(defrule
(or	(up-compare-goal trainarcher != yes)
(or	(and	(up-research-status c: ri-bodkin-arrow >= research-pending)
		(up-research-status c: ri-crossbow >= research-pending))
(or	(up-compare-goal position-goal != pocket)
	(up-compare-goal targetdistance < 45))))
=>
	(up-jump-rule 3))
(defrule
(or	(goal underattack yes)
(or	(strategic-number sn-military-superiority <= -3); test
(or	(unit-type-count-total archer-line >= 5)
	(strategic-number infantry >= 33)))); 25
(or	(up-compare-goal targetdistance < 45)
	(strategic-number sn-current-age >= imperial))
=>
	(up-jump-rule 2))
(defrule
	(civ-selected persian)
	(up-research-status c: ri-boiling-oil >= research-pending)
(or	(up-compare-goal excessGold < 250)
	(and	(unit-type-count villager-gold < 8)
		(up-compare-goal tradeunits < 16)))
=>
	(up-jump-rule 1))
(defrule
	(goal milunits yes);(goal strategy usual)
(nand	(strategic-number spears >= 15); 15
	(or	(unit-type-count cavalry-class >= 10); 12
		(and	(strategic-number spears >= 20); 25
			(and	(strategic-number sn-current-age >= imperial)
				(or	(goal palagoal yes)
					(and	(goal uugoal yes)
						(up-compare-const uu-type == cavalry-uu)))))))
	(goal attacking no)
=>
	(set-goal trainarcher no)); end jump
(defrule
	(goal trainarcher yes)
(or	(unit-type-count-total scorpion-line >= 9); 10
	(up-compare-goal mangonel-set >= 6))
=>
	(set-goal trainarcher no))
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
;#end-if
#end-if


#load-if-defined UP-GAME-WK
(defrule
(nor	(civ-selected magyar)
(or	(civ-selected turkish)
(or	(civ-selected tatars)
	(civ-selected hun))))
=>
	(up-jump-rule 2))
(defrule
	(civ-selected turkish)
	(goal uugoal yes)
	(up-compare-goal cavagoal != yes)
	(up-research-status c: ri-sipahi <= research-available)
	(up-research-status c: ri-heavy-cavalry-archer <= research-available)
(or	(up-research-status c: ri-parthian-tactics <= research-available)
	(goal trainhandcannon yes))
;	(up-research-status c: ri-thumb-ring <= research-available)
=>
	(up-jump-rule 1))
(defrule
	(goal trainarcher yes)
	(strategic-number sn-current-age >= imperial)
	(up-research-status c: imperial-age >= research-pending)
	(current-age >= castle-age)
=>
	(set-goal trainarcher no)
	(set-goal traincavarcher yes)); end jump
#end-if


(defrule
	(goal trainarcher yes)
(or	(up-research-status c: ri-arbalest <= research-unavailable)
	(and	(civ-selected italian)
		(and	(up-research-status c: ri-pavise <= research-available)
			(strategic-number infantry >= 5))))
	(unit-available hand-cannoneer)
=>
	(set-goal trainarcher no)
	(set-goal trainhandcannon yes))
(defrule
	(goal trainarcher yes)
	(goal traincavarcher yes)
	(up-research-status c: ri-arbalest < research-pending)
=>
	(set-goal trainarcher no))
(defrule
	(goal traincavarcher yes)
	(up-research-status c: ri-shatagni >= research-pending)
	(players-unit-type-count focus-player condottiero < 8)
	(players-unit-type-count focus-player condottiero-placeholder < 8)
	(unit-available hand-cannoneer)
=>
	(set-goal traincavarcher no)
	(set-goal trainhandcannon yes))
(defrule
	(goal trainarcher yes)
(or	(civ-selected bulgarians)
	(civ-selected spanish))
	(up-research-status c: castle-age >= research-pending)
=>
	(set-goal trainarcher no)); heavy scorpions if no hand cannons available for certain civs vs husks?
	; cav archers for bulgarians?
(defrule
	(goal trainarcher yes)
(or	(civ-selected celtic)
(or	(civ-selected gothic)
(or	(goal palagoal yes)
	(civ-selected turkish))))
	(up-research-status c: imperial-age >= research-pending)
=>
	(set-goal trainarcher no))
(defrule
	(goal trainarcher yes)
	(civ-selected burmese)
	(up-research-status c: imperial-age >= research-pending)
	(up-research-status c: ri-arbalest <= research-available)
	(up-research-status c: ri-leather-archer-armor <= research-available)
(or	(goal uugoal yes)
(or	(goal trainunique yes)
(or	(goal champgoal yes)
	(goal trainchamp yes))))
=>
	(set-goal trainarcher no))
(defrule
	(goal trainarcher yes)
	(goal milunits yes);(goal strategy usual)
(or	(civ-selected celtic)
(or	(civ-selected gothic)
(or	(goal palagoal yes)
	(civ-selected turkish))))
	(current-age >= castle-age)
	(unit-type-count-total archer-line < 5)
	(building-type-count-total stable >= 1)
	(strategic-number spears < 9)
	(goal underattack no)
	(strategic-number sn-military-superiority >= -1)
=>
	(set-goal trainarcher no))

(defrule
	(goal trainarcher yes)
	(or(up-research-status c: ri-bracer < 2)
	(up-research-status c: ri-arbalest < 2))
	(civilian-population > thirty-pop) ;there might be strategies that go very fast imp with bracer xbows
	(up-research-status c: ri-chemistry < 2)
=>
	(set-goal trainarcher no)
)

(defrule
	(goal traincavarcher yes)
	(goal trainhandcannon yes)
	(strategic-number husks < 5)
	(strategic-number eagles < 5)
	(up-research-status c: ri-heavy-cavalry-archer >= research-available)
	(up-research-status c: ri-thumb-ring >= research-pending)
	(up-research-status c: ri-bodkin-arrow >= research-pending)
(or	(up-research-status c: ri-parthian-tactics >= research-pending)
	(up-research-status c: ri-silk-armor >= research-pending))
(or	(not	(civ-selected turkish))
	(up-research-status c: ri-sipahi >= research-pending))
=>
	(set-goal trainhandcannon no))


(defrule
(or	(up-compare-goal uugoal != yes)
(or	(goal underattack yes)
(or	(up-compare-goal milunits != yes)
(or	(goal cavagoal yes)
	(and	(up-compare-const uu-type != archer-uu)
		(up-compare-const uu-type != powder-uu))))))
=>
	(up-jump-rule 3))
(defrule
	(goal position-goal flank)
	(strategic-number sn-military-superiority <= -1)
	(wall-completed-percentage 2 < 100)
	(wall-completed-percentage 1 < 100)
(or	(goal underattack yes)
	(strategic-number sn-military-superiority <= -3))
=>
	(up-jump-rule 2))
(defrule
	(strategic-number infantry < 33)
	(unit-type-count-total archer-line < 5)
(or	(building-type-count castle >= 2)
(or	(up-research-status c: imperial-age == research-pending)
(or	(and	(current-age >= imperial-age)
		(current-age-time < 60))
	(and	(up-research-status c: imperial-age >= research-pending)
		(building-type-count castle >= 1)))))
=>
	(set-goal temporary-goal 4294))
(defrule
(or	(strategic-number husks < 5)
	(up-compare-const uu-type == powder-uu))
(or	(goal temporary-goal 4294)
(or	(building-type-count castle >= 3)
	(and	(population >= max-civ-pop)
		(and	(building-type-count castle >= 2)
			(building-type-count-total castle >= 3)))))
=>
	(set-goal trainarcher no)
	(set-goal traincavarcher no)
	(set-goal trainhandcannon no)); end jump

#load-if-defined IMPERIAL-AGE-END
(defrule
	(up-compare-goal strategy-type == feudal-war)
	(strategic-number sn-current-age == feudal)
=>
	(up-jump-rule 1))
(defrule
	(up-research-status c: imperial-age <= research-available)
	(goal position-goal pocket)
;	(goal defend no)
	(goal underattack no)
	(up-compare-goal targetdistance >= 45)
	(strategic-number sn-military-superiority >= -2)
	(player-in-game every-ally)
(or	(and	(goal trainunique yes)
		(unit-available my-unique-unit-line))
	(and	(goal trainknight yes)
		(unit-available knight-line)))
=>
	(set-goal trainarcher no)
	(set-goal trainhussar no)
	(set-goal trainskirm no))
#end-if

(defrule
(or	(up-compare-goal milunits != yes)
(or	(up-compare-goal uugoal != yes)
(or	(strategic-number eagles >= 10)
(or	(up-compare-goal underattack != no)
	(unit-type-count-total militiaman >= 5)))))
=>
	(up-jump-rule 4))
(defrule
	(up-compare-const uu-type != infantry-uu)
(nor	(civ-selected gothic)
(or	(civ-selected aztec)
(or	(civ-selected frankish)
(or	(civ-selected malay)
	(civ-selected malian)))))
=>
	(up-jump-rule 3))
(defrule
(or	(and	(civ-selected malay)
		(up-compare-goal excessGold < 5000))
	(and	(civ-selected gothic)
		(strategic-number archers <= 0)))
=>
	(up-jump-rule 2))
(defrule
(or	(building-type-count castle >= 2)
(or	(up-research-status c: imperial-age == research-pending)
(or	(and	(current-age >= imperial-age)
		(current-age-time < 60))
	(and	(up-research-status c: imperial-age >= research-pending)
		(building-type-count castle >= 1)))))
=>
	(set-goal trainchamp no))
(defrule
	(goal trainunique yes)
(or	(building-type-count castle >= 3)
	(and	(population >= max-civ-pop)
		(and	(building-type-count castle >= 2)
			(building-type-count-total castle >= 3))))
=>
	(set-goal trainchamp no)); end jump

(defrule; testing
	(goal trainskirm yes)
	(up-research-status c: castle-age == research-available)
	(strategic-number sn-military-superiority >= 0); 1
(or	(players-current-age any-enemy >= castle-age)
	(strategic-number sn-military-superiority >= 1)); 2
(or	(current-age-time >= 270); 240
	(up-compare-goal strategy-type >= imperial-war))
(nand	(current-age-time < 420); 360 ; test
	(goal sk-var yes))
	(food-amount < 835)
	(goal attacking no); hmm
	(goal underattack no)
=>
	(set-goal trainskirm no))
(defrule
	(goal trainskirm yes)
(or	(up-compare-goal enemy-goal2 == klew) ; klew => meso => no spears anyway => no need to disable them here
	(strategic-number eagles >= 7))
(or	(up-compare-goal excessGold >= 250)
(or	(strategic-number eagles >= 15)
	(strategic-number sn-current-age <= feudal)))
	(strategic-number archers <= 3)
=>
	(set-goal trainskirm no))

(defrule
(or	(up-compare-goal milunits != yes);	(up-compare-goal strategy != usual)
(or	(not	(player-in-game any-ally))
	(and	(cc-players-unit-type-count 0 gold-mine <= 0)
		(and	(up-compare-goal excessGold < 250)
			(and	(up-compare-goal tradeunits <= 0)
;				(and
	(up-compare-goal relic-count <= 0)
;					(unit-type-count villager-gold <= 0))
)))))
=>
	(set-goal allowskirms yes)
	(up-jump-rule 6))
(defrule
(or	(up-compare-goal trainskirm != yes)
(or	(up-compare-goal position-goal != pocket)
	(and	(up-compare-goal excessGold < 200); (gold-amount
		(and	(up-compare-goal tradeunits < 12)
			(and	(up-compare-goal relic-count < 2)
				(and	(unit-type-count villager-gold < 6)
					(population < del-civ-pop)))))))
	(strategic-number sn-current-age >= imperial)
=>
	(up-jump-rule 5))
(defrule
(or	(goal underattack yes)
(or	(strategic-number sn-military-superiority <= -3); test
(or	(and	(up-research-status c: ri-bodkin-arrow >= research-pending)
		(up-research-status c: ri-elite-skirmisher >= research-pending))
(or	(up-compare-goal skirmisher-set >= 5)
	(strategic-number archers >= 45))))); 42
(or	(up-compare-goal targetdistance < 45)
	(strategic-number sn-current-age >= imperial))
=>
	(up-jump-rule 4))
(defrule
(or	(up-research-status c: imperial-age == research-pending)
	(and	(current-age >= imperial-age)
		(current-age-time < 10)))
(or	(up-compare-goal relic-count >= 5)
(or	(up-compare-goal excessGold >= 200)
(or	(unit-type-count villager-gold >= 9)
	(up-compare-goal tradeunits >= 18))))
	(strategic-number archers < 36); 33
	(goal attacking no)
=>
	(set-goal trainskirm no))
(defrule; test
	(strategic-number sn-current-age <= castlea)
	(current-age == castle-age)
	(up-research-status c: imperial-age <= research-available)
	(food-amount < 1225); 1125
	(up-compare-goal targetdistance >= 45)
(or	(unit-type-count-total knight-line >= 12); 7
(or	(strategic-number archers < 36); 33
(or	(goal attacking no)
	(up-compare-flag escrow-flag == 2))))
=>
	(set-goal trainskirm no))
(defrule
	(civ-selected gothic)
	(strategic-number gunpowder >= 15)
(or	(building-type-count-total siege-workshop <= 0); -total
(or	(not	(unit-available mangonel-line))
(or	(up-compare-goal trainmangonel != yes)
	(up-compare-goal excessGold < mangonel-gcost))))
=>
	(up-jump-rule 1))
(defrule
(or	(civ-selected celtic)
(or	(civ-selected gothic)
	(goal palagoal yes)))
	(up-research-status c: imperial-age >= research-pending)
(or	(current-age <= castle-age)
	(current-age-time < 300))
(or	(up-compare-goal excessGold >= 200)
(or	(unit-type-count villager-gold >= 6)
	(up-compare-goal tradeunits >= 18)))
=>
	(set-goal trainskirm no)); end jump

(defrule
	(goal trainpike yes)
	(up-compare-goal allowspears != yes)
=>
	(set-goal trainpike no))
(defrule
(or	(goal trainskirm yes)
	(goal traingenitour yes))
	(up-compare-goal allowskirms != yes)
=>
	(set-goal trainskirm no)
	(set-goal traingenitour no))

#load-if-defined GOTHIC-CIV
(defrule
	(goal milunits yes);(goal strategy usual)
	(building-type-count-total castle >= 1)
	(goal uugoal yes)
	(current-age >= castle-age)
	(up-compare-goal skirmisher-set < 5)
	(up-gaia-type-count c: gold >= 3)
	(strategic-number archers < 60)
(or	(goal underattack no)
	(building-type-count castle >= 1))
(or	(up-compare-goal excessGold >= 250);	(gold-amount >= 250); 200
(or	(unit-type-count villager-gold >= 9)
	(up-compare-goal tradeunits >= 27))); 33
=>
	(set-goal trainskirm no))
#end-if

#load-if-not-defined INCAN-CIV
;#load-if-not-defined INDIAN-CIV ; exception
#load-if-not-defined ITALIAN-CIV
#load-if-not-defined MAGYAR-CIV
#load-if-not-defined AZTEC-CIV
#load-if-not-defined BRITON-CIV
#load-if-not-defined BYZANTINE-CIV
#load-if-not-defined CHINESE-CIV
#load-if-not-defined ETHIOPIAN-CIV
#load-if-not-defined JAPANESE-CIV
#load-if-not-defined KOREAN-CIV
#load-if-not-defined MALAY-CIV
#load-if-not-defined MALIAN-CIV
#load-if-not-defined MAYAN-CIV
#load-if-not-defined MONGOL-CIV
#load-if-not-defined PORTUGUESE-CIV
#load-if-not-defined SARACEN-CIV
#load-if-not-defined VIETNAMESE-CIV
#load-if-not-defined VIKING-CIV; no arbs
(defrule
	(goal trainarcher yes)
(or	(and	(building-type-count-total castle >= 1)
		(and	(goal trainunique yes)
			(up-compare-const cavalry-uu != 1)))
	(and	(building-type-count-total barracks >= 1)
		(goal trainchamp yes)))
	(current-age >= castle-age)
	(up-research-status c: ri-arbalest <= research-unavailable)
(or	(goal underattack no)
	(up-research-status c: ri-crossbow <= research-available))
=>
	(set-goal trainarcher no))
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
;#end-if
#end-if


(defrule
	(goal trainmonk yes)
	(goal strategy krush)
	(unit-type-count-total monk-set >= 1)
	(up-compare-goal excessGold < 175)
	(goal trainknight yes)
	(building-type-count stable >= 1)
	(unit-available knight-line)
	(strategic-number sn-current-age <= castlea)
=>
	(set-goal trainmonk no))
(defrule
	(goal trainmonk yes)
	(goal strategy fast-imp)
(or	(unit-type-count-total monk-set >= 1)
(or	(up-compare-goal total-food-amount < imperial-food)
	(up-compare-goal total-gold-amount < imperial-gs)))
	(strategic-number sn-current-age <= castlea)
=>
	(set-goal trainmonk no))


#load-if-not-defined WONDER-RACE
;#load-if-defined UP-ALLY-IN-GAME
(defrule
	(up-compare-const civilian-percent <= 99)
=>
	(up-jump-rule 3))
(defrule
	(goal underattack no)
	(players-building-count every-enemy <= 0)
	(population < max-civ-pop)
	(population < eighty-pop)
	(up-compare-goal custom-civ-pop < 140);	(civilian-population < 140)
=>
	(up-jump-rule 3))
(defrule
	(goal underattack no)
(or	(goal palagoal yes)
	(and	(goal uugoal yes)
		(or	(up-compare-const uu-type == cavalry-uu)
			(up-compare-const uu-type == siege-uu))))
	(population < max-civ-pop)
	(up-compare-goal custom-civ-pop < 140)
	(up-research-status c: ri-paladin <= research-available)
	(up-research-status c: my-unique-unit-upgrade <= research-available)
=>
	(up-jump-rule 2))
(defrule
	(goal underattack no)
(or	(and	(goal trainbattle yes)
		(up-research-status c: ri-elite-battle-elephant <= research-available))
	(and	(goal trainsteppe yes)
		(up-research-status c: ri-elite-steppe-lancer <= research-available)))
	(population < max-civ-pop)
	(up-compare-goal custom-civ-pop < 140)
=>
	(up-jump-rule 1)); end jump
;#end-if
(defrule
	(goal trainvillager yes)
(or	(civilian-population >= up-max-civ)
	(and	(unit-type-count-total villager >= 5)
		(and	(up-compare-goal custom-civ-pop >= up-max-civ)
			(or	(unit-type-count-total villager >= 10)
				(up-compare-const civilian-percent <= 99)))))
	(unit-type-count-total villager >= 2)
=>
	(set-goal trainvillager no))
(defrule
	(goal trainvillager yes)
(or	(and	(up-compare-goal total-food-amount >= 2400)
			(research-available feudal-age))
(or	(population >= del-civ-pop)
	(and	(population >= max-civ-pop)
		(unit-type-count-total villager >= min-number-vills)))); hmm
	(unit-type-count-total villager >= 2)
=>
	(set-goal trainvillager no))
(defrule
(or	(up-compare-const inf-game == 1)
(or	(dropsite-min-distance wood < 0)
	(dropsite-min-distance wood g:>= map-size)))
	(up-compare-goal trainvillager != no)
(or	(unit-type-count-total villager >= min-number-vills)
	(and	(population >= max-civ-pop)
		(unit-type-count-total villager >= 10)))
=>
	(set-goal trainvillager no))
#end-if
;#load-if-not-defined DIFFICULTY-MODERATE
#load-if-not-defined DIFFICULTY-HARD
#load-if-not-defined DIFFICULTY-HARDEST
#load-if-not-defined DIFFICULTY-EXTREME
(defrule
	(goal trainvillager yes)
(or	(and	(players-building-count any-enemy >= 1)
		(and	(unit-type-count-total villager >= 12)
			(up-compare-goal my-cpop g:> target-cpop)))
	(up-pending-objects c: villager >= 1))
	(up-compare-goal my-cpop g:>= target-cpop)
=>
	(set-goal trainvillager no))
(defrule
(or	(goal traincart yes)
	(goal traincog yes))
(or	(and	(players-building-count any-enemy >= 1)
		(and	(up-compare-goal tradeunits >= 5)
			(up-compare-goal my-cpop g:> target-cpop)))
(or	(up-pending-objects c: trade-cart >= 1)
	(up-pending-objects c: trade-cog >= 1)))
	(up-compare-goal my-cpop g:>= target-cpop)
=>
	(set-goal traincart no)
	(set-goal traincog no))
#end-if
#end-if
#end-if
;#end-if
(defrule
(or	(goal traincart yes)
	(goal traincog yes))
	(up-compare-const civilian-percent <= 99)
(or	(up-compare-goal custom-civ-pop >= up-max-civ); >
	(unit-type-count-total villager < 10))
	(up-compare-goal tradeunits >= 2)
	(up-compare-goal tradeunits >= castle-diff)
=>
	(set-goal traincart no)
	(set-goal traincog no))
(defrule
	(goal trainfish yes)
(or	(population >= max-civ-pop)
(or	(civilian-population >= up-max-civ)
(or	(up-compare-goal custom-civ-pop >= up-max-civ)
	(up-compare-const civilian-percent <= 66))))
	(unit-type-count-total fishing-ship >= 1)
=>
	(set-goal trainfish no))
(defrule
	(up-compare-goal trainvillager != yes)
	(up-research-status c: ri-flemish-revolution == research-pending)
=>
	(set-goal trainvillager yes))
#load-if-defined INFINITE-RESOURCES-START
(defrule
(or	(goal trainfish yes)
(or	(goal traincart yes)
	(goal traincog yes)))
=>
	(set-goal trainfish no)
	(set-goal traincart no)
	(set-goal traincog no))
(defrule
	(goal trainvillager no)
	(research-completed ri-flemish-revolution)
=>
	(set-goal trainflemish yes))
#end-if
(defrule
	(goal tradecarts no)
	(goal traincart yes)
=>
	(set-goal traincart no))
#load-if-not-defined ALL-TECHS-ENABLED
(defrule
	(goal trainpike yes)
	(civ-selected burgundians)
	(up-research-status c: ri-halberdier <= research-unavailable)
	(unit-available flemish-militia)
	(can-afford-unit flemish-militia)
	(up-compare-goal tradeunits >= 1)
	(building-type-count town-center >= 1)
(or	(up-compare-goal excessGold >= 225)
	(up-compare-goal tradeunits >= 3))
=>
	(set-goal trainpike no)
	(set-goal trainflemish yes))
(defrule
	(up-compare-goal trainhussar != yes)
	(up-compare-goal trainknight != yes)
	(up-compare-goal traincamel != yes)
	(up-compare-goal trainbattle != yes)
	(up-compare-goal trainsteppe != yes)
=>
	(up-jump-rule 1))
(defrule
(not	(unit-available knight-line))
(or	(civ-selected aztec)
(or	(civ-selected mayan)
	(civ-selected incan)))
=>
	(set-goal trainhussar no)
	(set-goal trainknight no)
	(set-goal traincamel no)
	(set-goal trainbattle no)
	(set-goal trainsteppe no)); end jump
(defrule
	(goal traineagle yes)
(nor	(unit-available eagle-warrior-line)
	(unit-available heavy-eagle-warrior))
(nor	(civ-selected aztec)
(or	(civ-selected mayan)
	(civ-selected incan)))
=>
	(set-goal traineagle no))
(defrule
	(goal trainknight yes)
(not	(unit-available knight-line))
	(civ-selected indian)
=>
	(set-goal trainknight no))
(defrule
	(goal trainbattle yes)
(nor	(unit-available battle-elephant-line)
(or	(unit-available battle-elephant)
	(unit-available elite-battle-elephant)))
(nor	(civ-selected burmese)
(or	(civ-selected khmer)
(or	(civ-selected malay)
	(civ-selected vietnamese))))
=>
	(set-goal trainbattle no))
(defrule
	(goal trainsteppe yes)
(nor	(unit-available steppe-lancer-line)
(or	(unit-available steppe-lancer)
	(unit-available elite-steppe-lancer)))
(nor	(civ-selected cumans)
	(civ-selected tatars))
=>
	(set-goal trainsteppe no))
(defrule
	(goal traincondottiero yes)
(nor	(unit-available condottiero)
	(unit-available condottiero-placeholder))
(nor	(civ-selected italian)
	(players-civ any-ally italian))
=>
	(set-goal traincondottiero no))
(defrule
	(goal traingenitour yes)
(nor	(unit-available genitour-line)
(or	(unit-available genitour)
(or	(unit-available elite-genitour)
	(unit-available genitour-placeholder))))
(nor	(civ-selected berbers)
	(players-civ any-ally berbers))
=>
	(set-goal traingenitour no))
(defrule
	(goal trainflemish yes)
(nor	(unit-available flemish-militia)
(or	(unit-available flemish-pikewoman)
	(unit-available flemish-pikeman)))
(not	(civ-selected burgundians))
=>
	(set-goal trainflemish no))
#end-if

(defrule
	(taunt-detected any-human-ally 56)
=>
	(chat-to-allies-using-id 22153); "39 At once, sire!")
	(acknowledge-taunt every-ally 56)
	(acknowledge-taunt every-ally 57)
	(up-jump-rule 2))
(defrule
	(taunt-detected any-human-ally 57)
=>
	(chat-to-allies-using-id 22153); "39 At once, sire!")
	(disable-self))
(defrule
	(taunt-detected any-human-ally 57)
=>
	(set-goal trainpike no)
	(set-goal trainskirm no)
	(set-goal traingenitour no)); end jump
	

(defrule
	(players-civilian-population any-enemy g:>= custom-civ-pop)
	(up-compare-goal milunits != no)
	(strategic-number sn-military-superiority <= 2)
	(strategic-number teamsuperiority <= 2)
	(goal attacking no)
=>
	(up-get-fact-max any-enemy civilian-population 0 temporary-goal)
	(up-modify-goal temporary-goal c:* 4)
	(up-modify-goal temporary-goal c:/ 3)
	(up-modify-goal temporary-goal c:+ 5)
	(set-goal temporary-goal4 1293791))
(defrule
(or	(goal underattack yes)
	(and	(goal temporary-goal4 1293791)
		(up-compare-goal custom-civ-pop g:> temporary-goal)))
=>
	(up-jump-rule 2))
(defrule
	(strategic-number sn-current-age >= cimperial)
	(population < max-civ-pop)
	(civilian-population < up-max-civ)
	(up-compare-goal custom-civ-pop < up-max-civ)
	(up-compare-flag escrow-flag != 16)
	(up-compare-flag escrow-flag != 32)
	(up-compare-flag escrow-flag2 != 1)
	(up-compare-flag escrow-flag2 != 2)
	(up-compare-flag escrow-flag2 != 4)
	(up-compare-flag escrow-flag2 != 8)
(or	(up-compare-goal relocating >= yes)
	(strategic-number sn-military-superiority >= -1))
=>
	(set-goal escrow-state with-escrow)
	(up-jump-rule 2))
(defrule
	(unit-type-count-total villager < min-number-vills)
	(up-compare-flag escrow-flag != 1)
	(up-compare-flag escrow-flag != 2)
	(up-compare-flag escrow-flag != 16)
	(up-compare-flag escrow-flag != 32)
	(up-compare-flag escrow-flag2 != 1)
	(up-compare-flag escrow-flag2 != 2)
	(up-compare-flag escrow-flag2 != 4)
	(up-compare-flag escrow-flag2 != 8)
(or	(up-compare-goal relocating >= yes)
	(strategic-number sn-military-superiority >= -1))
=>
	(set-goal escrow-state with-escrow)
	(up-jump-rule 1)); end jump
(defrule
	(true)
=>
	(set-goal escrow-state without-escrow))


#load-if-not-defined DIFFICULTY-EASIEST
#load-if-defined INFINITE-RESOURCES-START
(defrule
	(population < max-civ-pop)
(or	(goal traintrebuchet no)
	(current-age <= castle-age))
	(goal trainunique no)
	(goal trainpetard no)
=>
	(set-goal trainunique yes))
(defrule
	(population < max-civ-pop)
	(goal trainram no)
	(goal trainscorpion no)
	(goal trainmangonel no)
	(goal trainbombard no)
=>
	(set-goal trainscorpion yes)
	(set-goal trainbombard yes))
(defrule
	(population < max-civ-pop)
	(up-compare-goal navycount g:< maxnavy)
	(goal traingalley no)
	(goal trainfire no)
	(goal traindemo no)
	(goal trainturtle no)
	(goal trainlongboat no)
	(goal traincannon no)
	(goal traincaravel no)
	(can-train dmw-unit)
=>
	(train dmw-unit))
(defrule
	(population < max-civ-pop)
	(goal trainarcher no)
	(goal trainskirm no)
	(goal trainhandcannon no)
	(goal traincavarcher no)
	(goal trainslinger no)
	(goal traingenitour no)
=>
	(set-goal infinite-range yes))
(defrule
	(population < max-civ-pop)
	(goal trainpike no)
	(goal trainchamp no)
	(goal traineagle no)
	(goal traincondottiero no)
=>
	(set-goal infinite-rax yes))
(defrule
	(population < max-civ-pop)
	(goal traincamel no)
	(goal trainknight no)
	(goal trainhussar no)
	(goal trainbattle no)
	(goal trainsteppe no)
=>
	(set-goal infinite-stable yes))
(defrule
	(population < max-civ-pop)
	(population < eighty-pop)
	(goal trainmonk no)
=>
	(set-goal trainmonk yes))
#else
(defrule
(or	(players-building-count every-enemy <= 0)
(or	(goal escrowing yes)
(or	(strategic-number sn-current-age < imperial)
	(up-compare-goal researchplan != yes))))
=>
	(up-jump-rule 4))
#end-if
(defrule
	(goal trainunique no)
	(goal trainpetard no)
	(goal traintrebuchet no)
	(goal trainram no)
	(goal trainmangonel no)
	(goal trainscorpion no)
	(goal trainbombard no)
	(goal traingalley no)
	(goal trainfire no)
	(goal traindemo no)
	(goal trainturtle no)
	(goal trainlongboat no)
	(goal traincannon no)
	(goal trainarcher no)
	(goal trainskirm no)
=>
	(set-goal temporary-goal8 1473960290))
(defrule
	(goal temporary-goal8 1473960290)
	(goal trainhandcannon no)
	(goal traincavarcher no)
	(goal trainslinger no)
	(goal trainpike no)
	(goal trainchamp no)
	(goal traineagle no)
	(goal traincondottiero no)
	(goal traincamel no)
	(goal trainknight no)
	(goal trainhussar no)
	(goal trainmonk no)
	(goal traincaravel no)
	(goal trainbattle no)
	(goal traingenitour no)
=>
	(set-goal temporary-goal8 1473960291))
(defrule
	(goal temporary-goal8 1473960291)
	(goal trainsteppe no)
	(goal trainflemish no)
=>
	(set-goal temporary-goal8 1473960292))
(defrule
	(goal temporary-goal8 1473960292)
;	(goal trainmonk no)
=>
;	(chat-local-to-self "Training back-up unit.")
	(set-goal default-unit yes)); end jump
#end-if

(defrule
	(goal milunits yes)
;	(goal strategy usual)
	(goal position-goal flank)
	(goal attacking no)
	(goal assistance no)
	(strategic-number sn-current-age <= feudal)
	(up-compare-goal enemy-goal == 0)
	(players-military-population every-enemy < 2)
	(players-building-count any-enemy >= 1)
	(goal inseln no)
	(up-enemy-buildings-in-town <= 0)
	(up-enemy-units-in-town <= 3)
=>
	(set-goal temporary-goal8 1473960292))
(defrule
	(goal inseln yes)
	(strategic-number sn-current-age < cimperial)
	(up-compare-goal strategy-type >= imperial-war)
	(up-enemy-units-in-town <= 0)
	(up-enemy-buildings-in-town <= 0)
=>
	(set-goal temporary-goal8 1473960292))
(defrule
	(goal temporary-goal8 1473960292)
=>
	(set-goal trainunique no)
	(set-goal trainpetard no)
	(set-goal trainarcher no)
	(set-goal trainskirm no)
	(set-goal trainhandcannon no)
	(set-goal traincavarcher no)
	(set-goal trainslinger no)
	(set-goal trainpike no)
	(set-goal trainchamp no)
	(set-goal traineagle no)
	(set-goal traincondottiero no)
	(set-goal traincamel no)
	(set-goal trainknight no)
	(set-goal trainhussar no)
	(set-goal trainbattle no))
(defrule
	(goal temporary-goal8 1473960292)
=>
	(set-goal traingenitour no)
	(set-goal trainsteppe no)
	(set-goal trainflemish no))

(defrule
	(true)
=>
	(up-modify-goal temporary-goal g:= allowed-num-military)
	(up-get-fact-max any-ally military-population 0 temporary-goal2)
	(up-get-fact-max any-enemy military-population 0 temporary-goal3)
	(up-modify-goal temporary-goal2 g:max temporary-goal3))
(defrule
	(game-time < max-delay)
	(goal attacking no)
	(goal underattack no)
(or	(difficulty == easiest)
(or	(difficulty == easy)
	(difficulty == moderate)))
	(up-compare-goal allowed-num-military < 16384)
;	(players-building-count any-enemy >= 1)
=>
	(up-modify-goal temporary-goal g:min temporary-goal2)
	(up-modify-goal temporary-goal c:- diff-id)
	(up-modify-goal temporary-goal c:max castle-diff)
	(up-modify-goal temporary-goal c:+ castle-diff)
	(up-modify-goal temporary-goal c:+ feitoria-diff)
	(up-modify-goal temporary-goal c:max 5)
	(up-modify-goal temporary-goal g:min allowed-num-military))
(defrule
(or	(up-compare-goal my-mpop g:>= temporary-goal)
	(and	(goal migration-state 1)
		(and	(up-compare-goal excessWood < 5000)
			(building-type-count-total town-center <= 0))))
=>
	(set-goal temporary-goal8 1473960293))
(defrule
	(goal temporary-goal8 1473960293)
=>
	(set-goal trainunique no)
	(set-goal traintrebuchet no)
	(set-goal trainmangonel no)
	(set-goal trainscorpion no)
	(set-goal trainbombard no)
	(set-goal traingalley no)
	(set-goal trainfire no)
	(set-goal traindemo no)
	(set-goal trainturtle no)
	(set-goal trainlongboat no)
	(set-goal traincannon no)
	(set-goal trainarcher no)
	(set-goal trainskirm no)
	(set-goal trainhandcannon no)
	(set-goal traincavarcher no))
(defrule
	(goal temporary-goal8 1473960293)
=>
	(set-goal trainslinger no)
	(set-goal trainpike no)
	(set-goal trainchamp no)
	(set-goal traineagle no)
	(set-goal traincondottiero no)
	(set-goal traincamel no)
	(set-goal trainknight no)
	(set-goal trainhussar no)
	(set-goal traincaravel no)
	(set-goal trainbattle no)
	(set-goal traingenitour no)
	(set-goal trainsteppe no)
	(set-goal trainmonk no)
	(set-goal trainflemish no))
(defrule
	(goal temporary-goal8 1473960293)
	(goal siegereq yes)
(or	(unit-type-count-total battering-ram-line >= 1)
(or	(unit-type-count-total trebuchet-set >= 1)
(or	(unit-type-count-total bombard-cannon-line >= 1)
	(unit-type-count-total petard >= 1))))
=>
	(set-goal trainpetard no)
	(set-goal trainram no))
;=========================================================
; Deleting units.
;=========================================================
(defrule
	(true)
=>
	(set-goal delete-flag 0))
;=========================================================
(defrule
	(taunt-detected any-ally 70)
(or	(up-idle-unit-count idle-type-villager >= ten-pop)
	(up-compare-goal custom-civ-pop > up-max-civ))
	(unit-type-count-total villager > min-number-vills)
=>
	(up-modify-flag delete-flag c:+ 1)
	(chat-to-player-using-id every-ally 22153); "39 At once, sire!"
	(acknowledge-taunt every-ally 70))
(defrule
	(taunt-detected any-ally 71)
(or	(goal enemy-boats no)
(or	(goal fleet no)
	(up-compare-goal navycount > minNavy)))
	(up-compare-goal navycount >= 1)
=>
	(up-modify-flag delete-flag c:+ 8)
	(up-modify-flag delete-flag c:+ 16)
	(up-modify-flag delete-flag c:+ 32)
	(up-modify-flag delete-flag c:+ 64)
	(chat-to-player-using-id every-ally 22153); "39 At once, sire!"
	(acknowledge-taunt every-ally 71))
(defrule
(or	(taunt-detected any-ally 70)
	(taunt-detected any-ally 71))
=>
	(chat-to-player-using-id every-ally 22118); "Alas, I cannot help that at this time."
	(acknowledge-taunt every-ally 70)
	(acknowledge-taunt every-ally 71))
(defrule
(or	(unit-type-count-total villager <= min-number-vills)
(or	(population < del-civ-pop)
(or	(up-research-status c: ri-flemish-revolution == research-pending)
	(goal trainvillager yes))))
=>
	(up-jump-rule 8))
(defrule
	(game-time > 3600)
(or	(up-compare-goal custom-civ-pop > 70);	(or	(unit-type-count-total villager > 70)
	(up-compare-goal custom-civ-pop > up-max-civ));	(unit-type-count-total villager > up-max-civ))
(or	(dropsite-min-distance wood g:>= map-size)
(or	(dropsite-min-distance wood <= -1)
	(and	(or	(building-type-count town-center >= 1)
			(building-type-count lumber-camp >= 1))
		(dropsite-min-distance wood >= 30))))
=>
	(up-modify-flag delete-flag c:+ 1)
	(up-jump-rule 11))
(defrule
	(strategic-number sn-current-age >= imperial)
	(players-building-count target-player >= 1); test
(or	(population >= max-pop)
(or	(up-compare-goal excessWood >= 6300)
(or	(up-compare-goal excessFood >= 6300)
	(up-compare-goal excessGold >= 6300))))
	(up-compare-goal excessWood >= 5400)
	(up-compare-goal excessFood >= 5400)
	(up-compare-goal excessGold >= 5400)
=>
	(up-modify-flag delete-flag c:+ 1)
	(up-jump-rule 10))
(defrule
	(up-compare-goal custom-civ-pop > res-vills-d);	(unit-type-count-total villager > res-vills-d)
	(strategic-number sn-current-age >= imperial)
	(players-building-count target-player >= 1); test
	(up-compare-goal excessWood >= 4500)
	(up-compare-goal excessFood >= 4500)
	(up-compare-goal excessGold >= 4500)
=>
	(up-modify-flag delete-flag c:+ 1)
	(up-jump-rule 9))
(defrule
	(up-compare-goal custom-civ-pop > res-vills-c);	(unit-type-count-total villager > res-vills-c)
	(strategic-number sn-current-age >= imperial)
	(players-building-count target-player >= 1); test
	(up-compare-goal excessWood >= 3600)
	(up-compare-goal excessFood >= 3600)
	(up-compare-goal excessGold >= 3600)
=>
	(up-modify-flag delete-flag c:+ 1)
	(up-jump-rule 8))
(defrule
	(up-compare-goal custom-civ-pop > res-vills-b);	(unit-type-count-total villager > res-vills-b)
	(strategic-number sn-current-age >= imperial)
	(players-building-count target-player >= 1); test
	(up-compare-goal excessWood >= 2700)
	(up-compare-goal excessFood >= 2700)
	(up-compare-goal excessGold >= 2700)
=>
	(up-modify-flag delete-flag c:+ 1)
	(up-jump-rule 7))
(defrule
	(up-compare-goal custom-civ-pop > res-vills-a);	(unit-type-count-total villager > res-vills-a)
	(strategic-number sn-current-age >= imperial)
	(players-building-count target-player >= 1); test
	(up-compare-goal excessWood >= 1800)
	(up-compare-goal excessFood >= 1800)
	(up-compare-goal excessGold >= 1800)
=>
	(up-modify-flag delete-flag c:+ 1)
	(up-jump-rule 6))
(defrule
	(up-compare-goal custom-civ-pop > up-max-civ);	(unit-type-count-total villager > up-max-civ)
	(strategic-number sn-current-age >= imperial)
	(players-building-count target-player >= 1); test
	(up-compare-goal excessFood >= 500)
	(up-compare-goal excessWood >= 500)
	(up-compare-goal excessGold >= 500)
	(nand(up-research-status c: ri-onager == 1)
	(up-compare-const TRADE-CUT == 1))
=>
	(up-modify-flag delete-flag c:+ 1)
	(up-jump-rule 5))
(defrule
	(up-compare-goal custom-civ-pop > up-max-civ);	(civilian-population > up-max-civ)
	(strategic-number sn-current-age >= imperial)
	(players-building-count target-player >= 1); test
;	(goal escrowing no); test ; maybe add +underattack/attacking
(or	(up-compare-goal excessFood >= 900)
(or	(up-compare-goal excessWood >= 900)
	(up-compare-goal excessGold >= 900)))
=>
	(up-modify-flag delete-flag c:+ 1)
	(up-jump-rule 4)); end jump
;(defrule
;	(up-compare-goal custom-civ-pop > res-vills-c);	(unit-type-count-total villager > res-vills-c); res-vills-d
;	(up-compare-goal custom-civ-pop > 70);	(unit-type-count-total villager > 70); test1
;	(strategic-number sn-current-age >= imperial)
;	(population >= del-civ-pop)
;	(goal escrowing no); test
;(or	(up-compare-goal custom-civ-pop > up-max-civ);	(unit-type-count-total villager > up-max-civ)
;	(and	(or	(players-building-type-count any-ally market >= 1)
;			(players-building-type-count any-ally dock >= 1))
;		(up-compare-goal tradeunits >= 30)))
;	(up-compare-goal excessWood >= 500)
;	(up-compare-goal excessFood >= 500)
;	(up-compare-goal excessGold >= 500)
;=>
;	(up-modify-flag delete-flag c:+ 1)
;	(up-jump-rule ))
(defrule
(or	(up-compare-goal siegereq != no)
(or	(unit-type-count-total bombard-cannon-line >= 8)
(or	(unit-type-count-total trebuchet-set >= 3)
(or	(unit-type-count-total battering-ram-line >= 5)
(or	(up-research-status c: imperial-age == research-pending)
(or	(up-compare-goal excessWood < 250)
(or	(up-compare-goal excessFood < 250)
	(up-compare-goal excessGold < 250))))))))
=>
	(up-jump-rule 1))
(defrule
	(timer-triggered MSuperiority); twentysec
	(up-compare-goal custom-civ-pop > min-number-vills);	(unit-type-count villager > min-number-vills)
	(population >= max-pop)
	(housing-headroom <= 0)
	(goal attacking no)
	(goal underattack no)
	(strategic-number sn-current-age >= imperial)
	(goal researchplan yes)
	(players-building-count target-player >= 1); test
	(goal escrowing no); test
(or	(building-type-count castle >= 1)
	(building-type-count siege-workshop >= 1))
;(or
;	(civilian-population > res-vills-d))
=>
	(chat-local-to-self "Deleting villager for siege.")
	(up-modify-flag delete-flag c:+ 1)
	(up-jump-rule 2))
(defrule
;tl	(timer-triggered twentysec)
	(goal traintransport yes)
	(goal attacking yes)
	(unit-type-count-total fishing-ship < 2)
	(unit-type-count-total transport-ship < 1)
	(unit-type-count-total villager > 10)
(or	(up-compare-goal custom-civ-pop > min-number-vills);	(unit-type-count-total villager > min-number-vills)
	(up-compare-goal excessFood >= 400))
	(housing-headroom <= 0)
(or	(population >= del-civ-pop)
	(population-headroom <= 0))
	(unit-available transport-ship)
	(can-afford-unit transport-ship)
=>
	(up-modify-flag delete-flag c:+ 1)
	(up-jump-rule 1))
(defrule
	(timer-triggered twentysec)
	(goal inseln yes)
	(goal migration-state 1)
	(unit-type-count-total transport-ship < 1)
	(unit-type-count-total villager > 10)
	(housing-headroom <= 0)
(or	(up-idle-unit-count idle-type-villager g:>= villagercount)
	(population-headroom <= 0))
	(can-afford-unit transport-ship)
	(unit-available transport-ship)
;	(can-train transport-ship); unit-available?
=>
	(up-modify-flag delete-flag c:+ 1)); end jumps
;=========================================================
(defrule
(or	(players-building-type-count every-ally market <= 0)
	(goal tradecarts no))
(or	(players-population every-ally < up-max-civ)
	(not	(player-in-game any-ally)))
	(population >= del-civ-pop)
(or	(unit-type-count-total villager >= 1)
	(building-type-count-total town-center >= 1))
	(unit-type-count-total trade-cart > 0)
=>
	(up-modify-flag delete-flag c:+ 2)
	(up-jump-rule 1))
(defrule
; tl :<	(up-compare-goal excessGold > 200)
	(population >= del-civ-pop)
(or	(up-compare-goal excessGold > 5000)
(or	(up-compare-goal tradeunits > maxcartspop); depending on popcap and difficulty
	(up-compare-goal tradeunits > maxcartssize))); depending on map size
(or	(unit-type-count-total villager >= 1)
	(building-type-count-total town-center >= 1))
;	(up-compare-goal tradeunits > 75)
(or	(up-compare-goal tradeunits > 100)
(or	(up-compare-goal tradeunits > maxcartspop)
	(up-compare-goal tradeunits > maxcartssize)))
	(unit-type-count-total trade-cart > 0)
=>
	(up-modify-flag delete-flag c:+ 2)); end jump
;=========================================================
(defrule
	(players-building-type-count every-ally dock <= 0)
(or	(players-population every-ally < up-max-civ)
	(not	(player-in-game any-ally)))
	(population >= del-civ-pop)
(or	(unit-type-count-total villager >= 1)
	(building-type-count-total town-center >= 1))
	(unit-type-count-total trade-cog > 0)
=>
	(up-modify-flag delete-flag c:+ 4)
	(up-jump-rule 1))
(defrule
; tl :<	(up-compare-goal excessGold > 200)
	(population >= del-civ-pop)
(or	(up-compare-goal excessGold > 5000)
(or	(up-compare-goal tradeunits > maxcartspop); depending on popcap and difficulty
	(up-compare-goal tradeunits > maxcartssize))); depending on map size
(or	(unit-type-count-total villager >= 1)
	(building-type-count-total town-center >= 1))
;	(up-compare-goal tradeunits > 75)
(or	(up-compare-goal tradeunits > 100)
(or	(up-compare-goal tradeunits > maxcartspop)
	(up-compare-goal tradeunits > maxcartssize)))
	(unit-type-count-total trade-cog > 0)
=>
	(up-modify-flag delete-flag c:+ 4)); end jump
;=========================================================
(defrule
(or	(unit-type-count-total fire-ship-line >= 1)
	(unit-type-count-total fire-galley >= 1))
	(game-time >= 3200)
	(goal enemy-boats no)
	(population >= del-civ-pop)
	(goal trainfire no)
	(up-compare-goal navycount > minNavy)
	(up-compare-goal biggestenemynavy <= minNavy)
	(up-compare-goal excessWood >= 900)
	(up-compare-goal excessFood >= 900)
	(up-compare-goal excessGold >= 900)
	(players-building-count any-enemy >= 1)
	(up-compare-goal navycount >= 1)
=>
	(up-modify-flag delete-flag c:+ 16)
	(up-jump-rule 5))
(defrule
	(game-time >= 3300)
	(goal enemy-boats no)
	(goal inseln no)
	(players-building-count any-enemy >= 1)
	(population >= del-civ-pop)
	(up-compare-goal excessWood >= 1800)
	(up-compare-goal excessFood >= 1800)
	(up-compare-goal excessGold >= 1800)
	(up-compare-goal navycount >= 1)
=>
	(up-modify-flag delete-flag c:+ 8)
	(up-modify-flag delete-flag c:+ 16)
	(up-modify-flag delete-flag c:+ 32)
	(up-modify-flag delete-flag c:+ 64)
	(up-jump-rule 4))
(defrule
	(game-time >= 4500)
	(goal enemy-boats no)
	(goal inseln no)
	(players-building-count any-enemy >= 1)
	(population >= del-civ-pop)
(or	(up-compare-goal excessWood >= 1800)
(or	(up-compare-goal excessFood >= 1800)
	(up-compare-goal excessGold >= 1800)))
	(up-compare-goal navycount >= 1)
=>
	(up-modify-flag delete-flag c:+ 8)
	(up-modify-flag delete-flag c:+ 16)
	(up-modify-flag delete-flag c:+ 32)
	(up-modify-flag delete-flag c:+ 64)
	(up-jump-rule 3))
(defrule
	(game-time >= 3300)
	(goal fleet no)
	(goal inseln no)
	(players-building-count any-enemy >= 1)
;	(population >= del-civ-pop)
	(up-compare-goal excessWood >= 1800)
	(up-compare-goal excessFood >= 1800)
	(up-compare-goal excessGold >= 1800)
	(up-compare-goal navycount >= 1)
=>
	(up-modify-flag delete-flag c:+ 8)
	(up-modify-flag delete-flag c:+ 16)
	(up-modify-flag delete-flag c:+ 32)
	(up-modify-flag delete-flag c:+ 64)
	(up-jump-rule 2))
(defrule
	(game-time >= 4500)
;	(goal enemy-boats no)
	(up-compare-goal navycount g:> maxnavy)
	(soldier-count < 20)
	(players-building-count any-enemy >= 1)
	(population >= del-civ-pop)
(or	(up-compare-goal excessWood >= 1800)
(or	(up-compare-goal excessFood >= 1800)
	(up-compare-goal excessGold >= 1800)))
	(up-compare-goal navycount >= 1)
=>
	(up-modify-flag delete-flag c:+ 8)
	(up-modify-flag delete-flag c:+ 16)
	(up-modify-flag delete-flag c:+ 32)
	(up-modify-flag delete-flag c:+ 64)
	(up-jump-rule 1))
(defrule
	(game-time >= 4500)
	(up-compare-goal navycount g:> maxnavy)
	(players-building-count any-enemy >= 1)
	(population >= del-civ-pop)
(or	(up-compare-goal excessWood >= 5000)
(or	(up-compare-goal excessFood >= 5000)
	(up-compare-goal excessGold >= 5000)))
	(up-compare-goal navycount >= 1)
=>
	(up-modify-flag delete-flag c:+ 8)
	(up-modify-flag delete-flag c:+ 16)
	(up-modify-flag delete-flag c:+ 32)
	(up-modify-flag delete-flag c:+ 64)); end jumps
;=========================================================
(defrule
(or	(population >= max-pop)
(or	(up-compare-goal tradeunits >= 36)
(or	(up-compare-goal excessFood >= 1200)
	(and	(up-compare-goal excessWood >= 600)
		(up-compare-goal excessGold >= 600)))))
	(up-compare-goal excessFood >= 600)
	(strategic-number sn-current-age >= imperial)
	(population >= del-civ-pop)
	(unit-type-count-total fishing-ship >= 1)
=>
	(up-modify-flag delete-flag c:+ 128)
	(up-jump-rule 2))
(defrule
	(cc-players-unit-type-count 0 shore-fish-class <= 0)
	(cc-players-unit-type-count 0 ocean-fish-class <= 0)
(or	(up-compare-goal custom-civ-pop >= up-max-civ)
(or	(civilian-population >= up-max-civ)
(or	(population >= max-civ-pop); siege-pop
	(housing-headroom < 10))))
	(unit-type-count-total fishing-ship >= 1)
=>
	(up-modify-flag delete-flag c:+ 128)
	(up-jump-rule 1))
(defrule
;tl	(timer-triggered twentysec)
	(goal traintransport yes)
	(goal attacking yes)
	(unit-type-count-total fishing-ship >= 1)
	(unit-type-count-total transport-ship < 1)
	(housing-headroom <= 0)
(or	(population >= del-civ-pop)
	(population-headroom <= 0))
	(unit-available transport-ship)
	(can-afford-unit transport-ship)
=>
	(up-modify-flag delete-flag c:+ 128)); end jumps
;=========================================================
(defrule
	(up-compare-flag delete-flag == 1)
	(unit-type-count villager >= 1)
=>
	(up-full-reset-search)
	(up-find-local c: villager-class g: villagercount)
	(up-clean-search search-local object-data-carry search-order-asc)
	(up-remove-objects search-local object-data-index >= 1)
;	(up-chat-data-to-self "Deleting %d villagers." g: local-total)
	(up-target-point 0 action-delete -1 -1))
(defrule
	(up-compare-flag delete-flag == 2)
	(unit-type-count trade-cart >= 1)
=>
	(up-full-reset-search)
	(up-find-local c: trade-cart c: 240)
	(up-clean-search search-local object-data-carry search-order-asc)
	(up-remove-objects search-local object-data-index >= 1)
;	(up-chat-data-to-self "Deleting %d trade-carts." g: local-total)
	(up-target-point 0 action-delete -1 -1))
(defrule
	(up-compare-flag delete-flag == 4)
	(unit-type-count trade-cog >= 1)
=>
	(up-full-reset-search)
	(up-find-local c: trade-cog c: 240)
	(up-clean-search search-local object-data-carry search-order-asc)
	(up-remove-objects search-local object-data-index >= 1)
;	(up-chat-data-to-self "Deleting %d trade-cogs." g: local-total)
	(up-target-point 0 action-delete -1 -1))
(defrule
	(up-compare-flag delete-flag == 8)
(or	(unit-type-count demolition-ship-line >= 1)
	(unit-type-count demolition-raft >= 1))
=>
	(up-full-reset-search)
	(up-find-local c: demolition-raft c: 240)
	(up-find-local c: demolition-ship c: 240)
	(up-find-local c: heavy-demolition-ship c: 240)
	(up-clean-search search-local object-data-hitpoints search-order-asc)
	(up-remove-objects search-local object-data-index >= 1)
;	(up-chat-data-to-self "Deleting %d demolition-ships." g: local-total)
	(up-target-point 0 action-delete -1 -1)
	(up-jump-rule 3))
(defrule
	(up-compare-flag delete-flag == 16)
(or	(unit-type-count fire-ship-line >= 1)
	(unit-type-count fire-galley >= 1))
=>
	(up-full-reset-search)
	(up-find-local c: fire-galley c: 240)
	(up-find-local c: fire-ship c: 240)
	(up-find-local c: fast-fire-ship c: 240)
	(up-clean-search search-local object-data-hitpoints search-order-asc)
	(up-remove-objects search-local object-data-index >= 1)
;	(up-chat-data-to-self "Deleting %d fire-ships." g: local-total)
	(up-target-point 0 action-delete -1 -1)
	(up-jump-rule 2))
(defrule
	(up-compare-flag delete-flag == 32)
	(unit-type-count galley-line >= 1)
=>
	(up-full-reset-search)
	(up-find-local c: galley c: 240)
	(up-find-local c: war-galley c: 240)
	(up-find-local c: galleon c: 240)
	(up-clean-search search-local object-data-hitpoints search-order-asc)
	(up-remove-objects search-local object-data-index >= 1)
;	(up-chat-data-to-self "Deleting %d galleys." g: local-total)
	(up-target-point 0 action-delete -1 -1)
	(up-jump-rule 1))
(defrule
	(up-compare-flag delete-flag == 64)
(or	(unit-type-count-total longboat-line >= 1)
(or	(unit-type-count-total turtle-ship-line >= 1)
	(unit-type-count-total caravel-line >= 1)))
=>
	(up-full-reset-search)
	(up-find-local c: longboat c: 240)
	(up-find-local c: elite-longboat c: 240)
	(up-find-local c: turtle-ship c: 240)
	(up-find-local c: elite-turtle-ship c: 240)
	(up-find-local c: caravel c: 240)
	(up-find-local c: elite-caravel c: 240)
	(up-clean-search search-local object-data-hitpoints search-order-asc)
	(up-remove-objects search-local object-data-index >= 1)
;	(up-chat-data-to-self "Deleting unique ships." g: local-total)
	(up-target-point 0 action-delete -1 -1)); end jump
(defrule
	(up-compare-flag delete-flag == 128)
	(unit-type-count fishing-ship >= 1)
=>
	(up-full-reset-search)
	(up-find-local c: fishing-ship c: 240)
	(up-clean-search search-local object-data-carry search-order-asc)
	(up-remove-objects search-local object-data-index >= 1)
;	(up-chat-data-to-self "Deleting %d fishing-ships." g: local-total)
	(up-target-point 0 action-delete -1 -1))









#load-if-not-defined DIFFICULTY-EASIEST
#load-if-not-defined DIFFICULTY-EASY
#load-if-not-defined DIFFICULTY-MODERATE
(defrule
	(players-building-count target-player >= 1)
	(goal siegereq yes)
=>
	(set-goal temporary-goal 1579175)
	(up-modify-goal temporary-goal2 g:= attacking)
	(up-modify-goal temporary-goal2 g:- underattack)
	(up-modify-goal temporary-goal2 c:max 0)
	(up-modify-goal temporary-goal2 c:* 100)
	(up-modify-goal temporary-goal2 c:min 100)
	(up-get-point position-target saved-point-x)
	(up-copy-point object-point-x position-self-x)
	(up-lerp-percent object-point-x saved-point-x g: temporary-goal2)
	(up-set-target-point object-point-x)
	(set-goal temporary-goal3 1579176))
#end-if
#end-if
#end-if
(defrule
	(goal traintransport yes)
	(can-train transport-ship)
=>
	(train transport-ship))
(defrule
	(goal trainvillager yes)
	(current-age <= castle-age)
(or	(current-age <= feudal-age)
	(goal strategy fast-imp))
(or	(current-age <= dark-age)
	(up-compare-goal strategy-type >= castle-war))
	(up-can-train escrow-state c: villager)
	(building-type-count town-center == 1)
	(up-compare-goal position-self-id != -1)
=>
	(up-full-reset-search)
	(up-set-target-by-id g: position-self-id)
	(up-get-object-data object-data-progress-value temporary-goal4)
	(up-jump-rule 1))
(defrule
	(goal trainvillager yes)
	(up-can-train escrow-state c: villager)
=>
	(enable-timer FDrop ffdrop)
	(up-train escrow-state c: villager)
	(up-jump-rule 1)); end jump
(defrule
	(goal trainvillager yes)
(or	(up-pending-objects c: villager <= 0)
(or	(up-compare-goal temporary-goal4 <= 0); valid when
(or	(up-compare-goal temporary-goal4 >= ffdrop2); relevant
	(building-type-count town-center >= 2))))
	(up-can-train escrow-state c: villager)
=>
	(up-train escrow-state c: villager)
	(enable-timer FDrop 21)); end jump
(defrule
	(goal traincannon yes)
	(goal temporary-goal 1579175)
	(up-can-train 0 c: cannon-galleon-line)
=>
	(up-full-reset-search)
	(up-find-local c: dock c: 240)
	(up-remove-objects search-local object-data-progress-value >= 1)
	(up-remove-objects search-local object-data-under-attack >= 1)
	(up-clean-search search-local object-data-distance search-order-asc)
	(up-remove-objects search-local object-data-index >= 1)
	(up-get-search-state local-total)
	(up-target-point 0 action-train c: cannon-galleon-line)
	(set-goal temporary-goal3 1579177))
(defrule
	(goal traincannon yes)
(nand	(goal temporary-goal3 1579177)
	(up-compare-goal local-total >= 1))
	(can-train cannon-galleon-line)
=>
	(train cannon-galleon-line))
(defrule
	(goal traintrebuchet yes)
	(goal temporary-goal 1579175)
	(up-can-train 0 c: trebuchet)
=>
	(up-full-reset-search)
	(up-find-local c: castle c: 240)
	(up-remove-objects search-local object-data-progress-value >= 1)
	(up-remove-objects search-local object-data-under-attack >= 1)
	(up-clean-search search-local object-data-distance search-order-asc)
	(up-remove-objects search-local object-data-index >= 1)
	(up-get-search-state local-total)
	(up-target-point 0 action-train c: trebuchet)
	(set-goal temporary-goal3 1579178))
(defrule
	(goal traintrebuchet yes)
(nand	(goal temporary-goal3 1579178)
	(up-compare-goal local-total >= 1))
	(can-train trebuchet)
=>
	(train trebuchet))
(defrule
	(goal trainbombard yes)
	(goal temporary-goal 1579175)
	(up-can-train 0 c: bombard-cannon)
=>
	(up-full-reset-search)
	(up-find-local c: siege-workshop c: 240)
	(up-remove-objects search-local object-data-progress-value >= 1)
	(up-remove-objects search-local object-data-under-attack >= 1)
	(up-clean-search search-local object-data-distance search-order-asc)
	(up-remove-objects search-local object-data-index >= 1)
	(up-get-search-state local-total)
	(up-target-point 0 action-train c: bombard-cannon)
	(set-goal temporary-goal3 1579179))
(defrule
	(goal trainbombard yes)
(nand	(goal temporary-goal3 1579179)
	(up-compare-goal local-total >= 1))
	(can-train bombard-cannon)
=>
	(train bombard-cannon))
(defrule
	(goal trainram yes)
	(goal temporary-goal 1579175)
	(up-can-train 0 c: battering-ram-line)
=>
	(up-full-reset-search)
	(up-find-local c: siege-workshop c: 240)
	(up-remove-objects search-local object-data-progress-value >= 1)
	(up-remove-objects search-local object-data-under-attack >= 1)
	(up-clean-search search-local object-data-distance search-order-asc)
	(up-remove-objects search-local object-data-index >= 1)
	(up-get-search-state local-total)
	(up-target-point 0 action-train c: battering-ram-line)
	(set-goal temporary-goal3 1579180))
(defrule
	(goal trainram yes)
(nand	(goal temporary-goal3 1579180)
	(up-compare-goal local-total >= 1))
	(can-train battering-ram-line)
=>
	(train battering-ram-line))
(defrule
	(goal trainpetard yes)
	(goal temporary-goal 1579175)
	(up-can-train 0 c: petard)
=>
	(up-full-reset-search)
	(up-find-local c: castle c: 240)
	(up-remove-objects search-local object-data-progress-value >= 1)
	(up-remove-objects search-local object-data-under-attack >= 1)
	(up-clean-search search-local object-data-distance search-order-asc)
	(up-remove-objects search-local object-data-index >= 1)
	(up-get-search-state local-total)
	(up-target-point 0 action-train c: petard)
	(set-goal temporary-goal3 1579181))
(defrule
	(goal trainpetard yes)
(nand	(goal temporary-goal3 1579181)
	(up-compare-goal local-total >= 1))
	(can-train petard)
=>
	(train petard))
(defrule
	(goal traincart yes)
	(goal siegereq yes);
	(can-train trade-cart)
=>
	(train trade-cart))
(defrule
	(goal traincog yes)
	(goal siegereq yes);
	(can-train trade-cog)
=>
	(train trade-cog))
(defrule
	(civ-selected gothic)
	(goal trainunique yes)
	(goal temporary-goal 1579175)
(or	(up-can-train 0 c: barracks-huskarl)
	(up-can-train 0 c: elite-barracks-huskarl))
=>
	(up-full-reset-search)
	(up-find-local c: barracks c: 240)
	(up-remove-objects search-local object-data-progress-value >= 1)
	(up-remove-objects search-local object-data-under-attack >= 1)
	(up-clean-search search-local object-data-distance search-order-asc)
	(up-remove-objects search-local object-data-index >= 1)
	(up-get-search-state local-total)
	(up-target-point 0 action-train c: barracks-huskarl)
	(up-target-point 0 action-train c: elite-barracks-huskarl)
	(set-goal temporary-goal3 1579182))
(defrule
	(civ-selected gothic)
	(goal trainunique yes)
(nand	(goal temporary-goal3 1579182)
	(up-compare-goal local-total >= 1))
	(goal siegereq yes)
(or	(can-train barracks-huskarl)
	(can-train elite-barracks-huskarl))
=>
	(train barracks-huskarl)
	(train elite-barracks-huskarl))
(defrule
	(civ-selected hun)
	(goal trainunique yes)
	(goal temporary-goal 1579175)
(or	(up-can-train 0 c: stable-tarkan)
	(up-can-train 0 c: elite-stable-tarkan))
=>
	(up-full-reset-search)
	(up-find-local c: stable c: 240)
	(up-remove-objects search-local object-data-progress-value >= 1)
	(up-remove-objects search-local object-data-under-attack >= 1)
	(up-clean-search search-local object-data-distance search-order-asc)
	(up-remove-objects search-local object-data-index >= 1)
	(up-get-search-state local-total)
	(up-target-point 0 action-train c: stable-tarkan)
	(up-target-point 0 action-train c: elite-stable-tarkan)
	(set-goal temporary-goal3 1579183))
(defrule
	(civ-selected hun)
	(goal trainunique yes)
(nand	(goal temporary-goal3 1579183)
	(up-compare-goal local-total >= 1))
	(goal siegereq yes)
(or	(can-train stable-tarkan)
	(can-train elite-stable-tarkan))
=>
	(train stable-tarkan)
	(train elite-stable-tarkan))
(defrule
	(civ-selected bulgarians)
	(goal trainunique yes)
	(goal temporary-goal 1579175)
(or	(up-can-train 0 c: krepost-konnik)
	(up-can-train 0 c: elite-krepost-konnik))
=>
	(up-full-reset-search)
	(up-find-local c: krepost c: 240)
	(up-remove-objects search-local object-data-progress-value >= 1)
	(up-remove-objects search-local object-data-under-attack >= 1)
	(up-clean-search search-local object-data-distance search-order-asc)
	(up-remove-objects search-local object-data-index >= 1)
	(up-get-search-state local-total)
	(up-target-point 0 action-train c: krepost-konnik)
	(up-target-point 0 action-train c: elite-krepost-konnik)
	(set-goal temporary-goal3 1579184))
(defrule
	(civ-selected bulgarians)
	(building-type-count krepost >= 1)
	(goal trainunique yes)
(nand	(goal temporary-goal3 1579184)
	(up-compare-goal local-total >= 1))
	(goal siegereq yes)
(or	(can-train krepost-konnik)
	(can-train elite-krepost-konnik))
=>
	(train krepost-konnik)
	(train elite-krepost-konnik))
(defrule
	(civ-selected sicilians)
	(goal trainunique yes)
	(goal temporary-goal 1579175)
(or	(up-can-train 0 c: donjon-serjeant)
	(up-can-train 0 c: elite-donjon-serjeant))
=>
	(up-full-reset-search)
	(up-find-local c: donjon c: 240)
	(up-remove-objects search-local object-data-progress-value >= 1)
	(up-remove-objects search-local object-data-under-attack >= 1)
	(up-clean-search search-local object-data-distance search-order-asc)
	(up-remove-objects search-local object-data-index >= 1)
	(up-get-search-state local-total)
	(up-target-point 0 action-train c: donjon-serjeant)
	(up-target-point 0 action-train c: elite-donjon-serjeant)
	(set-goal temporary-goal3 1579184))
(defrule
	(civ-selected sicilians)
	(building-type-count donjon >= 1)
	(goal trainunique yes)
(nand	(goal temporary-goal3 1579184)
	(up-compare-goal local-total >= 1))
	(goal siegereq yes)
(or	(can-train donjon-serjeant)
	(can-train elite-donjon-serjeant))
=>
	(train donjon-serjeant)
	(train elite-donjon-serjeant))
(defrule
	(goal trainunique yes)
	(goal temporary-goal 1579175)
	(up-can-train 0 c: my-unique-unit-line)
=>
	(up-full-reset-search)
	(up-find-local c: castle c: 240)
	(up-remove-objects search-local object-data-progress-value >= 1)
	(up-remove-objects search-local object-data-under-attack >= 1)
	(up-clean-search search-local object-data-distance search-order-asc)
	(up-remove-objects search-local object-data-index >= 1)
	(up-get-search-state local-total)
	(up-target-point 0 action-train c: my-unique-unit-line)
	(set-goal temporary-goal3 1579185))
(defrule
	(goal trainunique yes)
(nand	(goal temporary-goal3 1579185)
	(up-compare-goal local-total >= 1))
	(goal siegereq yes)
	(can-train my-unique-unit-line)
=>
	(train my-unique-unit-line))
#load-if-not-defined DIFFICULTY-EASIEST
#load-if-not-defined DIFFICULTY-EASY
(defrule
(nand	(unit-type-count-total monk-set >= 1)
	(and	(up-compare-const wk-game == 1)
		(and	(unit-type-count-total missionary < 4); 2
			(or	(up-research-status c: ri-bloodlines >= research-pending)
				(up-research-status c: ri-husbandry >= research-pending)))))
=>
	(up-jump-rule 2))
(defrule
	(goal trainmonk yes)
	(goal temporary-goal 1579175)
	(up-can-train 0 c: missionary)
=>
	(up-full-reset-search)
	(up-find-local c: monastery c: 240)
	(up-remove-objects search-local object-data-progress-value >= 1)
	(up-remove-objects search-local object-data-under-attack >= 1)
	(up-clean-search search-local object-data-distance search-order-asc)
	(up-remove-objects search-local object-data-index >= 1)
	(up-get-search-state local-total)
	(up-target-point 0 action-train c: missionary)
	(set-goal temporary-goal3 1579186)
	(up-modify-goal trainmonk g:- local-total)
	(up-modify-goal trainmonk c:max 0)
	(up-modify-goal trainmonk c:min 1))
(defrule
	(goal trainmonk yes)
(nand	(goal temporary-goal3 1579186)
	(up-compare-goal local-total >= 1))
	(goal siegereq yes)
	(can-train missionary)
=>
	(train missionary)
	(up-jump-rule 1)); end jump
#end-if
#end-if
(defrule
	(goal trainmonk yes)
	(goal temporary-goal 1579175)
	(up-can-train 0 c: monk)
=>
	(up-full-reset-search)
	(up-find-local c: monastery c: 240)
	(up-remove-objects search-local object-data-progress-value >= 1)
	(up-remove-objects search-local object-data-under-attack >= 1)
	(up-clean-search search-local object-data-distance search-order-asc)
	(up-remove-objects search-local object-data-index >= 1)
	(up-get-search-state local-total)
	(up-target-point 0 action-train c: monk)
	(set-goal temporary-goal3 1579187))
(defrule
	(goal trainmonk yes)
(nand	(goal temporary-goal3 1579187)
	(up-compare-goal local-total >= 1))
	(goal siegereq yes)
	(can-train monk)
=>
	(train monk))
(defrule
	(goal trainfish yes)
	(goal siegereq yes)
	(can-train fishing-ship)
=>
	(train fishing-ship))
(defrule
	(goal trainmangonel yes)
	(goal temporary-goal 1579175)
	(up-can-train 0 c: mangonel-line)
=>
	(up-full-reset-search)
	(up-find-local c: siege-workshop c: 240)
	(up-remove-objects search-local object-data-progress-value >= 1)
	(up-remove-objects search-local object-data-under-attack >= 1)
	(up-clean-search search-local object-data-distance search-order-asc)
	(up-remove-objects search-local object-data-index >= 1)
	(up-get-search-state local-total)
	(up-target-point 0 action-train c: mangonel-line)
	(set-goal temporary-goal3 1579188))
(defrule
	(goal trainmangonel yes)
(nand	(goal temporary-goal3 1579188)
	(up-compare-goal local-total >= 1))
	(goal siegereq yes)
	(can-train mangonel-line)
=>
	(train mangonel-line))
(defrule
	(goal trainscorpion yes)
	(goal temporary-goal 1579175)
	(up-can-train 0 c: scorpion-line)
=>
	(up-full-reset-search)
	(up-find-local c: siege-workshop c: 240)
	(up-remove-objects search-local object-data-progress-value >= 1)
	(up-remove-objects search-local object-data-under-attack >= 1)
	(up-clean-search search-local object-data-distance search-order-asc)
	(up-remove-objects search-local object-data-index >= 1)
	(up-get-search-state local-total)
	(up-target-point 0 action-train c: scorpion-line)
	(set-goal temporary-goal3 1579189))
(defrule
	(goal trainscorpion yes)
(nand	(goal temporary-goal3 1579189)
	(up-compare-goal local-total >= 1))
	(goal siegereq yes)
	(can-train scorpion-line)
=>
	(train scorpion-line))
(defrule
	(goal trainknight yes)
	(goal temporary-goal 1579175)
	(up-can-train 0 c: knight-line)
=>
	(up-full-reset-search)
	(up-find-local c: stable c: 240)
	(up-remove-objects search-local object-data-progress-value >= 1)
	(up-remove-objects search-local object-data-under-attack >= 1)
	(up-clean-search search-local object-data-distance search-order-asc)
	(up-remove-objects search-local object-data-index >= 1)
	(up-get-search-state local-total)
	(up-target-point 0 action-train c: knight-line)
	(set-goal temporary-goal3 1579190))
(defrule
	(goal trainknight yes)
(nand	(goal temporary-goal3 1579190)
	(up-compare-goal local-total >= 1))
	(goal siegereq yes)
	(can-train knight-line)
=>
	(train knight-line))
(defrule
	(goal trainchamp yes)
	(goal temporary-goal 1579175)
	(up-can-train 0 c: militiaman-line)
=>
	(up-full-reset-search)
	(up-find-local c: barracks c: 240)
	(up-remove-objects search-local object-data-progress-value >= 1)
	(up-remove-objects search-local object-data-under-attack >= 1)
	(up-clean-search search-local object-data-distance search-order-asc)
	(up-remove-objects search-local object-data-index >= 1)
	(up-get-search-state local-total)
	(up-target-point 0 action-train c: militiaman-line)
	(set-goal temporary-goal3 1579191))
(defrule
	(goal trainchamp yes)
(nand	(goal temporary-goal3 1579191)
	(up-compare-goal local-total >= 1))
	(goal siegereq yes)
	(can-train militiaman-line)
=>
	(train militiaman-line))
(defrule
	(goal trainhandcannon yes)
	(goal temporary-goal 1579175)
	(up-can-train 0 c: hand-cannoneer)
=>
	(up-full-reset-search)
	(up-find-local c: archery-range c: 240)
	(up-remove-objects search-local object-data-progress-value >= 1)
	(up-remove-objects search-local object-data-under-attack >= 1)
	(up-clean-search search-local object-data-distance search-order-asc)
	(up-remove-objects search-local object-data-index >= 1)
	(up-get-search-state local-total)
	(up-target-point 0 action-train c: hand-cannoneer)
	(set-goal temporary-goal3 1579192))
(defrule
	(goal trainhandcannon yes)
(nand	(goal temporary-goal3 1579192)
	(up-compare-goal local-total >= 1))
	(goal siegereq yes)
	(can-train hand-cannoneer)
=>
	(train hand-cannoneer))
(defrule
	(goal trainarcher yes)
	(goal temporary-goal 1579175)
	(up-can-train 0 c: archer-line)
=>
	(up-full-reset-search)
	(up-find-local c: archery-range c: 240)
	(up-remove-objects search-local object-data-progress-value >= 1)
	(up-remove-objects search-local object-data-under-attack >= 1)
	(up-clean-search search-local object-data-distance search-order-asc)
	(up-remove-objects search-local object-data-index >= 1)
	(up-get-search-state local-total)
	(up-target-point 0 action-train c: archer-line)
	(set-goal temporary-goal3 1579193))
(defrule
	(goal trainarcher yes)
(nand	(goal temporary-goal3 1579193)
	(up-compare-goal local-total >= 1))
	(goal siegereq yes)
	(can-train archer-line)
=>
	(train archer-line))
(defrule
	(goal traincavarcher yes)
	(goal temporary-goal 1579175)
	(up-can-train 0 c: cavalry-archer-line)
=>
	(up-full-reset-search)
	(up-find-local c: archery-range c: 240)
	(up-remove-objects search-local object-data-progress-value >= 1)
	(up-remove-objects search-local object-data-under-attack >= 1)
	(up-clean-search search-local object-data-distance search-order-asc)
	(up-remove-objects search-local object-data-index >= 1)
	(up-get-search-state local-total)
	(up-target-point 0 action-train c: cavalry-archer-line)
	(set-goal temporary-goal3 1579194))
(defrule
	(goal traincavarcher yes)
(nand	(goal temporary-goal3 1579194)
	(up-compare-goal local-total >= 1))
	(goal siegereq yes)
	(can-train cavalry-archer-line)
=>
	(train cavalry-archer-line))
(defrule
	(goal traineagle yes)
	(goal temporary-goal 1579175)
(or	(up-can-train 0 c: eagle-warrior-line)
	(up-can-train 0 c: heavy-eagle-warrior))
=>
	(up-full-reset-search)
	(up-find-local c: barracks c: 240)
	(up-remove-objects search-local object-data-progress-value >= 1)
	(up-remove-objects search-local object-data-under-attack >= 1)
	(up-clean-search search-local object-data-distance search-order-asc)
	(up-remove-objects search-local object-data-index >= 1)
	(up-get-search-state local-total)
	(up-target-point 0 action-train c: eagle-warrior-line)
	(up-target-point 0 action-train c: heavy-eagle-warrior)
	(set-goal temporary-goal3 1579195))
(defrule
	(goal traineagle yes)
(nand	(goal temporary-goal3 1579195)
	(up-compare-goal local-total >= 1))
	(goal siegereq yes)
(or	(can-train eagle-warrior-line)
	(can-train heavy-eagle-warrior))
=>
	(train eagle-warrior-line)
	(train heavy-eagle-warrior))
(defrule
	(goal trainbattle yes)
	(goal temporary-goal 1579175)
(or	(up-can-train 0 c: battle-elephant)
	(up-can-train 0 c: elite-battle-elephant))
=>
	(up-full-reset-search)
	(up-find-local c: stable c: 240)
	(up-remove-objects search-local object-data-progress-value >= 1)
	(up-remove-objects search-local object-data-under-attack >= 1)
	(up-clean-search search-local object-data-distance search-order-asc)
	(up-remove-objects search-local object-data-index >= 1)
	(up-get-search-state local-total)
	(up-target-point 0 action-train c: battle-elephant)
	(up-target-point 0 action-train c: elite-battle-elephant)
	(set-goal temporary-goal3 1579196))
(defrule
	(goal trainbattle yes)
(nand	(goal temporary-goal3 1579196)
	(up-compare-goal local-total >= 1))
	(goal siegereq yes)
(or	(can-train battle-elephant)
	(can-train elite-battle-elephant))
=>
	(train battle-elephant)
	(train elite-battle-elephant))
(defrule
	(goal trainslinger yes)
	(goal temporary-goal 1579175)
	(up-can-train 0 c: slinger)
=>
	(up-full-reset-search)
	(up-find-local c: archery-range c: 240)
	(up-remove-objects search-local object-data-progress-value >= 1)
	(up-remove-objects search-local object-data-under-attack >= 1)
	(up-clean-search search-local object-data-distance search-order-asc)
	(up-remove-objects search-local object-data-index >= 1)
	(up-get-search-state local-total)
	(up-target-point 0 action-train c: slinger)
	(set-goal temporary-goal3 1579197))
(defrule
	(goal trainslinger yes)
(nand	(goal temporary-goal3 1579197)
	(up-compare-goal local-total >= 1))
	(goal siegereq yes)
	(can-train slinger)
=>
	(train slinger))
(defrule
	(goal trainpike yes)
	(goal temporary-goal 1579175)
	(up-can-train 0 c: spearman-line)
=>
	(up-full-reset-search)
	(up-find-local c: barracks c: 240)
	(up-remove-objects search-local object-data-progress-value >= 1)
	(up-remove-objects search-local object-data-under-attack >= 1)
	(up-clean-search search-local object-data-distance search-order-asc)
	(up-remove-objects search-local object-data-index >= 1)
	(up-get-search-state local-total)
	(up-target-point 0 action-train c: spearman-line)
	(set-goal temporary-goal3 1579198))
(defrule
	(goal trainpike yes)
(nand	(goal temporary-goal3 1579198)
	(up-compare-goal local-total >= 1))
	(goal siegereq yes)
	(can-train spearman-line)
=>
	(train spearman-line))
(defrule
	(goal trainflemish yes)
	(goal siegereq yes)
	(can-train flemish-militia)
=>
	(train flemish-militia))
(defrule
	(goal traincondottiero yes)
	(goal temporary-goal 1579175)
	(up-can-train 0 c: condottiero)
=>
	(up-full-reset-search)
	(up-find-local c: barracks c: 240)
	(up-remove-objects search-local object-data-progress-value >= 1)
	(up-remove-objects search-local object-data-under-attack >= 1)
	(up-clean-search search-local object-data-distance search-order-asc)
	(up-remove-objects search-local object-data-index >= 1)
	(up-get-search-state local-total)
	(up-target-point 0 action-train c: condottiero)
	(set-goal temporary-goal3 1579199))
(defrule
	(goal traincondottiero yes)
(nand	(goal temporary-goal3 1579199)
	(up-compare-goal local-total >= 1))
	(goal siegereq yes)
	(can-train condottiero)
=>
	(train condottiero))
(defrule
	(goal traincamel yes)
	(goal temporary-goal 1579175)
(or	(up-can-train 0 c: camel-line)
	(up-can-train 0 c: imperial-camel))
=>
	(up-full-reset-search)
	(up-find-local c: stable c: 240)
	(up-remove-objects search-local object-data-progress-value >= 1)
	(up-remove-objects search-local object-data-under-attack >= 1)
	(up-clean-search search-local object-data-distance search-order-asc)
	(up-remove-objects search-local object-data-index >= 1)
	(up-get-search-state local-total)
	(up-target-point 0 action-train c: camel-line)
	(up-target-point 0 action-train c: imperial-camel)
	(set-goal temporary-goal3 1579200))
(defrule
	(goal traincamel yes)
(nand	(goal temporary-goal3 1579200)
	(up-compare-goal local-total >= 1))
	(goal siegereq yes)
(or	(can-train camel-line)
	(can-train imperial-camel))
=>
	(train camel-line)
	(train imperial-camel))
(defrule
	(goal trainskirm yes)
	(goal temporary-goal 1579175)
(or	(up-can-train 0 c: skirmisher-line)
	(up-can-train 0 c: imperial-skirmisher))
=>
	(up-full-reset-search)
	(up-find-local c: archery-range c: 240)
	(up-remove-objects search-local object-data-progress-value >= 1)
	(up-remove-objects search-local object-data-under-attack >= 1)
	(up-clean-search search-local object-data-distance search-order-asc)
	(up-remove-objects search-local object-data-index >= 1)
	(up-get-search-state local-total)
	(up-target-point 0 action-train c: skirmisher-line)
	(up-target-point 0 action-train c: imperial-skirmisher)
	(set-goal temporary-goal3 1579201))
(defrule
	(goal trainskirm yes)
(nand	(goal temporary-goal3 1579201)
	(up-compare-goal local-total >= 1))
	(goal siegereq yes)
(or	(can-train skirmisher-line)
	(can-train imperial-skirmisher))
=>
	(train skirmisher-line)
	(train imperial-skirmisher))
(defrule
	(goal traingenitour yes)
	(goal temporary-goal 1579175)
	(up-can-train 0 c: genitour-placeholder)
=>
	(up-full-reset-search)
	(up-find-local c: archery-range c: 240)
	(up-remove-objects search-local object-data-progress-value >= 1)
	(up-remove-objects search-local object-data-under-attack >= 1)
	(up-clean-search search-local object-data-distance search-order-asc)
	(up-remove-objects search-local object-data-index >= 1)
	(up-get-search-state local-total)
	(up-target-point 0 action-train c: genitour-placeholder)
	(set-goal temporary-goal3 1579201))
(defrule
	(goal traingenitour yes)
(nand	(goal temporary-goal3 1579202)
	(up-compare-goal local-total >= 1))
	(goal siegereq yes)
	(can-train genitour-placeholder)
=>
	(train genitour-placeholder))
(defrule
	(goal trainsteppe yes)
	(goal temporary-goal 1579175)
	(up-can-train 0 c: steppe-lancer-line)
=>
	(up-full-reset-search)
	(up-find-local c: stable c: 240)
	(up-remove-objects search-local object-data-progress-value >= 1)
	(up-remove-objects search-local object-data-under-attack >= 1)
	(up-clean-search search-local object-data-distance search-order-asc)
	(up-remove-objects search-local object-data-index >= 1)
	(up-get-search-state local-total)
	(up-target-point 0 action-train c: steppe-lancer-line)
	(set-goal temporary-goal3 1579203))
(defrule
	(goal trainsteppe yes)
(nand	(goal temporary-goal3 1579203)
	(up-compare-goal local-total >= 1))
	(goal siegereq yes)
	(can-train steppe-lancer-line)
=>
	(train steppe-lancer-line))
(defrule
	(goal trainhussar yes)
	(goal temporary-goal 1579175)
	(up-can-train 0 c: scout-cavalry-line)
=>
	(up-full-reset-search)
	(up-find-local c: stable c: 240)
	(up-remove-objects search-local object-data-progress-value >= 1)
	(up-remove-objects search-local object-data-under-attack >= 1)
	(up-clean-search search-local object-data-distance search-order-asc)
	(up-remove-objects search-local object-data-index >= 1)
	(up-get-search-state local-total)
	(up-target-point 0 action-train c: scout-cavalry-line)
	(set-goal temporary-goal3 1579204))
(defrule
	(goal trainhussar yes)
(nand	(goal temporary-goal3 1579204)
	(up-compare-goal local-total >= 1))
	(goal siegereq yes)
	(can-train scout-cavalry-line)
=>
	(train scout-cavalry-line))
(defrule
	(goal traindemo yes)
	(goal temporary-goal 1579175)
	(up-can-train 0 c: demolition-ship-line)
=>
	(up-full-reset-search)
	(up-find-local c: dock c: 240)
	(up-remove-objects search-local object-data-progress-value >= 1)
;	(up-remove-objects search-local object-data-under-attack >= 1)
	(up-clean-search search-local object-data-distance search-order-asc)
	(up-remove-objects search-local object-data-index >= 1)
	(up-get-search-state local-total)
	(up-target-point 0 action-train c: demolition-ship-line)
	(set-goal temporary-goal3 1579205))
(defrule
	(goal traindemo yes)
(nand	(goal temporary-goal3 1579205)
	(up-compare-goal local-total >= 1))
	(goal siegereq yes)
	(can-train demolition-ship-line)
=>
	(train demolition-ship-line))
(defrule
	(goal trainturtle yes)
	(goal temporary-goal 1579175)
	(up-can-train 0 c: turtle-ship-line)
=>
	(up-full-reset-search)
	(up-find-local c: dock c: 240)
	(up-remove-objects search-local object-data-progress-value >= 1)
	(up-remove-objects search-local object-data-under-attack >= 1)
	(up-clean-search search-local object-data-distance search-order-asc)
	(up-remove-objects search-local object-data-index >= 1)
	(up-get-search-state local-total)
	(up-target-point 0 action-train c: turtle-ship-line)
	(set-goal temporary-goal3 1579206))
(defrule
	(goal trainturtle yes)
(nand	(goal temporary-goal3 1579206)
	(up-compare-goal local-total >= 1))
(or	(goal siegereq yes)
	(unit-type-count-total cannon-galleon-line >= 4))
	(can-train turtle-ship-line)
=>
	(train turtle-ship-line))
(defrule
	(goal trainlongboat yes)
	(goal temporary-goal 1579175)
	(up-can-train 0 c: longboat-line)
=>
	(up-full-reset-search)
	(up-find-local c: dock c: 240)
	(up-remove-objects search-local object-data-progress-value >= 1)
	(up-remove-objects search-local object-data-under-attack >= 1)
	(up-clean-search search-local object-data-distance search-order-asc)
	(up-remove-objects search-local object-data-index >= 1)
	(up-get-search-state local-total)
	(up-target-point 0 action-train c: longboat-line)
	(set-goal temporary-goal3 1579207))
(defrule
	(goal trainlongboat yes)
(nand	(goal temporary-goal3 1579207)
	(up-compare-goal local-total >= 1))
(or	(goal siegereq yes)
	(unit-type-count-total cannon-galleon-line >= 4))
	(can-train longboat-line)
=>
	(train longboat-line))
(defrule
	(goal traincaravel yes)
	(goal temporary-goal 1579175)
(or	(up-can-train 0 c: caravel)
	(up-can-train 0 c: elite-caravel))
=>
	(up-full-reset-search)
	(up-find-local c: dock c: 240)
	(up-remove-objects search-local object-data-progress-value >= 1)
	(up-remove-objects search-local object-data-under-attack >= 1)
	(up-clean-search search-local object-data-distance search-order-asc)
	(up-remove-objects search-local object-data-index >= 1)
	(up-get-search-state local-total)
	(up-target-point 0 action-train c: caravel)
	(up-target-point 0 action-train c: elite-caravel)
	(set-goal temporary-goal3 1579208))
(defrule
	(goal traincaravel yes)
(nand	(goal temporary-goal3 1579208)
	(up-compare-goal local-total >= 1))
(or	(goal siegereq yes)
	(unit-type-count-total cannon-galleon-line >= 4))
(or	(can-train caravel)
	(can-train elite-caravel))
=>
	(train caravel)
	(train elite-caravel))
(defrule
	(goal trainfire yes)
	(goal temporary-goal 1579175)
	(up-can-train 0 c: fire-ship-line)
=>
	(up-full-reset-search)
	(up-find-local c: dock c: 240)
	(up-remove-objects search-local object-data-progress-value >= 1)
	(up-remove-objects search-local object-data-under-attack >= 1)
	(up-clean-search search-local object-data-distance search-order-asc)
	(up-remove-objects search-local object-data-index >= 1)
	(up-get-search-state local-total)
	(up-target-point 0 action-train c: fire-ship-line)
	(set-goal temporary-goal3 1579209))
(defrule
	(goal trainfire yes)
(nand	(goal temporary-goal3 1579209)
	(up-compare-goal local-total >= 1))
	(goal siegereq yes)
	(can-train fire-ship-line)
=>
	(train fire-ship-line))
(defrule
	(goal traingalley yes)
	(goal temporary-goal 1579175)
	(up-can-train 0 c: galley-line)
=>
	(up-full-reset-search)
	(up-find-local c: dock c: 240)
	(up-remove-objects search-local object-data-progress-value >= 1)
	(up-remove-objects search-local object-data-under-attack >= 1)
	(up-clean-search search-local object-data-distance search-order-asc)
	(up-remove-objects search-local object-data-index >= 1)
	(up-get-search-state local-total)
	(up-target-point 0 action-train c: galley-line)
	(set-goal temporary-goal3 1579210))
(defrule
	(goal traingalley yes)
(nand	(goal temporary-goal3 1579210)
	(up-compare-goal local-total >= 1))
(or	(goal siegereq yes)
	(unit-type-count-total cannon-galleon-line >= 4))
	(can-train galley-line)
=>
	(train galley-line))


#load-if-not-defined DIFFICULTY-EASIEST
#load-if-not-defined DIFFICULTY-EASY
#load-if-not-defined DIFFICULTY-MODERATE
#load-if-defined POST-IMPERIAL-AGE-START
(defrule
(or	(game-time >= 600)
(or	(up-compare-const dm-game != 1)
(or	(up-compare-const migration-style == 1)
(or	(up-compare-goal excessWood < 1600)
(or	(up-compare-goal excessFood < 1600)
	(up-compare-goal excessGold < 1600))))))
=>
	(up-jump-rule 2))
(defrule
(or	(up-compare-const inf-game == yes)
(or	(and	(game-time < 240)
		(strategic-number sn-military-superiority < 3))
	(and	(game-time < 360)
		(strategic-number sn-military-superiority < 1))))
	(can-train dm-unit)
=>
	(train dm-unit))
(defrule
	(goal fleet yes)
	(up-compare-goal navycount g:< maxnavy)
(or	(goal siegereq yes)
	(unit-type-count-total cannon-galleon-line >= 4))
(or	(up-compare-const inf-game == yes)
(or	(and	(game-time < 240)
		(strategic-number sn-military-superiority < 3))
	(and	(game-time < 360)
		(strategic-number sn-military-superiority < 1))))
	(can-train dmw-unit)
=>
	(train dmw-unit)); end jump
#end-if
#end-if
#end-if
#end-if
(defrule
	(up-compare-goal temporary-goal8 != 1473960292)
	(up-compare-goal temporary-goal8 != 1473960293)
	(goal siegereq yes)
(or	(can-train 1259)
	(can-train mercenary-kipchak))
=>
	(train 1259)
	(train mercenary-kipchak))
(defrule
	(can-train xolotl-warrior)
=>
	(train xolotl-warrior)
	(disable-self))
	
;Special rule for 1v1 michi (or stubbon ally)
#load-if-defined UP-MICHI-STYLE
#load-if-not-defined INFINITE-RESOURCE-START
#load-if-not-defined DIFFICULTY-EASIEST
#load-if-not-defined POPULATION-CAP-25
#load-if-defined COMMENT-OUT ;this won't work until weird-gaia-market is added to the active object list in AI engine
(defrule
(building-type-count-total town-center > 2)
(unit-type-count-total villager > 50)
(population < 185)
(building-type-count-total market > 0)
(players-building-type-count every-ally market < 1)
(cc-players-building-type-count 0 weird-gaia-market > 0)
(game-time > 1000)
(unit-type-count-total trade-cart < ten-pop)
(can-train trade-cart)
=>
(train trade-cart) ;I suspect promi manually disables trading if 1v1 elsewhere, so just train normally rather than go through promi's training system
(chat-to-player my-player-number "Debug: train trade carts in 1v1")
)
#end-if
#end-if
#end-if
#end-if
#end-if

#load-if-defined UP-MICHI-STYLE

(defrule
	(or(up-research-status c: imperial-age == research-pending)
	(up-research-status c: ri-onager >= research-pending))
	(up-compare-goal mangonel-set < 2)
=>
	(set-goal trainmangonel yes)) ;this still ends up sometimes prioritising rams/scorpions, so I train manually as well

(defrule
	(or(up-research-status c: imperial-age == research-pending)
	(up-research-status c: ri-onager >= research-pending))
	(up-compare-goal mangonel-set < 2)
	(game-time < 3000)
=>
	(train mangonel-line)
)
;last backup rule
(defrule
	(can-train-with-escrow mangonel-line)
	(up-research-status c: imperial-age >= research-pending)
=>
	(release-escrow wood)
	(release-escrow gold)
	(train mangonel-line)
	(disable-self)
	)
#end-if

#load-if-defined ARENA-MAP

(defrule
	(research-completed ri-onager)
	(strategic-number sn-corner-cut-state < 5)
	(unit-type-count-total mangonel-line < 2)
	(unit-type-count-total trade-cart > 1)
=>
	(train mangonel-line)
)

#end-if

(defrule
	(can-train free-transport-ship)
	(or(unit-type-count-total free-transport-ship < 1)
	(unit-type-count-total transport-ship < 1))
=>
	(train free-transport-ship)
)

(defrule
	(players-building-type-count every-enemy dock < 1)
	(unit-type-count transport-ship > 0)
	(current-age == dark-age)
	(up-compare-const migration-style != 1)
	(unit-type-count-total villager > 15)
=>
	(up-full-reset-search)
	(up-find-local c: transport-ship c: 1)
	(up-set-target-object search-local c: 0)
	(up-get-point position-object temporary-point-x)
	(up-get-point position-center point-x)
	(up-lerp-percent temporary-point-x point-x c: 175)
	(up-target-point temporary-point-x action-move -1 -1)
	(disable-self)
)