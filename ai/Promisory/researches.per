;=============================================================
;
; Age advancement
;
;=============================================================
(defrule
	(research-available feudal-age)
	(building-type-count town-center == 1)
=>
	(up-full-reset-search)
	(up-set-target-by-id g: position-self-id)
	(up-get-object-data object-data-id temporary-goal)
	(up-get-object-data object-data-progress-value temporary-goal2))
(defrule
	(up-compare-goal temporary-goal <= 1)
	(up-compare-goal temporary-goal2 <= 42)
	(research-available feudal-age)
	(up-compare-goal total-food-amount >= 2200)
	(building-type-count town-center == 1)
=>
	(chat-local-to-self "Resetting town-center.")
	(set-goal trainvillager no)
	(up-reset-building 1 c: town-center))
#load-if-not-defined DIFFICULTY-MODERATE
#load-if-not-defined DIFFICULTY-HARD
#load-if-not-defined DIFFICULTY-HARDEST
#load-if-not-defined DIFFICULTY-EXTREME
(defrule
	(player-in-game any-human)
	(players-current-age every-enemy <= dark-age)
	(players-current-age every-ally <= dark-age)
(or	(difficulty != moderate)
	(up-compare-goal enemyState <= dark))
=>
	(up-jump-rule 4))
#end-if
#end-if
#end-if
#end-if
(defrule
	(goal strategy fast-imp)
	(unit-type-count-total villager < fi-vills)
=>
	(up-jump-rule 2))
(defrule
(or	(up-compare-goal total-food-amount >= 1200); 990 ; (food-amount >= 700); 720
(or	(unit-type-count-total villager >= darkvills)
	(and	(goal position-goal flank)
		(players-current-age focus-player >= feudal-age))))
	(can-research feudal-age)
=>
	;(chat-to-player every-ally text-advancing-feudal); "I am advancing to the Feudal Age."
	(chat-to-player my-player-number text-advancing-feudal); "I am advancing to the Feudal Age."
	(set-strategic-number sn-enable-boar-hunting 1)
	(research feudal-age)
	(set-strategic-number sn-current-age dfeudal)
	(up-modify-sn sn-maximum-town-size c:min 12)
	(up-jump-rule 2))
(defrule
(or	(and	(up-compare-goal total-food-amount >= 990); 780 ; (food-amount >= 650)
		(up-compare-goal custom-civ-pop >= 30))
(or	(goal strategy sling)
	(up-compare-goal strategy-type == feudal-war)))
	(can-research feudal-age)
=>
	;(chat-to-player every-ally text-advancing-feudal); "I am advancing to the Feudal Age."
	(chat-to-player my-player-number text-advancing-feudal); "I am advancing to the Feudal Age."
	(set-strategic-number sn-enable-boar-hunting 1)
	(research feudal-age)
	(set-strategic-number sn-current-age dfeudal)
	(up-modify-sn sn-maximum-town-size c:min 12)
	(up-jump-rule 1)); end jump
(defrule
	(up-compare-goal trainvillager != yes)
(or	(up-pending-objects c: villager <= 0)
	(and	(up-pending-objects c: villager <= 1)
		(and	(up-timer-status FDrop != timer-running)
			(up-compare-goal temporary-goal2 >= 92))))
	(can-research feudal-age)
=>
	;(chat-to-player every-ally text-advancing-feudal); "I am advancing to the Feudal Age."
	(chat-to-player my-player-number text-advancing-feudal); "I am advancing to the Feudal Age."
	(set-strategic-number sn-enable-boar-hunting 1)
	(research feudal-age)
	(set-strategic-number sn-current-age dfeudal)
	(up-modify-sn sn-maximum-town-size c:min 12)); end jumps
;=============================================================
#load-if-not-defined DIFFICULTY-MODERATE
#load-if-not-defined DIFFICULTY-HARD
#load-if-not-defined DIFFICULTY-HARDEST
#load-if-not-defined DIFFICULTY-EXTREME
(defrule
	(player-in-game any-human)
	(players-current-age every-enemy <= feudal-age)
	(players-current-age every-ally <= feudal-age)
=>
	(up-jump-rule 1))
#end-if
#end-if
#end-if
#end-if
(defrule
	(can-research castle-age)
=>
	(research castle-age)
	;(chat-to-player every-ally text-advancing-castle); "I am advancing to the Castle Age."
	(chat-to-player my-player-number text-advancing-castle); "I am advancing to the Castle Age."
	(set-strategic-number sn-current-age fcastlea)
	(up-modify-sn sn-maximum-town-size c:min 14)); end jump
;=============================================================
#load-if-not-defined DIFFICULTY-MODERATE
#load-if-not-defined DIFFICULTY-HARD
#load-if-not-defined DIFFICULTY-HARDEST
#load-if-not-defined DIFFICULTY-EXTREME
(defrule
	(player-in-game any-human)
	(players-current-age every-enemy <= castle-age)
	(players-current-age every-ally <= castle-age)
=>
	(up-jump-rule 1))
#end-if
#end-if
#end-if
#end-if
(defrule
	(can-research imperial-age)
=>
	(research imperial-age)
	;(chat-to-player every-ally text-advancing-imperial); "I am advancing to the Imperial Age."
	(chat-to-player my-player-number text-advancing-imperial); "I am advancing to the Imperial Age."
	(set-strategic-number sn-current-age imperial)
	(up-modify-sn sn-maximum-town-size c:min 18)); end jump
;=============================================================
; Unique upgrades
;=============================================================
#load-if-not-defined AZTEC-CIV
#load-if-not-defined BOHEMIANS-CIV
#load-if-not-defined BURGUNDIANS-CIV
#load-if-not-defined BURMESE-CIV
#load-if-not-defined BULGARIANS-CIV
#load-if-not-defined CELTIC-CIV
#load-if-not-defined CUMANS-CIV
#load-if-not-defined ETHIOPIAN-CIV
#load-if-not-defined FRANKISH-CIV
#load-if-not-defined GOTHIC-CIV
#load-if-not-defined HUN-CIV
#load-if-not-defined INCAN-CIV
#load-if-not-defined INDIAN-CIV
#load-if-not-defined JAPANESE-CIV
#load-if-not-defined KHMER-CIV
#load-if-not-defined LITHUANIANS-CIV
#load-if-not-defined MALAY-CIV
#load-if-not-defined MALIAN-CIV
#load-if-not-defined PERSIAN-CIV
#load-if-not-defined POLES-CIV
#load-if-not-defined SARACEN-CIV
#load-if-not-defined SPANISH-CIV
#load-if-not-defined TATARS-CIV
#load-if-not-defined TEUTONIC-CIV ; Byzantines, Turks, Britons, Chinese, Mayas, Mongols, Koreans,
#load-if-not-defined VIKING-CIV ; Magyars, Italians, Berbers, Portuguese, Slavs, Vietnamese, Sicilians
(defrule
	(up-compare-goal uugoal != yes)
=>
	(set-goal uugoal yes))
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
(defrule
;(or	(up-compare-goal tradeunits >= 25)
(or	(unit-type-count-total my-unique-unit-line >= 5)
;(or
	(unit-type-count-total huskarl-set >= 5)
;(or	(up-compare-goal excessGold >= 2900)
;	(and	(population >= up-max-civ)
;		(up-compare-goal excessGold >= 1900)))))
)
	(up-compare-goal uugoal != yes)
=>
	(set-goal uugoal yes))
(defrule
(or	(unit-type-count-total genoese-crossbowman >= 5)
(or	(unit-type-count-total kamayuk >= 5)
(or	(unit-type-count-total magyar-huszar >= 5)
(or	(unit-type-count-total elephant-archer >= 5)
(or	(unit-type-count-total boyar >= 5)
(or	(unit-type-count-total organ-gun >= 5)
	(unit-type-count-total gbeto >= 5)))))))
	(up-compare-goal uugoal != yes)
=>
	(set-goal uugoal yes))
(defrule
(or	(unit-type-count-total shotel-warrior >= 5)
(or	(unit-type-count-total camel-archer >= 5)
(or	(unit-type-count-total rattan-archer >= 5)
(or	(unit-type-count-total ballista-elephant >= 5)
(or	(unit-type-count-total arambai >= 5)
	(unit-type-count-total karambit-warrior >= 5))))))
	(up-compare-goal uugoal != yes)
=>
	(set-goal uugoal yes))
(defrule
	(goal trainunique yes)
	(up-research-status c: my-unique-unit-upgrade >= research-pending)
	(up-compare-goal uugoal != yes)
=>
	(set-goal uugoal yes))

(defrule
(or	(goal uugoal yes)
(or	(unit-type-count-total my-unique-unit-line >= 4)
(or	(unit-type-count-total huskarl-set >= 4)
	(up-compare-goal excessGold >= 2900)))); 3600
	(can-research my-unique-unit-upgrade)
=>
	(research my-unique-unit-upgrade))
(defrule
	(up-compare-goal excessGold >= 2500)
(or	(population >= max-civ-pop)
(or	(population >= 192)
(or	(up-compare-goal relic-count >= 3); 4
(or	(up-compare-goal tradeunits >= 30); 40
(or	(up-compare-goal tradeunits >= maxcartspop)
	(up-compare-goal tradeunits >= maxcartssize))))))
	(can-research my-unique-unit-upgrade)
=>
	(research my-unique-unit-upgrade))


#load-if-not-defined BOHEMIANS-CIV
#load-if-not-defined POLES-CIV

#load-if-not-defined SICILIANS-CIV
#load-if-not-defined BURGUNDIANS-CIV

;#load-if-not-defined INCAN-CIV
#load-if-not-defined INDIAN-CIV
#load-if-not-defined ITALIAN-CIV;
#load-if-not-defined MAGYAR-CIV;
#load-if-not-defined SLAVIC-CIV

;#load-if-not-defined PORTUGUESE-CIV
#load-if-not-defined ETHIOPIAN-CIV
#load-if-not-defined MALIAN-CIV
;#load-if-not-defined BERBERS-CIV
;#load-if-not-defined KHMER-CIV
#load-if-not-defined MALAY-CIV
#load-if-not-defined BURMESE-CIV
#load-if-not-defined VIETNAMESE-CIV

#load-if-not-defined BULGARIANS-CIV
#load-if-not-defined CUMANS-CIV
#load-if-not-defined LITHUANIANS-CIV
#load-if-not-defined TATARS-CIV

#load-if-not-defined AZTEC-CIV
;#load-if-not-defined BRITON-CIV
;#load-if-not-defined BYZANTINE-CIV
#load-if-not-defined CELTIC-CIV
;#load-if-not-defined CHINESE-CIV
;#load-if-not-defined FRANKISH-CIV
#load-if-not-defined GOTHIC-CIV
#load-if-not-defined HUN-CIV
#load-if-not-defined JAPANESE-CIV
#load-if-not-defined KOREAN-CIV
#load-if-not-defined MAYAN-CIV
#load-if-not-defined MONGOL-CIV
;#load-if-not-defined PERSIAN-CIV
;#load-if-not-defined SARACEN-CIV
#load-if-not-defined SPANISH-CIV
#load-if-not-defined TEUTONIC-CIV
#load-if-not-defined TURKISH-CIV ; Aztecs, Britons, Byzantines, Chinese, Franks, Persians, Saracens, Vikings
;#load-if-not-defined VIKING-CIV ; Berbers, Khmer, Portuguese, Incans
;(defrule
;	(goal uugoal yes)
;(or	(and	(up-compare-const uu-type == cavalry-uu)
;		(up-research-status c: ri-plate-barding == research-available))
;(or	(and	(up-compare-const uu-type == infantry-uu)
;		(up-research-status c: ri-plate-mail == research-available))
;(or	(and	(up-compare-const uu-type == archer-uu)
;		(up-research-status c: ri-bracer == research-available))
;	(and	(up-compare-const uu-type == powder-uu)
;		(up-research-status c: ri-ring-archer-armor == research-available)))))
;=>
;	(up-jump-rule 1))
(defrule
	(up-compare-goal urgoal != yes)
	(up-research-status c: my-unique-unit-upgrade >= research-pending)
(or	(unit-type-count-total my-unique-unit-line >= 10)
	(and	(civ-selected gothic)
		(unit-type-count-total huskarl-set >= 10)))
	(goal underattack no)
=>
	(set-goal urgoal yes))
;#end-if
;#end-if
;#end-if
;#end-if
;#end-if
;#end-if
;#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if

#end-if
#end-if
#end-if
#end-if

#end-if
#end-if
#end-if
;#end-if
;#end-if
#end-if
#end-if
;#end-if

#end-if;
#end-if
#end-if;
#end-if
;#end-if

#end-if
#end-if

#end-if
#end-if


#load-if-not-defined BOHEMIANS-CIV
#load-if-not-defined POLES-CIV
#load-if-not-defined SICILIANS-CIV
#load-if-not-defined BURGUNDIANS-CIV
#load-if-not-defined VIETNAMESE-CIV
#load-if-not-defined TATARS-CIV
#load-if-not-defined SLAVIC-CIV
#load-if-not-defined PORTUGUESE-CIV
#load-if-not-defined MALIAN-CIV
#load-if-not-defined MALAY-CIV
#load-if-not-defined MAGYAR-CIV
#load-if-not-defined LITHUANIANS-CIV
#load-if-not-defined KHMER-CIV
#load-if-not-defined ITALIAN-CIV
#load-if-not-defined INDIAN-CIV
#load-if-not-defined INCAN-CIV
#load-if-not-defined ETHIOPIAN-CIV
#load-if-not-defined BURMESE-CIV
#load-if-not-defined BULGARIANS-CIV
#load-if-not-defined BERBERS-CIV
#load-if-not-defined PERSIAN-CIV
#load-if-not-defined JAPANESE-CIV
#load-if-not-defined BYZANTINE-CIV
#load-if-not-defined CUMANS-CIV
#load-if-not-defined BRITON-CIV
#load-if-not-defined CHINESE-CIV
#load-if-not-defined SPANISH-CIV
#load-if-not-defined VIKING-CIV
#load-if-not-defined SARACEN-CIV
#load-if-not-defined FRANKISH-CIV
#load-if-not-defined TURKISH-CIV
#load-if-not-defined MONGOL-CIV
#load-if-not-defined AZTEC-CIV
#load-if-not-defined TEUTONIC-CIV
#load-if-not-defined MAYAN-CIV
#load-if-not-defined KOREAN-CIV
#load-if-not-defined CELTIC-CIV
#load-if-not-defined HUN-CIV
#load-if-not-defined GOTHIC-CIV
(defrule
	(up-research-status c: my-unique-unit-upgrade >= research-pending)
	(can-research my-unique-research)
=>
	(research my-unique-research)
	(set-goal researchplan yes))
#else; Goths
(defrule
	(up-compare-goal uugoal != yes)
(or	(and	(strategic-number archers >= 15)
		(strategic-number gunpowder < 15))
	(and	(current-age >= imperial-age)
		(and	(building-type-count-total castle >= 1)
			(up-compare-goal champgoal != yes))))
	(strategic-number sn-current-age >= imperial)
=>
	(set-goal uugoal yes)
	(disable-self))
(defrule
	(up-compare-goal uugoal != yes)
(or	(players-civ focus-player mayan)
	(players-civ target-player mayan))
	(strategic-number sn-current-age >= imperial)
=>
	(set-goal uugoal yes)
	(disable-self))
(defrule
(or	(unit-type-count-total huskarl-set >= 1)
(or	(up-research-status c: my-unique-unit-upgrade >= research-pending)
	(goal uugoal yes)))
(or	(up-compare-goal strategy-type <= castle-war)
	(strategic-number sn-current-age >= imperial))
(or	(gold-amount >= 650); 850
(or	(goal uugoal yes)
	(goal trainunique yes)))
;	(nand	(up-research-status c: ri-champion >= research-pending)
;		(up-research-status c: ri-perfusion < research-pending)))
	(can-research ri-anarchy)
=>
	(research ri-anarchy))
(defrule
(or	(unit-type-count-total infantry-class >= 21); 1
(or	(up-research-status c: ri-champion >= research-pending)
(or	(goal champgoal yes)
(or	(and	(goal uugoal yes)
		(up-research-status c: my-unique-research >= research-pending))
	(goal researchplan yes)))))
	(can-research ri-perfusion)
=>
	(research ri-perfusion)
	(set-goal researchplan yes))
(defrule
	(up-compare-goal urgoal != yes)
(or	(goal champgoal yes)
	(goal uugoal yes))
	(food-amount >= 6000)
	(gold-amount >= 2600)
	(goal underattack no)
=>
	(set-goal urgoal yes))
#end-if
#else; Huns
#load-if-defined VICTORY-STANDARD
(defrule
	(up-research-status c: ri-paladin >= research-pending)
	(players-building-type-count any-enemy wonder >= 1)
	(building-type-count-total wonder <= 0)
	(players-building-type-count every-ally wonder <= 0)
	(can-research my-unique-research)
=>
	(research my-unique-research)
	(set-goal researchplan yes))
(defrule
	(up-compare-goal urgoal != yes)
	(game-time > 8)
	(up-compare-goal victory-time >= 0)
	(up-compare-goal victory-time <= 750)
(not	(hold-relics))
	(building-type-count wonder <= 0)
	(players-building-type-count every-ally wonder <= 0)
(or	(players-building-type-count any-enemy wonder >= 1)
	(enemy-captured-relics))
	(goal underattack no)
=>
	(set-goal urgoal yes))
#else
(defrule
(or	(enemy-captured-relics)
	(and	(goal researchplan yes)
		(population >= max-pop)))
	(can-research my-unique-research)
=>
	(research my-unique-research))
(defrule
	(up-research-status c: ri-paladin >= research-pending)
	(goal researchplan no)
=>
	(set-goal researchplan yes)
	(disable-self))
#end-if
(defrule
	(up-research-status c: my-unique-unit-upgrade >= research-pending)
(or	(goal uugoal yes)
(or	(goal trainunique yes)
(or	(unit-type-count-total my-unique-unit-line >= 4)
	(unit-type-count-total tarkan-line >= 4))))
	(can-research ri-marauders)
=>
	(research ri-marauders))
#end-if
#else ; Celts
(defrule
	(strategic-number sn-current-age >= imperial)
(or	(up-research-status c: imperial-age >= research-pending);	(current-age >= imperial-age)
(or	(strategic-number archers < 25); 25
(or	(strategic-number cavalry >= 10); 15
(or	(strategic-number eagles >= 10); 15
	(strategic-number husks >= 10))))); 15
;	(goal escrowing no)
;(or	(up-compare-goal custom-civ-pop >= up-max-civ);	(civilian-population >= up-max-civ)
;	(up-compare-goal custom-civ-pop >= 90);	(civilian-population >= 90));
	(goal palagoal no); hm
	(goal champgoal no); hm
;	(building-type-count castle >= 1)
	(goal uugoal no)
=>
	(set-goal uugoal yes))
(defrule
(or	(unit-type-count-total siege-weapon-class >= 4)
(or	(unit-type-count-total scorpion-class >= 4)
(or	(up-research-status c: ri-siege-onager >= research-pending)
	(gold-amount >= 1200))))
	(can-research my-unique-research)
=>
	(research my-unique-research)
	(set-goal researchplan yes))
(defrule
	(up-compare-goal urgoal != yes)
(or	(unit-type-count-total battering-ram-line >= 10)
(or	(unit-type-count-total scorpion-line >= 12)
	(up-compare-goal mangonel-set >= 12)))
(or	(and	(unit-type-count-total battering-ram-line >= 7)
		(up-research-status c: ri-siege-ram >= research-pending))
(or	(up-research-status c: ri-heavy-scorpion >= research-pending)
	(up-research-status c: ri-siege-onager >= research-pending)))
	(goal underattack no)
=>
	(set-goal urgoal yes))
(defrule
(or	(building-type-count-total castle >= 2)
	(building-type-count-total watch-tower >= 3))
(or	(strategic-number sn-current-age >= imperial)
(or	(building-type-count-total castle >= 3)
	(building-type-count-total watch-tower >= 6)))
(or	(goal researchplan yes)
(or	(goal underattack yes)
	(goal defend yes)))
	(can-research ri-stronghold)
=>
	(research ri-stronghold))
#end-if
#else ; Koreans
(defrule
(or	(up-compare-goal mangonel-set >= 4)
	(up-research-status c: ri-siege-onager >= research-pending))
	(can-research my-unique-research)
=>
	(research my-unique-research)
	(set-goal researchplan yes))
(defrule
	(up-compare-goal urgoal != yes)
	(up-compare-goal mangonel-set >= 12)
	(up-research-status c: ri-siege-onager >= research-pending)
	(goal underattack no)
=>
	(set-goal urgoal yes))
(defrule
(or	(goal attacking yes)
(or	(goal underattack yes)
	(goal researchplan yes)))
	(building-type-count-total watch-tower >= 1)
(or	(up-research-status c: ri-yeomen >= research-pending)
(or	(up-research-status c: ri-yasama >= research-pending)
(or	(up-research-status c: ri-arrowslits >= research-pending)
	(building-type-count-total watch-tower >= 3))))
	(can-research ri-panokseon)
=>
	(research ri-panokseon))
(defrule
	(up-compare-const de-game != 1)
(or	(unit-type-count-total turtle-ship-line >= 4)
	(up-research-status c: ri-elite-turtle-ship >= research-pending))
	(can-research ri-panokseon)
=>
	(research ri-panokseon))
#end-if
#else ; Mayans
(defrule
	(goal strategy stonewall)
	(strategic-number sn-current-age >= imperial)
	(current-age <= castle-age)
	(building-type-count-total castle >= 1)
	(strategic-number skirms < 30)
	(strategic-number siege < 10)
	(goal strategylocked no)
=>
	(set-goal milunits yes)
	(set-goal strategy usual)
	(set-goal attackprioritychange yes)
	(set-goal uugoal yes))
(defrule
(or	(unit-type-count-total eagle-warrior-line >= 6)
	(unit-type-count-total heavy-eagle-warrior >= 6))
	(up-research-status c: ri-elite-eagle-warrior >= research-pending)
	(can-research my-unique-research)
=>
	(research my-unique-research)
	(set-goal researchplan yes))
(defrule
	(unit-type-count-total eagle-warrior-line < 2)
	(unit-type-count-total heavy-eagle-warrior < 2)
	(up-research-status c: my-unique-unit-upgrade >= research-pending)
	(goal researchplan no)
=>
	(set-goal researchplan yes))
(defrule
	(up-compare-goal urgoal != yes)
(or	(unit-type-count-total eagle-warrior-line >= 12)
	(unit-type-count-total heavy-eagle-warrior >= 12))
	(up-research-status c: ri-elite-eagle-warrior >= research-pending)
	(goal underattack no)
=>
	(set-goal urgoal yes))
(defrule
(or	(strategic-number sn-current-age >= cimperial)
(or	(goal underattack yes)
	(goal attacking yes)))
(or	(unit-type-count-total skirmisher-line >= 7)
	(and	(up-compare-goal tradeunits <= 4)
		(goal trainskirm yes)))
	(can-research ri-obsidian-arrows)
=>
	(research ri-obsidian-arrows))
#end-if
#else ; Teutons
(defrule
	(current-age >= imperial-age)
	(goal palagoal no)
	(goal uugoal no)
	(game-time > 5)
=>
	(set-goal uugoal yes))
;(defrule
;	(goal uugoal yes)
;	(can-research my-unique-unit-upgrade)
;=>
;	(research my-unique-unit-upgrade)
;	(set-goal researchplan yes))
(defrule
	(building-type-count-total castle >= 3)
(or	(up-compare-goal excessFood >= 1900)
(or	(goal underattack yes)
(or	(up-research-status c: my-unique-unit-upgrade >= research-pending)
	(and	(goal researchplan yes)
		(town-under-attack)))))
	(can-research my-unique-research)
=>
	(research my-unique-research)
;	(set-goal researchplan yes)
)
(defrule
	(up-compare-goal urgoal != yes)
	(unit-type-count-total castle >= 6)
(or	(up-research-status c: ri-paladin >= research-pending)
	(up-research-status c: my-unique-unit-upgrade >= research-pending))
	(goal underattack no)
=>
	(set-goal urgoal yes))
(defrule
(or	(goal attacking yes)
	(goal researchplan yes))
(or	(unit-type-count-total siege-tower >= 2)
(or	(unit-type-count-total bombard-cannon-line >= 2)
(or	(unit-type-count-total trebuchet-set >= 2)
(or	(unit-type-count-total siege-weapon-class >= 2)
	(unit-type-count-total scorpion-class >= 2)))))
	(can-research ri-ironclad)
=>
	(research ri-ironclad))
#end-if
#else ; Aztecs
(defrule
(or	(unit-type-count-total infantry-class >= 6)
(or	(unit-type-count-total condottiero >= 6)
	(unit-type-count-total heavy-eagle-warrior >= 6)))
	(can-research my-unique-research)
=>
	(research my-unique-research)
	(set-goal researchplan yes))
(defrule
	(up-compare-goal urgoal != yes)
(or	(unit-type-count-total spearman-line >= 24)
(or	(unit-type-count-total eagle-warrior-line >= 12)
(or	(unit-type-count-total my-unique-unit-line >= 12)
	(unit-type-count-total militiaman-line >= 12))))
(or	(up-research-status c: ri-elite-eagle-warrior >= research-pending)
(or	(up-research-status c: ri-champion >= research-pending)
	(up-research-status c: my-unique-unit-upgrade >= research-pending)))
	(up-research-status c: ri-blast-furnace >= research-pending)
	(goal underattack no)
=>
	(set-goal urgoal yes))
(defrule
(or	(unit-type-count-total imperial-skirmisher >= 14)
(or	(unit-type-count-total skirmisher-line >= 14)
(or	(up-research-status c: imperial-age != research-available)
	(strategic-number sn-current-age >= imperial))))
(or	(unit-type-count-total imperial-skirmisher >= 7)
	(unit-type-count-total skirmisher-line >= 7))
	(can-research ri-atlatl)
=>
	(research ri-atlatl))
(defrule
(or	(unit-type-count-total genitour >= 14)
(or	(unit-type-count-total elite-genitour >= 14)
(or	(unit-type-count-total genitour-placeholder >= 14)
(or	(up-research-status c: imperial-age != research-available)
	(strategic-number sn-current-age >= imperial)))))
(or	(unit-type-count-total genitour >= 7)
(or	(unit-type-count-total elite-genitour >= 7)
	(unit-type-count-total genitour-placeholder >= 7)))
	(can-research ri-atlatl)
=>
	(research ri-atlatl))
#end-if
#else ; Mongols
(defrule
(or	(unit-type-count-total siege-weapon-class >= 5)
(or	(unit-type-count-total scorpion-class >= 5)
(or	(up-research-status c: my-unique-unit-upgrade >= research-pending)
	(up-compare-goal excessGold >= 1400))))
	(can-research my-unique-research)
=>
	(research my-unique-research)
;	(set-goal researchplan yes)
)
(defrule
	(up-compare-goal urgoal != yes)
(or	(unit-type-count-total battering-ram-line >= 9)
(or	(unit-type-count-total scorpion-line >= 9)
	(up-compare-goal mangonel-set >= 9)))
(or	(and	(unit-type-count-total battering-ram-line >= 6)
		(up-research-status c: ri-siege-ram >= research-pending))
(or	(up-research-status c: ri-heavy-scorpion >= research-pending)
	(up-research-status c: ri-siege-onager >= research-pending)))
	(goal underattack no)
=>
	(set-goal urgoal yes))
(defrule
(or	(and	(strategic-number sn-current-age >= imperial)
		(goal researchplan yes))
	(and	(or	(up-compare-const grouped-and-allied == 1)
			(goal inseln yes))
		(and	(goal attacking no)
			(strategic-number sn-maximum-town-size >= 36))))
	(can-research ri-nomads)
=>
	(research ri-nomads))
#end-if
#else ; Turks
(defrule
(or	(up-research-status c: my-unique-unit-upgrade >= research-pending)
(or	(unit-type-count-total bombard-cannon-line >= 3)
(or	(unit-type-count-total cannon-galleon-line >= 3)
	(building-type-count-total bombard-tower >= 3))))
	(can-research my-unique-research)
=>
	(research my-unique-research)
	(set-goal researchplan yes))
(defrule
	(up-compare-goal urgoal != yes)
(or	(unit-type-count-total bombard-cannon-line >= 12)
	(building-type-count-total bombard-tower >= 12))
	(up-research-status c: my-unique-unit-upgrade >= research-pending)
	(goal underattack no)
=>
	(set-goal urgoal yes))
(defrule
(or	(unit-type-count-total cavalry-archer-line >= 6)
(or	(and	(or	(unit-type-count-total cavalry-archer-line >= 2)
			(goal cavagoal yes))
		(up-research-status c: ri-heavy-cavalry-archer >= research-pending))
(or	(unit-type-count-total genitour >= 6)
(or	(unit-type-count-total elite-genitour >= 6)
	(unit-type-count-total genitour-placeholder >= 6)))))
	(can-research ri-sipahi)
=>
	(research ri-sipahi))
(defrule
	(up-research-status c: ri-elite-genitour >= research-pending)
	(can-research ri-sipahi)
=>
	(research ri-sipahi))
#end-if
#else ; Franks
(defrule
(or	(players-civ target-player gothic)
	(players-civ every-enemy gothic))
	(up-compare-const wk-game == 1);
=>
	(set-goal uugoal yes))
(defrule
(or	(up-research-status c: my-unique-unit-upgrade >= research-pending)
	(up-research-status c: ri-paladin >= research-pending))
	(goal researchplan no)
=>
	(set-goal researchplan yes)
	(disable-self))
(defrule
(or	(up-research-status c: my-unique-unit-upgrade >= research-pending)
	(unit-type-count-total my-unique-unit-line >= 5))
	(can-research ri-bearded-axe)
=>
	(research ri-bearded-axe))
(defrule
(or	(up-compare-const dm-game == 1)
(or	(up-compare-const inf-game == 1)
	(up-research-status c: ri-paladin >= research-pending)))
	(can-research ri-chivalry)
=>
	(research ri-chivalry))
(defrule
	(strategic-number sn-current-age >= cimperial)
(or	(goal palagoal yes)
(or	(goal trainhussar yes)
(or	(goal trainknight yes)
(or	(goal traincamel yes)
(or	(goal trainsteppe yes)
	(goal trainbattle yes))))))
	(can-research ri-chivalry)
=>
	(research ri-chivalry))
#end-if
#else ; Saracens
(defrule
	(up-compare-goal uugoal != yes)
(or	(building-type-count castle >= 1)
	(strategic-number sn-current-age >= imperial))
(or	(player-in-game any-ally); test
(or	(up-compare-goal tradeunits >= 9); 25
	(and	(population >= up-max-civ)
		(up-compare-goal excessGold >= 2900))))
(or	(up-compare-goal custom-civ-pop >= 60);	(civilian-population >= 60)
	(up-compare-goal excessGold >= 250))
=>
	(set-goal uugoal yes))
(defrule
	(up-compare-goal uugoal != no)
(or	(and	(building-type-count-total castle <= 0)
		(strategic-number sn-current-age <= castlea))
	(and	(not	(player-in-game any-ally))
		(and	(up-compare-goal tradeunits < 9); 25
			(and	(up-compare-goal excessGold < 250)
				(up-gaia-type-count c: gold < 4)))))
=>
	(set-goal uugoal no))
(defrule
(or	(and	(up-research-status c: my-unique-unit-upgrade >= research-pending)
		(goal uugoal yes))
(or	(up-compare-goal camel-set >= 5)
	(unit-type-count-total my-unique-unit-line >= 5)))
	(can-research my-unique-research)
=>
	(research my-unique-research)
	(set-goal researchplan yes))
(defrule
	(up-compare-goal uugoal != yes)
	(up-research-status c: my-unique-research >= research-pending)
	(can-research my-unique-unit-upgrade)
=>
	(set-goal uugoal yes)
	(research my-unique-unit-upgrade))
(defrule
	(up-compare-goal urgoal != yes)
(or	(unit-type-count-total my-unique-unit-line >= 12)
	(up-compare-goal camel-set >= 12))
(or	(up-research-status c: ri-heavy-camel >= research-pending)
	(up-research-status c: my-unique-unit-upgrade >= research-pending))
	(goal underattack no)
=>
	(set-goal urgoal yes))
(defrule
	(unit-type-count-total monastery-class >= 1)
(or	(unit-type-count-total monastery-class >= 6)
	(and	(strategic-number sn-current-age >= cimperial)
		(and	(or	(goal researchplan yes)
					(population >= del-civ-pop))
			(up-compare-goal tradeunits >= 1))))
	(can-research ri-madrasah)
=>
	(research ri-madrasah))
#end-if
#else ; Vikings
(defrule
	(up-research-status c: my-unique-unit-upgrade != research-available); >= research-pending)
(or	(unit-type-count-total my-unique-unit-line >= 5)
	(goal uugoal yes));
	(can-research my-unique-research)
=>
	(research my-unique-research))
(defrule
(or	(up-research-status c: my-unique-unit-upgrade >= research-pending)
	(up-research-status c: ri-champion >= research-pending))
	(goal researchplan no)
=>
	(set-goal researchplan yes))
(defrule
	(unit-type-count-total infantry-class >= 6)
	(strategic-number cavalry >= 5)
(or	(strategic-number sn-current-age >= imperial)
	(and	(unit-type-count-total infantry-class >= 18)
		(strategic-number cavalry >= 15)))
	(can-research ri-chieftains)
=>
	(research ri-chieftains))
#end-if
#else ; Spanish
(defrule
	(up-compare-goal uugoal != yes)
	(goal milunits yes)
	(current-age >= imperial-age);	(up-research-status c: imperial-age >= research-pending)
	(building-type-count castle >= 1)
(or	(and	(strategic-number spears >= 42); 35
		(goal trainhandcannon no))
	(up-compare-goal palagoal != yes))
;	(goal escrowing no)
(or	(up-compare-goal palagoal != yes)
(or	(up-compare-goal custom-civ-pop >= up-max-civ);	(civilian-population >= up-max-civ)
	(population >= max-civ-pop)))
=>
	(set-goal uugoal yes))
(defrule
(or	(up-research-status c: my-unique-unit-upgrade >= research-pending)
	(up-research-status c: ri-paladin >= research-pending))
	(goal researchplan no)
=>
	(set-goal researchplan yes)
	(disable-self))
(defrule
(or	(up-research-status c: my-unique-unit-upgrade >= research-pending)
	(and	(goal researchplan yes)
		(or	(goal defend yes)
			(up-compare-goal excessGold >= 900))))
	(can-research my-unique-research)
=>
	(research my-unique-research))
(defrule
	(up-compare-goal urgoal != yes)
	(population >= max-pop)
	(town-under-attack)
	(strategic-number sn-military-superiority >= 1)
	(unit-type-count-total villager >= 90)
(or	(up-research-status c: ri-paladin >= research-pending)
	(up-research-status c: my-unique-unit-upgrade >= research-pending))
	(goal underattack no)
=>
	(set-goal urgoal yes))
(defrule
	(unit-type-count-total monastery-class >= 1)
(or	(unit-type-count-total monastery-class >= 6)
	(and	(strategic-number sn-current-age >= cimperial)
		(and	(or	(goal researchplan yes)
					(population >= del-civ-pop))
			(up-compare-goal tradeunits >= 1))))
	(can-research ri-inquisition)
=>
	(research ri-inquisition))
#end-if
#else; Chinese
(defrule
(or	(up-research-status c: my-unique-unit-upgrade >= research-pending)
	(unit-type-count-total scorpion-line >= 7))
	(can-research my-unique-research)
=>
	(research my-unique-research)
	(set-goal researchplan yes))
(defrule
	(strategic-number sn-current-age >= imperial)
(or	(building-type-count-total castle >= 2)
	(goal uugoal no))
(or	(and	(up-research-status c: ri-fortified-wall >= research-pending)
		(or	(building-type-count-total stone-wall-line >= 4)
			(building-type-count gate >= 2)))
(or	(building-type-count-total bombard-tower >= 4)
	(building-type-count-total watch-tower >= 4)))
	(can-research ri-great-wall)
=>
	(research ri-great-wall))
(defrule
	(up-research-status c: ri-architecture >= research-pending)
(or	(building-type-count-total castle >= 2)
	(goal uugoal no))
(or	(and	(up-research-status c: ri-fortified-wall >= research-pending)
		(or	(building-type-count-total stone-wall-line >= 1)
			(building-type-count gate >= 1)))
(or	(building-type-count-total bombard-tower >= 1)
	(building-type-count-total watch-tower >= 1)))
	(can-research ri-great-wall)
=>
	(research ri-great-wall))
#end-if
#else; britons
(defrule
(or	(up-research-status c: my-unique-unit-upgrade >= research-pending)
(or	(building-type-count-total watch-tower >= 5)
	(unit-type-count-total archery-class >= 25)))
	(can-research my-unique-research)
=>
	(research my-unique-research)
	(set-goal researchplan yes))
(defrule
(or	(goal uugoal no)
(or	(building-type-count-total castle >= number-archery-ranges);
	(building-type-count-total castle >= 8)))
	(up-research-status c: ri-arrowslits >= research-available)
	(up-research-status c: ri-guard-tower >= research-available)
	(up-compare-goal excessStone >= 225)
	(strategic-number sn-current-age >= imperial)
	(can-research my-unique-research)
=>
	(research my-unique-research))
(defrule
	(unit-type-count-total trebuchet-set >= 2); 3
(or	(up-research-status c: ri-yeomen >= research-pending)
	(unit-type-count-total trebuchet-set >= 4)); 6
	(can-research ri-war-wolf)
=>
	(research ri-war-wolf))
#end-if
#else; cumans
(defrule
(or	(up-compare-const inf-game == yes)
(or	(up-compare-goal steppe-lancer-set >= 7)
(or	(unit-type-count-total scout-cavalry >= 7)
	(unit-type-count-total scout-cavalry-line >= 7))))
(or	(up-compare-goal strategy-type <= castle-war)
	(strategic-number sn-current-age >= imperial))
	(can-research ri-steppe-husbandry)
=>
	(research ri-steppe-husbandry))
(defrule
	(can-research ri-cuman-mercenaries)
=>
	(research ri-cuman-mercenaries)
	(set-goal researchplan yes))
(defrule
	(up-compare-goal urgoal != yes)
(or	(players-building-type-count any-ally castle >= 1)
(or	(goal researchplan yes)
(or	(up-compare-goal custom-civ-pop >= up-max-civ)
(or	(population >= max-civ-pop)
	(and	(research-available my-unique-research)
		(goal escrowing no))))))
	(goal underattack no)
=>
	(set-goal urgoal yes))
(defrule
	(up-compare-goal uugoal != yes)
	(up-compare-goal cavagoal != yes)
	(strategic-number spears >= 30)
(or	(goal trainskirm no)
	(up-compare-goal tradeunits >= 5))
=>
	(set-goal uugoal yes))
(defrule
	(up-compare-goal uugoal != yes)
	(up-research-status c: imperial-age >= research-pending); (current-age >= imperial-age)
	(goal palagoal no)
	(goal champgoal no)
	(goal cavagoal no)
=>
	(set-goal uugoal yes))
#end-if
#else; byzantines
(defrule
	(up-research-status c: my-unique-unit-upgrade != research-available); >= research-pending)
(or	(unit-type-count-total my-unique-unit-line >= 5)
	(goal uugoal yes));
	(can-research my-unique-research)
=>
	(research my-unique-research))
(defrule
(or	(unit-type-count-total fire-ship-line >= 3)
	(unit-type-count-total fire-galley >= 3))
	(can-research ri-greek-fire)
=>
	(research ri-greek-fire))
#end-if
#else; japanese
(defrule
	(up-compare-const de-game == 1)
(or	(players-building-type-count any-enemy castle <= 0)
	(up-research-status c: ri-supplies >= research-pending))
=>
	(up-jump-rule 1))
(defrule
	(up-compare-goal uugoal != yes)
	(up-research-status c: imperial-age >= research-pending); (current-age >= imperial-age)
	(up-compare-goal champgoal != yes)
(or	(dropsite-min-distance stone s:<= sn-maximum-stone-drop-distance)
(or	(dropsite-min-distance stone s:<= sn-camp-max-distance); test
(or	(stone-amount > 0)
(or	(unit-type-count villager-stone >= 1)
	(building-type-count-total castle >= 1)))))
=>
	(set-goal uugoal yes)); end jump
(defrule
	(up-compare-goal uugoal != yes)
(or	(goal champgoal no)
	(building-type-count castle >= 1)); -total
(or	(players-unit-type-count focus-player konnik-line >= 8)
(or	(players-unit-type-count focus-player huskarl-line >= 8)
(or	(players-unit-type-count focus-player teutonic-knight-line >= 8)
(or	(players-unit-type-count focus-player woad-raider-line >= 8)
(or	(players-unit-type-count focus-player throwing-axeman-line >= 8)
	(players-unit-type-count focus-player berserk-line >= 8))))))
=>
	(set-goal uugoal yes))
(defrule
	(up-compare-goal uugoal != yes)
(or	(goal champgoal no)
	(building-type-count castle >= 1)); -total
(or	(players-unit-type-count focus-player krepost-konnik-line >= 8)
(or	(players-unit-type-count focus-player foot-konnik-line >= 8)
(or	(players-unit-type-count focus-player keshik-line >= 8)
	(players-unit-type-count focus-player leitis-line >= 8))))
=>
	(set-goal uugoal yes))
(defrule
	(up-compare-goal urgoal != yes)
	(population >= del-civ-pop)
	(unit-type-count-total trebuchet-set >= 10)
(or	(up-research-status c: my-unique-unit-upgrade >= research-pending)
	(up-research-status c: ri-champion >= research-pending))
	(goal underattack no)
=>
	(set-goal urgoal yes))
(defrule
	(unit-type-count-total trebuchet-set >= 2)
(or	(unit-type-count-total trebuchet-set >= 3)
	(goal traintrebuchet yes))
	(can-research ri-timurid-siegecraft)
=>
	(research ri-timurid-siegecraft)
	(set-goal researchplan yes))
(defrule
	(building-type-count-total watch-tower >= 1)
(or	(up-research-status c: ri-arrowslits >= research-pending)
(or	(up-research-status c: ri-guard-tower >= research-pending)
	(building-type-count-total watch-tower >= 4)))
	(can-research ri-yasama)
=>
	(research ri-yasama))
(defrule
	(building-type-count-total watch-tower >= 1)
(or	(cc-players-unit-type-count my-player-number 504 >= 1)
(or	(cc-players-unit-type-count my-player-number 505 >= 1)
(or	(cc-players-unit-type-count my-player-number 517 >= 1)
	(cc-players-unit-type-count my-player-number 518 >= 1))))
(or	(up-research-status c: ri-arrowslits >= research-pending)
(or	(up-research-status c: ri-guard-tower >= research-pending)
	(building-type-count-total watch-tower >= 2)))
	(can-research ri-yasama)
=>
	(research ri-yasama))
(defrule
(or	(goal uugoal no)
	(building-type-count-total castle >= 8))
	(up-research-status c: ri-arrowslits >= research-available)
	(up-research-status c: ri-guard-tower >= research-available)
	(up-compare-goal excessStone >= 225)
	(strategic-number sn-current-age >= imperial)
	(can-research ri-yasama)
=>
	(research ri-yasama))
#end-if
#else; persians
;(defrule
;;	(building-type-count-total castle >= 1)
;	(players-unit-type-count any-enemy battering-ram-line >= 1)
;(or	(goal underattack yes)
;	(strategic-number sn-current-age >= imperial))
;(or	(goal underattack yes)
;(or	(goal researchplan yes)
;	(and	(town-under-attack)
;		(up-attacker-class == battering-ram-line))))
;	(can-research ri-boiling-oil)
;=>
;	(research ri-boiling-oil))
(defrule
	(goal trainarcher yes)
	(can-research ri-boiling-oil)
=>
	(research ri-boiling-oil))
#end-if
#else; berbers
(defrule
(or	(goal uugoal yes)
(or	(and	(up-research-status c: my-unique-unit-upgrade >= research-pending)
		(up-research-status c: ri-maghrabi-camels >= research-pending))
(or	(unit-type-count-total camel-archer >= 7)
	(unit-type-count-total elite-camel-archer >= 7))))
(or	(up-compare-goal strategy-type <= castle-war)
	(strategic-number sn-current-age >= imperial))
	(can-research ri-kasbah)
=>
	(research ri-kasbah))
(defrule
(or	(and	(player-in-game any-ally)
		(players-building-type-count any-ally castle >= 1))
	(and	(goal escrowing no)
		(or	(population >= max-civ-pop)
			(up-compare-goal custom-civ-pop >= up-max-civ))))
	(strategic-number sn-current-age >= imperial)
	(can-research ri-kasbah)
=>
	(research ri-kasbah))
(defrule
(or	(unit-type-count-total camel-archer >= 6)
(or	(unit-type-count-total elite-camel-archer >= 6)
(or	(unit-type-count-total imperial-camel >= 6)
	(up-compare-goal camel-set >= 6))))
	(can-research ri-maghrabi-camels)
=>
	(research ri-maghrabi-camels)
	(set-goal researchplan yes))
(defrule
	(up-compare-goal urgoal != yes)
(or	(unit-type-count-total camel-archer >= 18)
(or	(unit-type-count-total elite-camel-archer >= 18)
(or	(unit-type-count-total imperial-camel >= 18)
	(up-compare-goal camel-set >= 18))))
	(goal underattack no)
=>
	(set-goal urgoal yes))
(defrule
	(up-compare-goal uugoal != yes)
	(up-research-status c: imperial-age >= research-pending)
(or	(players-unit-type-count focus-player conquistador-line >= 10)
(or	(players-unit-type-count focus-player mangudai-line >= 10)
(or	(players-unit-type-count focus-player cavalry-archer-line >= 10)
(or	(players-unit-type-count focus-player kipchak-line >= 10)
(or	(players-unit-type-count focus-player arambai-line >= 10)
(or	(players-unit-type-count focus-player elephant-archer-line >= 7)
	(players-unit-type-count focus-player war-wagon-line >= 10)))))))
=>
	(set-goal uugoal yes))
#end-if
#else; bulgarians
(defrule
(nor	(up-compare-goal strategy-type <= castle-war)
	(strategic-number sn-current-age >= imperial))
=>
	(up-jump-rule 2))
(defrule
(or	(unit-type-count-total scout-cavalry-line >= 7)
(or	(unit-type-count-total konnik >= 7)
(or	(unit-type-count-total elite-konnik >= 7)
(or	(unit-type-count-total foot-konnik >= 7)
(or	(unit-type-count-total elite-foot-konnik >= 7)
(or	(unit-type-count-total krepost-konnik >= 7)
	(unit-type-count-total elite-krepost-konnik >= 7)))))))
	(can-research ri-stirrups)
=>
	(research ri-stirrups))
(defrule
(or	(unit-type-count-total knight-line >= 7)
(or	(unit-type-count-total cavalry-class >= 7)
(or	(up-compare-goal camel-set >= 7)
	(up-compare-goal battle-elephant-set >= 7))))
	(can-research ri-stirrups)
=>
	(research ri-stirrups)); end jump
(defrule
(or	(goal champgoal yes)
(or	(goal trainchamp yes)
	(unit-type-count-total militiaman-line >= 7)))
	(can-research ri-bagains)
=>
	(research ri-bagains)
	(set-goal researchplan yes))
(defrule
	(up-compare-goal urgoal != yes)
(or	(strategic-number infantry >= 5)
(or	(strategic-number cavalry >= 5)
(or	(strategic-number eagles >= 5)
	(strategic-number husks >= 5))))
(or	(goal champgoal yes)
(or	(goal trainchamp yes)
	(unit-type-count-total militiaman-line >= 21)))
	(goal underattack no)
=>
	(set-goal urgoal yes))
(defrule
	(up-compare-goal uugoal != yes)
	(up-research-status c: imperial-age >= research-pending); (current-age >= imperial-age)
	(goal palagoal no)
	(goal champgoal no)
(or	(goal cavagoal no)
	(and	(up-compare-goal tradeunits >= 5)
		(and	(up-research-status c: ri-heavy-cavalry-archer >= research-pending)
			(population >= max-civ-pop))))
=>
	(set-goal uugoal yes))
#end-if
#else; burmese
(defrule
(or	(up-compare-goal battle-elephant-set >= 4)
	(up-research-status c: ri-elite-battle-elephant >= research-pending))
(or	(up-compare-goal strategy-type <= castle-war)
	(strategic-number sn-current-age >= imperial))
	(can-research ri-howdah)
=>
	(research ri-howdah))
(defrule
(or	(unit-type-count-total cavalry-class >= 7)
(or	(up-compare-goal battle-elephant-set >= 7)
(or	(unit-type-count-total arambai >= 7)
	(unit-type-count-total elite-arambai >= 7))))
	(can-research ri-manipur-cavalry)
=>
	(research ri-manipur-cavalry)
	(set-goal researchplan yes))
(defrule
	(up-compare-goal urgoal != yes)
	(goal attacking yes)
(or	(unit-type-count-total cavalry-class >= 21)
(or	(up-compare-goal battle-elephant-set >= 21)
(or	(unit-type-count-total arambai >= 21)
	(unit-type-count-total elite-arambai >= 21))))
	(goal underattack no)
=>
	(set-goal urgoal yes))
(defrule
	(up-compare-goal uugoal != yes)
	(up-research-status c: imperial-age >= research-pending); (current-age >= imperial-age)
(or	(goal champgoal no)
	(up-compare-goal tradeunits < 20))
;(or	(and	(goal champgoal no)
;		(or	(up-research-status c: ri-manipur-cavalry >= research-pending)
;			(or	(and	(strategic-number cavalry >= 15)
;					(up-research-status c: ri-pikeman <= research-available))
;				(up-research-status c: ri-howdah >= research-pending))));(up-compare-goal relic-count >= 2))))
;	(and	(up-research-status c: ri-champion >= research-pending)
;		(goal trainchamp no)))
=>
	(set-goal uugoal yes))
#end-if
#else; ethiopians
(defrule
	(up-compare-goal uugoal != yes)
	(up-research-status c: imperial-age >= research-pending); (current-age >= imperial-age)
(or	(strategic-number husks >= 15)
	(strategic-number eagles >= 40))
(or	(up-research-status c: ri-heavy-scorpion <= research-available)
	(and	(goal trainscorpion no)
		(unit-type-count-total scorpion-line < 8)))
=>
	(set-goal uugoal yes))
(defrule
(or	(up-compare-goal strategy-type <= castle-war)
	(strategic-number sn-current-age >= imperial))
(or	(goal uugoal yes)
	(goal trainunique yes))
	(can-research ri-royal-heirs)
=>
	(research ri-royal-heirs)
	(set-goal researchplan yes))
(defrule
(or	(up-compare-goal mangonel-set >= 4)
(or	(unit-type-count-total bombard-cannon-line >= 4)
(or	(unit-type-count-total scorpion-line >= 4)
	(unit-type-count-total battering-ram-line >= 4))))
	(can-research ri-torsion-engines)
=>
	(research ri-torsion-engines)
	(set-goal researchplan yes))
(defrule
	(up-compare-goal urgoal != yes)
(or	(goal attacking yes)
	(goal escrowing no))
(or	(up-compare-goal mangonel-set >= 8)
(or	(unit-type-count-total bombard-cannon-line >= 8)
(or	(unit-type-count-total scorpion-line >= 9)
	(unit-type-count-total battering-ram-line >= 8))))
	(goal underattack no)
=>
	(set-goal urgoal yes))
#end-if
#else; incas
(defrule
(or	(unit-type-count-total genitour >= 4)
(or	(unit-type-count-total elite-genitour >= 4)
(or	(unit-type-count-total genitour-placeholder >= 4)
(or	(unit-type-count-total skirmisher-line >= 7)
	(unit-type-count-total slinger >= 4)))))
(or	(strategic-number sn-current-age >= imperial)
(or	(goal underattack yes)
	(goal attacking yes)))
	(can-research ri-andean-sling)
=>
	(research ri-andean-sling))
(defrule
;	(up-research-status c: ri-conscription >= research-pending)
(or	(unit-type-count-total eagle-warrior-line >= 6)
(or	(unit-type-count-total heavy-eagle-warrior >= 6)
(or	(unit-type-count-total kamayuk >= 6)
	(unit-type-count-total slinger >= 6))))
	(can-research ri-couriers)
=>
	(research ri-couriers))
(defrule
	(up-compare-goal urgoal != yes)
(or	(unit-type-count-total eagle-warrior-line >= 18)
(or	(unit-type-count-total heavy-eagle-warrior >= 18)
(or	(unit-type-count-total kamayuk >= 18)
	(unit-type-count-total slinger >= 18))))
	(goal underattack no)
=>
	(set-goal urgoal yes))
#end-if
#else; indians
(defrule
;(or	(cc-players-unit-type-count 0 gold-mine >= 1)
;(or	(cc-players-unit-type-count 0 relic >= 1)
(or	(up-compare-goal relic-count >= 1)
(or	(up-compare-goal tradeunits >= 1)
	(unit-type-count villager-gold >= 1)));))
	(can-research ri-sultans)
=>
	(research ri-sultans))
(defrule
(or	(goal trainhandcannon yes)
	(unit-type-count-total hand-cannoneer >= 7))
	(unit-type-count-total hand-cannoneer >= 4)
	(can-research ri-shatagni)
=>
	(research ri-shatagni))
(defrule
	(up-compare-goal urgoal != yes)
	(unit-type-count-total hand-cannoneer >= 14)
	(goal underattack no)
=>
	(set-goal urgoal yes))
#end-if
#else; italians
(defrule
(or	(strategic-number sn-current-age >= cimperial)
	(up-research-status c: ri-leather-archer-armor >= research-pending))
(or	(and	(goal uugoal yes)
		(unit-type-count-total genoese-crossbowman >= 4))
(or	(unit-type-count-total genoese-crossbowman >= 7)
(or	(unit-type-count-total archer-line >= 7)
(or	(unit-type-count-total condottiero >= 7)
	(up-research-status c: my-unique-unit-upgrade >= research-pending)))))
	(can-research ri-pavise)
=>
	(research ri-pavise))
(defrule
(nor	(players-building-type-count any-ally market >= 1)
(or	(players-building-type-count any-ally dock >= 1)
(or	(goal traincart yes)
	(goal traincog yes))))
=>
	(up-jump-rule 1))
(defrule
(or	(goal traincart yes)
(or	(goal traincog yes)
	(population >= max-pop)))
(or	(strategic-number sn-current-age >= imperial);	(strategic-number sn-military-superiority >= 1)
(or	(building-type-count-total market >= 2)
(or	(building-type-count-total dock >= 2)
	(up-compare-goal custom-civ-pop >= 75))))
	(can-research ri-silk-road)
=>
	(research ri-silk-road)); end jump
(defrule
	(up-compare-goal urgoal != yes)
(or	(goal traincart yes)
	(goal traincog yes))
(or	(players-building-type-count any-ally market >= 1)
	(players-building-type-count any-ally dock >= 1))
(or	(building-type-count-total market >= 2)
(or	(building-type-count-total dock >= 2)
	(goal escrowing no)))
	(goal underattack no)
=>
	(set-goal urgoal yes))
#end-if
#else; khmer
(defrule
(or	(up-compare-goal battle-elephant-set >= 4)
	(up-research-status c: ri-elite-battle-elephant >= research-pending))
(or	(up-compare-goal strategy-type <= castle-war)
	(strategic-number sn-current-age >= imperial))
	(can-research ri-tusk-swords)
=>
	(research ri-tusk-swords))
(defrule
(or	(up-research-status c: ri-elite-ballista-elephant >= research-pending)
(or	(up-research-status c: ri-heavy-scorpion >= research-pending)
(or	(unit-type-count-total scorpion-line >= 6)
(or	(unit-type-count-total ballista-elephant >= 6)
	(unit-type-count-total elite-ballista-elephant >= 6)))))
	(can-research ri-double-crossbow)
=>
	(research ri-double-crossbow)
	(set-goal researchplan yes))
(defrule
	(up-compare-goal urgoal != yes)
(or	(up-research-status c: ri-elite-ballista-elephant >= research-pending)
	(up-research-status c: ri-heavy-scorpion >= research-pending))
(or	(unit-type-count-total scorpion-line >= 10)
(or	(unit-type-count-total ballista-elephant >= 10)
	(unit-type-count-total elite-ballista-elephant >= 10)))
	(goal underattack no)
=>
	(set-goal urgoal yes))
#end-if
#else; lithuanians
(defrule
	(building-type-count-total town-center >= 1)
(or	(goal underattack yes)
(or	(building-type-count-total town-center >= 5)
	(strategic-number sn-current-age >= imperial)))
	(can-research ri-hill-forts)
=>
	(research ri-hill-forts))
(defrule
(or	(unit-type-count-total skirmisher-line >= 2)
(or	(unit-type-count-total spearman-line >= 2)
(or	(goal trainskirm yes)
	(goal trainpike yes))))
	(can-research ri-tower-shields)
=>
	(research ri-tower-shields)
	(set-goal researchplan yes))
(defrule
	(up-compare-goal urgoal != yes)
(or	(unit-type-count-total skirmisher-line >= 10)
	(unit-type-count-total spearman-line >= 10))
(or	(strategic-number skirmsarchers >= 10)
(or	(unit-type-count-total skirmisher-line >= 15)
	(unit-type-count-total spearman-line >= 15)))
	(goal underattack no)
=>
	(set-goal urgoal yes))
(defrule
	(up-compare-goal uugoal != yes)
	(up-research-status c: imperial-age >= research-pending); (current-age >= imperial-age)
	(goal palagoal no)
	(goal champgoal no)
(or	(goal cavagoal no)
	(and	(up-compare-goal tradeunits >= 5)
		(and	(up-research-status c: ri-heavy-cavalry-archer >= research-pending)
			(population >= max-civ-pop))))
=>
	(set-goal uugoal yes))
(defrule
	(up-compare-goal uugoal != yes)
;	(up-research-status c: imperial-age >= research-pending); (current-age >= imperial-age)
	(goal palagoal no)
	(goal champgoal no)
(or	(and	(players-civ focus-player bulgarians)
		(players-unit-type-count focus-player militiaman-line >= 16))
(or	(players-unit-type-count focus-player teutonic-knight-line >= 8)
(or	(players-unit-type-count focus-player boyar >= 16)
	(players-unit-type-count focus-player elite-boyar >= 16))))
=>
	(set-goal uugoal yes))
#end-if
#else; magyars
(defrule
(or	(strategic-number sn-current-age >= imperial)
(or	(up-research-status c: my-unique-unit-upgrade >= research-pending)
(or	(goal trainunique yes)
(or	(goal uugoal yes)
	(game-time >= 2400)))))
	(can-research ri-mercenaries)
=>
	(research ri-mercenaries))
(defrule
(or	(unit-type-count-total cavalry-archer-line >= 6)
	(and	(or	(unit-type-count-total cavalry-archer-line >= 2)
			(or	(goal cavagoal yes)
				(goal traincavarcher yes)))
		(up-research-status c: ri-heavy-cavalry-archer >= research-pending)))
	(can-research ri-recurve-bow)
=>
	(research ri-recurve-bow))
(defrule
(or	(strategic-number spears >= 24)
	(strategic-number infantry >= 48))
	(up-compare-goal tradeunits >= 10)
(or	(strategic-number spears >= 48)
	(up-compare-goal excessGold >= 900))
	(unit-type-count-total archery-class < 12)
	(unit-type-count-total archery-cannon-class < 12)
;	(unit-type-count-total cavalry-archer-class < 12)
	(unit-type-count-total scorpion-class < 6)
	(can-research ri-recurve-bow)
=>
	(research ri-recurve-bow))
(defrule
	(up-compare-goal urgoal != yes)
;	(up-research-status c: ri-bracer != research-available)
	(unit-type-count-total cavalry-archer-line >= 12)
	(goal underattack no)
=>
	(set-goal urgoal yes))
#end-if
#else; malay
(defrule
	(building-type-count-total dock >= 1)
(or	(goal enemy-boats yes)
(or	(up-compare-goal gl-threat-source == warship-class)
(or	(and	(up-compare-goal strategy-type <= castle-war)
		(up-compare-goal strategy-type2 == water))
	(strategic-number sn-current-age >= imperial))))
	(can-research ri-thalassocracy)
=>
	(research ri-thalassocracy))
(defrule
	(up-compare-goal urgoal != yes)
	(up-research-status c: imperial-age >= research-pending)
(or	(goal champgoal yes)
(or	(goal trainchamp yes)
	(up-research-status c: ri-two-handed-swordsman >= research-pending)))
=>
	(set-goal urgoal yes))
(defrule
	(up-compare-goal uugoal != yes)
	(up-research-status c: imperial-age >= research-pending); (current-age >= imperial-age)
	(goal palagoal no)
	(goal champgoal no)
(or	(goal cavagoal no)
	(and	(up-compare-goal tradeunits >= 5)
		(and	(up-research-status c: ri-heavy-cavalry-archer >= research-pending)
			(population >= max-civ-pop))))
=>
	(set-goal uugoal yes))
(defrule
(or	(and	(up-compare-goal tradeunits < 5)
		(or	(goal researchplan yes)
			(game-time >= 2520)))
(or	(goal champgoal yes)
(or	(goal trainchamp yes)
(or	(up-research-status c: ri-two-handed-swordsman >= research-pending)
	(unit-type-count-total militiaman-line >= 7)))))
	(can-research ri-forced-levy)
=>
	(research ri-forced-levy)
	(set-goal researchplan yes))
(defrule
(or	(and	(strategic-number sn-current-age >= cimperial)
		(goal uugoal no))
	(up-research-status c: ri-supplies >= research-pending))
	(can-research ri-forced-levy)
=>
	(research ri-forced-levy)
	(set-goal researchplan yes))
#end-if
#else; malian
(defrule
(or	(goal underattack yes)
	(strategic-number sn-current-age >= imperial))
(or	(and	(goal researchplan yes)
		(town-under-attack))
(or	(goal underattack yes)
	(goal defend yes)))
	(can-research ri-tigui)
=>
	(research ri-tigui))
(defrule
(or	(up-research-status c: ri-light-cavalry >= research-pending)
(or	(up-research-status c: ri-heavy-camel >= research-pending)
(or	(up-research-status c: ri-cavalier >= research-pending)
(or	(unit-type-count-total imperial-camel >= 7)
(or	(up-compare-goal steppe-lancer-set >= 7)
(or	(unit-type-count-total scout-cavalry-class >= 7)
	(unit-type-count-total cavalry-class >= 7)))))))
	(can-research ri-farimba)
=>
	(research ri-farimba)
	(set-goal researchplan yes))
(defrule
	(up-compare-goal urgoal != yes)
(or	(unit-type-count-total imperial-camel >= 14)
(or	(unit-type-count-total scout-cavalry-class >= 14)
	(unit-type-count-total cavalry-class >= 14)))
	(goal underattack no)
=>
	(set-goal urgoal yes))
(defrule
	(up-compare-goal uugoal != yes)
	(up-research-status c: imperial-age >= research-pending); (current-age >= imperial-age)
	(goal palagoal no)
	(goal champgoal no)
(or	(goal cavagoal no)
	(and	(up-compare-goal tradeunits >= 5)
		(and	(up-research-status c: ri-heavy-cavalry-archer >= research-pending)
			(population >= max-civ-pop))))
=>
	(set-goal uugoal yes))
#end-if
#else; portuguese
(defrule
(or	(up-compare-goal caravel-set >= 4)
	(goal traincaravel yes))
	(up-compare-goal caravel-set >= 2)
	(can-research ri-elite-caravel)
=>
	(research ri-elite-caravel))
(defrule
(or	(up-compare-goal navycount >= 5)
	(unit-type-count-total transport-ship >= 1))
(or	(up-compare-goal navycount >= 15)
	(strategic-number sn-current-age >= imperial))
	(can-research ri-carrack)
=>
	(research ri-carrack))
(defrule
(or	(unit-type-count-total archery-cannon-class >= 4)
(or	(unit-type-count-total organ-gun >= 4)
(or	(unit-type-count-total elite-organ-gun >= 4)
(or	(unit-type-count-total cannon-galleon-line >= 4)
(or	(unit-type-count-total bombard-cannon-line >= 4)
(or	(building-type-count-total bombard-tower >= 4); speed
	(up-research-status c: my-unique-unit-upgrade >= research-pending)))))))
	(can-research ri-arquebus)
=>
	(research ri-arquebus)
	(set-goal researchplan yes))
(defrule
	(up-research-status c: ri-ballistics >= research-pending)
	(up-compare-goal tradeunits >= 3)
	(can-research ri-arquebus)
=>
	(research ri-arquebus)
	(set-goal researchplan yes))
(defrule
	(up-compare-goal urgoal != yes)
(or	(unit-type-count-total archery-cannon-class >= 16)
(or	(unit-type-count-total organ-gun >= 16)
(or	(unit-type-count-total elite-organ-gun >= 16)
(or	(unit-type-count-total cannon-galleon-line >= 16)
(or	(unit-type-count-total bombard-cannon-line >= 10)
	(building-type-count-total bombard-tower >= 10))))))
	(goal underattack no)
=>
	(set-goal urgoal yes))
#end-if
#else; slavs
(defrule
	(unit-type-count-total monastery-class >= 1)
(or	(up-research-status c: ri-sanctity >= research-pending)
	(up-compare-goal excessGold >= 550))
(or	(unit-type-count-total monastery-class >= 7)
(or	(and	(goal trainmonk yes)
		(unit-type-count-total monastery-class >= 4))
	(and	(up-compare-goal excessGold >= 800)
		(up-compare-goal tradeunits >= 5))))
	(can-research ri-orthodoxy)
=>
	(research ri-orthodoxy))
(defrule
	(unit-type-count-total monastery-class >= 1)
	(strategic-number sn-current-age >= cimperial)
(or	(up-compare-goal excessGold >= 5500)
	(up-compare-goal tradeunits >= 1))
(or	(goal researchplan yes)
	(population >= del-civ-pop))
	(can-research ri-orthodoxy)
=>
	(research ri-orthodoxy))
(defrule
(or	(unit-type-count-total infantry-class >= 14)
(or	(up-research-status c: ri-halberdier >= research-pending)
	(up-research-status c: ri-champion >= research-pending)))
	(unit-type-count-total infantry-class >= 7)
	(can-research ri-druzhina)
=>
	(research ri-druzhina))
(defrule
	(up-compare-goal urgoal != yes)
(or	(goal escrowing no)
	(unit-type-count-total infantry-class >= 28))
	(unit-type-count-total infantry-class >= 21)
	(goal underattack no)
=>
	(set-goal urgoal yes))
#end-if
#else; tatars
(defrule
(or	(unit-type-count-total cavalry-archer-line >= 7)
(or	(unit-type-count-total scout-cavalry >= 7)
(or	(up-compare-goal steppe-lancer-set >= 7)
	(unit-type-count-total scout-cavalry-line >= 7))))
(or	(up-compare-goal strategy-type <= castle-war)
	(strategic-number sn-current-age >= imperial))
	(can-research ri-silk-armor)
=>
	(research ri-silk-armor))
(defrule
(or	(up-research-status c: ri-heavy-cavalry-archer >= research-pending)
	(and	(up-research-status c: imperial-age == research-pending)
		(up-research-status c: ri-bodkin-arrow >= research-pending)))
	(up-research-status c: imperial-age >= research-pending)
	(current-age >= castle-age)
(or	(unit-type-count-total cavalry-archer-line >= 28)
	(strategic-number sn-current-age >= imperial))
	(can-research ri-silk-armor)
=>
	(research ri-silk-armor))
(defrule
	(up-research-status c: ri-hussar >= research-pending)
(or	(unit-type-count-total scout-cavalry-line >= 9)
	(goal trainhussar yes))
	(unit-type-count-total scout-cavalry-line >= 3)
	(can-research ri-silk-armor)
=>
	(research ri-silk-armor))
(defrule
(or	(unit-type-count-total mercenary-kipchak >= 10)
(or	(up-research-status c: ri-elite-genitour >= research-pending)
(or	(up-research-status c: ri-elite-steppe-lancer >= research-pending)
(or	(unit-type-count-total genitour >= 10)
(or	(unit-type-count-total elite-genitour >= 10)
	(unit-type-count-total genitour-placeholder >= 10))))))
	(can-research ri-silk-armor)
=>
	(research ri-silk-armor))
(defrule
	(unit-type-count-total trebuchet-set >= 2)
(or	(unit-type-count-total trebuchet-set >= 3)
	(goal traintrebuchet yes))
	(can-research ri-timurid-siegecraft)
=>
	(research ri-timurid-siegecraft)
	(set-goal researchplan yes))
(defrule
	(up-compare-goal cavagoal != yes)
	(up-compare-goal strategy != fast-imp)
	(up-research-status c: ri-silk-armor >= research-pending)
	(up-research-status c: imperial-age >= research-pending); (current-age >= imperial-age)
	(goal palagoal no)
	(goal champgoal no)
	(goal uugoal no)
=>
	(set-goal cavagoal yes))
(defrule
	(up-compare-goal uugoal != yes)
	(up-research-status c: imperial-age >= research-pending); (current-age >= imperial-age)
	(goal palagoal no)
	(goal champgoal no)
(or	(goal cavagoal no)
	(and	(up-compare-goal tradeunits >= 5)
		(and	(up-research-status c: ri-heavy-cavalry-archer >= research-pending)
			(population >= max-civ-pop))))
=>
	(set-goal uugoal yes))
#end-if
#else; vietnamese
(defrule
(or	(up-compare-goal battle-elephant-set >= 4)
	(up-research-status c: ri-elite-battle-elephant >= research-pending))
(or	(up-compare-goal strategy-type <= castle-war)
	(strategic-number sn-current-age >= imperial))
	(can-research ri-chatras)
=>
	(research ri-chatras))
(defrule
(or	(and	(player-in-game any-ally)
		(or	(up-allied-resource-amount any-ally gold < 1000)
			(up-compare-goal excessGold < 1000)))
(or	(up-compare-goal excessGold < 300)
	(and	(up-compare-goal tradeunits < 9)
		(up-gaia-type-count c: gold < 4))))
	(can-research ri-paper-money)
=>
	(research ri-paper-money)
	(set-goal researchplan yes))
(defrule
	(up-compare-goal urgoal != yes)
(or	(and	(player-in-game any-ally)
		(or	(up-allied-resource-amount any-ally gold < 500)
			(up-compare-goal excessGold < 500)))
(or	(up-compare-goal excessGold < 200)
	(and	(up-compare-goal tradeunits < 6)
		(up-gaia-type-count c: gold < 2))))
	(goal underattack no)
=>
	(set-goal urgoal yes))
#end-if
#else; burgundians
(defrule
	(up-compare-goal excessFood >= 700)
(or	(commodity-selling-price food < 50)
(or	(building-type-count-total market <= 0)
	(up-compare-goal excessFood >= 1000)))
(or	(up-compare-goal excessGold < 500)
(or	(strategic-number sn-food-gatherer-percentage >= 50)
	(up-compare-goal excessFood >= 2200)))
	(can-research ri-burgundian-vineyards)
=>
	(research ri-burgundian-vineyards))
(defrule
(or	(up-compare-goal excessFood >= 1400)
(or	(up-compare-goal custom-civ-pop >= up-max-civ)
(or	(population >= max-civ-pop)
(or	(up-compare-goal tradeunits <= 3)
	(unit-type-count villager-farmer >= 30)))))
	(can-research ri-burgundian-vineyards)
=>
	(research ri-burgundian-vineyards))
(defrule
(or	(building-type-count town-center <= 0)
(or	(up-compare-goal gl-treaty-time >= 1)
	(and	(up-compare-goal custom-civ-pop < up-max-civ)
		(and	(population < max-civ-pop)
			(unit-type-count villager < min-number-vills)))))
=>
	(up-jump-rule 2))
(defrule
(or	(up-compare-goal relic-count >= 1)
	(up-compare-goal excessFood >= 1000))
(or	(and	(strategic-number sn-military-superiority <= -2)
		(goal underattack yes))
	(and	(goal attacking yes)
		(and	(building-type-count town-center >= 3)
			(or	(up-compare-goal relic-count >= 3)
				(building-type-count town-center >= 5)))))
	(can-research ri-flemish-revolution)
=>
	(research ri-flemish-revolution))
(defrule
	(up-compare-goal urgoal != yes)
	(goal underattack yes)
	(strategic-number sn-military-superiority <= -3)
(or	(strategic-number archers < 33)
(or	(strategic-number cavalry >= 10)
	(strategic-number siege >= 10)))
=>
	(set-goal urgoal yes))
(defrule
	(goal palagoal yes)
	(goal uugoal yes)
	(up-research-status c: ri-cavalier >= research-pending)
	(up-research-status c: my-unique-unit-upgrade <= research-available)
	(up-compare-goal excessFood < 1000)
	(up-compare-goal excessGold < 800)
	(up-compare-goal tradeunits < 10)
=>
	(set-goal uugoal no)
	(up-jump-rule 1))
(defrule
	(up-compare-goal uugoal != yes)
	(strategic-number sn-current-age >= cimperial)
	(goal palagoal no)
=>
	(set-goal uugoal yes))
#end-if
#else; sicilians

(defrule
	(building-type-count town-center >= 1)
(or	(building-type-count town-center >= 2)
	(not	(building-available town-center)))
(or	(building-type-count town-center >= 5)
(or	(goal underattack yes)
(or	(goal attacking yes)
	(and	(goal siegereq yes)
		(population >= del-civ-pop)))))
	(can-research ri-first-crusade)
=>
	(research ri-first-crusade))
#load-if-defined COMMENT-OUT ;if balance changes are reversed, restore this code
(defrule
(or	(military-population >= 2)
	(players-military-population any-ally >= 2))
(or	(and	(up-compare-goal excessGold < 225)
		(military-population >= 50))
(or	(population >= del-civ-pop)
	(players-population any-ally >= del-civ-pop)))
	(can-research ri-scutage)
=>
	(research ri-scutage))
#end-if
(defrule
	(current-age == imperial-age)
	(can-research ri-scutage)
	(unit-type-count-total knight-line > 3)
	(up-research-status c: ri-cavalier != 1)
	(up-research-status c: ri-plate-barding != 1)
=>
	(research ri-scutage)
)

(defrule
	(population > eighty-pop) ;research anyway if we have tons of resources with nothing better to do
	(food-amount > 2000)
	(wood-amount > 2000)
	(gold-amount > 1500)
	(current-age == imperial-age)
	(current-age-time > 300)
	(can-research ri-scutage)
=>
	(research ri-scutage)
)

(defrule
	(current-age == imperial-age)
	(unit-type-count-total knight-line > 2)
	(can-research ri-cavalier)
	(or(unit-type-count-total archer-line < 10)
	(and(up-research-status c: ri-arbalest != 1)
	(up-research-status c: ri-bracer != 1)));prioritise arb/bracer if relevant
=>
	(research ri-cavalier)
)


(defrule
	(current-age == imperial-age)
	(unit-type-count-total knight-line > 2)
	(can-research ri-plate-barding)
	(or(unit-type-count-total archer-line < 10)
	(and(up-research-status c: ri-arbalest != 1)
	(up-research-status c: ri-bracer != 1)))
=>
	(research ri-plate-barding)
)

(defrule
	(current-age == imperial-age)
	(food-amount > 1500)
	(gold-amount > 1000)
	(wood-amount > 1500)
	(current-age-time  > 300)
	(population > eighty-pop)
	(can-research ri-cavalier)
=>
	(research ri-cavalier)
)

(defrule
	(research-completed ri-onager)
	(can-research ri-cavalier)
=>
	(research ri-cavalier)
)

(defrule
	(up-compare-goal urgoal != yes)
	(goal underattack no)
(or	(military-population >= 30)
	(players-military-population any-ally >= 60))
(or	(and	(up-compare-goal excessGold < 200)
		(military-population >= 60))
(or	(population >= del-civ-pop)
	(players-population any-ally >= del-civ-pop)))
=>
	(set-goal urgoal yes))
#end-if
#else; Poles
(defrule
	(up-compare-goal uugoal != yes)
	(strategic-number sn-current-age >= cimperial)
(or	(up-research-status c: my-unique-unit-upgrade >= research-pending)
	(goal palagoal no))
=>
	(set-goal uugoal yes))
(defrule
(or	(goal strategy krush)
(or	(up-research-status c: ri-cavalier >= research-pending)
	(goal palagoal yes)))
	(can-research ri-szlachta-privileges)
=>
	(research ri-szlachta-privileges))
(defrule
(or	(up-research-status c: ri-winged-hussar >= research-pending)
(or	(population >= max-pop)
(or	(not	(player-in-game any-ally))
	(goal researchplan yes))))
	(can-research ri-lechitic-legacy)
=>
	(research ri-lechitic-legacy))
(defrule
	(up-research-status c: ri-winged-hussar >= research-pending)
(or	(goal trainhussar yes)
	(unit-type-count-total scout-cavalry-line >= 10))
=>
	(set-goal urgoal yes))
#end-if
#else; Bohemians
(defrule
	(up-compare-goal uugoal != yes)
	(strategic-number sn-current-age >= cimperial)
;(or	(up-research-status c: my-unique-unit-upgrade >= research-pending)
=>
	(set-goal uugoal yes))
(defrule
(or	(unit-type-count-total hand-cannoneer >= 7)
(or	(unit-type-count-total my-unique-unit-line >= 4)
(or	(unit-type-count-total bombard-cannon-line >= 1)
	(unit-type-count-total cannon-galleon-line >= 1))))
	(can-research ri-wagenburg-tactics)
=>
	(research ri-wagenburg-tactics))
(defrule
(or	(goal trainmonk yes)
	(unit-type-count-total monastery-class >= 2))
	(can-research ri-hussite-reforms)
=>
	(research ri-hussite-reforms))
#end-if

(defrule ; tbs
	(strategic-number sn-current-age >= imperial)
(or	(up-compare-goal tradeunits >= 60)
	(and	(and	(up-compare-goal excessWood >= 4000)
			(up-compare-goal excessFood >= 4000))
		(up-compare-goal excessGold >= 4000)))
	(up-compare-goal researchplan != yes)
=>
	(set-goal researchplan yes))
;=============================================================
(defrule
	(goal strategy fast-imp)
	(goal uugoal yes)
	(building-type-count-total castle <= 0)
	(up-compare-goal total-stone-amount < castle-stone)
=>
	(set-goal uugoal no))
;=============================================================
;
; Economic research
;
;=============================================================
;=============================================================
; Villager upgrades
;=============================================================
(defrule
	(goal strategy fast-imp)
	(strategic-number sn-current-age <= castlea)
	(up-research-status c: imperial-age <= research-available)
(or	(up-compare-goal excessWood < fiprep-cost)
	(up-compare-goal excessFood < imperial-fs))
=>
	(up-jump-rule 6))
(defrule
	(up-compare-goal custom-civ-pop < min-number-vills)
	(unit-type-count-total villager < 12)
	(population-headroom >= 16)
	(population < max-civ-pop)
	(civilian-population < up-max-civ)
(or	(housing-headroom >= 8)
	(game-time < 32))
=>
	(up-jump-rule 5))
(defrule
	(strategic-number sn-current-age <= dark)
	(up-compare-goal custom-civ-pop < up-max-civ)
	(population < max-civ-pop)
(or	(building-type-count-total town-center <= 1)
	(food-amount < 675))
=>
	(up-jump-rule 3))
(defrule
(or	(and	(goal strategy sling)
		(up-research-status c: ri-coinage != research-available))
	(and	(up-compare-goal strategy-type == feudal-war)
		(and	(unit-type-count-total villager >= 27)
			(or	(up-compare-goal total-food-amount >= castle-f2)
				(or	(building-type-count-total blacksmith >= 1)
					(research-available castle-age))))))
;	(up-compare-goal escrowing == 0)
	(can-research ri-wheel-barrow)
=>
	(research ri-wheel-barrow))
(defrule
(or	(strategic-number sn-current-age >= fcastlea)
(or	(unit-type-count-total villager >= 36)
	(and	(up-compare-goal strategy-type == feudal-war)
		(and	(wood-amount >= 225)
			(and	(up-research-status c: ri-double-bit-axe >= research-pending)
				(up-research-status c: ri-horse-collar >= research-pending))))))
;	(up-compare-goal escrowing == 0)
	(can-research ri-wheel-barrow)
=>
	(research ri-wheel-barrow))
(defrule
(or	(strategic-number sn-current-age >= fcastlea)
(or	(and	(up-compare-goal total-food-amount < castle-f2)
		(housing-headroom <= 0))
	(up-compare-goal total-food-amount < castle-feco)))
	(building-type-count-total farm >= 12)
	(unit-type-count villager-farmer >= 11)
	(can-research ri-wheel-barrow)
=>
	(research ri-wheel-barrow)); end first jump
(defrule
(or	(unit-type-count-total villager >= 60)
	(building-type-count-total town-center >= 3))
(or	(unit-type-count-total villager >= min-number-vills); 65
(or	(unit-type-count-total villager >= 50)
(or	(population >= max-civ-pop)
(or	(up-compare-goal custom-civ-pop >= up-max-civ)
	(civilian-population >= up-max-civ)))))
	(can-research ri-hand-cart)
=>
	(research ri-hand-cart)); end jump
;=============================================================
; Lumber upgrades
;=============================================================
(defrule
	(strategic-number sn-current-age <= dark)
(or	(and	(up-compare-goal excessFood < 100)
		(up-pending-objects c: villager <= 1))
	(and	(up-compare-goal excessWood < 150)
		(and	(building-type-count-total mill <= 0)
			(up-research-status c: feudal-age <= research-available))))
=>
	(up-jump-rule 2))
(defrule
(or	(strategic-number sn-current-age >= fcastlea)
(or	(and	(goal strategy-type feudal-war)
		(or	(building-type-count-total archery-range >= 1)
			(building-type-count-total stable >= 1)))
	(and	(food-amount >= db-food-buffer);	(up-compare-goal total-food-amount >= db-food-buffer)
		(or	(building-type-count-total blacksmith >= 1)
			(research-available castle-age)))))
	(can-research ri-double-bit-axe)
=>
	(research ri-double-bit-axe))
(defrule
(or	(goal strategy sling)
(or	(and	(building-type-count-total town-center >= 2)
		(up-compare-goal total-food-amount < castle-f2))
	(up-compare-goal total-food-amount < castle-feco)))
	(can-research ri-double-bit-axe)
=>
	(research ri-double-bit-axe)); end jump
;=============================================================
(defrule
	(goal strategy fast-imp)
	(strategic-number sn-current-age <= castlea)
	(up-research-status c: imperial-age <= research-available)
(or	(up-compare-goal excessWood < fiprep-cost)
	(up-compare-goal excessFood < imperial-fs))
=>
	(up-jump-rule 1))
(defrule
(or	(strategic-number sn-current-age == fcastlea)
(or	(up-research-status c: ri-wheel-barrow >= research-pending)
(or	(unit-type-count-total villager >= 32)
(or	(goal dreitc yes)
(or	(stone-amount < tc-stone)
(or	(civilian-population >= up-max-civ)
	(population >= max-civ-pop)))))))
	(can-research ri-bow-saw)
=>
	(research ri-bow-saw)); end jump
;=============================================================
#load-if-not-defined DIFFICULTY-EASIEST
#load-if-not-defined DIFFICULTY-EASY
#load-if-not-defined DIFFICULTY-MODERATE
(defrule
(or	(strategic-number sn-current-age >= cimperial)
(or	(up-research-status c: ri-hand-cart >= research-pending)
	(and	(up-compare-goal excessFood >= 300)
		(up-compare-goal excessWood >= 400))))
	(can-research ri-two-man-saw)
=>
	(research ri-two-man-saw))
#end-if
#end-if
#end-if
;=============================================================
; Farm upgrades
;=============================================================
;(defrule
;	(goal strategy a-rush)
;	(building-type-count-total town-center <= 1)
;(or	(unit-type-count forage-count >= 2)
;	(up-compare-goal mysheep >= 2))
;	(civilian-population < 36); 39
;	(food-amount < 400)
;(or	(up-research-status c: ri-bodkin-arrow < research-pending)
;	(up-research-status c: ri-crossbow < research-pending))
;=>
;	(up-jump-rule 8))
(defrule
	(strategic-number sn-current-age <= dark)
	(up-research-status c: ri-double-bit-axe > 1)
	(nand(goal strategy-type2 water)
	(unit-type-count-total fishing-ship > 3))
(or	(up-compare-goal strategy-type == feudal-war)
(or	(and	(up-compare-goal excessFood < 75)
		(up-pending-objects c: villager <= 1))
	(and	(up-compare-goal excessWood < 175)
		(building-type-count-total lumber-camp <= 0))))
=>
	(up-jump-rule 7))
(defrule
(or	(and	(up-research-status c: ri-double-bit-axe == research-available)
		(or	(up-compare-goal total-food-amount >= 175)
			(or	(unit-type-count villager-food >= 6)
				(building-type-count-total farm g:>= maxfarms))))
	(and	(game-time < 5)
		(up-compare-goal excessFood <= 225)))
=>
	(up-jump-rule 6))
(defrule
	(goal strategy fast-imp)
	(strategic-number sn-current-age <= castlea)
	(up-research-status c: imperial-age <= research-available)
(or	(up-compare-goal excessWood < fiprep-cost)
	(up-compare-goal excessFood < imperial-fs))
=>
	(up-jump-rule 5))
(defrule
	(building-type-count-total farm g:>= maxfarms)
(or	(unit-type-count villager-forager g:<= forage-count)
	(building-type-count-total farm >= 7))
	(current-age <= feudal-age)
	(up-compare-goal total-food-amount < 175); (
	(current-age-time < 75)
(or	(up-compare-goal forage-count >= 1)
;	(and
	(dropsite-min-distance hunting s:<= sn-maximum-hunt-drop-distance)
;		(unit-type-count villager-hunter >= 1))
)
	(up-research-status c: ri-fletching == research-available)
	(up-research-status c: ri-wheel-barrow == research-available)
	(up-research-status c: castle-age == research-available)
=>
	(up-jump-rule 4))
(defrule
	(unit-type-count fishing-ship >= 9)
	(unit-type-count villager < 33)
	(wood-amount < 175)
	(strategic-number sn-food-gatherer-percentage <= 24)
(or	(up-compare-goal strategy-type2 == water)
	(strategic-number sn-food-gatherer-percentage <= 16))
(or	(up-gaia-type-count c: shore-fish-class >= 1)
	(up-gaia-type-count c: ocean-fish-class >= 1))
=>
	(up-jump-rule 3))
(defrule
(or	(and	(goal enemy-goal flush) ;(goal strategy-type feudal-war)
		(or	(building-type-count-total stable >= 1)
			(building-type-count-total archery-range >= 1)))
(or	(and	(food-amount >= hc-food-buffer);	(up-compare-goal total-food-amount >= hc-food-buffer)
		(or	(building-type-count-total blacksmith >= 1)
			(research-available castle-age)))
	(up-compare-goal total-food-amount < castle-feco)))
	(can-research ri-horse-collar)
=>
	(research ri-horse-collar))
(defrule
(or	(and	(goal strategy-type feudal-war)
		(building-type-count-total blacksmith >= 1))
(or	(and	(goal strategy r-flush)
		(building-type-count-total blacksmith >= 1))
	(and	(goal strategy s-flush)
		(building-type-count-total stable >= 1))))
	(can-research ri-horse-collar)
=>
	(research ri-horse-collar))
(defrule
(or	(strategic-number sn-current-age >= fcastlea)
(or	(and	(building-type-count-total town-center >= 2)
		(up-compare-goal total-food-amount < castle-f2))
	(and	(goal maa-var yes)
		(building-type-count-total barracks >= 1))))
	(can-research ri-horse-collar)
=>
	(research ri-horse-collar)); end big jump

	
;=============================================================
(defrule
	(up-research-status c: ri-bow-saw >= research-pending)
(or	(up-compare-goal custom-civ-pop >= up-max-civ)
(or	(unit-type-count-total villager >= 42)
(or	(population >= max-civ-pop)
(or	(goal dreitc yes)
(or	(and	(strategic-number sn-current-age == fcastlea)
		(building-type-count-total farm g:< maxfarms))
	(strategic-number sn-military-superiority >= 1))))))
	(can-research ri-heavy-plow)
=>
	(research ri-heavy-plow))
(defrule
	(up-research-status c: ri-bow-saw >= research-pending)
(or	(up-research-status c: ri-hand-cart >= research-pending)
(or	(stone-amount < tc-stone)
	(civilian-population >= up-max-civ)))
	(can-research ri-heavy-plow)
=>
	(research ri-heavy-plow))
;=============================================================
#load-if-not-defined DIFFICULTY-EASIEST
#load-if-not-defined DIFFICULTY-EASY
#load-if-not-defined DIFFICULTY-MODERATE
(defrule
(or	(strategic-number sn-current-age >= cimperial)
(or	(up-research-status c: ri-hand-cart >= research-pending)
	(and	(up-compare-goal excessFood >= 275)
		(up-compare-goal excessWood >= 450))))
	(can-research ri-crop-rotation)
=>
	(research ri-crop-rotation))
#end-if
#end-if
#end-if
;=============================================================
; Mining
;=============================================================
(defrule
	(strategic-number sn-current-age <= dark)
(or	(food-amount < feudal-fs)
	(and	(wood-amount < raxcamp-cost)
		(up-research-status c: feudal-age <= research-unavailable)))
=>
	(up-jump-rule 2))
(defrule
	(unit-type-count-total villager-gold >= 1)
(or	(food-amount >= imperial-fs)
(or	(strategic-number sn-current-age >= imperial)
	(unit-type-count villager-gold >= 7))); 10
(or	(strategic-number sn-current-age >= fcastlea)
	(food-amount >= castle-fs))
(or	(up-research-status c: ri-wheel-barrow != research-available)
	(current-age <= feudal-age))
	(up-research-status c: ri-double-bit-axe != research-available)
	(up-research-status c: ri-horse-collar != research-available)
	(can-research ri-gold-mining)
=>
	(research ri-gold-mining))
(defrule
	(unit-type-count-total villager-gold >= 1)
	(up-research-status c: ri-bow-saw >= research-pending)
	(up-research-status c: ri-heavy-plow >= research-pending)
(or	(building-type-count-total town-center >= 2)
(or	(unit-type-count-total villager >= 45)
(or	(goal dreitc yes)
	(up-research-status c: ri-wheel-barrow >= research-pending)))); 2; 1
(or	(gold-amount < imperial-gold); 800
	(unit-type-count villager-gold >= 4))
	(can-research ri-gold-mining)
=>
	(research ri-gold-mining))
(defrule
	(unit-type-count villager-gold >= 4)
	(up-compare-goal excessGold < 150)
	(up-research-status c: ri-bow-saw >= research-pending)
	(building-type-count-total town-center >= 2)
(or	(up-research-status c: ri-heavy-plow >= research-pending)
(or	(up-research-status c: ri-hand-cart >= research-pending)
(or	(unit-type-count-total villager >= 45)
	(goal dreitc yes))))
	(can-research ri-gold-mining)
=>
	(research ri-gold-mining))
(defrule
	(unit-type-count-total villager-gold >= 4); 1
	(strategic-number sn-gold-gatherer-percentage >= 1)
	(building-type-count dock >= 1)
	(up-compare-goal navycount >= 1); hmm
	(goal enemy-boats yes)
	(strategic-number sn-current-age >= fcastlea)
(or	(up-research-status c: ri-wheel-barrow >= research-pending)
	(current-age <= feudal-age))
	(up-research-status c: ri-double-bit-axe >= research-pending)
	(can-research ri-gold-mining)
=>
	(research ri-gold-mining))
(defrule
	(unit-type-count-total villager-gold >= 4); 3
	(strategic-number sn-gold-gatherer-percentage >= 1)
	(goal strategy r-flush)
	(goal sk-var no)
	(up-research-status c: ri-horse-collar >= research-pending)
	(up-research-status c: ri-double-bit-axe >= research-pending)
	(up-research-status c: ri-wheel-barrow >= research-pending); test
	(building-type-count-total blacksmith >= 1)
(or	(building-type-count-total archery-range >= 2)
(or	(building-type-count-total stable >= 1); 2
	(building-type-count-total market >= 1)))
	(can-research ri-gold-mining)
=>
	(research ri-gold-mining))
(defrule
	(unit-type-count-total villager-gold >= 4); 3
	(strategic-number sn-gold-gatherer-percentage >= 1)
	(goal strategy grush)
	(up-research-status c: ri-double-bit-axe >= research-pending)
;	(up-research-status c: ri-wheel-barrow >= research-pending)
	(building-type-count-total dock >= 1)
(or	(wood-amount >= 200)
	(building-type-count-total dock >= 2))
	(can-research ri-gold-mining)
=>
	(research ri-gold-mining))
(defrule
	(unit-type-count-total villager-gold >= 3)
	(strategic-number sn-gold-gatherer-percentage >= 1)
	(goal strategy sling)
	(up-research-status c: ri-horse-collar >= research-pending)
	(up-research-status c: ri-double-bit-axe >= research-pending)
	(up-research-status c: ri-wheel-barrow >= research-pending)
	(up-research-status c: ri-coinage != research-available)
(or	(wood-amount >= 225)
	(building-type-count-total market >= 1))
	(can-research ri-gold-mining)
=>
	(research ri-gold-mining))
(defrule
(or	(strategic-number sn-gold-gatherer-percentage <= 0)
(or	(and	(strategic-number sn-current-age <= feudal)
		(food-amount < db-food-buffer))
(or	(and	(up-compare-goal strategy != a-rush)
		(up-compare-goal strategy != ca-rush))
	(and	(up-research-status c: ri-bodkin-arrow == research-available)
		(food-amount < 300)))))
=>
	(up-jump-rule 1))
(defrule
	(unit-type-count-total villager-gold >= 4); 3
	(goal strategy a-rush)
;	(up-research-status c: ri-horse-collar >= research-pending)
	(up-research-status c: ri-double-bit-axe >= research-pending)
	(up-research-status c: ri-wheel-barrow >= research-pending)
(or	(building-type-count-total town-center >= 2)
	(civilian-population >= 36)); 33
(or	(building-type-count-total archery-range >= 2)
	(building-type-count-total stable >= 1)); 2
	(can-research ri-gold-mining)
=>
	(research ri-gold-mining))
(defrule
	(strategic-number sn-current-age <= feudal)
	(food-amount >= db-food-buffer)
	(strategic-number sn-gold-gatherer-percentage >= 1)
	(unit-type-count villager-gold >= 1)
	(up-research-status c: ri-double-bit-axe != research-available)
	(up-research-status c: ri-horse-collar != research-available)
	(up-research-status c: ri-wheel-barrow != research-available)
	(can-research ri-gold-mining)
=>
	(research ri-gold-mining)); end jump
;=============================================================
#load-if-not-defined DIFFICULTY-EASIEST
#load-if-not-defined DIFFICULTY-EASY
#load-if-not-defined DIFFICULTY-MODERATE
(defrule
	(unit-type-count-total villager-gold >= 1)
(or	(unit-type-count villager-gold >= 12); 10
(or	(food-amount >= 1200)
	(strategic-number sn-current-age >= imperial)))
	(can-research ri-gold-shaft-mining)
=>
	(research ri-gold-shaft-mining))
;=============================================================
(defrule
	(unit-type-count-total villager-gold >= 9); 8
	(up-compare-goal total-gold-amount < imperial-gold); 200
	(up-compare-goal strategy-type <= castle-war)
	(goal dreitc yes)
	(up-research-status c: ri-bow-saw >= research-pending)
	(up-research-status c: ri-heavy-plow >= research-pending)
	(up-research-status c: ri-hand-cart >= research-pending)
	(can-research ri-gold-shaft-mining)
=>
	(research ri-gold-shaft-mining))
#end-if
#end-if
#end-if
;=============================================================
(defrule
	(unit-type-count-total villager-stone >= 2); 3
(or	(strategic-number sn-current-age >= imperial)
	(and	(unit-type-count-total villager-stone >= 4); 3
		(and	(strategic-number sn-military-superiority >= 1); 1 = test (it's also cheap)
			(up-research-status c: ri-hand-cart >= research-pending))))
	(goal dreitc yes)
	(goal underattack no)
	(can-research ri-stone-mining)
=>
	(research ri-stone-mining))
;=============================================================
(defrule
	(unit-type-count-total villager-stone >= 2); 3
	(strategic-number sn-stone-gatherer-percentage >= 1)
	(goal strategy sling)
	(up-research-status c: ri-horse-collar >= research-pending)
	(up-research-status c: ri-double-bit-axe >= research-pending)
	(up-research-status c: ri-wheel-barrow >= research-pending)
	(up-research-status c: ri-coinage != research-available)
	(up-research-status c: ri-gold-mining >= research-pending)
(or	(wood-amount >= 225)
	(building-type-count-total market >= 1))
	(can-research ri-stone-mining)
=>
	(research ri-stone-mining))
;=============================================================
(defrule
	(unit-type-count-total villager-stone >= 2); 3
	(strategic-number sn-stone-gatherer-percentage >= 1)
	(goal strategy castledrop)
	(stone-amount < 200)
	(building-type-count-total castle <= 0)
	(up-research-status c: ri-horse-collar >= research-pending)
	(up-research-status c: ri-double-bit-axe >= research-pending)
;	(up-research-status c: ri-wheel-barrow >= research-pending)
	(up-research-status c: castle-age >= research-pending)
	(can-research ri-stone-mining)
=>
	(research ri-stone-mining))
;=============================================================
#load-if-not-defined DIFFICULTY-EASIEST
#load-if-not-defined DIFFICULTY-EASY
#load-if-not-defined DIFFICULTY-MODERATE
(defrule
	(unit-type-count-total villager-stone >= 3); 2
	(goal dreitc yes)
	(goal underattack no)
	(up-research-status c: ri-hand-cart != research-available)
(or	(strategic-number sn-current-age >= imperial)
	(unit-type-count-total villager-stone >= 12)); 9;	(strategic-number sn-military-superiority >= 1)); 1 = test (it's also cheap)
(or	(and	(building-type-count-total castle < 3)
		(goal uugoal yes))
	(unit-type-count-total villager-stone >= 9))
;	(stone-amount < castle-stone)
	(can-research ri-stone-shaft-mining)
=>
	(research ri-stone-shaft-mining))
#end-if
#end-if
#end-if
;=============================================================
; Loom
;=============================================================
#load-if-not-defined UP-MICHI-STYLE ;don't research loom in michi until late castle, pointless upgrade

(defrule
	(can-research ri-loom)
	(goal walling-player yes)
	(unit-type-count-total villager > 15)
=>
	(research ri-loom)
)
(defrule
	(up-compare-const de-game == 1)
	(civ-selected gothic)
	(wall-completed-percentage 1 < 100)
	(wall-completed-percentage 2 < 100)
	(can-research ri-loom)
=>
;	(chat-local-to-self ".0")
	(research ri-loom))
(defrule
	(current-age == dark-age)
;	(game-time < 3); 5/5 at the start
(or	(town-under-attack)
(or	(and	(housing-headroom <= 0)
		(up-pending-objects c: house <= 0))
	(and	(unit-type-count villager-food <= 1); scout?
		;(and	(unit-type-count fishing-ship <= 0)
			(up-compare-goal total-food-amount < 42))));)
	(can-research ri-loom)
=>
;	(chat-local-to-self ".1")
	(research ri-loom)
	(enable-timer FDrop 21))
(defrule
;	(game-time < 3); 5/5 at the start
(or	(goal underattack yes)
(or	(goal defend yes)
(or	(up-compare-goal targetdistance < 32)
	(up-compare-goal targetdistance s:< sn-safe-town-size))))
(or	(unit-type-count-total villager >= 9)
	(up-compare-goal custom-civ-pop >= up-max-civ))
(or	(enemy-buildings-in-town)
	(players-military-population any-enemy >= 2))
	(can-research ri-loom)
=>
;	(chat-local-to-self ".1,5")
	(research ri-loom)
	(enable-timer FDrop 21))
;=============================================================
(defrule
	(current-age == dark-age)
	(up-research-status c: feudal-age <= research-available)
	(up-pending-objects c: villager <= 0)
(or	(and	(unit-type-count-total villager <= 7)
		(up-compare-goal total-food-amount < 25))
	(and	(unit-type-count-total villager <= 11)
		(up-compare-goal total-food-amount < 15)))
	(can-research ri-loom)
=>
;	(chat-local-to-self ".2")
	(research ri-loom)
	(enable-timer FDrop 21))
;=============================================================
(defrule
	(current-age == dark-age)
	(up-research-status c: feudal-age <= research-available)
	(up-compare-goal total-food-amount < 50)
(or	(and	(up-pending-objects c: villager <= 0)
		(unit-type-count villager-food <= 0))
	(and	(up-timer-status FDrop != timer-running)
		(up-pending-objects c: villager == 1)))
	(can-research ri-loom)
=>
;	(chat-local-to-self ".3")
	(research ri-loom)
	(enable-timer FDrop 21))
;=============================================================
(defrule
	(current-age == dark-age)
	(up-compare-goal gl-game-time >= 2)
(or	(unit-type-count-total villager >= 20)
	(goal defend yes))
(not	(civ-selected magyar))
	(can-research ri-loom)
=>
	(up-full-reset-search)
	(up-set-target-point position-self-x)
	(up-filter-distance c: -1 c: 32)
	(up-filter-status c: status-ready c: list-active)
	(up-find-resource c: dangerous-animal-class c: 24)
	(up-remove-objects search-remote object-data-maxhp > 75)
	(up-remove-objects search-remote object-data-carry <= 0)
	(up-get-search-state local-total))
(defrule
	(current-age == dark-age)
	(up-compare-goal gl-game-time >= 2)
	(up-compare-goal remote-total >= 3); 4
(or	(unit-type-count-total villager >= 20)
	(goal defend yes))
(not	(civ-selected magyar))
	(can-research ri-loom)
=>
;	(chat-local-to-self ".4")
	(research ri-loom)
	(enable-timer FDrop 21))
#end-if

#load-if-defined UP-MICHI-STYLE

(defrule
(can-research ri-loom)
(or(game-time > 1800) ;Fastest cut build order is ~30 minutes 4TC celts stopping at 85 pop
(unit-type-count-total villager > fifty-pop))
=>
(research ri-loom)
)

#end-if

#load-if-not-defined UP-MICHI-STYLE
;=============================================================
(defrule
	(goal strategy fast-imp)
	(up-compare-goal custom-civ-pop < fi-vills)
=>
	(up-jump-rule 1))
(defrule
	(current-age == dark-age)
	(up-compare-goal gl-game-time >= 2)
	(unit-type-count-total villager >= 20)
(or	(goal position-goal flank)
	(unit-type-count-total villager >= 24))
	(and	(or	(up-compare-goal strategy-type == feudal-war)
				(unit-type-count-total villager >= darkvills))
		(and	(up-compare-goal total-food-amount < 460)
			(up-compare-goal total-food-amount < feudal-f2)))
	(can-research ri-loom)
=>
;	(chat-local-to-self ".4,5")
	(research ri-loom)
	(enable-timer FDrop 21)); end jump
;=============================================================
(defrule
	(current-age == dark-age)
	(up-compare-goal gl-game-time >= 2)
	(up-compare-goal scouting-unit <= -1);(military-population <= 0)
(not	(civ-selected magyar))
(or	(strategic-number sn-cap-civilian-explorers >= 1)
	(strategic-number sn-minimum-civilian-explorers >= 1))
(or	(cc-players-unit-type-count 0 wolf >= 2)
	(cc-players-unit-type-count 0 jaguar >= 2))
	(unit-type-count-total villager >= 1)
	(can-research ri-loom)
=>
;	(chat-local-to-self ".5")
	(research ri-loom)
	(enable-timer FDrop 21))
;=============================================================
(defrule
	(civilian-population < up-max-civ)
	(population < max-civ-pop)
	(up-compare-goal custom-civ-pop < up-max-civ)
	(unit-type-count-total villager < min-number-vills)
	(unit-type-count-total villager < 8)
	(up-compare-goal my-cpop g:< minBoar)
=>
	(up-jump-rule 2))
(defrule
(or	(strategic-number sn-current-age >= fcastlea)
	(and	(or	(up-compare-goal strategy-type == feudal-war)
			(goal strategy sling))
		(strategic-number sn-current-age >= dfeudal)))
	(can-research ri-loom)
=>
;	(chat-local-to-self ".6")
	(research ri-loom)
	(enable-timer FDrop 21))
(defrule
(or	(players-current-age target-player >= feudal-age)
	(players-military-population target-player >= 2)); 3
(or	(and	(wall-completed-percentage 2 < 100)
		(wall-completed-percentage 1 < 100))
(or	(up-enemy-units-in-town >= 1)
(or	(goal defend yes)
	(goal underattack yes))))
	(can-research ri-loom)
=>
;	(chat-local-to-self ".6")
	(research ri-loom)
	(enable-timer FDrop 21)); end jump
#end-if
;=============================================================
(defrule
	(strategic-number sn-maximum-gaia-attack-response > 2)
	(research-completed ri-loom)
=>
	(set-strategic-number sn-maximum-gaia-attack-response 2))
(defrule
	(strategic-number sn-maximum-gaia-attack-response > 1)
	(research-completed ri-supremacy)
=>
	(set-strategic-number sn-maximum-gaia-attack-response 1))
;=============================================================
; Teams
;=============================================================
#load-if-not-defined WONDER-RACE
(defrule
;	(goal researchplan no)
;	(game-time < 3000)
;	(up-compare-goal tradeunits < maxcartspop)
;	(up-compare-goal tradeunits < maxcartssize)
(or	(goal underattack yes)
(or	(and	(unit-type-count-total trade-cart <= 0)
		(unit-type-count-total trade-cog <= 0))
	(and	(players-building-type-count every-ally market <= 0)
		(players-building-type-count every-ally dock <= 0))))
=>
	(up-jump-rule 3))
(defrule
	(strategic-number sn-current-age >= fcastlea)
(or	(players-building-type-count any-ally market >= 1)
(or	(players-building-type-count any-ally dock >= 1)
	(player-in-game any-ally)))
	(up-compare-goal tradeunits >= 4)
;(or	(goal strategy sling)
(or	(up-compare-goal tradeunits >= 9); 12
(or	(strategic-number sn-current-age >= imperial)
	(up-compare-goal custom-civ-pop >= up-max-civ)));)
	(can-research ri-cartography)
=>
	(research ri-cartography))
(defrule
(or	(up-compare-goal tradeunits >= 2)
	(building-type-count-total market >= 2))
(or	(goal strategy sling)
(or	(up-compare-goal tradeunits >= 4)
(or	(strategic-number sn-current-age >= imperial)
	(up-compare-goal custom-civ-pop >= up-max-civ))))
	(can-research ri-caravan)
=>
	(research ri-caravan))
(defrule
(or	(unit-type-count-total 178 >= 1); (empty)
	(unit-type-count-total 205 >= 1)); (full)
(or	(goal traincart yes)
(or	(goal traincog yes)
	(up-compare-goal tradeunits >= 4)))
(or	(strategic-number sn-current-age >= imperial)
(or	(population >= max-civ-pop)
	(up-compare-goal custom-civ-pop >= up-max-civ)))
	(can-research ri-caravan)
=>
	(research ri-caravan)); end jump
;=============================================================
(defrule
	(goal strategy stonewall)
(or	(up-research-status c: ri-elite-eagle-warrior < research-pending)
	(and	(up-compare-goal excessWood < 1000)
		(and	(up-compare-goal excessFood < 1000)
			(up-compare-goal excessGold < 1000))))
=>
	(up-jump-rule 3))
(defrule
	(player-in-game any-ally)
(or	(taunt-detected any-ally 3)
(or	(taunt-detected any-ally 4)
(or	(taunt-detected any-ally 5)
(or	(taunt-detected any-ally 6)
	(taunt-detected any-ally 38)))))
	(population >= max-civ-pop);
	(goal underattack no)
	(strategic-number sn-current-age >= imperial)
	(can-research ri-coinage)
=>
	(research ri-coinage))
(defrule
	(player-in-game any-ally)
(or	(up-compare-goal excessWood > 1900)
(or	(up-compare-goal excessFood > 1900)
	(up-compare-goal excessGold > 1900)))
(or	(up-allied-resource-amount any-ally wood < 1200)
(or	(up-allied-resource-amount any-ally food < 1200)
	(up-allied-resource-amount any-ally gold < 1200)))
;	(goal underattack no)
;(or
	(population >= max-civ-pop); del-civ-pop
	(strategic-number sn-current-age >= imperial);)
	(player-in-game any-ally); every
	(can-research ri-coinage)
=>
	(research ri-coinage))
(defrule
	(player-in-game any-ally)
(or	(goal strategy sling)
(or	(up-compare-goal excessWood > 2200)
(or	(up-compare-goal excessFood > 2200)
	(up-compare-goal excessGold > 2200))))
	(can-research ri-coinage)
=>
	(research ri-coinage))
;=============================================================
(defrule
	(player-in-game any-ally)
	(goal underattack no)
(or	(goal strategy sling)
	(strategic-number sn-current-age >= imperial))
(or	(goal strategy sling)
(or	(population >= max-civ-pop);
(or	(up-compare-goal excessWood > 1900)
(or	(up-compare-goal excessFood > 1900)
	(up-compare-goal excessGold > 1900)))))
	(can-research ri-banking)
=>
	(research ri-banking))
;=============================================================
; Infantry upgrades
;=============================================================
(defrule
	(strategic-number sn-current-age == feudal);	(research-available castle-age)
	(up-compare-goal enemy-goal2 != klew)
	(unit-type-count-total militiaman < 6); 5
	(up-compare-goal strategy-type >= castle-war)
	(food-amount < castle-fs)
	(gold-amount < 240)
=>
	(up-jump-rule 2))
(defrule
(or	(and	(goal maa-var yes)
		(up-compare-goal strategy-type == feudal-war))
(or	(unit-type-count-total militiaman >= 5)
	(and	(strategic-number sn-current-age >= imperial)
		(goal champgoal yes))))
	(can-research ri-man-at-arms)
=>
	(research ri-man-at-arms)); end mini jump
(defrule
	(goal enemy-goal2 klew)
(or	(unit-type-count-total militiaman-line >= 1)
(or	(goal trainchamp yes)
	(up-research-status c: ri-supplies >= research-pending)))
	(can-research ri-man-at-arms)
=>
	(research ri-man-at-arms))
;=============================================================
(defrule
(or	(unit-type-count-total man-at-arms >= 5)
(or	(and	(goal enemy-goal2 klew)
		(unit-type-count-total militiaman-line >= 1))
	(and	(strategic-number sn-current-age >= imperial)
		(goal champgoal yes))))
	(can-research ri-long-swordsman)
=>
	(research ri-long-swordsman))
;=============================================================
(defrule
(or	(unit-type-count-total long-swordsman >= 5)
(or	(and	(goal enemy-goal2 klew)
		(unit-type-count-total militiaman-line >= 1))
	(and	(strategic-number sn-current-age >= imperial)
		(goal champgoal yes))))
	(can-research ri-two-handed-swordsman)
=>
	(research ri-two-handed-swordsman))
;=============================================================
(defrule
(or	(unit-type-count-total two-handed-swordsman >= 5)
(or	(and	(goal enemy-goal2 klew)
		(unit-type-count-total militiaman-line >= 1))
	(goal champgoal yes)))
	(can-research ri-champion)
=>
	(research ri-champion))
;=============================================================
(defrule
	(strategic-number sn-current-age >= imperial)
	(goal trainchamp yes)
(or	(can-research ri-man-at-arms)
(or	(can-research ri-long-swordsman)
	(can-research ri-two-handed-swordsman)))
=>
	(research ri-man-at-arms)
	(research ri-long-swordsman)
	(research ri-two-handed-swordsman)); test
;=============================================================
(defrule
(or	(and	(food-amount >= 2000)
		(gold-amount >= 5000))
(or	(up-compare-goal strategy == stonewall)
(or	(unit-type-count-total eagle-warrior-line >= 6)
	(unit-type-count-total heavy-eagle-warrior >= 6))))
	(can-research ri-elite-eagle-warrior)
=>
	(research ri-elite-eagle-warrior))
;=============================================================
; Cavalry upgrades
;=============================================================
(defrule
(or	(unit-type-count-total knight-line >= 20); 18
(or	(strategic-number sn-current-age <= castlea)
	(goal palagoal yes)))
(or	(strategic-number sn-current-age >= cimperial)
(or	(goal trainknight yes)
	(unit-type-count-total knight-line >= 2)))
	(can-research ri-cavalier)
=>
	(research ri-cavalier))
;=============================================================
(defrule
(or	(and	(unit-type-count-total knight-line >= 20)
		(up-research-status c: ri-bloodlines >= research-available))
	(goal palagoal yes))
	(can-research ri-paladin)
=>
	(research ri-paladin)
	(set-goal researchplan yes))
;=============================================================
(defrule
(or	(and	(goal trainhussar yes)
		(strategic-number sn-current-age >= imperial))
(or	(unit-type-count-total scout-cavalry-line >= 3)
	(cc-players-unit-type-count 0 gold-mine < 8)))
	(can-research ri-light-cavalry)
=>
	(research ri-light-cavalry))
;=============================================================
(defrule
(or	(unit-type-count-total scout-cavalry-line >= 3)
(or	(goal trainhussar yes)
(or	(up-research-status c: ri-lechitic-legacy >= research-available); pending
	(cc-players-unit-type-count 0 gold-mine < 8))))
	(can-research ri-hussar)
=>
	(research ri-hussar))
;=============================================================
(defrule
(or	(strategic-number cavalry >= 15)
(or	(up-compare-goal camel-set >= 7)
(or	(players-unit-type-count focus-player genitour >= 10)
(or	(players-unit-type-count focus-player elite-genitour >= 10)
(or	(players-unit-type-count focus-player genitour-placeholder >= 10)
	(strategic-number cavarchers >= 10))))))
(or	(goal traincamel yes)
	(up-compare-goal camel-set >= 4))
	(can-research ri-heavy-camel)
=>
	(research ri-heavy-camel))
;=============================================================
#load-if-defined UP-GAME-WK
(defrule
(or	(strategic-number cavalry >= 15)
(or	(up-compare-goal camel-set >= 7)
(or	(players-unit-type-count focus-player genitour >= 10)
(or	(players-unit-type-count focus-player elite-genitour >= 10)
(or	(players-unit-type-count focus-player genitour-placeholder >= 10)
	(strategic-number cavarchers >= 10))))))
(or	(goal traincamel yes)
	(up-compare-goal camel-set >= 4))
	(can-research ri-imperial-camel)
=>
	(research ri-imperial-camel))
;=============================================================
(defrule
(or	(and	(up-compare-goal excessFood >= 3000)
		(up-compare-goal excessGold >= 1750))
(or	(up-research-status c: ri-howdah >= research-pending)
(or	(up-research-status c: ri-tusk-swords >= research-pending)
(or	(up-research-status c: ri-chatras >= research-pending)
	(up-compare-goal battle-elephant-set >= 4)))))
	(can-research ri-elite-battle-elephant)
=>
	(research ri-elite-battle-elephant))
;=============================================================
(defrule
(or	(goal trainsteppe yes)
(or	(and	(up-compare-goal tradeunits >= 9)
		(goal researchplan yes))
	(up-compare-goal steppe-lancer-set >= 4)))
	(can-research ri-elite-steppe-lancer)
=>
	(research ri-elite-steppe-lancer))
#end-if
;=============================================================
; Archer upgrades
;=============================================================
(defrule
(or	(building-type-count monastery < 1)
(or	(unit-type-count-total monk >= 3)
	(and	(unit-type-count-total monk >= 1)
		(up-compare-const mp-game == 1))))
(or	(goal strategy a-rush)
(or	(goal strategy r-flush)
	(unit-type-count-total archer-line >= 4)))
	(can-research ri-crossbow)
=>
	(research ri-crossbow))
(defrule
	(goal trainarcher yes)
	(strategic-number sn-current-age >= imperial)
	(can-research ri-crossbow)
=>
	(research ri-crossbow))
;=============================================================
(defrule
(or	(players-unit-type-count focus-player huskarl-line < 4)
	(unit-type-count-total archer-line >= 9))
	(unit-type-count-total archer-line >= 5)
	(can-research ri-arbalest)
=>
	(research ri-arbalest))
;=============================================================
(defrule
(or	(goal dreitc yes)
	(and	(strategic-number sn-military-superiority <= -1)
		(up-compare-goal position-goal != pocket)))
(or	(unit-type-count-total skirmisher-line >= 5)
(or	(strategic-number archers >= 5)
(or	(and	(goal researchplan yes)
		(up-compare-goal excessGold >= 1200))
	(cc-players-unit-type-count 0 gold-mine < 8))))
	(can-research ri-elite-skirmisher)
=>
	(research ri-elite-skirmisher))
(defrule
	(goal trainskirm yes)
	(strategic-number sn-current-age >= imperial)
	(can-research ri-elite-skirmisher)
=>
	(research ri-elite-skirmisher))
(defrule
(or	(goal attacking yes)
	(goal underattack yes))
(or	(unit-type-count-total skirmisher-line >= 5)
	(cc-players-unit-type-count 0 gold-mine < 8))
(or	(can-research ri-elite-skirmisher)
	(can-research ri-imperial-skirmisher))
=>
	(research ri-elite-skirmisher)
	(research ri-imperial-skirmisher))
#load-if-defined UP-GAME-WK
(defrule
(or	(goal dreitc yes)
	(and	(strategic-number sn-military-superiority <= -1)
		(up-compare-goal position-goal != pocket)))
(or	(unit-type-count-total skirmisher-line >= 5)
(or	(strategic-number archers >= 5)
(or	(and	(goal researchplan yes)
		(up-compare-goal excessGold >= 1200))
	(cc-players-unit-type-count 0 gold-mine < 8))))
	(can-research ri-imperial-skirmisher)
=>
	(research ri-imperial-skirmisher))
(defrule
(or	(up-research-status c: ri-atlatl >= research-pending)
(or	(up-research-status c: ri-yeomen >= research-pending)
	(up-research-status c: ri-elite-genitour < research-pending)))
(or	(unit-type-count-total skirmisher-line >= 2)
	(goal trainskirm yes))
	(can-research ri-imperial-skirmisher)
=>
	(research ri-imperial-skirmisher))
(defrule
(or	(up-research-status c: ri-imperial-skirmisher < research-pending)
(or	(unit-type-count-total genitour >= 4)
(or	(unit-type-count-total elite-genitour >= 4)
	(unit-type-count-total genitour-placeholder >= 4))))
(or	(unit-type-count-total genitour >= 2)
(or	(unit-type-count-total elite-genitour >= 2)
(or	(unit-type-count-total genitour-placeholder >= 2)
	(goal traingenitour yes))))
	(can-research ri-elite-genitour)
=>
	(research ri-elite-genitour))
#end-if
;=============================================================
(defrule
(or	(goal strategy ca-rush)
(or	(goal cavagoal yes)
	(unit-type-count-total cavalry-archer-line >= 5)))
	(can-research ri-heavy-cavalry-archer)
=>
	(research ri-heavy-cavalry-archer))
;=============================================================
; Pike upgrades
;=============================================================
(defrule
(or	(unit-type-count-total spearman-line >= 4)
(or	(and	(goal trainpike yes)
		(strategic-number sn-current-age >= imperial))
(or	(and	(goal researchplan yes)
		(gold-amount >= 1400))
	(cc-players-unit-type-count 0 gold-mine < 8))))
	(can-research ri-pikeman)
=>
	(research ri-pikeman))
;=============================================================
(defrule
(or	(unit-type-count-total spearman-line >= 4)
(or	(and	(goal researchplan yes)
		(gold-amount >= 1400))
	(cc-players-unit-type-count 0 gold-mine < 8)))
	(can-research ri-halberdier)
=>
	(research ri-halberdier))
;=============================================================
; Siege upgrades
;=============================================================
#load-if-not-defined DIFFICULTY-EASIEST
(defrule
	(unit-type-count-total battering-ram-line >= 1); 2
(or	(unit-type-count-total battering-ram-line >= 4)
(or	(goal trainram yes)
(or	(up-compare-goal excessFood >= 900)
(or	(goal researchplan yes)
(or	(goal attacking yes)
	(strategic-number sn-military-superiority >= 0))))))
	(can-research ri-capped-ram)
=>
	(research ri-capped-ram))
#load-if-not-defined DIFFICULTY-EASY
#load-if-not-defined DIFFICULTY-MODERATE
(defrule
	(unit-type-count-total battering-ram-line >= 1); 2
(or	(unit-type-count-total battering-ram-line >= 6)
(or	(and	(or	(unit-type-count-total battering-ram-line >= 4)
			(goal trainram yes))
		(goal attacking yes))
(or	(up-compare-goal excessFood >= 1600)
	(goal researchplan yes))))
	(can-research ri-siege-ram)
=>
	(research ri-siege-ram))
#end-if
#end-if
;=============================================================
(defrule
(or	(and	(up-research-status c: ri-double-crossbow >= research-pending)
		(up-compare-goal uugoal != yes))
(or	(and	(unit-type-count-total scorpion-line >= 3)
		(goal researchplan yes))
	(unit-type-count-total scorpion-line >= 4)))
	(can-research ri-heavy-scorpion)
=>
	(research ri-heavy-scorpion))
;=============================================================
(defrule
	(up-compare-goal mangonel-set >= 3)
	(can-research ri-onager)
=>
	(research ri-onager))
(defrule
	(up-compare-goal mangonel-set >= 5)
	(can-research ri-siege-onager)
=>
	(research ri-siege-onager))
#load-if-not-defined BERBERS-CIV
#load-if-not-defined BOHEMIANS-CIV
#load-if-not-defined BRITON-CIV
#load-if-not-defined BURGUNDIANS-CIV
#load-if-not-defined BURMESE-CIV
#load-if-not-defined BYZANTINE-CIV
#load-if-not-defined CHINESE-CIV
#load-if-not-defined FRANKISH-CIV
#load-if-not-defined GOTHIC-CIV
#load-if-not-defined HUN-CIV
#load-if-not-defined INCAN-CIV
#load-if-not-defined INDIAN-CIV
#load-if-not-defined ITALIAN-CIV
#load-if-not-defined JAPANESE-CIV
#load-if-not-defined KHMER-CIV
#load-if-not-defined LITHUANIANS-CIV
#load-if-not-defined MAGYAR-CIV
#load-if-not-defined MALAY-CIV
#load-if-not-defined MAYAN-CIV
#load-if-not-defined PERSIAN-CIV
#load-if-not-defined POLES-CIV
#load-if-not-defined PORTUGUESE-CIV
#load-if-not-defined SPANISH-CIV
#load-if-not-defined TATARS-CIV
#load-if-not-defined TURKISH-CIV
#load-if-not-defined VIETNAMESE-CIV ; Siege Onagers
#load-if-not-defined VIKING-CIV ; Aztecs, Celts, Koreans, Mongols, Saracens, Teutons, Slavs, Ethiopians, Malians, Bulgarians, Cumans, Sicilians
(defrule
;	(goal escrowing no)
(or	(gold-amount >= 2500)
(or	(food-amount >= 2500)
(or	(wood-amount >= 2500)
(or	(strategic-number skirmsarchers >= 40)
	(players-unit-type-count focus-player scorpion-line >= 8)))))
	(can-research ri-onager)
=>
	(research ri-onager))
(defrule
;	(goal escrowing no)
(or	(gold-amount >= 2500)
(or	(food-amount >= 2500)
(or	(wood-amount >= 2500)
(or	(strategic-number skirmsarchers >= 40)
	(players-unit-type-count focus-player scorpion-line >= 8)))))
	(can-research ri-siege-onager)
=>
	(research ri-siege-onager))
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
#end-if
(defrule
(or	(up-compare-const michi-style == yes)
	(and	(gold-amount >= 1800)
		(up-compare-goal mangonel-set >= 1)))
(or	(up-research-status c: ri-heavy-scorpion == research-unavailable)
	(up-compare-goal mangonel-set >= 1))
(or	(can-research ri-onager)
	(can-research ri-siege-onager))
=>
	(research ri-onager)
	(research ri-siege-onager))
	
#load-if-defined UP-MICHI-STYLE ;now we can cut always get onager over other researches

(defrule
(true)
=>
(research ri-onager)
(research ri-siege-onager)
)
#end-if

(defrule
	(or(up-compare-const diff-fp != 1)
	(up-compare-const TRADE-CUT != 1))
=>
	(up-jump-rule 2)
)
(defrule
(food-amount > 1800)
(gold-amount > 1200)
(can-research ri-onager)
(unit-type-count-total trade-cart > 0)
=>
(research ri-onager)
(research ri-siege-onager)
(research ri-siege-engineers)
)

(defrule
(current-age == imperial-age)
(current-age-time > 600)
(unit-type-count-total trade-cart > 0)
=>
(research ri-onager)
)

#load-if-defined AMAZON-TUNNEL-MAP

;End jump (2)

(defrule
	(can-research-with-escrow ri-onager)
	(unit-type-count-total trade-cart > 0)
	(unit-type-count-total villager > ten-pop)
=>
	(release-escrow food)
	(release-escrow gold)
	(research ri-onager) ;researching onager ASAP improves possibility of cut as there are less buildings the onagers can get stuck behind
)

#end-if
;=============================================================
#load-if-not-defined DIFFICULTY-EASY
#load-if-not-defined DIFFICULTY-MODERATE
(defrule
	(unit-type-count-total bombard-cannon-line >= 1)
	(can-research ri-houfnice)
=>
	(research ri-houfnice))
#end-if
#end-if
;=============================================================
#load-if-not-defined DIFFICULTY-EASY
#load-if-not-defined DIFFICULTY-MODERATE
(defrule
(or	(unit-type-count-total battering-ram-line >= 4); 5
(or	(unit-type-count-total organ-gun >= 2)
(or	(unit-type-count-total elite-organ-gun >= 2)
(or	(unit-type-count-total scorpion-line >= 2)
(or	(up-compare-goal mangonel-set >= 2)
(or	(unit-type-count-total bombard-cannon-line >= 2)
	(unit-type-count-total trebuchet-set >= 2)))))))
	(can-research ri-siege-engineers)
=>
	(research ri-siege-engineers))
(defrule
(or	(unit-type-count-total hussite-wagon-line >= 2)
(or	(unit-type-count-total ballista-elephant >= 2)
	(unit-type-count-total elite-ballista-elephant >= 2)))
	(can-research ri-siege-engineers)
=>
	(research ri-siege-engineers))
#end-if
#end-if
#end-if
;=============================================================
; Cavalry upgrades
;=============================================================
(defrule
	(civ-selected bulgarians)
(or	(goal attacking yes)
(or	(goal underattack yes)
	(goal defend yes)))
=>
	(up-jump-rule 1))
(defrule
	(strategic-number sn-current-age < fcastlea)
	(goal attacking no)
	(goal underattack no)
	(up-compare-goal strategy-type >= castle-war)
=>
	(up-jump-rule 2))
(defrule
(or	(unit-type-count-total imperial-camel >= 6)
(or	(unit-type-count-total ballista-elephant >= 6)
(or	(unit-type-count-total elite-ballista-elephant >= 6)
(or	(unit-type-count-total scout-cavalry-class >= 6)
(or	(unit-type-count-total cavalry-class >= 6)
(or	(unit-type-count-total magyar-huszar >= 6)
	(unit-type-count-total boyar >= 6)))))))
	(can-research ri-scale-barding)
=>
	(research ri-scale-barding))
(defrule
(or	(up-compare-goal steppe-lancer-set >= 6)
	(up-compare-goal battle-elephant-set >= 6))
	(can-research ri-scale-barding)
=>
	(research ri-scale-barding)); end jump
(defrule
	(goal strategy krush)
	(strategic-number sn-current-age >= fcastlea)
(or	(up-compare-goal excessFood >= 595)
(or	(players-building-type-count target-player watch-tower >= 2)
(or	(strategic-number archers >= 7)
	(strategic-number skirmsarchers >= 14))))
(or	(up-research-status c: castle-age == research-pending)
	(up-compare-goal excessFood >= 250)); 200
	(can-research ri-scale-barding)
=>
	(research ri-scale-barding))
;=============================================================
(defrule
(or	(up-compare-goal battle-elephant-set >= 6)
(or	(unit-type-count-total imperial-camel >= 6)
(or	(unit-type-count-total cavalry-class >= 6)
(or	(unit-type-count-total magyar-huszar >= 6)
(or	(unit-type-count-total boyar >= 6)
(or	(up-compare-goal steppe-lancer-set >= 6)
	(up-compare-goal ballista-elephant-set >= 6)))))))
	(can-research ri-chain-barding)
=>
	(research ri-chain-barding))
;=============================================================
#load-if-not-defined DIFFICULTY-EASIEST
#load-if-not-defined DIFFICULTY-EASY
(defrule
(or	(up-compare-goal battle-elephant-set >= 6)
(or	(unit-type-count-total imperial-camel >= 6)
(or	(unit-type-count-total cavalry-class >= 6)
(or	(unit-type-count-total magyar-huszar >= 6)
(or	(unit-type-count-total boyar >= 6)
(or	(up-compare-goal steppe-lancer-set >= 6)
	(up-compare-goal ballista-elephant-set >= 6)))))))
	(can-research ri-plate-barding)
=>
	(research ri-plate-barding))
#end-if
#end-if
;=============================================================
(defrule
	(strategic-number sn-current-age < fcastlea)
	(goal attacking no)
	(goal underattack no)
	(up-compare-goal strategy-type >= castle-war)
=>
	(up-jump-rule 4))
(defrule
(or	(unit-type-count-total imperial-camel >= 6)
(or	(unit-type-count-total missionary >= 6)
(or	(unit-type-count-total scout-cavalry-class >= 6)
(or	(unit-type-count-total cavalry-class >= 6)
(or	(unit-type-count-total magyar-huszar >= 6)
(or	(unit-type-count-total boyar >= 6)
	(up-compare-goal battle-elephant-set >= 6)))))))
	(can-research ri-bloodlines)
=>
	(research ri-bloodlines))
(defrule
(or	(unit-type-count-total cavalry-archer-class >= 6)
(or	(unit-type-count-total ballista-elephant >= 6)
(or	(unit-type-count-total elite-ballista-elephant >= 6)
(or	(unit-type-count-total cavalry-cannon-class >= 6)
	(and	(goal palagoal yes)
		(strategic-number sn-current-age >= cimperial))))))
	(can-research ri-bloodlines)
=>
	(research ri-bloodlines))
(defrule
(or	(unit-type-count-total genitour >= 6)
(or	(unit-type-count-total elite-genitour >= 6)
(or	(unit-type-count-total genitour-placeholder >= 6)
(or	(unit-type-count-total elephant-archer >= 6)
(or	(unit-type-count-total elite-elephant-archer >= 6)
(or	(up-compare-goal steppe-lancer-set >= 6)
	(unit-type-count-total cavalry-cannon-class >= 6)))))))
	(can-research ri-bloodlines)
=>
	(research ri-bloodlines))
(defrule
	(goal strategy krush)
	(strategic-number sn-current-age >= fcastlea)
(or	(up-research-status c: ri-bloodlines != research-available)
	(building-type-count blacksmith <= 0))
	(up-compare-goal excessFood >= 270)
	(up-compare-goal excessGold >= 230)
(or	(up-compare-goal kr-var >= 2)
	(up-compare-goal excessFood >= 595))
	(can-research ri-bloodlines)
=>
	(research ri-bloodlines)); end jump
;=============================================================
(defrule
(or	(up-compare-goal battle-elephant-set >= 10)
(or	(unit-type-count-total ballista-elephant >= 16)
(or	(unit-type-count-total elite-ballista-elephant >= 16)
(or	(unit-type-count-total imperial-camel >= 16)
(or	(unit-type-count-total cavalry-class >= 16)
(or	(unit-type-count-total magyar-huszar >= 16)
	(unit-type-count-total boyar >= 16)))))))
=>
	(up-jump-rule 2))
(defrule
(or	(unit-type-count-total genitour >= 16)
(or	(unit-type-count-total elite-genitour >= 16)
(or	(unit-type-count-total genitour-placeholder >= 16)
(or	(unit-type-count-total cavalry-cannon-class >= 16)
(or	(unit-type-count-total elephant-archer >= 16)
	(unit-type-count-total cavalry-archer-class >= 16))))))
=>
	(up-jump-rule 1))
(defrule
	(strategic-number moenche < 10)
	(strategic-number sn-current-age < cimperial)
(or	(and	(up-compare-const de-game != 1)
		(food-amount < 1250))
	(up-compare-goal excessFood < 200))
=>
	(up-jump-rule 4))
(defrule
(or	(up-compare-goal battle-elephant-set >= 6)
(or	(unit-type-count-total ballista-elephant >= 9)
(or	(unit-type-count-total elite-ballista-elephant >= 9)
(or	(unit-type-count-total imperial-camel >= 9)
(or	(unit-type-count-total cavalry-class >= 9)
(or	(unit-type-count-total magyar-huszar >= 9)
	(unit-type-count-total boyar >= 9)))))))
	(can-research ri-husbandry)
=>
	(research ri-husbandry))
(defrule
(or	(unit-type-count-total genitour >= 9)
(or	(unit-type-count-total elite-genitour >= 9)
(or	(unit-type-count-total genitour-placeholder >= 9)
(or	(unit-type-count-total cavalry-cannon-class >= 9)
(or	(unit-type-count-total elephant-archer >= 9)
(or	(up-compare-goal steppe-lancer-set >= 9)
	(unit-type-count-total cavalry-archer-class >= 9)))))))
	(can-research ri-husbandry)
=>
	(research ri-husbandry))
(defrule
(or	(and	(strategic-number sn-current-age >= cimperial)
		(or	(goal palagoal yes)
			(up-research-status c: ri-hussar >= research-pending)))
	(and	(goal strategy krush)
		(and	(civ-selected burgundians)
			(not	(can-afford-unit knight)))))
	(can-research ri-husbandry)
=>
	(research ri-husbandry))
(defrule
	(up-compare-const de-game == 1)
	(unit-type-count-total missionary >= 6)
	(up-research-status c: ri-bloodlines >= research-pending)
	(strategic-number sn-current-age >= cimperial)
	(can-research ri-husbandry)
=>
	(research ri-husbandry)); end jump
;=============================================================
; Archer upgrades
;=============================================================
(defrule
	(civ-selected bulgarians)
(or	(goal attacking yes)
(or	(goal underattack yes)
	(goal defend yes)))
=>
	(up-jump-rule 1))
(defrule
	(strategic-number sn-current-age < fcastlea)
	(up-compare-goal strategy-type != feudal-war)
	(food-amount < castle-fs)
	(goal attacking no);
	(goal underattack no);
=>
	(up-jump-rule 5))
(defrule
(or	(and	(up-research-status c: ri-double-bit-axe < research-pending)
		(food-amount < 200))
(or	(up-compare-goal milunits == no)
(or	(up-compare-goal milunits == s-flush)
	(up-compare-goal milunits == krush))))
=>
	(up-jump-rule 2))
(defrule
(or	(building-type-count watch-tower >= 2)
(or	(building-type-count castle >= 2)
(or	(unit-type-count-total archery-class >= 1)
(or	(up-compare-goal skirmisher-set >= 1)
(or	(unit-type-count-total elephant-archer >= 1)
(or	(unit-type-count-total slinger >= 1)
	(unit-type-count-total cavalry-archer-class >= 1)))))))
;	(up-research-status c: ri-wheel-barrow >= research-pending)
	(can-research ri-fletching)
=>
	(research ri-fletching))
(defrule
(or	(and	(building-type-count-total town-center >= 5)
		(strategic-number sn-current-age >= cimperial))
(or	(building-type-count bombard-tower >= 2)
	(building-type-count donjon >= 2)))
=>
	(research ri-fletching)); end mini jump
(defrule
(or	(unit-type-count-total galley-line >= 3)
(or	(unit-type-count-total longboat-line >= 3)
(or	(and	(goal strategy grush)
		(goal fg-var no))
(or	(goal strategy a-rush)
(or	(goal strategy ca-rush)
	(goal strategy r-flush))))))
;(or	(up-research-status c: ri-double-bit-axe >= research-pending)
;	(food-amount >= 200))
	(can-research ri-fletching)
=>
	(research ri-fletching))
(defrule
(or	(building-type-count krepost >= 2)
(or	(up-compare-goal caravel-set >= 3)
(or	(unit-type-count-total rattan-archer >= 1)
(or	(unit-type-count-total elite-rattan-archer >= 1)
(or	(unit-type-count-total camel-archer >= 1)
(or	(unit-type-count-total elite-camel-archer >= 1)
	(unit-type-count-total genoese-crossbowman >= 1)))))))
	(can-research ri-fletching)
=>
	(research ri-fletching)); end jump
;============================================================
(defrule
(or	(building-type-count watch-tower >= 3)
(or	(building-type-count castle >= 3)
(or	(unit-type-count-total archery-class >= 3)
(or	(unit-type-count-total slinger >= 3)
(or	(unit-type-count-total galley-line >= 3)
(or	(unit-type-count-total longboat-line >= 3)
	(unit-type-count-total cavalry-archer-class >= 3)))))))
	(can-research ri-bodkin-arrow)
=>
	(research ri-bodkin-arrow))
(defrule
(or	(up-compare-goal skirmisher-set >= 3)
(or	(up-compare-goal caravel-set >= 3)
(or	(goal strategy a-rush)
(or	(goal strategy ca-rush)
	(goal strategy r-flush)))))
	(can-research ri-bodkin-arrow)
=>
	(research ri-bodkin-arrow))
(defrule
(or	(building-type-count krepost >= 3)
(or	(unit-type-count-total rattan-archer >= 3)
(or	(unit-type-count-total elite-rattan-archer >= 3)
(or	(unit-type-count-total camel-archer >= 3)
(or	(unit-type-count-total elite-camel-archer >= 3)
(or	(unit-type-count-total elephant-archer >= 3)
	(unit-type-count-total genoese-crossbowman >= 3)))))))
	(can-research ri-bodkin-arrow)
=>
	(research ri-bodkin-arrow))
(defrule
(or	(building-type-count bombard-tower >= 3)
	(building-type-count donjon >= 3))
	(can-research ri-bodkin-arrow)
=>
	(research ri-bodkin-arrow))
;============================================================
(defrule
(or	(unit-type-count-total archery-class >= 6)
(or	(unit-type-count-total elephant-archer >= 6)
(or	(unit-type-count-total slinger >= 6)
(or	(unit-type-count-total genoese-crossbowman >= 6)
(or	(unit-type-count-total cavalry-archer-class >= 6)
(or	(building-type-count castle >= 3)
	(building-type-count watch-tower >= 3)))))))
	(can-research ri-bracer)
=>
	(research ri-bracer))
(defrule
(or	(building-type-count donjon >= 3)
(or	(building-type-count bombard-tower >= 3)
(or	(up-compare-goal skirmisher-set >= 6)
(or	(up-compare-goal caravel-set >= 3)
(or	(unit-type-count-total galley-line >= 3)
	(unit-type-count-total longboat-line >= 3))))))
	(can-research ri-bracer)
=>
	(research ri-bracer))
(defrule
(or	(building-type-count krepost >= 3)
(or	(unit-type-count-total rattan-archer >= 6)
(or	(unit-type-count-total elite-rattan-archer >= 6)
(or	(unit-type-count-total camel-archer >= 6)
(or	(unit-type-count-total elite-camel-archer >= 6)
(or	(unit-type-count-total elephant-archer >= 6)
	(unit-type-count-total genoese-crossbowman >= 6)))))))
	(can-research ri-bracer)
=>
	(research ri-bracer))
;=============================================================
(defrule
	(civ-selected bulgarians)
(or	(goal attacking yes)
(or	(goal underattack yes)
	(goal defend yes)))
=>
	(up-jump-rule 1))
(defrule
	(strategic-number sn-current-age <= feudal)
(or	(and	(players-military-population every-enemy <= 2); 1
		(players-building-type-count target-player watch-tower <= 1))
	(goal gatherinside yes))
	(up-compare-goal excessFood < 1000);
=>
	(up-jump-rule 6))
(defrule
	(up-research-status c: ri-bodkin-arrow == research-available)
	(up-compare-goal excessGold >= 1)
	(building-type-count-total blacksmith < 2);
=>
	(up-jump-rule 4))
(defrule
(or	(up-research-status c: ri-horse-collar >= research-pending)
	(food-amount >= 175)); 125
(or	(and	(goal milunits r-flush)
		(up-research-status c: ri-fletching >= research-pending))
	(and	(or	(goal milunits a-rush)
			(goal milunits ca-rush))
		(up-research-status c: ri-bodkin-arrow >= research-pending)))
	(can-research ri-padded-archer-armor)
=>
	(research ri-padded-archer-armor))
(defrule
(or	(up-research-status c: ri-horse-collar >= research-pending)
	(food-amount >= 175)); 125
	(goal milunits r-flush)
	(goal sk-var yes)
	(strategic-number archers >= 1)
	(can-research ri-padded-archer-armor)
=>
	(research ri-padded-archer-armor))
(defrule
;	(up-research-status c: ri-wheel-barrow >= research-pending)
	(up-research-status c: ri-fletching >= research-pending)
(or	(unit-type-count-total archery-class >= 6)
(or	(unit-type-count-total cavalry-archer-class >= 6)
(or	(unit-type-count-total slinger >= 6)
(or	(unit-type-count-total elephant-archer >= 6)
	(unit-type-count-total genoese-crossbowman >= 6)))))
(or	(strategic-number sn-current-age >= fcastlea)
	(up-compare-goal strategy-type == feudal-war))
	(can-research ri-padded-archer-armor)
=>
	(research ri-padded-archer-armor))
(defrule
	(up-research-status c: ri-fletching >= research-pending)
(or	(up-compare-goal skirmisher-set >= 6)
(or	(unit-type-count-total rattan-archer >= 6)
(or	(unit-type-count-total elite-rattan-archer >= 6)
(or	(unit-type-count-total camel-archer >= 6)
(or	(unit-type-count-total elite-camel-archer >= 6)
(or	(unit-type-count-total elephant-archer >= 6)
	(unit-type-count-total genoese-crossbowman >= 6)))))))
	(can-research ri-padded-archer-armor)
=>
	(research ri-padded-archer-armor)); end jump
(defrule
(or	(unit-type-count-total arambai >= 6)
(or	(unit-type-count-total elite-arambai >= 6)
(or	(unit-type-count-total archery-cannon-class >= 6)
	(unit-type-count-total cavalry-cannon-class >= 6))))
	(can-research ri-padded-archer-armor)
=>
	(research ri-padded-archer-armor)); end jump
;=============================================================
(defrule
	(up-research-status c: ri-bodkin-arrow >= research-pending)
(or	(unit-type-count-total archery-class >= 6)
(or	(unit-type-count-total cavalry-archer-class >= 6)
(or	(unit-type-count-total slinger >= 6)
(or	(unit-type-count-total elephant-archer >= 6)
	(unit-type-count-total genoese-crossbowman >= 6)))))
	(can-research ri-leather-archer-armor)
=>
	(research ri-leather-archer-armor))
(defrule
	(up-research-status c: ri-bodkin-arrow >= research-pending)
(or	(up-compare-goal skirmisher-set >= 6)
(or	(unit-type-count-total rattan-archer >= 6)
(or	(unit-type-count-total elite-rattan-archer >= 6)
(or	(unit-type-count-total camel-archer >= 6)
(or	(unit-type-count-total elite-camel-archer >= 6)
(or	(unit-type-count-total elephant-archer >= 6)
	(unit-type-count-total genoese-crossbowman >= 6)))))))
	(can-research ri-leather-archer-armor)
=>
	(research ri-leather-archer-armor))
(defrule
(or	(unit-type-count-total arambai >= 6)
(or	(unit-type-count-total elite-arambai >= 6)
(or	(and	(or	(goal milunits a-rush)
			(goal milunits ca-rush))
		(up-research-status c: ri-bodkin-arrow >= research-pending))
(or	(unit-type-count-total archery-cannon-class >= 6)
	(unit-type-count-total cavalry-cannon-class >= 6)))))
	(can-research ri-leather-archer-armor)
=>
	(research ri-leather-archer-armor))
;=============================================================
#load-if-not-defined DIFFICULTY-EASIEST
#load-if-not-defined DIFFICULTY-EASY
(defrule
	(up-research-status c: ri-bracer == research-available)
(or	(food-amount < 550)
	(building-type-count-total blacksmith < 2))
=>
	(up-jump-rule 2))
(defrule
	(up-research-status c: ri-bodkin-arrow >= research-pending)
(or	(up-compare-goal skirmisher-set >= 6)
(or	(unit-type-count-total camel-archer >= 6)
(or	(unit-type-count-total elite-camel-archer >= 6)
(or	(unit-type-count-total archery-class >= 6)
(or	(unit-type-count-total cavalry-archer-class >= 6)
(or	(unit-type-count-total slinger >= 6)
	(unit-type-count-total genoese-crossbowman >= 6)))))))
	(can-research ri-ring-archer-armor)
=>
	(research ri-ring-archer-armor))
(defrule
	(up-research-status c: ri-bodkin-arrow >= research-pending)
(or	(unit-type-count-total elephant-archer >= 6)
(or	(unit-type-count-total camel-archer >= 6)
(or	(unit-type-count-total elite-camel-archer >= 6)
(or	(unit-type-count-total rattan-archer >= 6)
(or	(unit-type-count-total elite-rattan-archer >= 6)
	(unit-type-count-total genoese-crossbowman >= 6))))))
	(can-research ri-ring-archer-armor)
=>
	(research ri-ring-archer-armor)); end jump
(defrule
(or	(unit-type-count-total arambai >= 6)
(or	(unit-type-count-total elite-arambai >= 6)
(or	(unit-type-count-total archery-cannon-class >= 6)
	(unit-type-count-total cavalry-cannon-class >= 6))))
	(can-research ri-ring-archer-armor)
=>
	(research ri-ring-archer-armor))
#end-if
#end-if
;=============================================================
(defrule
(or	(unit-type-count-total cavalry-archer-line >= 5)
(or	(unit-type-count-total mangudai-line >= 5)
(or	(unit-type-count-total elephant-archer >= 5)
(or	(unit-type-count-total elite-elephant-archer >= 5)
(or	(unit-type-count-total camel-archer >= 5)
	(unit-type-count-total elite-camel-archer >= 5))))))
	(can-research ri-parthian-tactics)
=>
	(research ri-parthian-tactics))
(defrule
(or	(unit-type-count-total kipchak >= 5)
(or	(unit-type-count-total elite-kipchak >= 5)
	(unit-type-count-total mercenary-kipchak >= 5)))
	(can-research ri-parthian-tactics)
=>
	(research ri-parthian-tactics))
;=============================================================
(defrule
(nor	(goal underattack yes)
(or	(goal attacking yes)
(or	(up-compare-goal strategy-type <= castle-war);
	(strategic-number sn-current-age >= imperial))))
=>
	(up-jump-rule 2))
(defrule
(or	(up-compare-goal skirmisher-set >= 7)
(or	(unit-type-count-total elephant-archer >= 7)
(or	(unit-type-count-total archery-class >= 7)
(or	(unit-type-count-total slinger >= 7)
(or	(unit-type-count-total cavalry-archer-class >= 7)
(or	(unit-type-count-total genoese-crossbowman >= 7)
	(unit-type-count-total rattan-archer >= 7)))))))
	(can-research ri-thumb-ring)
=>
	(research ri-thumb-ring))
(defrule
(or	(unit-type-count-total cavalry-archer-line >= 5)
(or	(unit-type-count-total elite-rattan-archer >= 7)
(or	(unit-type-count-total camel-archer >= 7)
	(unit-type-count-total elite-camel-archer >= 7))))
	(can-research ri-thumb-ring)
=>
	(research ri-thumb-ring)); end jump
;=============================================================
(defrule
(or	(strategic-number infantry >= 15)
(or	(unit-type-count-total archery-class >= 6)
(or	(unit-type-count-total cavalry-archer-class >= 6)
(or	(unit-type-count-total galley-line >= 6)
(or	(and	(goal palagoal yes)
		(strategic-number spears >= 11))
	(goal researchplan yes))))))
	(can-research ri-chemistry)
=>
	(research ri-chemistry))
(defrule
(or	(unit-type-count-total slinger >= 6)
(or	(up-compare-goal skirmisher-set >= 6)
(or	(up-compare-goal caravel-set >= 6)
(or	(unit-type-count-total longboat-line >= 6)
	(unit-type-count-total scorpion-line >= 4)))))
	(can-research ri-chemistry)
=>
	(research ri-chemistry))
(defrule
(or	(unit-type-count-total ballista-elephant >= 6)
(or	(unit-type-count-total arambai >= 6)
(or	(unit-type-count-total rattan-archer >= 6)
(or	(unit-type-count-total elephant-archer >= 6)
(or	(unit-type-count-total camel-archer >= 6)
(or	(unit-type-count-total elite-genitour >= 6)
	(unit-type-count-total genoese-crossbowman >= 6)))))))
	(can-research ri-chemistry)
=>
	(research ri-chemistry))
(defrule
(or	(building-type-count-total castle >= 3)
(or	(building-type-count-total krepost >= 3)
(or	(building-type-count-total watch-tower >= 4)
(or	(unit-type-count-total elite-ballista-elephant >= 6)
(or	(unit-type-count-total elite-arambai >= 6)
	(unit-type-count-total elite-rattan-archer >= 6))))))
	(can-research ri-chemistry)
=>
	(research ri-chemistry))
(defrule
(or	(goal trainhandcannon yes)
(or	(goal trainbombard yes)
	(goal traincannon yes)))
	(can-research ri-chemistry)
=>
	(research ri-chemistry))
#load-if-defined UP-GAME-WK
(defrule
(or	(building-type-count-total donjon >= 3)
	(up-compare-goal mangonel-set >= 6))
	(can-research ri-chemistry)
=>
	(research ri-chemistry))
#end-if
;=============================================================
(defrule
(or	(goal researchplan yes)
;(or	(unit-type-count-total scorpion-line >= 4)
(or	(unit-type-count-total skirmisher-line >= 14)
(or	(unit-type-count-total archery-class >= 9)
(or	(unit-type-count-total cavalry-archer-class >= 9)
(or	(unit-type-count-total galley-line >= 6)
(or	(up-compare-goal caravel-set >= 6)
	(unit-type-count-total longboat-line >= 6)))))));)
	(can-research ri-ballistics)
=>
	(research ri-ballistics))
(defrule
(or	(unit-type-count-total elephant-archer >= 6)
(or	(unit-type-count-total slinger >= 6)
(or	(up-compare-goal skirmisher-set >= 6)
(or	(and	(goal strategy grush)
		(goal fg-var no))
(or	(building-type-count-total castle >= 3)
	(building-type-count-total watch-tower >= 4))))))
	(can-research ri-ballistics)
=>
	(research ri-ballistics))
(defrule
(or	(unit-type-count-total arambai >= 6)
(or	(unit-type-count-total elite-arambai >= 6)
(or	(unit-type-count-total rattan-archer >= 6)
(or	(unit-type-count-total elite-rattan-archer >= 6)
(or	(unit-type-count-total camel-archer >= 6)
(or	(unit-type-count-total elite-camel-archer >= 6)
	(unit-type-count-total genoese-crossbowman >= 6)))))))
	(can-research ri-ballistics)
=>
	(research ri-ballistics))
(defrule
(or	(building-type-count-total donjon >= 3)
(or	(building-type-count-total krepost >= 3)
	(up-research-status c: ri-arquebus >= research-pending)))
	(can-research ri-ballistics)
=>
	(research ri-ballistics))
;=============================================================
; Infantry upgrades
;=============================================================
(defrule
	(civ-selected bulgarians)
(or	(goal attacking yes)
(or	(goal underattack yes)
	(goal defend yes)))
=>
	(up-jump-rule 1))
(defrule
	(strategic-number sn-current-age < fcastlea)
	(food-amount < castle-fs)
(nand	(unit-type-count-total infantry-class >= 30)
	(strategic-number sn-military-superiority <= -1))
(or	(up-compare-goal strategy-type != feudal-war)
(or	(up-research-status c: ri-fletching < research-pending)
	(and	(nand	(unit-type-count-total militiaman-line >= 6)
			(up-research-status c: ri-man-at-arms >= research-pending))
		(unit-type-count-total spearman-line < 12))))
=>
	(up-jump-rule 5))
(defrule
(or	(unit-type-count-total infantry-class >= 6)
(or	(unit-type-count-total kamayuk >= 6)
(or	(unit-type-count-total shotel-warrior >= 6)
(or	(unit-type-count-total elite-shotel-warrior >= 6)
(or	(unit-type-count-total gbeto >= 6)
(or	(unit-type-count-total karambit-warrior >= 6)
	(unit-type-count-total condottiero >= 6)))))))
	(can-research ri-scale-mail)
=>
	(research ri-scale-mail))
(defrule
(or	(up-research-status c: ri-pikeman >= research-pending)
(or	(unit-type-count-total heavy-eagle-warrior >= 6)
(or	(unit-type-count-total elite-gbeto >= 6)
	(unit-type-count-total elite-karambit-warrior >= 6))))
	(can-research ri-scale-mail)
=>
	(research ri-scale-mail))
(defrule
(or	(unit-type-count-total heavy-eagle-warrior >= 6)
(or	(unit-type-count-total flemish-pikeman >= 6)
(or	(unit-type-count-total flemish-pikewoman >= 6)
(or	(up-research-status c: ri-flemish-revolution >= research-pending)
(or	(unit-type-count-total elite-gbeto >= 6)
	(unit-type-count-total elite-karambit-warrior >= 6))))))
	(can-research ri-scale-mail)
=>
	(research ri-scale-mail))
(defrule
(or	(up-research-status c: ri-pikeman >= research-pending)
(or	(up-research-status c: ri-two-handed-swordsman >= research-pending)
	(up-research-status c: ri-elite-eagle-warrior >= research-pending)))
(or	(goal trainpike yes)
(or	(goal trainchamp yes)
(or	(goal traineagle yes)
	(unit-type-count infantry-class >= 1))))
	(can-research ri-scale-mail)
=>
	(research ri-scale-mail))
(defrule
	(goal enemy-goal2 klew)
	(goal trainchamp yes)
(or	(up-compare-goal excessFood >= 250)
	(and	(up-research-status c: ri-man-at-arms != research-available)
		(up-research-status c: ri-supplies != research-available)))
	(can-research ri-scale-mail)
=>
	(research ri-scale-mail)); end jump
;=============================================================
(defrule
(or	(unit-type-count-total infantry-class >= 6)
(or	(unit-type-count-total kamayuk >= 6)
(or	(unit-type-count-total shotel-warrior >= 6)
(or	(unit-type-count-total elite-shotel-warrior >= 6)
(or	(unit-type-count-total gbeto >= 6)
(or	(unit-type-count-total karambit-warrior >= 6)
	(unit-type-count-total condottiero >= 6)))))))
	(can-research ri-chain-mail)
=>
	(research ri-chain-mail))
(defrule
(or	(unit-type-count-total heavy-eagle-warrior >= 6)
(or	(unit-type-count-total flemish-pikeman >= 6)
(or	(unit-type-count-total flemish-pikewoman >= 6)
(or	(up-research-status c: ri-flemish-revolution >= research-pending)
(or	(unit-type-count-total elite-gbeto >= 6)
	(unit-type-count-total elite-karambit-warrior >= 6))))))
	(can-research ri-chain-mail)
=>
	(research ri-chain-mail))
;=============================================================
#load-if-not-defined FEUDAL-AGE-END
(defrule
	(civ-selected bulgarians)
(or	(goal attacking yes)
(or	(goal underattack yes)
	(goal defend yes)))
=>
	(up-jump-rule 1))
(defrule
	(strategic-number moenche < 10)
	(strategic-number sn-current-age < fcastlea)
(or	(food-amount < 1050); 950
	(and	(up-research-status c: ri-scale-mail < research-pending)
		(up-research-status c: ri-scale-barding < research-pending)))
=>
	(up-jump-rule 6))
(defrule
(or	(and	(research-completed ri-scale-barding)
		(up-research-status c: ri-chain-barding <= research-unavailable))
	(and	(research-completed ri-scale-mail)
		(up-research-status c: ri-chain-mail <= research-unavailable)))
=>
	(up-jump-rule 1))
(defrule
	(strategic-number moenche < 10)
	(up-research-status c: castle-age >= research-pending);	(current-age >= castle-age)
(nand	(up-research-status c: imperial-age == research-available); test
	(food-amount < 1250)); 1150
	(up-research-status c: ri-chain-mail < research-pending)
	(up-research-status c: ri-chain-barding < research-pending)
(nand	(up-compare-goal excessFood >= 400); 450
	(up-compare-goal excessGold < 50))
=>
	(up-jump-rule 4))
#end-if
(defrule
(or	(unit-type-count-total scout-cavalry-class >= 6)
(or	(unit-type-count-total cavalry-class >= 6)
(or	(unit-type-count-total magyar-huszar >= 6)
(or	(unit-type-count-total boyar >= 6)
(or	(unit-type-count-total infantry-class >= 6)
(or	(unit-type-count-total kamayuk >= 6)
	(unit-type-count-total condottiero >= 6)))))))
	(can-research ri-forging)
=>
	(research ri-forging))
(defrule
(or	(unit-type-count-total heavy-eagle-warrior >= 6)
(or	(unit-type-count-total shotel-warrior >= 6)
(or	(unit-type-count-total elite-shotel-warrior >= 6)
(or	(unit-type-count-total gbeto >= 6)
(or	(unit-type-count-total elite-gbeto >= 6)
(or	(unit-type-count-total karambit-warrior >= 6)
	(unit-type-count-total elite-karambit-warrior >= 6)))))))
	(can-research ri-forging)
=>
	(research ri-forging))
(defrule
(or	(up-compare-goal steppe-lancer-set >= 6)
(or	(up-compare-goal camel-set >= 6)
(or	(unit-type-count-total flemish-pikeman >= 6)
(or	(unit-type-count-total flemish-pikewoman >= 6)
(or	(up-research-status c: ri-flemish-revolution >= research-pending)
	(up-compare-goal battle-elephant-set >= 6))))))
	(can-research ri-forging)
=>
	(research ri-forging))
(defrule
	(goal enemy-goal2 klew)
	(goal trainchamp yes)
(or	(up-compare-goal excessFood >= 250)
	(and	(up-research-status c: ri-man-at-arms != research-available)
		(up-research-status c: ri-supplies != research-available)))
	(can-research ri-forging)
=>
	(research ri-forging)); end jump
;=============================================================
#load-if-not-defined DIFFICULTY-EASIEST
#load-if-not-defined DIFFICULTY-EASY
#load-if-not-defined DIFFICULTY-MODERATE
(defrule
	(strategic-number sn-current-age < cimperial)
	(up-compare-goal excessFood < 1200)
(or	(up-compare-goal de-game != 1)
	(up-compare-goal excessFood < 1100))
	(goal attacking no)
=>
	(up-jump-rule 2))
(defrule
(or	(unit-type-count-total infantry-class >= 6)
(or	(unit-type-count-total kamayuk >= 6)
(or	(unit-type-count-total shotel-warrior >= 6)
(or	(unit-type-count-total elite-shotel-warrior >= 6)
	(unit-type-count-total condottiero >= 6)))))
	(can-research ri-squires)
=>
	(research ri-squires))
(defrule
(or	(unit-type-count-total heavy-eagle-warrior >= 6)
(or	(unit-type-count-total gbeto >= 6)
(or	(unit-type-count-total elite-gbeto >= 6)
(or	(unit-type-count-total karambit-warrior >= 6)
	(unit-type-count-total elite-karambit-warrior >= 6)))))
	(can-research ri-squires)
=>
	(research ri-squires)); end jump
(defrule
(or	(unit-type-count-total infantry-class >= 24)
(or	(unit-type-count-total kamayuk >= 24)
(or	(unit-type-count-total shotel-warrior >= 24)
(or	(unit-type-count-total elite-shotel-warrior >= 24)
	(unit-type-count-total condottiero >= 24)))))
	(can-research ri-squires)
=>
	(research ri-squires))
(defrule
(or	(unit-type-count-total heavy-eagle-warrior >= 24)
(or	(unit-type-count-total flemish-pikeman >= 24)
(or	(up-research-status c: ri-flemish-revolution >= research-pending)
(or	(unit-type-count-total gbeto >= 24)
(or	(unit-type-count-total elite-gbeto >= 24)
(or	(unit-type-count-total karambit-warrior >= 24)
	(unit-type-count-total elite-karambit-warrior >= 24)))))))
	(can-research ri-squires)
=>
	(research ri-squires))
(defrule
(or	(unit-type-count-total flemish-pikewoman >= 24)
	(and	(strategic-number sn-current-age >= cimperial)
		(or	(goal strategy stonewall)
			(or	(and	(up-compare-goal uugoal == yes)
					(up-compare-const uu-type == infantry-uu))
				(and	(goal champgoal yes)
					(up-research-status c: ri-long-swordsman >= research-pending))))))
	(can-research ri-squires)
=>
	(research ri-squires))
;=============================================================
(defrule
	(strategic-number sn-current-age <= feudal)
	(strategic-number eagles < 3)
=>
	(up-jump-rule 2))
(defrule
(or	(and	(goal trainchamp yes)
		(or	(up-compare-goal strategy-type <= castle-war)
			(strategic-number sn-current-age >= imperial)))
(or	(up-research-status c: ri-champion >= research-pending)
(or	(up-research-status c: ri-forced-levy >= research-pending)
	(and	(goal champgoal yes)
		(strategic-number sn-current-age >= imperial)))))
	(can-research ri-supplies)
=>
	(research ri-supplies))
(defrule
	(goal trainchamp yes)
(or	(up-research-status c: ri-long-swordsman >= research-pending)
	(and	(goal enemy-goal2 klew)
		(or	(up-research-status c: ri-man-at-arms >= research-pending)
			(goal trainchamp yes))))
	(can-research ri-supplies)
=>
	(research ri-supplies)); end jump
#end-if
#end-if
#end-if
;=============================================================
(defrule
(or	(up-research-status c: ri-chain-mail != research-available)
	(building-type-count-total blacksmith >= 2));
(or	(unit-type-count-total heavy-eagle-warrior >= 6)
(or	(unit-type-count-total shotel-warrior >= 6)
(or	(unit-type-count-total infantry-class >= 6)
(or	(unit-type-count-total kamayuk >= 6)
	(unit-type-count-total condottiero >= 6)))))
	(can-research ri-iron-casting)
=>
	(research ri-iron-casting))
(defrule
(or	(up-research-status c: ri-chain-mail != research-available)
	(building-type-count-total blacksmith >= 2));
(or	(unit-type-count-total elite-shotel-warrior >= 6)
(or	(unit-type-count-total gbeto >= 6)
(or	(unit-type-count-total elite-gbeto >= 6)
(or	(unit-type-count-total karambit-warrior >= 6)
	(unit-type-count-total elite-karambit-warrior >= 6)))))
	(can-research ri-iron-casting)
=>
	(research ri-iron-casting))
(defrule
(or	(up-research-status c: ri-chain-barding != research-available)
	(building-type-count-total blacksmith >= 2));
(or	(up-compare-goal battle-elephant-set >= 6)
(or	(up-compare-goal steppe-lancer-set >= 6)
(or	(unit-type-count-total imperial-camel >= 6)
(or	(unit-type-count-total cavalry-class >= 6)
(or	(unit-type-count-total magyar-huszar >= 6)
	(unit-type-count-total boyar >= 6))))))
	(can-research ri-iron-casting)
=>
	(research ri-iron-casting))
(defrule
(or	(unit-type-count-total flemish-pikeman >= 6)
(or	(unit-type-count-total flemish-pikewoman >= 6)
	(up-research-status c: ri-flemish-revolution >= research-pending)))
	(can-research ri-iron-casting)
=>
	(research ri-iron-casting))
;=============================================================
#load-if-not-defined DIFFICULTY-EASIEST
#load-if-not-defined DIFFICULTY-EASY
(defrule
(or	(unit-type-count-total infantry-class >= 6)
(or	(unit-type-count-total shotel-warrior >= 6)
(or	(unit-type-count-total elite-shotel-warrior >= 6)
(or	(unit-type-count-total gbeto >= 6)
(or	(unit-type-count-total elite-gbeto >= 6)
(or	(unit-type-count-total karambit-warrior >= 6)
	(unit-type-count-total elite-karambit-warrior >= 6)))))))
	(can-research ri-plate-mail)
=>
	(research ri-plate-mail))
(defrule
(or	(unit-type-count-total heavy-eagle-warrior >= 6)
(or	(unit-type-count-total flemish-pikeman >= 6)
(or	(unit-type-count-total flemish-pikewoman >= 6)
(or	(up-research-status c: ri-flemish-revolution >= research-pending)
(or	(unit-type-count-total kamayuk >= 6)
	(unit-type-count-total condottiero >= 6))))))
	(can-research ri-plate-mail)
=>
	(research ri-plate-mail))
#end-if
#end-if
;=============================================================
(defrule
(or	(unit-type-count-total infantry-class >= 6)
(or	(unit-type-count-total heavy-eagle-warrior >= 6)
(or	(unit-type-count-total kamayuk >= 6)
(or	(unit-type-count-total condottiero >= 6)
(or	(unit-type-count-total cavalry-class >= 6)
(or	(unit-type-count-total magyar-huszar >= 6)
	(unit-type-count-total boyar >= 6)))))))
	(can-research ri-blast-furnace)
=>
	(research ri-blast-furnace))
(defrule
(or	(up-compare-goal battle-elephant-set >= 6)
(or	(unit-type-count-total shotel-warrior >= 6)
(or	(unit-type-count-total elite-shotel-warrior >= 6)
(or	(unit-type-count-total gbeto >= 6)
(or	(unit-type-count-total elite-gbeto >= 6)
(or	(unit-type-count-total karambit-warrior >= 6)
	(unit-type-count-total elite-karambit-warrior >= 6)))))))
	(can-research ri-blast-furnace)
=>
	(research ri-blast-furnace))
(defrule
(or	(up-compare-goal steppe-lancer-set >= 6)
(or	(unit-type-count-total flemish-pikeman >= 6)
(or	(unit-type-count-total flemish-pikewoman >= 6)
(or	(up-research-status c: ri-flemish-revolution >= research-pending)
	(up-compare-goal camel-set >= 6)))))
	(can-research ri-blast-furnace)
=>
	(research ri-blast-furnace))
;=============================================================
; Boats
;=============================================================
#load-if-not-defined DIFFICULTY-EASIEST
#load-if-not-defined DIFFICULTY-EASY
#load-if-not-defined DIFFICULTY-MODERATE
(defrule
	(goal enemy-boats yes)
	(goal fleet yes);
(or	(up-compare-goal navycount >= 1)
	(building-type-count-total dock >= 4))
	(can-research ri-shipwright)
=>
	(research ri-shipwright))
#end-if
#end-if
#end-if
(defrule
(or	(up-compare-goal navycount >= 5)
(or	(map-type islands)
	(map-type team-islands)))
	(can-research ri-cannon-galleon)
=>
	(research ri-cannon-galleon))
#load-if-not-defined DIFFICULTY-EASIEST
#load-if-not-defined DIFFICULTY-EASY
(defrule
(or	(up-compare-goal navycount >= 5)
(or	(map-type islands)
	(map-type team-islands)))
(or	(unit-type-count-total cannon-galleon-line >= 1)
	(goal researchplan yes))
	(can-research ri-deck-guns); elite cannon galleon
=>
	(research ri-deck-guns))
#end-if
#end-if
(defrule
(or	(unit-type-count-total galley-line >= 2); 3
	(and	(goal inseln yes)
		(and	(up-research-status c: ri-bow-saw >= research-pending)
			(and	(or	(not	(civ-selected aztec))
						(up-compare-const wk-game == 1))
				(strategic-number sn-current-age >= imperial)))))
	(can-research ri-war-galley)
=>
	(research ri-war-galley))
(defrule
(or	(unit-type-count-total fire-galley >= 2)
(or	(unit-type-count-total demolition-raft >= 2)
(or	(unit-type-count-total fire-ship-line >= 2)
	(unit-type-count-total demolition-ship-line >= 2))))
	(can-research ri-war-galley)
=>
	(research ri-war-galley))
(defrule
(or	(goal trainfire yes)
(or	(goal traindemo yes)
	(goal traingalley yes)))
	(can-research ri-war-galley)
=>
	(research ri-war-galley))
(defrule
(or	(unit-type-count-total galley-line >= 2); 3
	(and	(goal inseln yes)
		(up-research-status c: ri-bow-saw >= research-pending)))
	(can-research ri-galleon)
=>
	(research ri-galleon))
(defrule
(or	(unit-type-count-total turtle-ship-line >= 2)
	(goal trainturtle yes))
	(can-research ri-elite-turtle-ship)
=>
	(research ri-elite-turtle-ship))
(defrule
(or	(unit-type-count-total longboat-line >= 2)
	(up-research-status c: ri-dry-dock >= research-pending));
	(can-research ri-elite-longboat)
=>
	(research ri-elite-longboat))
(defrule
(or	(and	(goal traindemo yes)
		(unit-type-count-total demolition-ship-line >= 2))
	(unit-type-count-total demolition-ship-line >= 3))
	(can-research ri-heavy-demolition-ship)
=>
	(research ri-heavy-demolition-ship))
(defrule
(or	(unit-type-count-total fire-ship-line >= 3)
(or	(and	(goal enemy-boats yes)
		(and	(up-research-status c: ri-galleon <= research-unavailable)
			(up-research-status c: ri-fast-fire-ship == research-available)))
	(up-research-status c: ri-greek-fire >= research-pending)))
	(can-research ri-fast-fire-ship)
=>
	(research ri-fast-fire-ship))
#load-if-not-defined DIFFICULTY-EASY
#load-if-not-defined DIFFICULTY-EASIEST
(defrule
(or	(up-compare-goal navycount >= 3)
	(unit-type-count-total transport-ship >= 1))
(or	(up-compare-goal navycount >= 12)
(or	(goal attacking yes)
(or	(goal migration-state 1)
	(strategic-number sn-current-age >= imperial))))
	(can-research ri-careening)
=>
	(research ri-careening))
#end-if
#end-if
#load-if-not-defined DIFFICULTY-MODERATE
(defrule
(or	(up-compare-goal navycount >= 12)
(or	(and	(up-compare-goal navycount >= 6)
		(goal attacking yes))
(or	(unit-type-count-total fire-ship-line >= 6)
(or	(unit-type-count-total demolition-ship-line >= 4)
	(unit-type-count-total transport-ship >= 1)))))
	(can-research ri-dry-dock)
=>
	(research ri-dry-dock))
(defrule
(or	(up-research-status c: ri-heavy-demolition-ship >= research-pending)
	(up-research-status c: ri-fast-fire-ship == research-pending))
(or	(goal traindemo yes)
(or	(goal trainfire yes)
	(goal trainturtle yes)))
(or	(can-research ri-careening)
	(can-research ri-dry-dock))
=>
	(research ri-careening)
	(research ri-dry-dock))
(defrule
	(up-compare-const wk-game == 1)
	(unit-type-count-total trade-cog >= 1)
(or	(goal traincog yes)
	(unit-type-count-total trade-cog >= 3))
	(players-building-type-count any-ally dock >= 1)
(or	(can-research ri-careening)
	(can-research ri-dry-dock))
=>
	(research ri-careening)
	(research ri-dry-dock))
#end-if
;============================================================
; Monks
;============================================================

#load-if-defined BOHEMIANS-CIV

(defrule
	(unit-type-count-total villager > twenty-pop)
	(can-research-with-escrow ri-fervor)
	(research-completed ri-bow-saw)
	(or(gold-amount > 200)
	(unit-type-count-total monk > 0))
=>
	(up-modify-goal temporary-goal8 g:= escrow-state)
	(set-goal escrow-state with-escrow)
	(up-research escrow-state c: ri-fervor); this is basically an eco tech
	(up-modify-goal escrow-state g:= temporary-goal8)
)

(defrule
	(up-research-status c: imperial-age > 1)
	(can-research ri-sanctity)
	(unit-type-count-total villager > twenty-pop)
=>
	(research ri-sanctity)
)

#end-if

#load-if-not-defined DIFFICULTY-EASIEST
(defrule
	(up-compare-goal strategy != stonewall)
;(or
	(strategic-number moenche >= 10)
;	(and	(strategic-number moenche >= 7)
;		(players-civ any-enemy aztec)))
	(can-research ri-heresy)
=>
	(research ri-heresy))
;=============================================================
(defrule
	(up-compare-goal strategy != stonewall)
;(or
	(strategic-number moenche >= 10)
;	(and	(strategic-number moenche >= 7)
;		(players-civ any-enemy aztec)))
	(can-research ri-faith)
=>
	(research ri-faith))
;=============================================================
#load-if-not-defined DIFFICULTY-EASY
(defrule
(or	(unit-type-count-total monastery-class >= 7)
(or	(goal attacking yes)
(or	(goal underattack yes)
	(strategic-number sn-current-age >= imperial))))
(or	(unit-type-count-total monastery-class >= 5)
	(and	(up-research-status c: ri-sanctity >= research-pending)
		(unit-type-count-total monastery-class >= 1)))
	(can-research ri-sanctity)
=>
	(research ri-sanctity))
;=============================================================
#load-if-not-defined DIFFICULTY-MODERATE
(defrule
(or	(gold-amount >= 950)
	(strategic-number sn-current-age >= imperial))
	(strategic-number archers < 24)
	(players-unit-type-count focus-player eagle-warrior-line < 18)
	(players-unit-type-count focus-player scout-cavalry-line < 15)
(or	(unit-type-count-total monastery-class >= 11)
	(and	(civ-selected aztec)
		(unit-type-count-total monastery-class >= 9)))
	(can-research ri-theocracy)
=>
	(research ri-theocracy))
#end-if
;=============================================================
(defrule
(or	(gold-amount >= 950)
	(strategic-number sn-current-age >= imperial))
	(strategic-number archers < 24)
	(players-unit-type-count focus-player eagle-warrior-line < 18)
	(players-unit-type-count focus-player scout-cavalry-line < 15)
(or	(unit-type-count-total monastery-class >= 11)
	(and	(civ-selected aztec)
		(unit-type-count-total monastery-class >= 9)))
	(can-research ri-block-printing)
=>
	(research ri-block-printing))
#end-if
;=============================================================
(defrule
	(up-compare-goal strategy != stonewall)
	(unit-type-count-total monastery-class >= 9)
(or	(players-unit-type-count target-player scorpion-line >= 5)
(or	(players-unit-type-count target-player mangonel-line >= 3)
	(and	(players-unit-type-count target-player battering-ram-line >= 5)
		(unit-type-count siege-weapon-class < 1))))
	(strategic-number archers < 24)
	(players-unit-type-count focus-player eagle-warrior-line < 18)
	(players-unit-type-count focus-player scout-cavalry-line < 15)
=>
	(research ri-redemption))
;=============================================================
#load-if-not-defined DIFFICULTY-EASY
(defrule
	(up-compare-goal strategy != stonewall)
(or	(gold-amount >= 950)
	(strategic-number sn-current-age >= imperial))
(or	(unit-type-count-total monastery-class >= 11)
	(and	(civ-selected aztec)
		(unit-type-count-total monastery-class >= 9)))
	(strategic-number archers < 24)
	(players-unit-type-count focus-player eagle-warrior-line < 18)
	(players-unit-type-count focus-player scout-cavalry-line < 15)
	(can-research ri-illumination)
=>
	(research ri-illumination))
#end-if
#end-if
;=============================================================
(defrule
	(up-compare-goal strategy != stonewall)
(or	(and	(civ-selected aztec)
		(strategic-number sn-current-age >= imperial))
	(strategic-number moenche >= 7))
;(or	(gold-amount >= 400)
;	(strategic-number moenche >= 7))
;	(strategic-number sn-current-age >= imperial)
(or	(unit-type-count-total monastery-class >= 11)
	(and	(civ-selected aztec)
		(unit-type-count-total monastery-class >= 9)))
	(strategic-number archers < 24)
	(players-unit-type-count focus-player eagle-warrior-line < 18)
	(players-unit-type-count focus-player scout-cavalry-line < 15)
	(can-research ri-atonement)
=>
	(research ri-atonement))
;=============================================================
(defrule
	(up-compare-goal strategy != stonewall)
(or	(up-compare-goal excessGold >= 950)
	(goal researchplan yes))
(or	(unit-type-count-total monastery-class >= 11)
	(and	(civ-selected aztec)
		(unit-type-count-total monastery-class >= 9)))
	(strategic-number archers < 24)
	(players-unit-type-count focus-player eagle-warrior-line < 18)
	(players-unit-type-count focus-player scout-cavalry-line < 15)
	(can-research ri-redemption)
=>
	(research ri-redemption))
;=============================================================
(defrule
	(up-compare-const wk-game == 1)
	(up-compare-goal strategy != stonewall)
	(up-compare-goal excessGold >= 950)
	(population >= del-civ-pop)
(or	(strategic-number sn-current-age >= imperial)
	(unit-type-count-total monastery-class >= 20))
	(unit-type-count-total monastery-class >= 10)
	(can-research ri-fervor)
=>
	(research ri-fervor))
;=============================================================
(defrule
	(up-compare-goal strategy != stonewall)
	(up-gaia-type-count-total c: relic >= 9)
	(up-compare-goal relic-count >= 3)
	(unit-type-count-total monastery-class >= 3)
(or	(can-research ri-fervor)
	(can-research ri-sanctity))
=>
	(research ri-fervor)
	(research ri-sanctity))
;=============================================================
#load-if-defined AZTEC-CIV
(defrule
	(up-compare-goal strategy != stonewall)
;	(gold-amount >= 1100)
	(strategic-number sn-current-age >= imperial)
	(population >= up-max-civ)
	(strategic-number archers < 24)
	(players-unit-type-count focus-player eagle-warrior-line < 18)
	(players-unit-type-count focus-player scout-cavalry-line < 15)
	(unit-type-count-total monastery-class >= 10)
	(can-research ri-faith)
=>
	(research ri-faith))
;=============================================================
(defrule
	(up-compare-goal strategy != stonewall)
;	(gold-amount >= 1100)
	(strategic-number sn-current-age >= imperial)
	(population >= up-max-civ)
	(strategic-number archers < 24)
	(players-unit-type-count focus-player eagle-warrior-line < 18)
	(players-unit-type-count focus-player scout-cavalry-line < 15)
	(unit-type-count-total monastery-class >= 10)
	(can-research ri-heresy)
=>
	(research ri-heresy))
;=============================================================
(defrule
	(up-compare-goal strategy != stonewall)
	(gold-amount >= 500)
	(strategic-number sn-current-age >= imperial)
	(population >= del-civ-pop)
	(strategic-number archers < 24)
	(players-unit-type-count focus-player eagle-warrior-line < 18)
	(players-unit-type-count focus-player scout-cavalry-line < 15)
	(unit-type-count-total monastery-class >= 15); 10
	(can-research ri-herbal-medicine)
=>
	(research ri-herbal-medicine))
;=============================================================
(defrule
	(up-compare-goal strategy != stonewall)
	(gold-amount >= 500)
	(strategic-number sn-current-age >= imperial)
	(population >= del-civ-pop)
	(strategic-number archers < 24)
	(players-unit-type-count focus-player eagle-warrior-line < 18)
	(players-unit-type-count focus-player scout-cavalry-line < 15)
	(unit-type-count-total monastery-class >= 15); 10
	(can-research ri-fervor)
=>
	(research ri-fervor))
#end-if
;=============================================================
; Miscellaneous
;=============================================================
#load-if-not-defined DIFFICULTY-EASIEST
#load-if-not-defined DIFFICULTY-EASY
(defrule
;(or	(strategic-number sn-military-superiority >= 1)
;	(goal researchplan yes))
(or	(strategic-number sn-current-age >= cimperial)
	(up-research-status c: ri-hand-cart >= research-pending))
	(can-research ri-guilds)
=>
	(research ri-guilds))
#load-if-not-defined DIFFICULTY-MODERATE
(defrule
;(or	(population < siege-pop)
;	(goal siegereq yes))
(or	(up-compare-const inf-game == yes)
(or	(strategic-number sn-current-age >= cimperial)
	(up-compare-goal strategy-type <= castle-war)))
	(can-research ri-conscription)
=>
	(research ri-conscription))
(defrule
(or	(building-type-count-total wonder >= 1)
	(and	(goal researchplan yes)
			(and	(strategic-number sn-military-superiority >= 1)
				(and	(up-compare-goal excessWood >= 300)
					(up-compare-goal excessFood >= 400)))))
	(can-research ri-treadmill-crane)
=>
	(research ri-treadmill-crane))
#end-if
#end-if
#end-if
;=============================================================
(defrule
(or	(goal nomaden yes)
(or	(goal landnomad 3)
	(goal landnomad yes)))
(or	(military-population <= 0)
	(up-compare-goal scouting-unit <= -1))
	(goal underattack no)
	(goal defend no)
(not	(town-under-attack))
	(up-compare-goal increase-ts != 0)
;	(strategic-number sn-current-age < imperial)
	(strategic-number sn-maximum-town-size >= 28)
	(can-research ri-town-watch)
=>
	(research ri-town-watch))
(defrule
(or	(and	(population >= up-max-civ)
		(up-compare-goal excessFood >= 2200))
(or	(population-headroom <= 0)
(or	(and	(up-pending-objects c: house <= 0)
		(and	(housing-headroom <= 0)
			(population-headroom >= 1)))
	(goal researchplan yes))))
	(up-compare-goal excessFood >= 875)
	(can-research ri-town-watch)
=>
	(research ri-town-watch))
(defrule
	(up-compare-goal migration-state >= 1)
	(up-compare-goal relocating >= 1)
	(up-compare-goal increase-ts != 0)
;	(strategic-number sn-current-age < imperial)
	(strategic-number sn-maximum-town-size >= 28)
	(can-research ri-town-watch)
=>
	(research ri-town-watch))
(defrule
(or	(taunt-detected any-ally 55)
	(and	(or	(goal enemy-goal trush)
				(up-compare-goal ttower-distance < 32))
		(players-building-type-count target-player watch-tower <= 0)))
	(can-research ri-town-watch)
=>
	(research ri-town-watch))
(defrule
(or	(strategic-number sn-current-age < cimperial)
	(and	(population < max-civ-pop)
		(and	(up-compare-goal custom-civ-pop < up-max-civ)
			(civilian-population < up-max-civ))))
=>
	(up-jump-rule 2))
(defrule
(or	(up-compare-goal excessFood >= 875)
(or	(goal defend yes)
(or	(building-type-count-total outpost >= 1)
	(up-enemy-units-in-town >= 1))))
	(can-research ri-town-watch)
=>
	(research ri-town-watch))
(defrule
	(up-compare-goal tradeunits >= 1)
	(up-compare-goal excessFood >= 1600)
	(up-compare-goal excessGold >= 900)
(or	(up-compare-goal tradeunits >= 10)
	(and	(up-compare-goal excessFood >= 2100)
		(up-compare-goal excessGold >= 1900)))
	(can-research ri-town-patrol)
=>
	(research ri-town-patrol)); end jump
(defrule
(or	(up-compare-goal strategy-type <= castle-war)
	(strategic-number sn-current-age >= imperial))
(or	(goal researchplan yes)
	(and	(strategic-number sn-current-age >= imperial)
		(or	(up-compare-goal excessFood >= 800)
			(unit-type-count infantry-class >= 30))))
	(unit-type-count infantry-class >= 10)
	(can-research ri-tracking)
=>
	(research ri-tracking))
#load-if-not-defined DIFFICULTY-EASIEST
#load-if-not-defined DIFFICULTY-EASY
#load-if-not-defined DIFFICULTY-MODERATE
(defrule
(or	(up-compare-flag forward-flag == 2)
(or	(building-type-count-total wonder >= 1)
	(players-building-type-count any-ally wonder >= 1)))
	(can-research ri-bombard-tower)
=>
	(research ri-bombard-tower))
(defrule
	(population >= max-civ-pop)
(or	(strategic-number sn-military-superiority >= 2)
	(and	(or	(population >= del-civ-pop)
				(building-type-count feitoria >= 1))
		(strategic-number sn-military-superiority >= 1)))
	(strategic-number teamsuperiority >= -2)
	(building-type-count-total castle >= 3)
	(goal attacking yes)
	(goal underattack no)
	(goal wwonder no)
	(can-research ri-bombard-tower)
=>
	(research ri-bombard-tower))
(defrule
(or	(population >= max-pop)
(or	(and	(goal researchplan yes)
		(population >= max-civ-pop))
(or	(up-research-status c: ri-architecture >= research-pending)
(or	(up-research-status c: ri-crenellations >= research-pending)
(or	(up-research-status c: ri-stronghold >= research-pending)
	(goal underattack yes))))))
	(can-research ri-hoardings)
=>
	(research ri-hoardings))
(defrule
	(goal uugoal yes)
(or	(goal underattack yes)
(or	(goal defend yes)
	(town-under-attack)))
	(can-research ri-hoardings)
=>
	(research ri-hoardings))
#end-if
(defrule
(or	(and	(strategic-number sn-military-superiority <= -1)
		(goal defend yes))
(or	(up-enemy-units-in-town >= 5)
(or	(goal underattack yes);	(town-under-attack)
	(goal researchplan yes))))
(or	(building-type-count-total castle >= 4)
        (building-type-count-total watch-tower >= 6))
	(can-research ri-murder-holes)
=>
	(research ri-murder-holes))
#end-if
(defrule
(or	(goal attacking yes)
(or	(goal underattack yes)
	(goal researchplan yes)))
	(building-type-count-total watch-tower >= 1)
(or	(up-research-status c: ri-yeomen >= research-pending)
(or	(up-research-status c: ri-yasama >= research-pending)
(or	(up-research-status c: ri-arrowslits >= research-pending)
	(building-type-count-total watch-tower >= 3))))
	(can-research ri-guard-tower)
=>
	(research ri-guard-tower))
#load-if-not-defined DIFFICULTY-EASY
(defrule
(or	(goal attacking yes)
(or	(goal underattack yes)
	(goal researchplan yes)))
	(building-type-count-total watch-tower >= 1)
(or	(up-research-status c: ri-yeomen >= research-pending)
(or	(up-research-status c: ri-yasama >= research-pending)
(or	(up-research-status c: ri-arrowslits >= research-pending)
	(building-type-count-total watch-tower >= 3))))
	(can-research ri-keep)
=>
	(research ri-keep))
(defrule
(or	(up-pending-objects c: stone-wall-line >= 1)
(or	(up-pending-objects c: 939 >= 1); gate
(or	(and	(goal researchplan yes)
		(population >= max-pop))
(or	(building-type-count-total wonder >= 1)
	(and	(strategic-number sn-current-age >= imperial)
		(goal underattack yes))))))
	(can-research ri-masonry)
=>
	(research ri-masonry))
#load-if-not-defined DIFFICULTY-MODERATE
(defrule
(or	(up-compare-const diff-id <= 0)
	(up-compare-const diff-fp == 1))
	(strategic-number sn-current-age >= imperial)
(or	(building-type-count feitoria >= 1)
(or	(up-research-status c: ri-hoardings >= research-pending)
	(and	(up-compare-goal excessWood >= 1975)
		(up-compare-goal excessFood >= 1950))))
	(can-research ri-masonry)
=>
	(research ri-masonry))
(defrule
(or	(building-type-count-total castle >= 4)
(or	(building-type-count-total krepost >= 5)
(or	(building-type-count-total donjon >= 6)
(or	(building-type-count-total bombard-tower >= 7)
	(building-type-count-total watch-tower >= 8)))))
(or	(can-research ri-masonry)
	(can-research ri-architecture))
=>
	(research ri-masonry)
	(research ri-architecture))
(defrule
(or	(up-pending-objects c: stone-wall-line >= 1)
(or	(up-pending-objects c: 939 >= 1); gate
(or	(and	(goal researchplan yes)
		(population >= max-pop))
(or	(building-type-count-total wonder >= 1)
	(goal underattack yes)))))
	(can-research ri-architecture)
=>
	(research ri-architecture))
(defrule
(or	(up-compare-const diff-id <= 0)
	(up-compare-const diff-fp == 1))
(or	(up-research-status c: ri-hoardings >= research-pending)
	(and	(up-compare-goal excessWood >= 2000)
		(up-compare-goal excessFood >= 2100)))
	(can-research ri-architecture)
=>
	(research ri-architecture))
(defrule
	(strategic-number sn-current-age >= imperial)
(or	(building-type-count-total castle >= 2)
	(building-type-count-total watch-tower >= 3))
	(goal enemy-boats yes)
(or	(town-under-attack)
	(goal underattack yes))
;	(goal attacking no)
	(goal researchplan yes); test
	(can-research ri-heated-shot)
=>
	(research ri-heated-shot))
#load-if-not-defined UP-GAME-WK
(defrule
	(strategic-number sn-current-age >= imperial)
(or	(building-type-count-total castle >= 2)
	(building-type-count-total watch-tower >= 3))
(or	(players-unit-type-count focus-player camel-line >= 40)
	(players-unit-type-count focus-player mameluke-line >= 40))
(or	(town-under-attack)
	(goal underattack yes))
;	(goal attacking no)
	(goal researchplan yes); test
	(can-research ri-heated-shot)
=>
	(research ri-heated-shot))
#else
(defrule
	(up-research-status c: ri-thalassocracy >= research-pending)
	(building-type-count dock >= 1)
	(goal enemy-boats yes)
	(can-research ri-heated-shot)
=>
	(research ri-heated-shot))
#end-if
(defrule
;	(goal researchplan yes)
(or	(up-compare-const scenario-game == 1)
(or	(building-type-count-total wonder >= 1)
	(and	(up-compare-goal relic-count >= 1)
		(hold-relics))))
(or	(wall-completed-percentage 2 >= 100)
	(wall-completed-percentage 1 >= 100)); test
(or	(building-type-count-total stone-wall >= 4)
	(building-type-count gate >= 2))
	(can-research ri-fortified-wall)
=>
	(research ri-fortified-wall))
#end-if
#end-if
#end-if
;=============================================================
; Early smith upgrades
;=============================================================
#load-if-not-defined DIFFICULTY-EASIEST
#load-if-not-defined DIFFICULTY-EASY
#load-if-not-defined DIFFICULTY-MODERATE
(defrule
	(strategic-number sn-current-age >= imperial)
	(goal palagoal yes)
	(building-type-count stable >= 1); -total
(or	(can-research ri-scale-barding)
;(or
	(can-research ri-chain-barding)
;	(can-research ri-plate-barding))
)
=>
	(research ri-scale-barding)
	(research ri-chain-barding)
;	(research ri-plate-barding)
)
(defrule
(or	(and	(goal strategy castledrop)
		(strategic-number sn-current-age >= fcastlea))
	(and	(goal uugoal yes)
		(strategic-number sn-current-age >= imperial)))
	(building-type-count castle >= 1); -total
	(up-compare-const uu-type == cavalry-uu)
(or	(can-research ri-scale-barding)
;(or
	(can-research ri-chain-barding)
;	(can-research ri-plate-barding))
)
=>
	(research ri-scale-barding)
	(research ri-chain-barding)
;	(research ri-plate-barding)
)
(defrule
(or	(and	(goal strategy castledrop)
		(strategic-number sn-current-age >= fcastlea))
	(and	(goal uugoal yes)
		(strategic-number sn-current-age >= imperial)))
	(building-type-count castle >= 1); -total
	(up-compare-const uu-type == archer-uu)
(or	(can-research ri-fletching)
;(or
	(can-research ri-bodkin-arrow)
;	(can-research ri-bracer))
)
=>
	(research ri-fletching)
	(research ri-bodkin-arrow)
;	(research ri-bracer)
)
(defrule
	(strategic-number sn-current-age >= imperial)
(or	(goal champgoal yes)
	(goal strategy stonewall))
	(building-type-count barracks >= 1); -total
(or	(can-research ri-scale-mail)
;(or
	(can-research ri-chain-mail)
;	(can-research ri-plate-mail))
)
=>
	(research ri-scale-mail)
	(research ri-chain-mail)
;	(research ri-plate-mail)
)
(defrule
(or	(and	(goal strategy castledrop)
		(strategic-number sn-current-age >= fcastlea))
	(and	(goal uugoal yes)
		(strategic-number sn-current-age >= imperial)))
	(building-type-count castle >= 1); -total
	(up-compare-const uu-type == infantry-uu)
(or	(can-research ri-scale-mail)
;(or
	(can-research ri-chain-mail)
;	(can-research ri-plate-mail))
)
=>
	(research ri-scale-mail)
	(research ri-chain-mail)
;	(research ri-plate-mail)
)
#load-if-not-defined BOHEMIANS-CIV
#load-if-not-defined KHMER-CIV
#load-if-not-defined PORTUGUESE-CIV
(defrule
(or	(and	(goal strategy castledrop)
		(strategic-number sn-current-age >= castlea)); fcastlea
	(and	(goal uugoal yes)
		(strategic-number sn-current-age >= cimperial)))
	(building-type-count castle >= 1); -total
	(up-compare-const uu-type == powder-uu)
;(or
	(can-research ri-padded-archer-armor)
;(or
;	(can-research ri-leather-archer-armor)
;	(can-research ri-ring-archer-armor))
;)
=>
	(research ri-padded-archer-armor)
;	(research ri-leather-archer-armor)
;	(research ri-ring-archer-armor)
)
#end-if
#end-if
#end-if

#end-if
#end-if
#end-if; diffs
#else; wonder race
(defrule
	(strategic-number sn-current-age >= imperial)
	(can-research ri-treadmill-crane)
=>
	(research ri-treadmill-crane))
#end-if
#load-if-defined UP-GAME-WK
(defrule
	(true)
=>
	(up-get-fact unit-type-count-total steppe-lancer steppe-lancer-set)
	(up-get-fact unit-type-count-total elite-steppe-lancer temporary-goal)
	(up-modify-goal temporary-goal c:max 0)
	(up-modify-goal steppe-lancer-set g:+ temporary-goal))
(defrule
	(can-research ri-cartography)
=>
	(research ri-cartography))
(defrule
	(up-research-status c: ri-sanctity >= research-pending)
	(unit-type-count-total monastery-class >= 9)
	(up-compare-goal excessGold >= 200)
	(can-research ri-fervor)
=>
	(research ri-fervor))
(defrule
	(unit-type-count-total fishing-ship >= 5)
(or	(goal dreitc yes)
	(up-compare-goal total-food-amount < 300))
(or	(strategic-number sn-military-superiority >= 1)
(or	(up-compare-goal navycount >= 7)
	(goal enemy-boats no)))
	(can-research ri-gillnets)
=>
	(research ri-gillnets))
(defrule
	(up-research-status c: ri-eagle-warrior <= research-available)
	(unit-type-count-total eagle-warrior-line >= 5)
	(can-afford-research ri-eagle-warrior)
	(strategic-number sn-enable-training-queue != 0)
(or	(goal traineagle yes)
(or	(goal trainchamp yes)
(or	(goal trainpike yes)
	(goal traincondottiero yes))))
=>
	(set-strategic-number sn-enable-training-queue 0))
(defrule
(or	(and	(or	(up-compare-goal strategy == stonewall)
				(or	(and	(goal traineagle yes)
						(unit-type-count-total eagle-warrior-line >= 1))
					(unit-type-count-total eagle-warrior-line >= 3)))
		(strategic-number sn-current-age >= imperial))
	(unit-type-count-total eagle-warrior-line >= 5))
	(can-research ri-eagle-warrior)
=>
	(research ri-eagle-warrior))
(defrule
(or	(and	(goal traineagle yes)
		(and	(strategic-number sn-current-age >= imperial)
			(up-compare-goal excessGold >= 500)))
	(and	(up-compare-goal excessFood >= 2000)
		(up-compare-goal excessGold >= 5000)))
	(can-research ri-eagle-warrior)
=>
	(research ri-eagle-warrior))
(defrule
(or	(unit-type-count-total genoese-crossbowman >= 4)
(or	(unit-type-count-total kamayuk >= 4)
(or	(unit-type-count-total magyar-huszar >= 4)
(or	(unit-type-count-total elephant-archer >= 4)
(or	(unit-type-count-total boyar >= 4)
(or	(unit-type-count-total organ-gun >= 4)
	(unit-type-count-total gbeto >= 4)))))))
	(can-research my-unique-unit-upgrade)
=>
	(research my-unique-unit-upgrade))
(defrule
(or	(unit-type-count-total shotel-warrior >= 4)
(or	(unit-type-count-total camel-archer >= 4)
(or	(unit-type-count-total rattan-archer >= 4)
(or	(unit-type-count-total ballista-elephant >= 4)
(or	(unit-type-count-total arambai >= 4)
	(unit-type-count-total karambit-warrior >= 4))))))
	(can-research my-unique-unit-upgrade)
=>
	(research my-unique-unit-upgrade))
(defrule
	(strategic-number sn-current-age < imperial)
	(up-compare-goal attacking != yes)
=>
	(up-jump-rule 1))
(defrule
	(unit-type-count-total infantry-class >= 12)
(or	(unit-type-count-total infantry-class >= 24)
	(population >= del-civ-pop))
	(up-research-status c: ri-chain-mail >= research-pending)
(or	(up-research-status c: ri-blast-furnace >= research-pending)
(or	(up-research-status c: ri-plate-mail >= research-pending)
(or	(goal champgoal yes)
	(and	(up-compare-goal uugoal == yes)
		(up-compare-const uu-type == infantry-uu)))))
	(can-research ri-arson)
=>
	(research ri-arson))
(defrule
	(building-type-count watch-tower-building <= 0)
	(building-type-count guard-tower <= 0)
	(building-type-count keep <= 0)
	(building-type-count watch-tower-line <= 0)
=>
	(up-jump-rule 3))
(defrule
	(building-type-count-total watch-tower-building >= 2)
(or	(cc-players-unit-type-count my-player-number 504 >= 1)
(or	(cc-players-unit-type-count my-player-number 505 >= 1)
(or	(cc-players-unit-type-count my-player-number 517 >= 1)
	(cc-players-unit-type-count my-player-number 518 >= 1))))
(or	(up-research-status c: ri-guard-tower >= research-pending)
	(building-type-count-total watch-tower-building >= 4))
	(can-research ri-arrowslits)
=>
	(research ri-arrowslits))
(defrule
(or	(goal strategy trush)
(or	(goal defend yes)
(or	(goal underattack yes)
	(town-under-attack))))
(or	(goal strategy trush)
(or	(up-research-status c: ri-guard-tower >= research-pending)
	(and	(strategic-number sn-current-age >= imperial)
		(population >= max-pop))))
	(can-research ri-arrowslits)
=>
	(research ri-arrowslits))
(defrule
(or	(up-research-status c: ri-great-wall >= research-pending)
(or	(up-research-status c: ri-keep >= research-pending)
(or	(up-research-status c: ri-stronghold >= research-pending)
(or	(up-research-status c: ri-yasama >= research-pending)
	(up-research-status c: ri-yeomen >= research-pending)))))
	(can-research ri-arrowslits)
=>
	(research ri-arrowslits)); end jump
#end-if

